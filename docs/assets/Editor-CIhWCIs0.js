import{r as a,j as e,I as ie,B as R,u as he,c as ae,v as ge,s as A,L as me,H as fe,S as pe,M as xe,t as je,C as ye,A as Se,i as be,f as ke,p as le,a as ve,b as we,d as re,e as Ce,g as Ne,P as oe,T as ue,h as Ee,k as Te,l as ce,m as Ie,n as Re,o as Me,q as Pe,w as $e,K as G,x as _e,y as Ae}from"./index-D6bt0bvq.js";import{R as Fe}from"./AdminResources-3y6kdnpN.js";import"./markdown-C16qQ7Y6.js";const qe="10401040",de=`{title: }
{key: }
{authors: }
{country: }
{tags: }
{youtube: }
{mp3: }

`;function Ve(){const[c,d]=a.useState(()=>{try{return localStorage.getItem("editor:author")||""}catch{return""}}),[h,r]=a.useState(""),[i,y]=a.useState(!1),[k,g]=a.useState("");a.useEffect(()=>{try{localStorage.setItem("editor:author",c||"")}catch{}},[c]);function E(f){if(f.preventDefault(),g(""),!c.trim()){g("Author name is required.");return}h===qe?y(!0):g("Invalid password.")}return i?e.jsx(Le,{authorName:c.trim()}):e.jsxs("div",{className:"container",style:{maxWidth:520},children:[e.jsx("h1",{children:"GraceChords Editor"}),e.jsx("p",{children:"Enter your author name and password to continue."}),e.jsxs("form",{onSubmit:E,className:"card",style:{display:"grid",gap:10,padding:16},children:[e.jsxs("label",{children:["Author name",e.jsx(ie,{value:c,onChange:f=>d(f.target.value),placeholder:"Your name",required:!0})]}),e.jsxs("label",{children:["Password",e.jsx(ie,{type:"password",value:h,onChange:f=>r(f.target.value),placeholder:"Password",required:!0})]}),k?e.jsx("div",{className:"alert error Small",children:k}):null,e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",gap:8},children:e.jsx(R,{variant:"primary",type:"submit",children:"Enter"})})]})]})}function Le({authorName:c}){const[d]=he(),[h,r]=a.useState(()=>{const l=d.get("tab");return l==="posts"||l==="resources"?"posts":"songs"}),[i,y]=a.useState(()=>{try{const l=sessionStorage.getItem("editor:staged");return l?JSON.parse(l):[]}catch{return[]}});a.useEffect(()=>{try{i.length?sessionStorage.setItem("editor:staged",JSON.stringify(i)):sessionStorage.removeItem("editor:staged")}catch{}},[i]);const[k,g]=a.useState(!1),[E,f]=a.useState(!1),[v,p]=a.useState("main"),[M,S]=a.useState(null),[P,$]=a.useState(!1),[F,q]=a.useState(""),[C,N]=a.useState(""),[W,H]=a.useState(!1),[,z]=a.useState(0),K=ae&&typeof ae=="function"?ae()==="dark":!1,V=d.get("song"),_=d.get("resource"),L=d.get("newSong"),B=d.get("newResource"),T=d.get("tab");a.useEffect(()=>{T==="posts"||T==="resources"?r("posts"):T==="songs"?r("songs"):(_||B)&&r("posts")},[T,_,B]),a.useEffect(()=>{const l=localStorage.getItem("ghToken");l?(q(l),I(l,{silent:!0})):$(!0)},[]);function Y(l){l?.length&&y(b=>[...b,...l])}function Q(l){l?.length&&y(b=>[...b,...l])}function ee(l){y(b=>b.filter((D,j)=>j!==l))}function te(){y([])}async function I(l,{silent:b=!1}={}){const D=(l||"").trim();if(!D){N("Token cannot be empty");return}H(!0),N("");try{localStorage.setItem("ghToken",D);const j=await ge();if(S(j),!b){const t=`GitHub token OK: ${j.login}`;typeof A=="function"?A(t):alert(t)}$(!1),q("")}catch(j){localStorage.removeItem("ghToken"),S(null),N(j?.message||String(j)),$(!0)}finally{H(!1)}}function O(){if(!localStorage.getItem("ghToken")){q(""),N(""),$(!0);return}J()}async function J(){if(!i.length){A?.("Stage at least one change first.")??alert("Stage at least one change first.");return}if(!c){A?.("Author name required to open a PR.")??alert("Author name required to open a PR.");return}try{const{default_branch:l}=await ce({owner:"rwm6857",repo:"GraceChords"});p(l||"main"),g(!0)}catch(l){A?.(String(l.message||l))??alert(String(l.message||l))}}async function se({branchName:l,prTitle:b,prBody:D}){f(!0);try{const j="rwm6857",t="GraceChords",{sha:s}=await ce({owner:j,repo:t});await Ie({owner:j,repo:t,fromSha:s,newBranch:l});for(const n of i){if(n.action==="delete-request")continue;const x=`${n.kind==="song"?"public/songs":"public/resources"}/${n.filename}`,m=await Re({owner:j,repo:t,path:x,ref:l}),w=n.action==="add"?`add: ${n.filename}`:`update: ${n.filename}`;await Me({owner:j,repo:t,branch:l,path:x,contentBase64:Pe(n.content||""),message:w,sha:m})}const o=await $e({owner:j,repo:t,head:l,base:v,title:b,body:D});try{sessionStorage.removeItem("editor:staged")}catch{}y([]),g(!1),window.open(o.html_url,"_blank","noopener")}catch(j){throw A?.(String(j.message||j))??alert(String(j.message||j)),j}finally{f(!1)}}return e.jsx("div",{className:"gc-editor-page",children:e.jsxs("div",{className:"container gc-editor",children:[e.jsx(Ge,{}),e.jsxs("header",{className:"gc-editor__header",children:[e.jsxs("div",{className:"gc-editor__title",children:[e.jsx("h1",{children:"GraceChords Editor"}),e.jsxs("span",{className:"gc-editor__author",children:["Author: ",c,e.jsxs("span",{style:{marginLeft:8,display:"inline-flex",alignItems:"center",gap:4},children:["Token ",M?e.jsx("span",{title:`Token OK: ${M.login}`,style:{color:"var(--primary)"},children:"âœ”"}):e.jsx("span",{title:"Token missing or invalid",style:{color:"#ef4444"},children:"âœ˜"})]})]})]}),e.jsxs("nav",{className:"gc-editor__tabs","aria-label":"Editor tabs",children:[e.jsx("button",{className:`gc-editor__tab ${h==="songs"?"is-active":""}`,onClick:()=>r("songs"),children:"ðŸŽµ Song Editor"}),e.jsx("button",{className:`gc-editor__tab ${h==="posts"?"is-active":""}`,onClick:()=>r("posts"),children:"ðŸ“„ Post Editor"})]}),e.jsxs("div",{className:"gc-editor__actions",children:[e.jsx(me,{to:"/",className:"gc-editor__iconbtn",title:"Back to home","aria-label":"Back to home",children:e.jsx(fe,{size:18})}),e.jsx("button",{className:"gc-editor__iconbtn","aria-label":"Toggle theme",onClick:()=>{je(),z(l=>l+1)},title:K?"Switch to light mode":"Switch to dark mode",children:K?e.jsx(pe,{size:18}):e.jsx(xe,{size:18})})]})]}),e.jsxs("div",{className:"gc-editor-shell",children:[h==="songs"?e.jsx(Be,{onStageSong:Y,prefill:V?{kind:"existing",id:V}:L?{kind:"new"}:null}):e.jsx(De,{onStagePost:Q,prefill:_?{kind:"existing",slug:_}:B?{kind:"new"}:null}),e.jsxs("section",{className:"gc-editor-panel gc-editor-panel--staged gc-staged-card",children:[e.jsxs("div",{className:"Row",style:{alignItems:"center",gap:8},children:[e.jsxs("h3",{style:{margin:0},children:["Staged changes ",e.jsxs("span",{className:"Small",children:["(",i.length,")"]})]}),e.jsx("div",{className:"spacer"}),e.jsx(R,{onClick:te,disabled:!i.length,children:"Clear all"}),e.jsxs(R,{variant:"primary",onClick:O,disabled:!i.length,children:[e.jsx(ye,{})," Open PR"]})]}),e.jsx("div",{style:{width:"100%",marginTop:8,overflow:"auto"},children:e.jsxs("table",{className:"Table Small",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Kind"}),e.jsx("th",{children:"Action"}),e.jsx("th",{children:"Title"}),e.jsx("th",{children:"Filename"}),e.jsx("th",{children:"Details"}),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[i.map((l,b)=>e.jsxs("tr",{children:[e.jsx("td",{children:l.kind}),e.jsx("td",{children:l.action}),e.jsx("td",{children:l.title}),e.jsx("td",{children:e.jsx("code",{children:l.filename})}),e.jsx("td",{children:l.changeSummary||l.deleteReason||""}),e.jsx("td",{children:e.jsx("button",{className:"btn small",onClick:()=>ee(b),children:"Remove"})})]},`${l.filename}-${b}`)),!i.length&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"Small",style:{textAlign:"center",padding:12},children:"Nothing staged yet."})})]})]})})]})]}),i.length>0&&e.jsxs("button",{className:"gc-staged-floating",onClick:O,children:["Staged: ",i.length," â€“ Review / Open PR"]}),e.jsx(Se,{open:k,onClose:()=>g(!1),defaultBranch:v,staged:i,authorName:c,onCreate:se,busy:E}),e.jsx(Ue,{open:P,tokenInput:F,setTokenInput:q,tokenError:C,validating:W,onSubmit:I,onClose:()=>{$(!1),N("")}})]})})}function Be({onStageSong:c,prefill:d}){const[h,r]=a.useState(de),[i,y]=a.useState({});a.useEffect(()=>{y(Z(h))},[h]);const k=a.useRef(null),[g,E]=a.useState(()=>{try{return localStorage.getItem("editor:showPreview")!=="0"}catch{return!0}});a.useEffect(()=>{try{localStorage.setItem("editor:showPreview",g?"1":"0")}catch{}},[g]);const f=a.useMemo(()=>{const t=be?.items||[],s=new Set,o=[];for(const n of t)s.has(n.id)||(s.add(n.id),o.push(n));return o},[]),[v,p]=a.useState(""),[M,S]=a.useState(null),[P,$]=a.useState(""),[F,q]=a.useState(""),[C,N]=a.useState(-1),[W,H]=a.useState(!1),[z,K]=a.useState(""),[V,_]=a.useState(!1);a.useEffect(()=>{_(!1)},[d?.id,d?.kind]);const L=a.useMemo(()=>{const t=F.trim().toLowerCase();return t?f.filter(s=>{const o=String(s.title||"").toLowerCase(),n=(s.tags||[]).map(x=>String(x).toLowerCase()).join(" "),u=(s.authors||[]).map(x=>String(x).toLowerCase()).join(" ");return o.includes(t)||n.includes(t)||u.includes(t)}).slice(0,12):[]},[f,F]);a.useEffect(()=>{N(-1)},[F]),a.useEffect(()=>{if(V||!d)return;const t=d.kind,s=d.id;if(t==="existing"&&s){const o=f.find(n=>String(n.id)===String(s)||n.filename===s||n.filename?.replace(/\.chordpro$/,"")===String(s));if(o){B(o),_(!0);return}_(!0);return}t==="new"&&(T(),_(!0))},[d,V,f]);async function B(t){if(t)try{const o=`${"./".replace(/\/+$/,"")+"/"}songs/${t.filename}`,n=await ke(o);if(n){r(n);const u=Z(n),x=J(n,u,t.filename);p(t.filename),S(u),$(x?.content||""),q(""),N(-1)}}catch(s){console.error(s),alert(`Failed to load ${t.filename}`)}}function T(){p(""),S(null),$(""),r(de)}function Y(t){const s=k.current;if(!s){r(u=>(u||"")+t);return}const o=s.selectionStart??0,n=s.selectionEnd??o;r(u=>{const x=u.slice(0,o),m=u.slice(n);return x+t+m}),setTimeout(()=>{try{s.focus();const u=o+t.length;s.setSelectionRange(u,u)}catch{}},0)}function Q(t){const s={Verse:{start:`{sov Verse}
`,end:`{eov}
`},Chorus:{start:`{soc Chorus}
`,end:`{eoc}
`},Bridge:{start:`{sob Bridge}
`,end:`{eob}
`}}[t]||{start:`{start_of_${t.toLowerCase()}}:
`,end:`{end_of_${t.toLowerCase()}}
`},o=k.current;if(!o){r(m=>(m||"")+s.start+s.end);return}const n=o.selectionStart??0,u=o.selectionEnd??n,x=u>n;r(m=>{const w=m.slice(0,n),ne=x?m.slice(n,u):"",X=m.slice(u);return w+s.start+ne+s.end+X}),setTimeout(()=>{try{o.focus();const m=n+s.start.length,w=m+(x?u-n:0);o.setSelectionRange(m,w||m)}catch{}},0)}function ee(t){const s=[0,2,4,5,7,9],o=new Set([1,2,5]),n=String(t||"").toUpperCase(),u=G.indexOf(n),x=u>=0?u:G.indexOf("G"),m=[];for(let w=0;w<s.length;w++){const ne=(x+s[w])%G.length,X=G[ne];m.push(o.has(w)?`${X}m`:X)}return m}function te(t){const s=String(t).trim();if(!s)return"G";const o=/^([A-Ga-g][#b]?)(m|min)?$/i.exec(s);if(!o)return"G";const n=_e(o[1]),u=G.indexOf(n);if(u<0)return"G";const m=!!o[2]?(u+3)%G.length:u;return G[m]}const I=a.useMemo(()=>{try{const t=le(h||""),s=(t.sections||[]).map(o=>({section:o.label,lines:(o.lines||[]).map(n=>({text:n.instrumental?"":n.comment||n.lyrics||"",chords:n.instrumental?[]:n.chords||[],comment:!!n.comment,instrumental:n.instrumental||null}))}));return{meta:t.meta,blocks:s}}catch{return{meta:{},blocks:[]}}},[h]),O=a.useMemo(()=>ee(te(i.key||"G")),[i.key]);a.useEffect(()=>{function t(s){if(W||!s.altKey)return;const o=s.key;if(!/^([1-6])$/.test(o))return;const n=parseInt(o,10)-1,u=O[n];u&&(s.preventDefault(),Y(`[${u}]`))}return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[O,W]);function J(t=h,s=i,o=v){try{const{text:n,docTitle:u,docKey:x}=ve(t,{country:s.country||"",tags:s.tags||"",youtube:s.youtube||"",mp3:s.mp3||"",added:s.added||""}),m=o||we(u),w=re(n);return{filename:m,title:u||s.title||"Untitled",content:w,key:x||s.key||""}}catch{}try{const n=le(t);n.meta.title=s.title||n.meta.title||"",n.meta.key=s.key||n.meta.key||"",n.meta.meta={...n.meta.meta||{},authors:s.authors||n.meta.meta?.authors||"",country:s.country||n.meta.meta?.country||"",tags:s.tags||n.meta.meta?.tags||"",youtube:s.youtube||n.meta.meta?.youtube||"",mp3:s.mp3||n.meta.meta?.mp3||""};let u=Ce(n,{useDirectives:!0});u=re(u);const x=Ne(s.id||n.meta.title||"untitled");return{filename:o||`${x}.chordpro`,title:n.meta.title||"Untitled",content:u,key:n.meta.key||""}}catch(n){return console.error(n),null}}const se=(h||"").replace(/\s+/g,"").replace(/\{[^}]*\}/g,""),l=!!((i.title||"").trim()||se),b=!!v;function D(){let t=h;if(!b&&!Z(t).added){const w=new Date().toISOString();t=U(t,"added",w),r(t)}const s=J(t,Z(t),v);if(!s)return;if(!b){c([{kind:"song",action:"add",title:s.title,filename:s.filename,content:s.content}]),T();return}const o=[];(i.title||"").trim()!==(M?.title||"").trim()&&o.push("Title"),["authors","tags","key","country","youtube"].some(m=>(i[m]||"").trim()!==(M?.[m]||"").trim())&&o.push("Metadata"),(s.content||"")!==(P||"")&&o.push("Content");const x=o.length?o.join(" + "):"Minor edit";c([{kind:"song",action:"edit",title:s.title,filename:v,content:s.content,changeSummary:x}]),T()}function j(t){v&&(c([{kind:"song",action:"delete-request",title:i.title||"Untitled",filename:v,deleteReason:t}]),K(""),H(!1),T())}return e.jsxs("div",{className:"gc-song-editor",children:[e.jsx("section",{className:"gc-editor-panel gc-editor-panel--selector",children:e.jsxs("div",{className:"gc-song-selector",children:[e.jsx(R,{onClick:T,iconLeft:e.jsx(oe,{}),children:"New Song"}),e.jsxs("div",{className:"gc-song-selector__search",children:[e.jsx("input",{type:"search",placeholder:"Search existing songsâ€¦",value:F,onChange:t=>q(t.target.value),onKeyDown:t=>{if(L.length)if(t.key==="ArrowDown")t.preventDefault(),N(s=>Math.min(s+1,L.length-1));else if(t.key==="ArrowUp")t.preventDefault(),N(s=>Math.max(s-1,0));else if(t.key==="Enter"){t.preventDefault();const s=C>=0?L[C]:L[0];B(s)}else t.key==="Escape"&&N(-1)}}),L.length>0&&e.jsx("ul",{className:"gc-song-selector__results",children:L.map((t,s)=>e.jsx("li",{className:C===s?"is-active":"",onMouseEnter:()=>N(s),onMouseDown:()=>B(t),children:t.title},t.id))})]}),v?e.jsxs("span",{className:"badge",style:{background:"#fde68a",color:"#92400e"},children:["Editing ",v]}):e.jsx("span",{className:"badge",style:{background:"#d1fae5",color:"#065f46"},children:"New song"})]})}),e.jsxs("section",{className:"gc-editor-panel gc-editor-panel--meta",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginTop:12},children:[e.jsxs("label",{children:["Title",e.jsx("input",{value:i.title||"",onChange:t=>r(s=>U(s,"title",t.target.value))})]}),e.jsxs("label",{children:["Original Key",e.jsx("input",{value:i.key||"",onChange:t=>r(s=>U(s,"key",t.target.value)),placeholder:"e.g., C, Am, Dm, F#m"})]}),e.jsxs("label",{children:["Authors",e.jsx("input",{value:i.authors||"",onChange:t=>r(s=>U(s,"authors",t.target.value))})]}),e.jsxs("label",{children:["Country",e.jsx("input",{value:i.country||"",onChange:t=>r(s=>U(s,"country",t.target.value))})]}),e.jsxs("label",{children:["Tags",e.jsx("input",{value:i.tags||"",onChange:t=>r(s=>U(s,"tags",t.target.value)),placeholder:"Fast, Slow, Hymn, Holiday"})]}),e.jsxs("label",{children:["YouTube (ID or URL)",e.jsx("input",{value:i.youtube||"",onChange:t=>r(s=>U(s,"youtube",t.target.value)),placeholder:"e.g. dQw4w9WgXcQ or https://youtu.be/..."})]})]}),e.jsxs("section",{className:"gc-editor-panel gc-editor-panel--body",style:{marginTop:12},children:[e.jsxs("div",{className:"gc-editor-toolbar",children:[e.jsxs("div",{className:"gc-quick-row",children:[e.jsx("strong",{children:"Quick Chords"}),O.map((t,s)=>e.jsx("button",{className:"gc-btn gc-btn--sm",onClick:()=>Y(`[${t}]`),title:`Insert [${t}] (Alt+${s+1})`,children:t},t))]}),e.jsxs("div",{className:"gc-quick-sections",children:[e.jsx("strong",{children:"Quick Sections"}),e.jsx("button",{className:"gc-btn gc-btn--sm",onClick:()=>Q("Verse"),children:"Verse"}),e.jsx("button",{className:"gc-btn gc-btn--sm",onClick:()=>Q("Chorus"),children:"Chorus"}),e.jsx("button",{className:"gc-btn gc-btn--sm",onClick:()=>Q("Bridge"),children:"Bridge"})]}),e.jsxs("label",{className:"gc-preview-toggle",children:[e.jsx("input",{type:"checkbox",checked:g,onChange:t=>E(t.target.checked)})," Preview"]})]}),e.jsxs("div",{className:`gc-editor-split ${g?"":"is-single"}`,children:[e.jsx("div",{className:"gc-editor-pane gc-editor-pane--input",children:e.jsx("textarea",{ref:k,value:h,onChange:t=>r(t.target.value),style:{width:"100%",minHeight:"70vh",height:"70vh",fontFamily:'"Roboto Mono", ui-monospace, Menlo, Consolas, monospace'}})}),g&&e.jsxs("div",{className:"gc-editor-pane gc-editor-pane--preview",children:[e.jsxs("div",{className:"Small",style:{marginBottom:8,fontFamily:'"Roboto Mono", ui-monospace, Menlo, Consolas, monospace'},children:[I?.meta?.title?e.jsx("div",{style:{fontWeight:700},children:I.meta.title}):null,I?.meta?.key||I?.meta?.originalkey?e.jsxs("div",{style:{fontStyle:"italic"},children:["Key of ",I.meta.key||I.meta.originalkey]}):null]}),e.jsx("div",{style:{marginTop:8},children:(I.blocks||[]).map((t,s)=>e.jsxs("div",{children:[e.jsx("div",{className:"section",children:t.section||""}),(t.lines||[]).map((o,n)=>o.instrumental?e.jsx(He,{spec:o.instrumental},`${s}-${n}`):e.jsx(Ke,{plain:o.text,chords:o.chords||[],comment:o.comment},`${s}-${n}`))]},s))})]})]}),e.jsxs("div",{className:"gc-stage-actions",children:[e.jsx(R,{variant:"primary",onClick:D,disabled:!l,children:"Add Changes"}),b&&e.jsx(R,{onClick:()=>H(!0),iconLeft:e.jsx(ue,{}),children:"Request Deletion"}),e.jsx("span",{className:"Small",style:{marginLeft:"auto"},children:"Files save as .chordpro"})]})]}),W&&e.jsx("div",{className:"modal",children:e.jsxs("div",{className:"modal-body",children:[e.jsx("h3",{children:"Request Deletion"}),e.jsxs("label",{children:["Why should this song be removed?",e.jsx("textarea",{rows:3,value:z,onChange:t=>K(t.target.value),placeholder:"Reason for deletion"})]}),e.jsxs("div",{className:"Row",style:{justifyContent:"flex-end",gap:8},children:[e.jsx("button",{className:"btn",onClick:()=>{H(!1),K("")},children:"Cancel"}),e.jsx("button",{className:"btn primary",onClick:()=>j(z),disabled:!z.trim(),children:"Submit request"})]})]})})]})}function De({onStagePost:c,prefill:d}){const[h,r]=a.useState(null),[i,y]=a.useState(""),[k,g]=a.useState("");function E(p){if(p){if(p.isExisting){A?.("Use Stage Edit for existing posts.")??alert("Use Stage Edit for existing posts.");return}c([{kind:"post",action:"add",title:p.meta?.title||"Untitled",filename:p.filename,content:p.content}])}}function f(p){if(!p?.isExisting){A?.("Load an existing post to stage an edit.")??alert("Load an existing post to stage an edit.");return}c([{kind:"post",action:"edit",title:p.meta?.title||"Untitled",filename:p.filename,content:p.content,changeSummary:i||""}])}function v(p){if(!p?.isExisting){A?.("Load an existing post to request deletion.")??alert("Load an existing post to request deletion.");return}c([{kind:"post",action:"delete-request",title:p.meta?.title||"Untitled",filename:p.filename,deleteReason:k||""}])}return e.jsx(Fe,{heading:"Posts",showGhTools:!1,wrapInContainer:!1,panelize:!0,prefill:d,onDraftChange:r,actions:({draft:p,newPost:M})=>{const S=p||h;return e.jsxs(Ee,{style:{position:"sticky",bottom:0,marginTop:12,display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsxs(R,{onClick:M,children:[e.jsx(oe,{})," New"]}),e.jsxs(R,{onClick:()=>E(S),disabled:!S,children:[e.jsx(oe,{})," Stage Add"]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,minWidth:0},children:[e.jsxs("label",{className:"Small",style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("span",{children:"Filename"}),e.jsx("input",{readOnly:!0,value:S?.filename||"",style:{width:240},placeholder:"slug.md"})]}),S?.isExisting?e.jsx("span",{className:"badge",style:{background:"#fde68a",color:"#92400e"},title:"Editing existing file",children:"Editing"}):e.jsx("span",{className:"badge",style:{background:"#d1fae5",color:"#065f46"},title:"New file will be created",children:"New"})]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[e.jsxs("label",{className:"Small",style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("span",{children:"What changed?"}),e.jsx("input",{value:i,onChange:P=>y(P.target.value),placeholder:"Content, tagsâ€¦",disabled:!S?.isExisting})]}),e.jsxs(R,{className:"gc-btn gc-btn--primary",onClick:()=>f(S),disabled:!S?.isExisting,children:[e.jsx(Te,{})," Stage Edit"]}),e.jsxs("label",{className:"Small",style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("span",{children:"Removal reason"}),e.jsx("input",{value:k,onChange:P=>g(P.target.value),placeholder:"Why remove this post?",disabled:!S?.isExisting})]}),e.jsxs(R,{className:"gc-btn gc-btn--primary",onClick:()=>v(S),disabled:!S?.isExisting,children:[e.jsx(ue,{})," Stage Deletion"]})]})]})}})}function Ge(){const[c,d]=a.useState(!1);return a.useEffect(()=>{if(!c)return;function h(r){r.key==="Escape"&&d(!1)}return window.addEventListener("keydown",h),()=>window.removeEventListener("keydown",h)},[c]),e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"gc-editor-help-tab",onClick:()=>d(h=>!h),"aria-expanded":c,"aria-label":"Open editor help",children:" Editor Help "}),c&&e.jsxs("div",{className:"gc-editor-help-drawer",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[e.jsx("strong",{children:"Editor Help"}),e.jsx("button",{className:"btn small",onClick:()=>d(!1),"aria-label":"Close help",children:"âœ•"})]}),e.jsxs("div",{className:"gc-help__content Small",style:{marginTop:8},children:[e.jsx("h3",{children:"Editor basics"}),e.jsx("p",{children:"Fill metadata (title, key, authors, country, tags, YouTube). Use quick chords and quick sections to speed up typing."}),e.jsx("p",{children:"New Song + search lets you start fresh or load an existing song to edit."}),e.jsx("h3",{children:"ChordPro tips"}),e.jsxs("p",{children:["Place chords in square brackets like ",e.jsx("code",{children:"[G]"}),". Section headers use short codes such as ",e.jsx("code",{children:"{sov Verse}"})," â€¦ ",e.jsx("code",{children:"{eov}"}),"."]}),e.jsx("pre",{className:"Small",style:{whiteSpace:"pre-wrap"},children:`{title: Example}
{key: G}
{sov Verse}
[G]Amazing [C]grace
{eov}`}),e.jsx("h3",{children:"Staging & PRs"}),e.jsx("p",{children:"â€œAdd Changesâ€ stages the current song (new or edited) for the PR. Deletion requests log a reason without deleting files."}),e.jsx("p",{children:"Use the staged table or floating pill to review and open the PR; a maintainer will review and merge."})]})]})]})}function Ue({open:c,tokenInput:d,setTokenInput:h,tokenError:r,validating:i,onSubmit:y,onClose:k}){return c?e.jsx("div",{className:"modal",children:e.jsxs("div",{className:"modal-body",children:[e.jsx("h3",{children:"GitHub token required"}),e.jsx("p",{className:"Small",style:{opacity:.85},children:"Paste a GitHub personal access token (repo scope) to send changes as a pull request. It is stored only in this browser."}),e.jsxs("label",{children:["Token",e.jsx("input",{type:"password",value:d,onChange:g=>h(g.target.value),placeholder:"ghp_...",autoFocus:!0})]}),r?e.jsx("div",{className:"alert error Small",children:r}):null,e.jsxs("div",{className:"Row",style:{justifyContent:"flex-end",gap:8},children:[e.jsx("button",{className:"btn",onClick:k,disabled:i,children:"Cancel"}),e.jsx("button",{className:"btn primary",onClick:()=>y(d),disabled:i,children:i?"Validatingâ€¦":"Save token"})]})]})}):null}function He({spec:c}){const d=Ae(c||{},{split:!1});return d.length?e.jsx("div",{style:{marginBottom:10},children:d.map((h,r)=>e.jsx("div",{style:{whiteSpace:"pre",fontFamily:"'Fira Mono', ui-monospace, SFMono-Regular, Menlo, Consolas, monospace",fontWeight:700,fontSize:"inherit",lineHeight:1.35},children:h},r))}):null}function Ke({plain:c,chords:d,comment:h}){if(h)return e.jsx("div",{className:"comment",children:c});const r=a.useRef(null),i=a.useRef(null),[y,k]=a.useState({offsets:[],padTop:0,chordTop:0});return a.useEffect(()=>{if(!r.current)return;if(!i.current){const C=document.createElement("canvas");C.width=1,C.height=1,i.current=C}const g=i.current.getContext("2d"),E=r.current.querySelector(".lyrics"),f=window.getComputedStyle(E);g.font=`${f.fontStyle} ${f.fontWeight} ${f.fontSize} ${f.fontFamily}`;const v=(d||[]).map(C=>({left:g.measureText(c.slice(0,C.index)).width,sym:C.sym})),p="'Fira Mono', ui-monospace, SFMono-Regular, Menlo, Consolas, monospace",M=f.fontSize;g.font=`${f.fontStyle} 700 ${M} ${p}`;const P=g.measureText("Mg").actualBoundingBoxAscent||parseFloat(f.fontSize)*.8,F=Math.ceil(P+2);k({offsets:v,padTop:F,chordTop:0})},[c,d]),e.jsxs("div",{ref:r,style:{position:"relative",marginBottom:10,paddingTop:y.padTop},children:[y.offsets.length>0&&e.jsx("div",{"aria-hidden":!0,className:"chord-layer",style:{position:"absolute",left:0,right:0,top:y.chordTop},children:y.offsets.map((g,E)=>e.jsx("span",{style:{position:"absolute",left:`${g.left}px`,fontFamily:"'Fira Mono', ui-monospace, SFMono-Regular, Menlo, Consolas, monospace",fontWeight:700},children:g.sym},E))}),e.jsx("div",{className:"lyrics",children:c})]})}function U(c,d,h){const r=new RegExp(`\\{\\s*${d}\\s*:[^}]*\\}`,"i");return r.test(c)?c.replace(r,`{${d}: ${h}}`):/\{\s*title\s*:[^}]*\}/i.test(c)?c.replace(/\{\s*title\s*:[^}]*\}\s*/,i=>i+`
{${d}: ${h}}
`):`{${d}: ${h}}
`+c}function Z(c){const d={},h=/^\{\s*([^:}]+)\s*:\s*([^}]*)\s*\}\s*$/gm;let r;for(;r=h.exec(c);){const i=r[1].trim().toLowerCase(),y=r[2];d[i]=y}return d}export{Ve as default};
