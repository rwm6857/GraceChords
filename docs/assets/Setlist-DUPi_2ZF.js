const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jszip.min-Brab4LeI.js","assets/index-DegWZp5h.js","assets/index-BLBeZ3GQ.css","assets/index-De8N2VqQ.js"])))=>i.map(i=>d[i]);
import{_ as ze,p as xe,Y as Ot,Z as Kt,$ as Ut,r as b,i as Xt,a0 as Ft,a1 as Wt,F as Vt,a2 as zt,j as n,a3 as P,a4 as Yt,a5 as ot,a6 as ge,a7 as lt,L as ct,a8 as dt,a9 as qt,aa as Ht,y as Ue,D as Jt,ab as Zt,ac as Xe,ad as Fe,ae as We,af as ut,ag as ft,ah as pt,ai as Gt,aj as Qt,ak as en,al as Me,am as ye,an as mt,s as Y,l as tn,m as nn,ao as sn,ap as rn,aq as an,ar as on}from"./index-DegWZp5h.js";import{P as ln}from"./PageContainer-gLsoIXyY.js";const Tt="gracechords.sets.v1";function Le(){try{const e=localStorage.getItem(Tt);return e?JSON.parse(e):{sets:{}}}catch{return{sets:{}}}}function vt(e){localStorage.setItem(Tt,JSON.stringify(e))}function cn(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"id-"+Math.random().toString(36).slice(2)+Date.now().toString(36)}function ve(){const{sets:e}=Le();return Object.values(e).sort((s,r)=>(r.updatedAt||0)-(s.updatedAt||0))}function dn(e){const{sets:s}=Le();return s[e]||null}function ht(e){const s=Date.now(),r={id:e.id||cn(),name:e.name?.trim()||"Untitled Set",items:Array.isArray(e.items)?e.items:[],createdAt:e.createdAt||s,updatedAt:s},u=Le();return u.sets[r.id]=r,vt(u),r}function un(e){const s=Le();return s.sets[e]?(delete s.sets[e],vt(s),!0):!1}const fn="application/vnd.openxmlformats-officedocument.presentationml.slide+xml",gt="application/vnd.openxmlformats-officedocument.presentationml.slideMaster+xml",pn="application/vnd.openxmlformats-officedocument.presentationml.slideLayout+xml",mn="application/vnd.openxmlformats-officedocument.theme+xml",ee="http://schemas.openxmlformats.org/presentationml/2006/main",Ye="http://schemas.openxmlformats.org/officeDocument/2006/relationships",yt="application/vnd.openxmlformats-officedocument.presentationml.notesMaster+xml",hn=new DOMParser,gn=new XMLSerializer;function yn(e){const s="setlist",r=String(e).trim();return r&&r.replace(/\s+/g,"_").replace(/[^A-Za-z0-9_.-]/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"")||s}async function xt(e){const s=await fetch(e);if(!s.ok)throw new Error(`Failed to load PPTX: ${e}`);return s.arrayBuffer()}function le(e){const s=hn.parseFromString(e,"application/xml"),r=s.getElementsByTagName("parsererror")[0];if(r)throw new Error(r.textContent||"Failed to parse XML");return s}function Ne(e){return gn.serializeToString(e)}function q(e){const s=String(e||"").match(/(\d+)$/);return s?Number(s[1]):0}function me(e,s){let r=0;return e.filter(u=>s.test(u)).forEach(u=>{const a=u.name.match(s);if(!a)return;const f=Number(a[1]);Number.isNaN(f)||(r=Math.max(r,f))}),r}function jt(e,s,r){if(Array.from(e.getElementsByTagName("Override")).some(f=>f.getAttribute("PartName")===s))return;const a=e.createElement("Override");a.setAttribute("PartName",s),a.setAttribute("ContentType",r),e.documentElement.appendChild(a)}function we(e,s){if(!s)return null;if(s.startsWith("/"))return s.slice(1);const r=e.split("/");r.pop();const u=s.split("/");for(const a of u)if(a==="..")r.pop();else{if(a===".")continue;r.push(a)}return r.join("/")}function ce(e,s){const r=e.split("/");r.pop();const u=s.split("/");let a=0;for(;a<r.length&&a<u.length&&r[a]===u[a];)a++;const f=r.length-a,m=[];for(let y=0;y<f;y++)m.push("..");return m.push(...u.slice(a)),m.join("/")}function Nt(e){const s=e.match(/^(.*\/)([^/]*?)(\d+)(\.[^.]+)$/);return s?{dir:s[1],prefix:s[2],number:Number(s[3]),ext:s[4]}:null}function oe(e,s,r){const u=Number(e[s]||0);r>u&&(e[s]=r)}function It(e,s){const u=Number(e[s]||0)+1;return e[s]=u,u}function H(e,s){if(!e)return null;const r=e.file(s);return Array.isArray(r)?r.length?r[0]:null:r||null}function be(e){const s=e.lastIndexOf("/"),r=s>=0?e.slice(0,s+1):"",u=s>=0?e.slice(s+1):e;return`${r}_rels/${u}.rels`}function xn(e,s){if(!e||!s)return{contentType:"",fromOverride:!1,extension:""};const r=`/${s}`,a=Array.from(e.getElementsByTagName("Override")).find(h=>h.getAttribute("PartName")===r);if(a)return{contentType:a.getAttribute("ContentType")||"",fromOverride:!0,extension:s.split(".").pop()||""};const f=Array.from(e.getElementsByTagName("Default")),m=s.split(".").pop()||"",y=f.find(h=>h.getAttribute("Extension")===m);return y?{contentType:y.getAttribute("ContentType")||"",fromOverride:!1,extension:m}:{contentType:"",fromOverride:!1,extension:m}}function wn(e,s,r){if(!r||Array.from(e.getElementsByTagName("Default")).some(m=>m.getAttribute("Extension")===r))return;const a=Array.from(s?.getElementsByTagName?.("Default")||[]).find(m=>m.getAttribute("Extension")===r);if(!a)return;const f=e.createElement("Default");f.setAttribute("Extension",r),f.setAttribute("ContentType",a.getAttribute("ContentType")||""),e.documentElement.appendChild(f)}function bn(e){return e?!/xml|text|application\/(.*\+xml)/i.test(e):!1}function Sn(e){const s=/(.*\D)(\d+)(\.\w+)$/,r=e&&e.match(s);if(r){const[,u,,a]=r;return f=>`${u}${f}${a}`}return u=>`slides/slide${u}.xml`}async function Tn(e){const s="ppt/presentation.xml",r=H(e,s);if(!r)throw new Error("Base PPTX missing ppt/presentation.xml");const u=await r.async("string"),a=le(u),f=a.getElementsByTagNameNS(ee,"sldIdLst")[0]||a.getElementsByTagName("p:sldIdLst")[0],y=(f?Array.from(f.getElementsByTagNameNS(ee,"sldId")).concat(Array.from(f.getElementsByTagName("p:sldId"))):[]).reduce((w,j)=>{const M=Number(j.getAttribute("id"));return Number.isNaN(M)?w:Math.max(w,M)},255),h="ppt/_rels/presentation.xml.rels",N=H(e,h);if(!N)throw new Error("Base PPTX missing ppt/_rels/presentation.xml.rels");const T=await N.async("string"),D=le(T),p=Array.from(D.getElementsByTagName("Relationship")),R=p.reduce((w,j)=>{const M=q(j.getAttribute("Id"));return Math.max(w,M)},0),W=p.filter(w=>(w.getAttribute("Type")||"").endsWith("/slide")),C=W.length&&W[0].getAttribute("Target")||"",$=Sn(C),_=a.getElementsByTagNameNS(ee,"sldMasterIdLst")[0]||a.getElementsByTagName("p:sldMasterIdLst")[0]||null,O=(_?Array.from(_.getElementsByTagNameNS(ee,"sldMasterId")).concat(Array.from(_.getElementsByTagName("p:sldMasterId"))):[]).reduce((w,j)=>{const M=Number(j.getAttribute("id"));return Number.isNaN(M)?w:Math.max(w,M)},2147483647),te=a.getElementsByTagNameNS(ee,"notesMasterIdLst")[0]||a.getElementsByTagName("p:notesMasterIdLst")[0]||null;let J=null;const de=p.find(w=>(w.getAttribute("Type")||"").endsWith("/notesMaster"));if(de){const w=de.getAttribute("Target")||"";J=we("ppt/presentation.xml",w)}let ue=null;const Se=p.find(w=>(w.getAttribute("Type")||"").endsWith("/theme"));if(Se){const w=Se.getAttribute("Target")||"";ue=we("ppt/presentation.xml",w)}const se="[Content_Types].xml",fe=H(e,se);if(!fe)throw new Error("Base PPTX missing [Content_Types].xml");const Re=await fe.async("string"),Ie=le(Re),V={};e.filter(()=>!0).forEach(w=>{const j=Nt(w.name);if(!j)return;const M=`${j.dir}${j.prefix}`;oe(V,M,j.number)}),oe(V,"ppt/slides/slide",me(e,/^ppt\/slides\/slide(\d+)\.xml$/)),oe(V,"ppt/notesSlides/notesSlide",me(e,/^ppt\/notesSlides\/notesSlide(\d+)\.xml$/)),oe(V,"ppt/slideMasters/slideMaster",me(e,/^ppt\/slideMasters\/slideMaster(\d+)\.xml$/)),oe(V,"ppt/slideLayouts/slideLayout",me(e,/^ppt\/slideLayouts\/slideLayout(\d+)\.xml$/)),oe(V,"ppt/theme/theme",me(e,/^ppt\/theme\/theme(\d+)\.xml$/)),oe(V,"ppt/notesMasters/notesMaster",me(e,/^ppt\/notesMasters\/notesMaster(\d+)\.xml$/)),oe(V,"ppt/media/image",me(e,/^ppt\/media\/image(\d+)\.[^.]+$/));const re=e.file(/^ppt\/slides\/slide\d+\.xml$/).sort((w,j)=>q(w.name)-q(j.name));let Z="",K="",ne="";if(re.length){const w=re[0],j=H(e,be(w.name));if(j){const M=le(await j.async("string")),G=Array.from(M.getElementsByTagName("Relationship")).find(X=>(X.getAttribute("Type")||"").endsWith("/slideLayout"));if(G){Z=G.getAttribute("Target")||"";const X=we(w.name,Z);X&&H(e,X)&&(K=X)}}}if(K)!Z&&re.length&&(Z=ce(re[0].name,K));else{const w=e.file(/^ppt\/slideLayouts\/.*\.xml$/).sort((j,M)=>q(j.name)-q(M.name));w.length&&(K=w[0].name,Z=re.length?ce(re[0].name,K):"../slideLayouts/slideLayout1.xml")}if(K){const w=H(e,be(K));if(w){const j=le(await w.async("string")),Te=Array.from(j.getElementsByTagName("Relationship")).find(G=>(G.getAttribute("Type")||"").endsWith("/slideMaster"));if(Te){const G=Te.getAttribute("Target")||"",X=we(K,G);X&&H(e,X)&&(ne=X)}}}if(!ne){const w=e.file(/^ppt\/slideMasters\/.*\.xml$/).sort((j,M)=>q(j.name)-q(M.name));w.length&&(ne=w[0].name)}if(!J){const w=e.file(/^ppt\/notesMasters\/.*\.xml$/).sort((j,M)=>q(j.name)-q(M.name));w.length&&(J=w[0].name)}return{zip:e,presentationXmlPath:s,presentationDoc:a,sldIdList:f,sldMasterList:_,notesMasterList:te,presentationRelsPath:h,presentationRelsDoc:D,contentTypesPath:se,contentTypesDoc:Ie,nextSlideId:y,nextRelId:R,nextMasterId:O,counters:V,partMap:new Map,masterRelMap:new Map,notesMasterRelMap:new Map,getSlideTarget:$,defaultLayoutTarget:Z,defaultLayoutPath:K,defaultMasterPath:ne,defaultNotesMasterPath:J,defaultThemePath:ue}}function vn(e,s,r){const u=e.presentationRelsDoc.documentElement,a=e.presentationRelsDoc.createElement("Relationship");a.setAttribute("Id",r),a.setAttribute("Type","http://schemas.openxmlformats.org/officeDocument/2006/relationships/slide");const f=e.getSlideTarget?e.getSlideTarget(s):`slides/slide${s}.xml`;a.setAttribute("Target",f),u.appendChild(a)}function jn(e,s){const r=e.presentationDoc,u=e.sldIdList||(()=>{const f=r.createElementNS(ee,"p:sldIdLst");return r.documentElement.appendChild(f),e.sldIdList=f,f})(),a=r.createElementNS(ee,"p:sldId");e.nextSlideId+=1,a.setAttribute("id",String(e.nextSlideId)),a.setAttributeNS(Ye,"r:id",s),u.appendChild(a)}function Nn(e,s){if(e.masterRelMap.has(s))return e.masterRelMap.get(s);const r=e.presentationDoc,u=e.presentationRelsDoc;let a=e.sldMasterList;if(!a){a=r.createElementNS(ee,"p:sldMasterIdLst");const h=r.documentElement.firstChild;h?r.documentElement.insertBefore(a,h):r.documentElement.appendChild(a),e.sldMasterList=a}e.nextMasterId=Number(e.nextMasterId||2147483647),e.nextMasterId+=1,e.nextRelId+=1;const f=`rId${e.nextRelId}`,m=r.createElementNS(ee,"p:sldMasterId");m.setAttribute("id",String(e.nextMasterId)),m.setAttributeNS(Ye,"r:id",f),a.appendChild(m);const y=u.createElement("Relationship");return y.setAttribute("Id",f),y.setAttribute("Type","http://schemas.openxmlformats.org/officeDocument/2006/relationships/slideMaster"),y.setAttribute("Target",ce("ppt/presentation.xml",s)),u.documentElement.appendChild(y),e.masterRelMap.set(s,f),f}function In(e,s){if(e.notesMasterRelMap.has(s))return e.notesMasterRelMap.get(s);const r=e.presentationDoc,u=e.presentationRelsDoc;let a=e.notesMasterList;if(!a){a=r.createElementNS(ee,"p:notesMasterIdLst");const h=r.documentElement,N=e.sldIdList||h.firstChild;N?h.insertBefore(a,N):h.appendChild(a),e.notesMasterList=a}e.nextRelId+=1;const f=`rId${e.nextRelId}`,m=r.createElementNS(ee,"p:notesMasterId");m.setAttributeNS(Ye,"r:id",f),a.appendChild(m);const y=u.createElement("Relationship");return y.setAttribute("Id",f),y.setAttribute("Type","http://schemas.openxmlformats.org/officeDocument/2006/relationships/notesMaster"),y.setAttribute("Target",ce("ppt/presentation.xml",s)),u.documentElement.appendChild(y),e.notesMasterRelMap.set(s,f),f}async function Ae(e,s,r,u,a,f={}){if(!a)return null;const m=`${u}:${a}`;if(e.partMap.has(m))return e.partMap.get(m);const y=xn(r,a),h=H(s,a);if(!h)return null;if(y.contentType===pn&&e.defaultLayoutPath)return e.partMap.set(m,e.defaultLayoutPath),e.defaultLayoutPath;if(y.contentType===gt&&e.defaultMasterPath)return e.partMap.set(m,e.defaultMasterPath),e.defaultMasterPath;if(y.contentType===yt&&e.defaultNotesMasterPath)return e.partMap.set(m,e.defaultNotesMasterPath),e.defaultNotesMasterPath;if(y.contentType===mn&&e.defaultThemePath)return e.partMap.set(m,e.defaultThemePath),e.defaultThemePath;const N=Nt(a);let T;if(N){const W=`${N.dir}${N.prefix}`,C=It(e.counters,W);T=`${N.dir}${N.prefix}${C}${N.ext}`}else{if(H(e.zip,a))return e.partMap.set(m,a),a;T=a}e.partMap.set(m,T),y.fromOverride?jt(e.contentTypesDoc,`/${T}`,y.contentType):y.extension&&wn(e.contentTypesDoc,r,y.extension);const D=await h.async(bn(y.contentType)?"uint8array":"string");e.zip.file(T,D);const p=be(a),R=H(s,p);if(R){const W=await R.async("string"),C=le(W),$=Array.from(C.getElementsByTagName("Relationship"));for(const A of $){if((A.getAttribute("TargetMode")||"").toLowerCase()==="external")continue;const te=A.getAttribute("Target")||"",J=we(a,te);if(!J)continue;let de=null;if(typeof f.relationshipMutator=="function"){const se=await f.relationshipMutator({node:A,type:A.getAttribute("Type")||"",absolutePath:J,newPartPath:T,originalPartPath:a});if(se===!1)continue;se&&se.targetPath&&(de=se.targetPath)}const ue=de||await Ae(e,s,r,u,J);if(!ue)continue;const Se=ce(T,ue);A.setAttribute("Target",Se)}const _=be(T);e.zip.file(_,Ne(C))}return y.contentType===gt?Nn(e,T):y.contentType===yt&&In(e,T),T}async function Pn(e,s,r,u,a,f){const m=be(a),y=H(s,m);if(!y)return;const h=await y.async("string"),N=le(h),T=Array.from(N.getElementsByTagName("Relationship")),D=N.documentElement;let p=!1,R=T.reduce((C,$)=>{const _=$.getAttribute("Id")||"";return Math.max(C,q(_))},0);for(const C of T){const $=C.getAttribute("Type")||"",_=C.getAttribute("Target")||"";if(!_)continue;const A=we(a,_);if(A){if($.endsWith("/slideLayout")){e.defaultLayoutTarget?p?D.removeChild(C):(p=!0,C.setAttribute("Target",e.defaultLayoutTarget)):p?D.removeChild(C):p=!0;continue}if($.endsWith("/notesSlide")){const O=await Ae(e,s,r,u,A,{relationshipMutator:({type:te})=>te.endsWith("/slide")?{targetPath:f}:null});if(!O)continue;C.setAttribute("Target",ce(f,O))}else if($.includes("/image")||$.includes("/audio")||$.includes("/video")){const O=await Ae(e,s,r,u,A);if(!O)continue;C.setAttribute("Target",ce(f,O))}else{const O=await Ae(e,s,r,u,A);if(!O)continue;C.setAttribute("Target",ce(f,O))}}}if(!p&&e.defaultLayoutTarget){const C=N.createElement("Relationship"),$=`rId${R+1||1}`;C.setAttribute("Id",$),C.setAttribute("Type","http://schemas.openxmlformats.org/officeDocument/2006/relationships/slideLayout"),C.setAttribute("Target",e.defaultLayoutTarget),D.appendChild(C)}const W=be(f);e.zip.file(W,Ne(N))}async function En(e,s,r){const u=s.file(/^ppt\/slides\/slide\d+\.xml$/).sort((m,y)=>{const h=q(m.name),N=q(y.name);return h-N});if(!u.length)return;const a=H(s,"[Content_Types].xml");if(!a)throw new Error("Source PPTX missing [Content_Types].xml");const f=le(await a.async("string"));for(const m of u){const y=It(e.counters,"ppt/slides/slide"),h=`ppt/slides/slide${y}.xml`,N=await m.async("string");e.zip.file(h,N),jt(e.contentTypesDoc,`/${h}`,fn),e.nextRelId+=1;const T=`rId${e.nextRelId}`;vn(e,y,T),jn(e,T);const D=m.name;e.partMap.set(`${r}:${D}`,h),await Pn(e,s,f,r,D,h)}}function Cn(e){e.zip.file(e.presentationXmlPath,Ne(e.presentationDoc)),e.zip.file(e.presentationRelsPath,Ne(e.presentationRelsDoc)),e.zip.file(e.contentTypesPath,Ne(e.contentTypesDoc))}function Mn(e,s){const r=document.createElement("a");r.href=URL.createObjectURL(e),r.download=s,r.rel="noopener",r.click(),URL.revokeObjectURL(r.href)}async function $n(e=[],s="Setlist"){if(!Array.isArray(e)||e.length===0)throw new Error("No PPTX files to merge");const r=(await ze(async()=>{const{default:T}=await import("./jszip.min-Brab4LeI.js").then(D=>D.j);return{default:T}},__vite__mapDeps([0,1,2]))).default,[u,...a]=e,f=await xt(u),m=await r.loadAsync(f),y=await Tn(m);for(let T=0;T<a.length;T++){const D=await xt(a[T]),p=await r.loadAsync(D);await En(y,p,`src${T+1}`)}Cn(y);const h=await m.generateAsync({type:"blob"}),N=yn(s||"Setlist");Mn(h,`${N}.pptx`)}function An(e){return e?e.slug?e.slug:e.filename?e.filename.replace(/\.chordpro$/i,""):e.title?e.title.trim().toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_.-]/g,""):"":""}async function Ln(e={},s={}){const{name:r="Setlist",songs:u=[]}=e||{},{availablePptxMap:a=null,onEmpty:f}=s,m=[];for(const y of u){const h=An(y);h&&(a&&!a[h]||m.push(xe(`pptx/${h}.pptx`)))}if(!m.length){typeof f=="function"&&f();return}await $n(m,r)}let wt;const bt=()=>wt||(wt=ze(()=>import("./index-De8N2VqQ.js").then(e=>e.i),__vite__mapDeps([3,1,2])));function Rn(){try{if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID()}catch{}return`sel-${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`}function Ve(e){if(!e)return null;const{id:s,toKey:r=""}=e;return s==null?null:{uid:Rn(),id:s,toKey:r}}function je(e=[]){return e.map(s=>Ve(s)).filter(Boolean)}function St(e){try{return decodeURIComponent(e)}catch{return e}}function $e(e,s){if(!s)return"";const r=String(e||"");if(!r.trim())return"";const u=r.search(/\d/),a=(u===-1?r:r.slice(0,u)).trim();if(!a)return"";const f=T=>String(T||"").toLowerCase().replace(/[^a-z0-9]/g,""),m=f(a);if(!f(s).startsWith(m))return"";const h=u===-1?"":r.slice(u).trim(),N=h?`${s} ${h}`:`${s} `;return f(r)===f(N)?"":N}function Bn(){const{code:e,songIds:s}=Ot(),r=Kt(),u=Ut(),[a,f]=b.useState("New Setlist"),[m,y]=b.useState(""),[h,N]=b.useState([]),[T,D]=b.useState(()=>{try{return localStorage.getItem("pref:icpOnly")==="1"}catch{return!1}});b.useEffect(()=>{try{localStorage.setItem("pref:icpOnly",T?"1":"0")}catch{}},[T]);const[p,R]=b.useState([]),[W,C]=b.useState({}),[$,_]=b.useState(""),[A,O]=b.useState("");Object.keys(W).length;const[te,J]=b.useState(!1),[de,ue]=b.useState(()=>{try{return window.innerWidth<=640}catch{return!1}}),[Se,se]=b.useState(()=>{try{return window.innerWidth<=820}catch{return!1}}),[fe,Re]=b.useState(()=>{try{return window.innerWidth<=900}catch{return!1}}),Ie=b.useRef(""),V=b.useRef(""),re=b.useRef(!1),[Z,K]=b.useState(null),[ne,w]=b.useState(()=>ve()),[j,M]=b.useState(""),[Te,G]=b.useState(!1),[X,ke]=b.useState(""),[De,Be]=b.useState(!1),[ie,_e]=b.useState(""),[Oe,he]=b.useState(""),[Pe,Pt]=b.useState(""),qe=b.useRef(new Map);b.useEffect(()=>{const t=Xt?.items||[],i=new Set,l=[];for(const o of t)i.has(o.id)||Ft(o)||(i.add(o.id),l.push(o));N(l)},[]),b.useEffect(()=>{let t=!1;async function i(){const l={};for(const o of p){const c=h.find(L=>L.id===o.id);if(!c)continue;const d=c.filename.replace(/\.chordpro$/i,""),g=xe(`pptx/${d}.pptx`);await Qt(g,d)&&(l[d]=!0)}t||C(l)}return i(),()=>{t=!0}},[p,h]),b.useEffect(()=>{try{const t=document.documentElement,i=document.body;Ie.current=t.style.overflowY||"",V.current=i.style.overflowY||"",getComputedStyle(t).overflowY==="hidden"&&(t.style.overflowY=""),getComputedStyle(i).overflowY==="hidden"&&(i.style.overflowY="")}catch{}return()=>{try{document.documentElement.style.overflowY=Ie.current,document.body.style.overflowY=V.current}catch{}}},[]),b.useEffect(()=>{if(!e)return;const{entries:t,error:i}=Wt(e);if(i){alert(i),u("/setlist",{replace:!0});return}const l=t.map(d=>({id:d.id,toKey:d.toKey}));R(je(l));const o=l.map(d=>encodeURIComponent(d.id)).join(","),c=l.map(d=>encodeURIComponent(d.toKey||"")).join(",");u(`/setlist/${o}?toKeys=${c}`,{replace:!0})},[e]),b.useEffect(()=>{if(!s)return;const t=(s||"").split(",").map(c=>St(c.trim())).filter(Boolean);if(!t.length)return;const l=(new URLSearchParams(r.search||"").get("toKeys")||"").split(",").map(c=>St(c)),o=t.map((c,d)=>({id:c,toKey:l[d]||""}));R(je(o))},[s,r.search]),b.useEffect(()=>{try{if(!Array.isArray(p))return;if(p.length===0){(e||s)&&u("/setlist",{replace:!0});return}const t=p.map(c=>encodeURIComponent(c.id)).join(","),i=p.map(c=>encodeURIComponent(c.toKey||"")).join(","),l=s||"",o=new URLSearchParams(r.search||"").get("toKeys")||"";(t!==l||i!==o)&&u(`/setlist/${t}?toKeys=${i}`,{replace:!0})}catch{}},[p.map(t=>`${t.id}:${t.toKey}`).join("|"),s,r.search,e]),b.useEffect(()=>{try{const t=localStorage.getItem("setlist");if(!t||ve().length>0)return;const i=JSON.parse(t);if(i?.name||(i?.list?.length||0)>0){const l=ht({name:i.name||"Imported Set",items:i.list||[]});w(ve()),K(l.id),f(l.name),R(je(l.items||[])),M(l.id)}}catch{}},[]),b.useEffect(()=>{function t(){try{const i=window.innerWidth;ue(i<=640),se(i<=820),Re(i<=900)}catch{}}return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),b.useEffect(()=>{new URLSearchParams(r.search||"").get("icp")==="1"&&D(!0)},[r.search]),b.useEffect(()=>{if(re.current)return;const t=r.state?.quickAction;t&&h.length&&(Mt(t,h),re.current=!0,u(r.pathname+(r.search||""),{replace:!0,state:null}))},[r.state,h.map(t=>t.id).join("|")]);const Ke=b.useMemo(()=>new Vt(h,{keys:["title","tags"],threshold:.4}),[h]);function Et(t){return!T||(Array.isArray(t.tags)?t.tags.includes("ICP"):t.tags==="ICP")}const Ct=b.useMemo(()=>(m?Ke.search(m).map(i=>i.item):h.slice().sort((i,l)=>i.title.localeCompare(l.title))).filter(Et),[m,Ke,h,T]);function He(t){if(!t)return;const i=Ve({id:t.id,toKey:t.originalKey||t.key||"C"});R(l=>[...l,i])}async function Je(t){const i=en(t);if(i.error)return he("Please check verse reference."),!1;const l=await Dt(i);if(!l.ok)return he(l.message),!1;const o=Ve({id:i.id,toKey:""});return o?(R(c=>[...c,o]),_e(""),he(""),Be(!1),!0):!1}function Ze(t){R(i=>i.filter(l=>l.uid!==t))}function Ee(t,i){R(l=>{const o=l.findIndex(x=>x.uid===t);if(o<0)return l;const c=o+(i==="up"?-1:1);if(c<0||c>=l.length)return l;const d=l.slice(),[g]=d.splice(o,1);return d.splice(c,0,g),d})}function Ge(t,i){R(l=>{if(i<0||i>=l.length)return l;const o=l.findIndex(g=>g.uid===t);if(o<0||o===i)return l;const c=l.slice(),[d]=c.splice(o,1);return c.splice(i,0,d),c})}function Mt(t,i){if(!t)return;function l(S){!S||!S.length||R(je(S.map(I=>({id:I.id,toKey:I.toKey}))))}function o(S){return S?{id:S.id,toKey:S.originalKey||S.key||"C"}:null}function c(S,I){return S.filter(v=>v&&!I.has(v.id))}function d(S,I){const v=c(S,I),B=v.length?mt(v):null;return B&&I.add(B.id),B}function g(){const S=Me(i,"FAST"),I=[],v=new Set;if((S.length>=4?ye(S,4):S.slice()).forEach(E=>{E&&v.add(E.id),I.push(E)}),I.length<4){const E=ye(c(i,v),Math.min(4-I.length,Math.max(0,i.length-I.length)));I.push(...E)}return I.filter(Boolean).map(o).filter(Boolean).slice(0,4)}function x(){const S=new Set,I=Me(i,"SLOW"),v=F=>I.filter(U=>(U?.originalKey||"").toUpperCase()===F.toUpperCase()),B=Me(i,"FAST"),E=d(v("G"),S)||d(I,S)||d(i,S),Q=d(B,S)||d(i,S),z=d(v("A"),S)||d(I,S)||d(i,S);return[E,Q,z].filter(Boolean).map(o).filter(Boolean)}function L(){const I=mt(["CROSS","COMMITMENT","MISSION","MISSIONS","PRAISE","HYMN"]),v=Me(i,I),B=new Set,E=[];v.length>=4?E.push(...ye(v,4)):v.length>=2?E.push(...ye(v,Math.min(4,v.length))):v.length&&E.push(...v),E.forEach(z=>z&&B.add(z.id));const Q=Math.max(0,2-E.length);if(Q>0){const z=ye(c(i,B),Math.min(Q,i.length-E.length));E.push(...z)}if(E.length<4){const z=ye(c(i,B),Math.min(4-E.length,i.length-E.length));E.push(...z)}return E.filter(Boolean).map(o).filter(Boolean).slice(0,4)}let k=[];t==="celebrationSet"?k=g():t==="threeSongFlow"?k=x():t==="randomThemeSet"&&(k=L()),k.length&&l(k)}function $t(t,i){R(l=>l.map(o=>o.uid===t?{...o,toKey:i}:o))}function Qe(t){w(ve()),M(t||"")}function et(){K(null),f("New Setlist"),R([]),M("")}function At(){const t=a?.trim()||"New Setlist",i=window.prompt("Save set as:",t);if(i===null)return;const l=String(i).trim()||"New Setlist";let o=Z;if(!o){const g=(ve()||[]).find(x=>(x.name||"")===l);g&&(o=g.id)}const c=p.map(({id:g,toKey:x})=>({id:g,toKey:x})),d=ht({id:o,name:l,items:c});f(d.name),K(d.id),Qe(d.id)}function Lt(){const t=X||j||"";if(!t){G(!1);return}const i=dn(t);i&&(K(i.id),f(i.name||"New Setlist"),R(je(i.items||[])),M(i.id)),G(!1)}function Rt(){const t=ne[0]?.id||"";ke(j||t),G(!0)}function kt(){Z&&window.confirm(`Delete set "${a}"? This cannot be undone.`)&&(un(Z),et(),Qe(""))}async function tt(){J(!0);try{let t=function(d){return Object.keys(d?.verses||{}).map(g=>Number(g)).filter(g=>!Number.isNaN(g)).sort((g,x)=>g-x)};const{downloadMultiSongPdf:i}=await bt(),l=[],o=qe.current;async function c(d,g){const x=`${d}::${g}`;if(o.has(x))return o.get(x);try{const L=await fetch(xe(`esv/${encodeURIComponent(d)}/${g}.json`));if(!L.ok)throw new Error("Missing chapter");const k=await L.json();return o.set(x,k),k}catch{return o.set(x,null),null}}for(const d of p){if(Fe(d.id)){const x=We(d.id);if(!x){Y("Please check verse reference.");continue}try{const L=x.segments||[],k=L.length>1,S=[],I=new Set;for(const v of L){const B=await c(x.book,v.chapter);if(!B?.verses)continue;const E=B.verses||{},Q=t(B),z=Q.length?Q[Q.length-1]:0;if(!v.ranges){for(const F of Q){const U=`${v.chapter}:${F}`;if(I.has(U))continue;const pe=E[String(F)];if(!pe)continue;const ae=k?`${v.chapter}:${F}`:`${F}`;S.push({plain:`${ae} ${pe}`}),I.add(U)}continue}for(const F of v.ranges){const U=F.start,pe=F.end==null?z:F.end;for(let ae=U;ae<=pe;ae+=1){const it=`${v.chapter}:${ae}`;if(I.has(it))continue;const at=E[String(ae)];if(!at)continue;const _t=k?`${v.chapter}:${ae}`:`${ae}`;S.push({plain:`${_t} ${at}`}),I.add(it)}}}if(!S.length){Y(`No verses found for ${x.refDisplay}`);continue}l.push({title:x.refDisplay||x.id,key:"",pdfColumns:1,sections:[{label:"",lines:S}]})}catch(L){console.error(L),Y(`Failed to load ${x.refDisplay}`)}continue}const g=h.find(x=>x.id===d.id);if(g)try{const x=xe(`songs/${g.filename}`),L=await tn(x),k=nn(L),S=k.meta?.key||k.meta?.originalkey||g.originalKey||"C",I=sn(S,d.toKey||S),v=(String(S).match(/^([A-G][#b]?)/)||[,""])[1],B=!!(v&&/b$/.test(v)),E=(k.sections||[]).map(F=>({section:F.label,lines:(F.lines||[]).map(U=>U.instrumental?{instrumental:rn(U.instrumental,I,B)}:U.comment?{plain:U.comment,chordPositions:[],comment:U.comment}:{plain:U.lyrics||"",chordPositions:(U.chords||[]).map(pe=>({sym:an(pe.sym,I,B),index:pe.index}))})})),Q=g.filename.replace(/\.chordpro$/i,""),z=on({title:k.meta?.title||g.title||Q,key:d.toKey||S,capo:k.meta?.capo,lyricsBlocks:E});l.push(z)}catch(x){console.error(x),Y(`Failed to process ${g.filename}`)}}l.length&&await i(l)}finally{J(!1)}}function Ce(){bt()}async function nt(){try{const t=p.map(c=>encodeURIComponent(c.id)).join(","),i=p.map(c=>encodeURIComponent(c.toKey||"")).join(","),o=`${(()=>{try{if(typeof window<"u"&&window.location)return`${window.location.origin||""}/`}catch{}return""})()}setlist/${t}?toKeys=${i}`;await navigator.clipboard.writeText(o);try{Y?.("Link copied!")}catch{}}catch{alert("Failed to copy link")}}b.useEffect(()=>{if(!De)return;const t=String(ie||"").split(/\d/)[0].trim(),i=zt(t);Pt(i||"")},[ie,De]);async function Dt(t){if(!t?.book||!t?.segments?.length)return{ok:!1,message:"Please check verse reference."};async function i(o,c){const d=`${o}::${c}`,g=qe.current;if(g.has(d))return g.get(d);try{const x=await fetch(xe(`esv/${encodeURIComponent(o)}/${c}.json`));if(!x.ok)throw new Error("Missing chapter");const L=await x.json();return g.set(d,L),L}catch{return g.set(d,null),null}}let l=!1;for(const o of t.segments){const c=await i(t.book,o.chapter);if(!c?.verses)return{ok:!1,message:"No verse found."};const d=c.verses||{},g=Object.keys(d);if(!o.ranges){g.length&&(l=!0);continue}for(const x of o.ranges){const L=x.start,k=x.end??L;if(!d[String(L)]||!d[String(k)])return{ok:!1,message:"Please check verse reference."};l=!0}}return l?{ok:!0}:{ok:!1,message:"No verse found."}}function Bt(){const t=$e(ie,Pe);t&&_e(t)}async function st(){if(A)return;_(`Bundling 0/${p.length}…`);const t=(await ze(async()=>{const{default:o}=await import("./jszip.min-Brab4LeI.js").then(c=>c.j);return{default:o}},__vite__mapDeps([0,1,2]))).default,i=new t;let l=0;for(let o=0;o<p.length;o++){const c=p[o],d=h.find(x=>x.id===c.id);if(!d){_(`Bundling ${o+1}/${p.length}…`);continue}_(`Bundling ${o+1}/${p.length}…`);const g=d.filename.replace(/\.chordpro$/i,"");if(W[g])try{const x=await fetch(xe(`pptx/${g}.pptx`));if(!x.ok)continue;const L=await x.blob();l++,i.file(`${String(l).padStart(2,"0")}-${g}.pptx`,L)}catch{}}if(l>0){const o=await i.generateAsync({type:"blob"}),c=new Date().toISOString().slice(0,10).replace(/-/g,""),d=document.createElement("a");d.href=URL.createObjectURL(o),d.download=`setlist-pptx-${c}.zip`,d.click(),URL.revokeObjectURL(d.href)}else try{Y&&Y("No PPTX files found for selected songs")||alert("No PPTX files found for selected songs")}catch{}_("")}async function rt(){if(!($||A)){O("Combining…");try{const t=[],i=[];for(const l of p){const o=h.find(d=>d.id===l.id);if(!o)continue;const c=o.filename.replace(/\.chordpro$/i,"");if(!W[c]){i.push(o.title||c);continue}t.push(o)}if(!t.length){try{Y&&Y("No PPTX files found for selected songs")||alert("No PPTX files found for selected songs")}catch{}return}if(i.length){const l=i.length===1?`${i[0]} PPT file unavailable`:`${i.length} songs missing PPT files`;try{Y?.(l)}catch{}}await Ln({name:a||"Setlist",songs:t},{})}catch(t){console.error(t);try{Y&&Y("Failed to combine PPTX files")||alert("Failed to combine PPTX files")}catch{}}finally{O("")}}}return n.jsxs(ln,{className:"is-setlist",children:[Te?n.jsx("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,.45)",zIndex:90},role:"dialog","aria-modal":"true",children:n.jsxs("div",{style:{background:"var(--card)",color:"var(--text)",border:"1px solid var(--line)",borderRadius:10,padding:16,width:"min(560px, 92vw)"},children:[n.jsx("h3",{style:{marginTop:0,marginBottom:8},children:"Load Set"}),ne.length?n.jsxs("label",{style:{display:"block",margin:"8px 0"},children:["Select a saved set",n.jsx("select",{value:X,onChange:t=>ke(t.target.value),style:{width:"100%"},children:ne.map(t=>n.jsxs("option",{value:t.id,children:[t.name," · ",new Date(t.updatedAt).toLocaleString()]},t.id))})]}):n.jsx("div",{className:"meta",children:"No saved sets yet."}),n.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:8,marginTop:12},children:[n.jsx(P,{onClick:()=>G(!1),children:"Cancel"}),n.jsx(P,{variant:"primary",onClick:Lt,disabled:!ne.length,children:"Load"})]})]})}):null,De?n.jsx("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,.45)",zIndex:90},role:"dialog","aria-modal":"true",children:n.jsxs("div",{style:{background:"var(--card)",color:"var(--text)",border:"1px solid var(--line)",borderRadius:10,padding:16,width:"min(560px, 92vw)"},children:[n.jsx("h3",{style:{marginTop:0,marginBottom:8},children:"Add Verse"}),n.jsxs("label",{className:"gc-field",style:{margin:"8px 0"},children:[n.jsx("span",{className:"gc-label",children:"Bible verse"}),n.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:[n.jsxs("div",{style:{position:"relative",flex:1},children:[$e(ie,Pe)?n.jsx("div",{"aria-hidden":!0,style:{position:"absolute",inset:0,padding:"10px 12px",fontFamily:"var(--gc-font-family)",color:"var(--gc-text-secondary)",whiteSpace:"pre",overflow:"hidden",textOverflow:"ellipsis",pointerEvents:"none"},children:$e(ie,Pe)}):null,n.jsx("input",{value:ie,onChange:t=>{_e(t.target.value),Oe&&he("")},placeholder:"John 3:16",onKeyDown:t=>{if(t.key==="Tab"&&$e(ie,Pe)){t.preventDefault(),Bt();return}t.key==="Enter"&&(t.preventDefault(),Je(ie))},className:"gc-input",style:{width:"100%",background:"transparent",position:"relative",zIndex:1}})]}),n.jsxs("div",{style:{minWidth:110},children:[n.jsx("span",{className:"gc-label",style:{display:"block",marginBottom:6},children:"Translation"}),n.jsx("span",{className:"gc-select",style:{width:"100%"},children:n.jsx("select",{disabled:!0,style:{width:"100%"},children:n.jsx("option",{children:"ESV"})})})]})]})]}),Oe?n.jsx("div",{className:"meta",style:{color:"var(--gc-danger)",marginTop:6},children:Oe}):null,n.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:8,marginTop:12},children:[n.jsx(P,{onClick:()=>{Be(!1),he("")},children:"Cancel"}),n.jsx(P,{variant:"primary",onClick:()=>Je(ie),children:"Add Verse"})]})]})}):null,n.jsx(Yt,{busy:te}),n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:12,marginBottom:4},children:[n.jsx("div",{}),n.jsx("h1",{style:{margin:0},children:"Setlist Builder"}),n.jsx("div",{})]}),de?n.jsx(ot,{className:"card",style:{marginTop:8,position:"static"},children:n.jsxs("div",{className:"setlist-actions--mobile",style:{width:"100%"},children:[n.jsx(P,{variant:"primary",onClick:tt,onMouseEnter:Ce,onFocus:Ce,disabled:te||p.length===0,title:"Export set as a single PDF",iconLeft:n.jsx(ge,{}),children:"PDF"}),n.jsx(P,{onClick:rt,disabled:p.length===0||!!$||!!A,title:p.length===0?"Add songs to combine PPTX files":"Combine PPTX files into a single presentation",iconLeft:n.jsx(ge,{}),children:A||"Export PPT"}),n.jsx(P,{onClick:st,disabled:p.length===0||!!$||!!A,title:p.length===0?"Add songs to export PPTX bundle":"Export PPTX bundle (ZIP) for selected songs",iconLeft:n.jsx(ge,{}),children:"PPT ZIP"}),n.jsx(P,{onClick:nt,title:"Copy shareable link",iconLeft:n.jsx(lt,{}),disabled:p.length===0,children:"Share"}),n.jsx(P,{as:ct,to:p.length?`/worship/${p.map(t=>encodeURIComponent(t.id)).join(",")}?toKeys=${p.map(t=>encodeURIComponent(t.toKey||"")).join(",")}`:"/worship",title:"Open Worship Mode",iconLeft:n.jsx(dt,{}),children:"Worship"})]})}):n.jsxs(ot,{className:"card",style:{marginTop:8,position:"static"},children:[n.jsx("div",{style:{width:"100%",marginBottom:6},children:n.jsx("strong",{title:"Current set name",children:a||"New Setlist"})}),n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap",width:"100%"},children:[n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[n.jsxs(P,{size:"sm",variant:"secondary",onClick:At,title:"Save set",iconLeft:n.jsx(qt,{}),children:[" ",n.jsx("span",{className:"text-when-wide",children:"Save"})]}),n.jsxs(P,{size:"sm",variant:"secondary",onClick:Rt,title:"Load saved set",iconLeft:n.jsx(Ht,{}),disabled:!ne.length,children:[" ",n.jsx("span",{className:"text-when-wide",children:"Load"})]}),n.jsxs(P,{size:"sm",variant:"secondary",onClick:et,title:"New set",iconLeft:n.jsx(Ue,{}),children:[" ",n.jsx("span",{className:"text-when-wide",children:"New"})]}),n.jsxs(P,{size:"sm",variant:"secondary",onClick:kt,disabled:!Z,title:"Delete set",iconLeft:n.jsx(Jt,{}),children:[" ",n.jsx("span",{className:"text-when-wide",children:"Delete"})]}),n.jsxs(P,{size:"sm",variant:"secondary",onClick:nt,title:"Copy shareable link",iconLeft:n.jsx(lt,{}),disabled:p.length===0,children:[" ",n.jsx("span",{className:"text-when-wide",children:"Share Set"})]})]}),n.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[n.jsx(P,{variant:"primary",size:"md",onClick:tt,onMouseEnter:Ce,onFocus:Ce,disabled:te||p.length===0,title:"Export set as a single PDF",iconLeft:n.jsx(ge,{}),children:te?"Exporting…":n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"text-when-wide",children:"Export PDF"}),n.jsx("span",{className:"text-when-narrow",children:"PDF"})]})}),n.jsx(P,{variant:"primary",size:"md",onClick:rt,disabled:p.length===0||!!$||!!A,title:p.length===0?"Add songs to combine PPTX files":"Combine PPTX files into a single presentation",iconLeft:n.jsx(ge,{}),children:A||n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"text-when-wide",children:"Export PPT"}),n.jsx("span",{className:"text-when-narrow",children:"Export PPT"})]})}),n.jsx(P,{variant:"primary",size:"md",onClick:st,disabled:p.length===0||!!$||!!A,title:p.length===0?"Add songs to export PPTX bundle":"Export PPTX bundle (ZIP) for selected songs",iconLeft:n.jsx(ge,{}),children:$||n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"text-when-wide",children:"PPT ZIP"}),n.jsx("span",{className:"text-when-narrow",children:"PPT ZIP"})]})}),n.jsxs(P,{variant:"primary",size:"md",as:ct,to:p.length?`/worship/${p.map(t=>encodeURIComponent(t.id)).join(",")}?toKeys=${p.map(t=>encodeURIComponent(t.toKey||"")).join(",")}`:"/worship",title:"Open Worship Mode",iconLeft:n.jsx(dt,{}),children:[" ",n.jsx("span",{className:"text-when-wide",children:"Worship Mode"}),n.jsx("span",{className:"text-when-narrow",children:"Worship"})]})]})]})]}),n.jsxs("div",{className:"BuilderPage",style:{marginTop:8},children:[n.jsx("div",{className:"BuilderLeft",children:n.jsx("section",{className:"setlist-section setlist-add","data-role":"add",children:n.jsxs("div",{className:"card setlist-pane",children:[n.jsxs("div",{className:["BuilderHeader","section-header",fe?"no-sticky":""].filter(Boolean).join(" "),style:{display:"flex",alignItems:"center",gap:8},children:[n.jsx("strong",{style:{whiteSpace:"nowrap"},children:"Add songs"}),n.jsx(Zt,{value:m,onChange:t=>y(t.target.value),placeholder:"Search...",style:{flex:1,minWidth:0}}),n.jsxs("label",{className:"row",style:{gap:6,alignItems:"center"},children:[n.jsx("input",{type:"checkbox",checked:T,onChange:t=>D(t.target.checked)}),n.jsx("span",{className:"meta",title:"Limit results to songs tagged ICP",children:"ICP only"})]})]}),n.jsx("div",{className:["BuilderScroll","setlist-scroll","setlist-list",fe?"no-pane-scroll":"pane-scroll","pane--addSongs"].join(" "),children:Ke?n.jsx("div",{style:{display:"grid",gap:".5rem",gridTemplateColumns:"repeat(auto-fill, minmax(320px, 1fr))",marginTop:6},children:Ct.map(t=>n.jsx(Xe,{title:t.title,subtitle:`${t.originalKey||""}${t.tags?.length?` • ${t.tags.join(", ")}`:""}`,rightSlot:n.jsx(P,{"aria-label":"Add",title:"Add to set",variant:"primary",iconLeft:n.jsx(Ue,{}),iconOnly:!0,onClick:i=>{i.stopPropagation(),He(t)}}),onClick:()=>He(t)},t.id))}):n.jsx("div",{children:"Loading search…"})})]})})}),n.jsx("div",{className:"BuilderRight",style:{minHeight:0,display:"flex",flexDirection:"column"},children:n.jsxs("section",{className:"setlist-section setlist-current","data-role":"current",children:[n.jsxs("div",{className:"card setlist-pane",children:[n.jsxs("div",{className:["BuilderHeader","section-header",fe?"no-sticky":""].filter(Boolean).join(" "),style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8},children:[n.jsxs("strong",{children:["Current setlist (",p.length,")"]}),n.jsx(P,{size:"sm",variant:"secondary",onClick:()=>{Be(!0),he("")},iconLeft:n.jsx(Ue,{}),children:"Add Verse"})]}),n.jsx("div",{className:["BuilderScroll","setlist-scroll","setlist-list",fe?"no-pane-scroll":"pane-scroll","pane--currentSet"].join(" "),style:{marginTop:6},children:p.map((t,i)=>{if(Fe(t.id)){const d=We(t.id)?.refDisplay||t.id;return n.jsx(Xe,{draggable:!0,onDragStart:g=>{g.dataTransfer.setData("text/plain",String(t.uid||t.id)),g.dataTransfer.effectAllowed="move"},onDragOver:g=>{g.preventDefault(),g.dataTransfer.dropEffect="move"},onDrop:g=>{g.preventDefault();const x=g.dataTransfer.getData("text/plain");Ge(x,i)},title:d,subtitle:"ESV",rightSlot:n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[n.jsx(P,{onClick:()=>Ee(t.uid,"up"),title:"Move up",iconLeft:n.jsx(ut,{})}),n.jsx(P,{onClick:()=>Ee(t.uid,"down"),title:"Move down",iconLeft:n.jsx(ft,{})}),n.jsx(P,{onClick:()=>Ze(t.uid),title:"Remove",iconLeft:n.jsx(pt,{}),iconOnly:!0,style:{color:"#b91c1c"}})]})},t.uid||`${t.id}-${i}`)}const o=h.find(c=>c.id===t.id);return o?n.jsx(Xe,{draggable:!0,onDragStart:c=>{c.dataTransfer.setData("text/plain",String(t.uid||t.id)),c.dataTransfer.effectAllowed="move"},onDragOver:c=>{c.preventDefault(),c.dataTransfer.dropEffect="move"},onDrop:c=>{c.preventDefault();const d=c.dataTransfer.getData("text/plain");Ge(d,i)},title:o.title,subtitle:`Original: ${o.originalKey||"—"}`,rightSlot:n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[n.jsx(Gt,{variant:"ui",baseKey:o.originalKey||"C",valueKey:t.toKey||o.originalKey||"C",onChange:c=>$t(t.uid,c)}),n.jsx(P,{onClick:()=>Ee(t.uid,"up"),title:"Move up",iconLeft:n.jsx(ut,{})}),n.jsx(P,{onClick:()=>Ee(t.uid,"down"),title:"Move down",iconLeft:n.jsx(ft,{})}),n.jsx(P,{onClick:()=>Ze(t.uid),title:"Remove",iconLeft:n.jsx(pt,{}),iconOnly:!0,style:{color:"#b91c1c"}})]})},t.uid||`${t.id}-${i}`):null})})]}),n.jsxs("div",{className:"print-only",style:{marginTop:16},children:[n.jsx("h2",{style:{fontSize:"20pt",margin:"0 0 8pt 0"},children:a}),n.jsx("ol",{style:{fontSize:"12pt",lineHeight:1.4,paddingLeft:"1.2em"},children:p.map((t,i)=>{if(Fe(t.id)){const o=We(t.id);return n.jsx("li",{children:o?.refDisplay||t.id},t.uid||`${t.id}-${i}`)}const l=h.find(o=>o.id===t.id);return l?n.jsxs("li",{children:[l.title," — ",t.toKey||l.originalKey||"—"]},t.uid||`${t.id}-${i}`):null})})]})]})})]})]})}export{Bn as default};
