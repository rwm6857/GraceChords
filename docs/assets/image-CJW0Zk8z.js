import{e as p,p as M}from"./index-Dc9CKKFk.js";function w(t,{pxWidth:r,pxHeight:d,dpi:u=150}){const c=document.createElement("canvas");c.width=r,c.height=d;const e=c.getContext("2d");e.fillStyle="#fff",e.fillRect(0,0,c.width,c.height);const y=u/72;e.scale(y,y);const i=t.margin,f=Math.max(22,t.lyricSizePt+6),a=Math.max(12,t.lyricSizePt-2);e.fillStyle="#000",e.font=`bold ${f}px ${t.lyricFamily}`,e.fillText(t.title,i,i+24),e.font=`italic ${a}px ${t.lyricFamily}`,e.fillText(`Key: ${t.key||"â€”"}`,i,i+40);const g=4,x=t.lyricSizePt,s=Math.round(t.lyricSizePt*.85),$=i+t.headerOffsetY;return(t.layout.pages||[])[0].columns.forEach(l=>{let o=l.x,n=$;l.blocks.forEach(h=>{var P;h.type==="section"?(n+=s,e.font=`bold ${x}px ${t.lyricFamily}`,e.fillText(`[${h.header}]`,o,n),n+=x+4):h.type==="line"&&((P=h.chords)!=null&&P.length&&(e.font=`bold ${t.chordSizePt}px ${t.chordFamily}`,h.chords.forEach(T=>e.fillText(T.sym,o+T.x,n)),n+=t.chordSizePt+g/2),e.font=`normal ${t.lyricSizePt}px ${t.lyricFamily}`,e.fillText(h.lyrics,o,n),n+=t.lyricSizePt+g)})}),c}async function k(t,r={}){const d=r.dpi||150,u=r.widthInches||8.5,c=r.heightInches||11,e=Math.round(u*d),y=Math.round(c*d),{lyricFamily:i,chordFamily:f}=await p(),a=document.createElement("canvas").getContext("2d"),s=M(t,{lyricFamily:i,chordFamily:f},l=>o=>(a.font=`${l}px ${i}`,a.measureText(o||"").width),l=>o=>(a.font=`bold ${l}px ${f}`,a.measureText(o||"").width));if(s.layout.pages.length>1)return{error:"MULTI_PAGE",plan:s};const $=w(s,{pxWidth:e,pxHeight:y,dpi:d}),m=document.createElement("a"),S=(r.slug||t.slug||t.title||"untitled").replace(/\s+/g,"_");return m.href=$.toDataURL("image/jpeg",.92),m.download=`${S}.jpg`,m.click(),{plan:s}}export{k as downloadSingleSongJpg,p as ensureCanvasFonts,w as renderPlanToCanvas};
