const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-NFWnGZCj.js","./index-HS4bf4_T.js","./index-BYKK_lVy.css"])))=>i.map(i=>d[i]);
import{r as n,i as Q,j as t,B as X,S as Y,_ as Z,f as ee,p as te,n as se,b as v,c as le}from"./index-HS4bf4_T.js";let I;const E=()=>I||(I=Z(()=>import("./index-NFWnGZCj.js").then(r=>r.i),__vite__mapDeps([0,1,2]),import.meta.url));function S(r,i){return le(r,i)}function C(r){return[...new Set(r.filter(Boolean))].sort((i,y)=>String(i).localeCompare(String(y),void 0,{sensitivity:"base"}))}function re(){const r=n.useMemo(()=>{var e;return(((e=Q)==null?void 0:e.items)||[]).slice().sort(S)},[]),[i,y]=n.useState(""),[h,M]=n.useState("All"),[x,_]=n.useState("All"),[m,R]=n.useState("All"),D=n.useMemo(()=>C(r.flatMap(e=>Array.isArray(e.tags)?e.tags:e.tags?[e.tags]:[])),[r]),$=n.useMemo(()=>C(r.map(e=>e.country).filter(Boolean)),[r]),H=n.useMemo(()=>C(r.flatMap(e=>Array.isArray(e.authors)?e.authors:e.authors?[e.authors]:[])),[r]),u=n.useMemo(()=>{const e=i.trim().toLowerCase();let l=r;return e&&(l=l.filter(s=>{const a=(s.title||"").toLowerCase(),c=(Array.isArray(s.authors)?s.authors.join(", "):s.authors||"").toLowerCase();return a.includes(e)||c.includes(e)})),h!=="All"&&(l=l.filter(s=>Array.isArray(s.tags)?s.tags.includes(h):s.tags===h)),x!=="All"&&(l=l.filter(s=>s.country===x)),m!=="All"&&(l=l.filter(s=>Array.isArray(s.authors)?s.authors.includes(m):s.authors===m)),l.slice().sort(S)},[r,i,h,x,m]),[p,j]=n.useState(()=>new Set),o=n.useMemo(()=>u.filter(e=>p.has(e.id)).slice().sort(S),[u,p]),A=u.length,N=p.size;function k(e,l){j(s=>{const a=new Set(s);return l?a.add(e):a.delete(e),a})}function O(){u.length&&j(e=>{const l=new Set(e);for(const s of u)l.add(s.id);return l})}function z(){j(new Set)}const[w,W]=n.useState(!0),[q,f]=n.useState(null),[b,F]=n.useState(!1);async function U(){var e;if(o.length){F(!0);try{const{downloadSongbookPdf:l}=await E(),s=[];for(const a of o)try{const c=`./songs/${a.filename}`,d=await ee(c),g=te(d),V=g.blocks.map(B=>({section:B.section,lines:(B.lines||[]).map(L=>({plain:L.text,chordPositions:(L.chords||[]).map(P=>({sym:P.sym,index:P.index}))}))})),G=a.filename.replace(/\.chordpro$/,""),J=se({title:g.meta.title||a.title||G,key:g.meta.key||g.meta.originalkey||a.originalKey||"C",capo:(e=g.meta)==null?void 0:e.capo,lyricsBlocks:V});s.push(J)}catch(c){console.error(c),v(`Failed to process ${a.filename}`)}s.length&&await l(s,{includeTOC:w,coverImageDataUrl:q})}finally{F(!1)}}}function T(){E()}function K(e){var a;const l=(a=e.target.files)==null?void 0:a[0];if(!l){f(null);return}if(l.size>2*1024*1024){v("Image must be under 2 MB"),e.target.value="",f(null);return}if(!l.type.startsWith("image/")){v("File must be an image"),e.target.value="",f(null);return}const s=new FileReader;s.onload=()=>f(String(s.result||"")),s.readAsDataURL(l)}return r.length===0?t.jsxs("div",{className:"container",children:[t.jsx("h1",{children:"No songs found"}),t.jsx("p",{className:"Small",children:"The song index is empty or failed to load."})]}):t.jsxs("div",{className:"container",children:[t.jsx(X,{busy:b}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("div",{children:t.jsx("a",{href:"/",className:"back",children:"← Back"})}),t.jsx("h1",{style:{margin:0},children:"Songbook Builder"}),t.jsx("div",{})]}),t.jsxs("div",{className:"card toolbar",style:{marginTop:12},children:[t.jsxs("div",{className:"Field",children:[t.jsx("input",{id:"sb-toc",type:"checkbox",checked:w,onChange:e=>W(e.target.checked)}),t.jsx("label",{htmlFor:"sb-toc",children:"Include table of contents"})]}),t.jsxs("div",{className:"Field",children:[t.jsx("label",{htmlFor:"sb-cover",children:"Cover page (image):"}),t.jsx("input",{id:"sb-cover",className:"CoverInput",type:"file",accept:"image/*",onChange:K})]}),t.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:6},children:[t.jsxs("button",{className:"btn",onClick:O,disabled:!A,children:["Select all (",A,")"]}),t.jsx("button",{className:"btn",onClick:z,disabled:!N,children:"Clear"}),t.jsx("button",{className:"btn primary",onClick:U,onMouseEnter:T,onFocus:T,disabled:!o.length||b,title:o.length?"Export PDF":"Select some songs first",children:b?"Exporting…":`Export PDF (${o.length})`})]})]}),t.jsxs("div",{className:"card",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[t.jsxs("div",{className:"BuilderLeft",children:[t.jsxs("div",{className:"Row",style:{gap:"1rem",alignItems:"flex-end",flexWrap:"wrap",marginTop:8},children:[t.jsxs("div",{className:"Field",style:{minWidth:220},children:[t.jsx("label",{htmlFor:"sb-search",children:"Search:"}),t.jsx("input",{id:"sb-search",type:"search",placeholder:"Title or author",value:i,onChange:e=>y(e.target.value),style:{width:"100%"}})]}),t.jsxs("div",{className:"Field",children:[t.jsx("label",{htmlFor:"sb-tag",children:"Tag:"}),t.jsxs("select",{id:"sb-tag",value:h,onChange:e=>M(e.target.value),children:[t.jsx("option",{children:"All"}),D.map(e=>t.jsx("option",{value:e,children:e},e))]})]}),t.jsxs("div",{className:"Field",children:[t.jsx("label",{htmlFor:"sb-country",children:"Country:"}),t.jsxs("select",{id:"sb-country",value:x,onChange:e=>_(e.target.value),children:[t.jsx("option",{children:"All"}),$.map(e=>t.jsx("option",{value:e,children:e},e))]})]}),t.jsxs("div",{className:"Field",children:[t.jsx("label",{htmlFor:"sb-author",children:"Author:"}),t.jsxs("select",{id:"sb-author",value:m,onChange:e=>R(e.target.value),children:[t.jsx("option",{children:"All"}),H.map(e=>t.jsx("option",{value:e,children:e},e))]})]})]}),t.jsxs("div",{className:"Row Small",style:{marginTop:".5rem"},children:[t.jsx("strong",{children:N})," selected"]}),t.jsx("div",{className:"SongList",role:"region","aria-label":"Song list",style:{minHeight:0,maxHeight:300,overflow:"auto",marginTop:6},children:t.jsx("div",{className:"gc-list",children:u.map(e=>{const l=p.has(e.id),s=Array.isArray(e.authors)?e.authors.join(", "):e.authors||"",a=Array.isArray(e.tags)?e.tags:e.tags?String(e.tags).split(",").map(d=>d.trim()):[],c=[s||"—",e.country].filter(Boolean).join(" • ");return t.jsx(Y,{title:e.title,subtitle:c,tags:a,leftSlot:t.jsx("input",{type:"checkbox",checked:l,onChange:d=>k(e.id,d.target.checked),onClick:d=>d.stopPropagation(),"aria-label":`Select ${e.title}`}),onClick:()=>k(e.id,!l)},e.id)})})})]}),t.jsxs("div",{className:"BuilderRight",children:[t.jsxs("strong",{children:["Current selection (",o.length,")"]}),t.jsx("div",{className:"PreviewList",role:"region","aria-label":"Selected songs",style:{minHeight:0,maxHeight:360,overflow:"auto",marginTop:6},children:t.jsx("ol",{className:"List",style:{listStyle:"decimal inside"},children:o.map(e=>t.jsxs("li",{children:[e.title,Array.isArray(e.authors)&&e.authors.length?t.jsxs("span",{className:"Small",children:[" — ",e.authors.join(", ")]}):null]},e.id))})})]})]})]})}export{re as default};
