const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./jspdf.es.min-DA_FFzd_.js","./index-C5qgAAU9.js","./index-Wri8gDRg.css"])))=>i.map(i=>d[i]);
import{_ as L}from"./index-C5qgAAU9.js";import{e as b}from"./fonts-OQpvcT7Z.js";import{chooseBestLayout as D,normalizeSongInput as _,DEFAULT_LAYOUT_OPT as H}from"./pdfLayout-CxnTdz_5.js";import{planSongLayout as J}from"./pdfLayout-CxnTdz_5.js";function $(a,e,t="normal"){return l=>o=>(a.setFont(e,t),a.setFontSize(l),a.getTextWidth(o||""))}const G=typeof window<"u"&&(()=>{try{return localStorage.getItem("pdfDebug")==="1"}catch{return!1}})();async function M(){const{jsPDF:a}=await L(async()=>{const{jsPDF:e}=await import("./jspdf.es.min-DA_FFzd_.js").then(t=>t.j);return{jsPDF:e}},__vite__mapDeps([0,1,2]),import.meta.url);return new a({unit:"pt",format:"letter"})}function E(a,e,t){var m;const l=a.internal.pageSize.getWidth(),o=a.internal.pageSize.getHeight(),i={...H,...t,pageWidth:l,pageHeight:o};(m=e==null?void 0:e.meta)!=null&&m.capo&&(t==null?void 0:t.showCapo)!==!1&&(i.headerOffsetY=(i.headerOffsetY||H.headerOffsetY)+14);const n=$(a,i.lyricFamily,"normal"),s=$(a,i.chordFamily,"bold"),{plan:h}=D(e,i,n,s);return{plan:h}}function v(a,e,{title:t,key:l,capo:o,showCapo:i=!0}){const n=String(e.lyricFamily||"Helvetica"),s=String(e.chordFamily||"Courier"),h=a.internal.pageSize.getWidth(),m=a.internal.pageSize.getHeight(),r=e.margin,d=Math.max(22,e.lyricSizePt+6),g=Math.max(12,e.lyricSizePt-2),W=4,T=e.lyricSizePt,k=Math.round(e.lyricSizePt*.85),c=r+e.headerOffsetY,u=h-r*2,f=e.columns===2?(u-e.gutter)/2:u;e.layout.pages.forEach((P,C)=>{if(C>0&&a.addPage(),a.setFont(n,"bold"),a.setFontSize(d),a.text(t,r,r+24),a.setFont(n,"italic"),a.setFontSize(g),a.text(`Key: ${l||"—"}`,r,r+40),i&&typeof o=="number"&&a.text(`Capo: ${o}`,r,r+54),G){a.setDrawColor(180),a.rect(r,c,f,m-r-c),e.columns===2&&a.rect(r+f+e.gutter,c,f,m-r-c),e.layout.pages.length,e.columns,a.setFont(n,"normal"),a.setFontSize(9);const S=e.debugFooter?e.debugFooter:`Plan: ${e.columns} col • size ${e.lyricSizePt}pt • singlePage=${e.layout.pages.length===1?"yes":"no"}`;a.text(S,r,m-r*.6)}P.columns.forEach(S=>{var x;let z=S.x,y=c;for(const F of S.blocks)if(F.type==="section")y+=k,a.setFont(n,"bold"),a.setFontSize(T),a.text(`[${F.header}]`,z,y),y+=T+4;else if(F.type==="line")if(F.comment){const w=Math.max(10,e.lyricSizePt-2);a.setFont(n,"italic"),a.setFontSize(w),a.setTextColor(120),a.text(F.comment,z,y),a.setTextColor(0),y+=w+3}else{if((x=F.chords)!=null&&x.length){a.setFont(s,"bold"),a.setFontSize(e.chordSizePt);for(const w of F.chords)a.text(w.sym,z+w.x,y);y+=e.chordSizePt+W/2}a.setFont(n,"normal"),a.setFontSize(e.lyricSizePt),a.text(F.lyrics,z,y),y+=e.lyricSizePt+W}})})}async function A(a,e={}){const t=await M();let l={};try{l=await b(t)}catch{}const o={lyricFamily:l.lyricFamily||e.lyricFamily||"Helvetica",chordFamily:l.chordFamily||e.chordFamily||"Courier",...e},i=t.internal.pageSize.getWidth(),n=t.internal.pageSize.getHeight(),s=d=>g=>g?g.length*(d*.6):0,h=d=>g=>{try{return t.setFont(o.lyricFamily,"normal"),t.setFontSize(d),t.getTextWidth(g||"")}catch{return s(d)(g)}},m=d=>g=>{try{return t.setFont(o.chordFamily,"bold"),t.setFontSize(d),t.getTextWidth(g||"")}catch{return s(d)(g)}},r=_(a);return D(r,{...o,pageWidth:i,pageHeight:n},h,m)}async function B(a,e){var r;const t=await M();let l={};try{l=await b(t)}catch{}const o={lyricSizePt:Math.max(12,(e==null?void 0:e.lyricSizePt)||16),chordSizePt:Math.max(12,(e==null?void 0:e.chordSizePt)||16),margin:36,lyricFamily:l.lyricFamily||"Helvetica",chordFamily:l.chordFamily||"Courier",columns:(e==null?void 0:e.columns)===2?2:1,showCapo:e==null?void 0:e.showCapo},i=_(a),n=E(t,i,o),s=n&&n.plan?n.plan:n,h=a.title||i.title||"Untitled",m=a.key||i.key||"C";return v(t,s,{title:h,key:m,capo:(r=i.meta)==null?void 0:r.capo,showCapo:(e==null?void 0:e.showCapo)!==!1}),t.setProperties({title:`${h} – GraceChords`}),t.save(`${h.replace(/\s+/g,"_")}.pdf`),{plan:s}}async function I(a,e={}){const t=await M();let l={};try{l=await b(t)}catch{}const o={lyricSizePt:Math.max(12,(e==null?void 0:e.lyricSizePt)||16),chordSizePt:Math.max(12,(e==null?void 0:e.chordSizePt)||16),margin:36,lyricFamily:l.lyricFamily||"Helvetica",chordFamily:l.chordFamily||"Courier",columns:(e==null?void 0:e.columns)===2?2:1,showCapo:e==null?void 0:e.showCapo},i=!!(e!=null&&e.includeTOC),n=e==null?void 0:e.coverImageDataUrl,s=a.map((c,u)=>{var x;const f=_(c),P=E(t,f,o),C=P&&P.plan?P.plan:P,S=c.title||f.title||"Untitled",z=c.key||f.key||"C",y=(x=f.meta)==null?void 0:x.capo;return{raw:c,plan:C,title:S,key:z,capo:y,num:c._songbookNum||u+1,origTitle:c._origTitle||S}}),h=t.internal.pageSize.getWidth(),m=t.internal.pageSize.getHeight(),r=o.margin,d=16,g=Math.floor((m-r*2-40)/d),W=i?Math.ceil(s.length/g):0;let T=1+(n?1:0)+W;const k=s.map(c=>{const u={num:c.num,title:c.origTitle,page:T};return T+=c.plan.layout.pages.length,u});if(n){try{t.addImage(n,"JPEG",0,0,h,m,void 0,"FAST")}catch{}(i||s.length)&&t.addPage()}if(i){t.setFont(o.lyricFamily,"bold"),t.setFontSize(24),t.text("Table of Contents",h/2,r+20,{align:"center"}),t.setFont(o.lyricFamily,"normal"),t.setFontSize(12);let c=r+40;k.forEach((u,f)=>{f>0&&f%g===0&&(t.addPage(),c=r);const P=`${u.num} ${u.title}`;t.text(P,r,c);const C=String(u.page),S=h-r,z=t.getTextWidth(P),y=t.getTextWidth(C),x=S-r-z-y-4;if(x>0){const F=t.getTextWidth("."),w=".".repeat(Math.max(0,Math.floor(x/F)));t.text(w,r+z+2,c)}t.text(C,S,c,{align:"right"}),c+=d}),s.length&&t.addPage()}s.forEach((c,u)=>{u>0&&t.addPage(),v(t,c.plan,{title:c.title,key:c.key,capo:c.capo,showCapo:(e==null?void 0:e.showCapo)!==!1})}),t.setProperties({title:(e==null?void 0:e.docTitle)||"GraceChords Setlist"}),t.save((e==null?void 0:e.fileName)||"GraceChords_Selection.pdf")}async function O(a,{includeTOC:e,coverImageDataUrl:t}={}){const l=a.map((i,n)=>({...i,title:`${n+1}. ${i.title}`,_songbookNum:n+1,_origTitle:i.title})),o=new Date().toISOString().slice(0,10).replace(/-/g,"");await I(l,{includeTOC:e,coverImageDataUrl:t,docTitle:"GraceChords Songbook",fileName:`songbook-${o}.pdf`})}function j(a,e,t={lyrics:"Noto Sans",chords:"Noto Sans Mono",chordWeight:"bold"}){return _measureSection(a,{fontSize:e,lyricFamily:t.lyrics,chordFamily:t.chords,chordWeight:t.chordWeight||"bold"})}export{D as chooseBestLayout,A as chooseBestLayoutAuto,I as downloadMultiSongPdf,B as downloadSingleSongPdf,O as downloadSongbookPdf,j as measureSection,_ as normalizeSongInput,J as planSongLayout};
