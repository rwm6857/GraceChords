const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./jszip.min-BWVdNgT-.js","./index-vxMVVDS7.js","./index-DzN3YmhX.css","./index-Df1ZhIbB.js"])))=>i.map(i=>d[i]);
import{_ as oe,j as t,u as tt,a as nt,b as st,r as x,i as it,d as rt,F as ot,B as v,c as at,T as Pe,D as B,L as ve,e as Ne,M as Te,S as lt,C as ct,P as $e,f as dt,I as ut,g as Ie,K as pt,A as ft,h as mt,k as ht,l as yt,m as gt,p as xt,s as wt,t as St,n as bt,o as jt,q as D}from"./index-vxMVVDS7.js";import{P as Pt}from"./PageContainer-B9RqifrH.js";const De="gracechords.sets.v1";function ee(){try{const e=localStorage.getItem(De);return e?JSON.parse(e):{sets:{}}}catch{return{sets:{}}}}function _e(e){localStorage.setItem(De,JSON.stringify(e))}function vt(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"id-"+Math.random().toString(36).slice(2)+Date.now().toString(36)}function K(){const{sets:e}=ee();return Object.values(e).sort((s,i)=>(i.updatedAt||0)-(s.updatedAt||0))}function Nt(e){const{sets:s}=ee();return s[e]||null}function Ee(e){const s=Date.now(),i={id:e.id||vt(),name:e.name?.trim()||"Untitled Set",items:Array.isArray(e.items)?e.items:[],createdAt:e.createdAt||s,updatedAt:s},o=ee();return o.sets[i.id]=i,_e(o),i}function Tt(e){const s=ee();return s.sets[e]?(delete s.sets[e],_e(s),!0):!1}const $t="application/vnd.openxmlformats-officedocument.presentationml.slide+xml",It="application/vnd.openxmlformats-officedocument.presentationml.notesSlide+xml",G="http://schemas.openxmlformats.org/presentationml/2006/main",Et="http://schemas.openxmlformats.org/officeDocument/2006/relationships",Ct=new DOMParser,At=new XMLSerializer;function Lt(e){const s="setlist",i=String(e).trim();return i&&i.replace(/\s+/g,"_").replace(/[^A-Za-z0-9_.-]/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"")||s}async function Ce(e){const s=await fetch(e);if(!s.ok)throw new Error(`Failed to load PPTX: ${e}`);return s.arrayBuffer()}function X(e){const s=Ct.parseFromString(e,"application/xml"),i=s.getElementsByTagName("parsererror")[0];if(i)throw new Error(i.textContent||"Failed to parse XML");return s}function M(e){return At.serializeToString(e)}function V(e){const s=String(e||"").match(/(\d+)$/);return s?Number(s[1]):0}function ie(e,s){let i=0;return e.filter(o=>s.test(o)).forEach(o=>{const a=o.name.match(s);if(!a)return;const r=Number(a[1]);Number.isNaN(r)||(i=Math.max(i,r))}),i}function Q(e,s,i){if(Array.from(e.getElementsByTagName("Override")).some(r=>r.getAttribute("PartName")===s))return;const a=e.createElement("Override");a.setAttribute("PartName",s),a.setAttribute("ContentType",i),e.documentElement.appendChild(a)}function re(e,s){if(!s)return null;if(s.startsWith("/"))return s.slice(1);const i=e.split("/");i.pop();const o=s.split("/");for(const a of o)if(a==="..")i.pop();else{if(a===".")continue;i.push(a)}return i.join("/")}function Z(e,s){const i=e.split("/");i.pop();const o=s.split("/");let a=0;for(;a<i.length&&a<o.length&&i[a]===o[a];)a++;const r=i.length-a,m=[];for(let w=0;w<r;w++)m.push("..");return m.push(...o.slice(a)),m.join("/")}function te(e){const s=e.match(/^(.*\/)([^/]*?)(\d+)(\.[^.]+)$/);return s?{dir:s[1],prefix:s[2],number:Number(s[3]),ext:s[4]}:null}function H(e,s,i){const o=Number(e[s]||0);i>o&&(e[s]=i)}function ne(e,s){const o=Number(e[s]||0)+1;return e[s]=o,o}function L(e,s){if(!e)return null;const i=e.file(s);return Array.isArray(i)?i.length?i[0]:null:i||null}async function kt(e){const s="ppt/presentation.xml",i=L(e,s);if(!i)throw new Error("Base PPTX missing ppt/presentation.xml");const o=await i.async("string"),a=X(o),r=a.getElementsByTagNameNS(G,"sldIdLst")[0]||a.getElementsByTagName("p:sldIdLst")[0],w=(r?Array.from(r.getElementsByTagNameNS(G,"sldId")).concat(Array.from(r.getElementsByTagName("p:sldId"))):[]).reduce(($,j)=>{const A=Number(j.getAttribute("id"));return Number.isNaN(A)?$:Math.max($,A)},255),p="ppt/_rels/presentation.xml.rels",S=L(e,p);if(!S)throw new Error("Base PPTX missing ppt/_rels/presentation.xml.rels");const y=await S.async("string"),N=X(y),b=Array.from(N.getElementsByTagName("Relationship")).reduce(($,j)=>{const A=V(j.getAttribute("Id"));return Math.max($,A)},0),k="[Content_Types].xml",E=L(e,k);if(!E)throw new Error("Base PPTX missing [Content_Types].xml");const T=await E.async("string"),C=X(T),g={};return e.filter(()=>!0).forEach($=>{const j=te($.name);if(!j)return;const A=`${j.dir}${j.prefix}`;H(g,A,j.number)}),H(g,"ppt/slides/slide",ie(e,/^ppt\/slides\/slide(\d+)\.xml$/)),H(g,"ppt/notesSlides/notesSlide",ie(e,/^ppt\/notesSlides\/notesSlide(\d+)\.xml$/)),H(g,"ppt/media/image",ie(e,/^ppt\/media\/image(\d+)\.[^.]+$/)),{zip:e,presentationXmlPath:s,presentationDoc:a,sldIdList:r,presentationRelsPath:p,presentationRelsDoc:N,contentTypesPath:k,contentTypesDoc:C,nextSlideId:w,nextRelId:b,counters:g}}function Dt(e,s,i){const o=e.presentationRelsDoc.documentElement,a=e.presentationRelsDoc.createElement("Relationship");a.setAttribute("Id",i),a.setAttribute("Type","http://schemas.openxmlformats.org/officeDocument/2006/relationships/slide"),a.setAttribute("Target",`slides/slide${s}.xml`),o.appendChild(a)}function _t(e,s){const i=e.presentationDoc,o=e.sldIdList||(()=>{const r=i.createElementNS(G,"p:sldIdLst");return i.documentElement.appendChild(r),e.sldIdList=r,r})(),a=i.createElementNS(G,"p:sldId");e.nextSlideId+=1,a.setAttribute("id",String(e.nextSlideId)),a.setAttributeNS(Et,"r:id",s),o.appendChild(a)}async function Rt(e,s,i,o){const a=L(s,i);if(!a)throw new Error(`Missing PPTX binary part: ${i}`);const r=await a.async("uint8array");e.file(o,r)}async function Re(e,s,i,o){const a=L(s,i);if(!a)throw new Error(`Missing PPTX xml part: ${i}`);const r=await a.async("string");e.file(o,r)}async function Bt(e,s,i,o,a){const r=te(i);if(!r)return null;const m=`${r.dir}${r.prefix}`,w=ne(e.counters,m),p=`${r.dir}${r.prefix}${w}${r.ext}`;await Re(e.zip,s,i,p),Q(e.contentTypesDoc,`/${p}`,It);const S=`${r.dir}_rels/${r.prefix}${r.number}${r.ext}.rels`,y=L(s,S);if(y){const N=await y.async("string"),u=X(N),b=Array.from(u.getElementsByTagName("Relationship")),k=Z(p,o);b.forEach(T=>{(T.getAttribute("Type")||"").endsWith("/slide")&&T.setAttribute("Target",k)});const E=`${r.dir}_rels/${r.prefix}${w}${r.ext}.rels`;e.zip.file(E,M(u))}return a.set(i,p),p}async function Xt(e,s,i,o,a,r){const m=o.path,p=`ppt/slides/_rels/slide${o.number}.xml.rels`,S=L(s,p);if(!S)return;const y=await S.async("string"),N=X(y),u=Array.from(N.getElementsByTagName("Relationship")),b=a;for(const E of u){const T=E.getAttribute("Type")||"",C=E.getAttribute("Target")||"";if(C)if(T.endsWith("/notesSlide")){const g=re(m,C);if(!g)continue;const j=r.get(g)||await Bt(e,s,g,a,r);if(!j)continue;const A=Z(b,j);E.setAttribute("Target",A)}else if(T.includes("/image")||T.includes("/video")||T.includes("/audio")){const g=re(m,C);if(!g)continue;const $=r.get(g)||await Mt(e,s,i,g,r);if(!$)continue;const j=Z(b,$);E.setAttribute("Target",j)}else{const g=re(m,C);if(!g||g.startsWith("ppt/slideLayouts")||g.startsWith("ppt/slideMasters")||!L(s,g))continue;const $=r.get(g)||await Kt(e,s,i,g,r);if(!$)continue;const j=Z(b,$);E.setAttribute("Target",j)}}const k=`ppt/slides/_rels/${a.split("/").pop()}.rels`;e.zip.file(k,M(N))}function Ae(e,s){if(!e)return null;const o=Array.from(e.getElementsByTagName("Override")).find(a=>a.getAttribute("PartName")===s);return o&&o.getAttribute("ContentType")||null}function Ot(e,s,i){if(!i||Array.from(e.getElementsByTagName("Default")).some(m=>m.getAttribute("Extension")===i))return;const a=Array.from(s?.getElementsByTagName?.("Default")||[]).find(m=>m.getAttribute("Extension")===i);if(!a)return;const r=e.createElement("Default");r.setAttribute("Extension",i),r.setAttribute("ContentType",a.getAttribute("ContentType")||""),e.documentElement.appendChild(r)}async function Kt(e,s,i,o,a){const r=te(o);if(!r){if(!L(e.zip,o)){const y=L(s,o);if(!y)return null;const N=await y.async("string");e.zip.file(o,N);const u=Ae(i,`/${o}`);u&&Q(e.contentTypesDoc,`/${o}`,u)}return a.set(o,o),o}const m=`${r.dir}${r.prefix}`,w=ne(e.counters,m),p=`${r.dir}${r.prefix}${w}${r.ext}`;await Re(e.zip,s,o,p);const S=Ae(i,`/${o}`);return S&&Q(e.contentTypesDoc,`/${p}`,S),a.set(o,p),p}async function Mt(e,s,i,o,a){const r=te(o);if(!r)return null;const m=`${r.dir}${r.prefix}`,w=ne(e.counters,m),p=`${r.dir}${r.prefix}${w}${r.ext}`;await Rt(e.zip,s,o,p);const S=r.ext.startsWith(".")?r.ext.slice(1):"";return Ot(e.contentTypesDoc,i,S),a.set(o,p),p}async function zt(e,s){const i=s.file(/^ppt\/slides\/slide\d+\.xml$/).sort((m,w)=>{const p=V(m.name),S=V(w.name);return p-S});if(!i.length)return;const o=L(s,"[Content_Types].xml");if(!o)throw new Error("Source PPTX missing [Content_Types].xml");const a=await o.async("string"),r=X(a);for(let m=0;m<i.length;m++){const w=i[m],p=V(w.name),S=ne(e.counters,"ppt/slides/slide"),y=`ppt/slides/slide${S}.xml`,N=await w.async("string");e.zip.file(y,N),Q(e.contentTypesDoc,`/${y}`,$t),e.nextRelId+=1;const u=`rId${e.nextRelId}`;Dt(e,S,u),_t(e,u);const b=new Map;b.set(w.name,y),await Xt(e,s,r,{path:w.name,number:p},y,b)}}function Ut(e){e.zip.file(e.presentationXmlPath,M(e.presentationDoc)),e.zip.file(e.presentationRelsPath,M(e.presentationRelsDoc)),e.zip.file(e.contentTypesPath,M(e.contentTypesDoc))}function Ft(e,s){const i=document.createElement("a");i.href=URL.createObjectURL(e),i.download=s,i.rel="noopener",i.click(),URL.revokeObjectURL(i.href)}async function Wt(e=[],s="Setlist"){if(!Array.isArray(e)||e.length===0)throw new Error("No PPTX files to merge");const i=(await oe(async()=>{const{default:y}=await import("./jszip.min-BWVdNgT-.js").then(N=>N.j);return{default:y}},__vite__mapDeps([0,1,2]),import.meta.url)).default,[o,...a]=e,r=await Ce(o),m=await i.loadAsync(r),w=await kt(m);for(let y=0;y<a.length;y++){const N=await Ce(a[y]),u=await i.loadAsync(N);await zt(w,u)}Ut(w);const p=await m.generateAsync({type:"blob"}),S=Lt(s||"Setlist");Ft(p,`${S}.pptx`)}function Yt(e){const s=e||"/";return s.endsWith("/")?s:`${s}/`}function qt(e){return e?e.slug?e.slug:e.filename?e.filename.replace(/\.chordpro$/i,""):e.title?e.title.trim().toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_.-]/g,""):"":""}async function Ht(e={},s={}){const{name:i="Setlist",songs:o=[]}=e||{},{availablePptxMap:a=null,baseUrl:r="./",onEmpty:m}=s,w=Yt(r),p=[];for(const S of o){const y=qt(S);y&&(a&&!a[y]||p.push(`${w}pptx/${y}.pptx`))}if(!p.length){typeof m=="function"&&m();return}await Wt(p,i)}function Jt({label:e,id:s,children:i,className:o="",...a}){return t.jsxs("label",{className:"gc-field",htmlFor:s,children:[e?t.jsx("span",{className:"gc-label",children:e}):null,t.jsx("span",{className:"gc-select",children:t.jsx("select",{id:s,className:o,...a,children:i})})]})}let Le;const ke=()=>Le||(Le=oe(()=>import("./index-Df1ZhIbB.js").then(e=>e.i),__vite__mapDeps([3,1,2]),import.meta.url));function Vt(){try{if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID()}catch{}return`sel-${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`}function Be(e){if(!e)return null;const{id:s,toKey:i=""}=e;return s==null?null:{uid:Vt(),id:s,toKey:i}}function J(e=[]){return e.map(s=>Be(s)).filter(Boolean)}function en(){const{code:e,songIds:s}=tt(),i=nt(),o=st(),[a,r]=x.useState("New Setlist"),[m,w]=x.useState(""),[p,S]=x.useState([]),[y,N]=x.useState(()=>{try{return localStorage.getItem("pref:icpOnly")==="1"}catch{return!1}});x.useEffect(()=>{try{localStorage.setItem("pref:icpOnly",y?"1":"0")}catch{}},[y]);const[u,b]=x.useState([]),[k,E]=x.useState({}),[T,C]=x.useState(""),[g,$]=x.useState("");Object.keys(k).length;const[j,A]=x.useState(!1),[Xe,Oe]=x.useState(()=>{try{return window.innerWidth<=640}catch{return!1}}),[Zt,Ke]=x.useState(()=>{try{return window.innerWidth<=820}catch{return!1}}),[z,Me]=x.useState(()=>{try{return window.innerWidth<=900}catch{return!1}}),ae=x.useRef(""),le=x.useRef(""),[U,F]=x.useState(null),[O,ce]=x.useState(()=>K()),[de,W]=x.useState(""),[ze,Y]=x.useState(!1),[ue,pe]=x.useState("");x.useEffect(()=>{const n=it?.items||[],c=new Set,d=[];for(const l of n)c.has(l.id)||(c.add(l.id),d.push(l));S(d)},[]),x.useEffect(()=>{let n=!1;async function c(){const d={};for(const l of u){const f=p.find(R=>R.id===l.id);if(!f)continue;const h=f.filename.replace(/\.chordpro$/i,""),P=`./pptx/${h}.pptx`;await yt(P,h)&&(d[h]=!0)}n||E(d)}return c(),()=>{n=!0}},[u,p]),x.useEffect(()=>{try{const n=document.documentElement,c=document.body;ae.current=n.style.overflowY||"",le.current=c.style.overflowY||"",getComputedStyle(n).overflowY==="hidden"&&(n.style.overflowY=""),getComputedStyle(c).overflowY==="hidden"&&(c.style.overflowY="")}catch{}return()=>{try{document.documentElement.style.overflowY=ae.current,document.body.style.overflowY=le.current}catch{}}},[]),x.useEffect(()=>{if(!e)return;const{entries:n,error:c}=rt(e);if(c){alert(c),o("/setlist",{replace:!0});return}const d=n.map(h=>({id:h.id,toKey:h.toKey}));b(J(d));const l=d.map(h=>h.id).join(","),f=d.map(h=>encodeURIComponent(h.toKey||"")).join(",");o(`/setlist/${l}?toKeys=${f}`,{replace:!0})},[e]),x.useEffect(()=>{if(!s)return;const n=(s||"").split(",").map(f=>f.trim()).filter(Boolean);if(!n.length)return;const d=(new URLSearchParams(i.search||"").get("toKeys")||"").split(",").map(f=>decodeURIComponent(f)).filter(Boolean),l=n.map((f,h)=>({id:f,toKey:d[h]||""}));b(J(l))},[s,i.search]),x.useEffect(()=>{try{if(!Array.isArray(u))return;if(u.length===0){(e||s)&&o("/setlist",{replace:!0});return}const n=u.map(f=>f.id).join(","),c=u.map(f=>encodeURIComponent(f.toKey||"")).join(","),d=s||"",l=new URLSearchParams(i.search||"").get("toKeys")||"";(n!==d||c!==l)&&o(`/setlist/${n}?toKeys=${c}`,{replace:!0})}catch{}},[u.map(n=>`${n.id}:${n.toKey}`).join("|"),s,i.search,e]),x.useEffect(()=>{try{const n=localStorage.getItem("setlist");if(!n||K().length>0)return;const c=JSON.parse(n);if(c?.name||(c?.list?.length||0)>0){const d=Ee({name:c.name||"Imported Set",items:c.list||[]});ce(K()),F(d.id),r(d.name),b(J(d.items||[])),W(d.id)}}catch{}},[]),x.useEffect(()=>{function n(){try{const c=window.innerWidth;Oe(c<=640),Ke(c<=820),Me(c<=900)}catch{}}return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]);const se=x.useMemo(()=>new ot(p,{keys:["title","tags"],threshold:.4}),[p]);function Ue(n){return!y||(Array.isArray(n.tags)?n.tags.includes("ICP"):n.tags==="ICP")}const Fe=x.useMemo(()=>(m?se.search(m).map(c=>c.item):p.slice().sort((c,d)=>c.title.localeCompare(d.title))).filter(Ue),[m,se,p,y]);function fe(n){if(!n)return;const c=Be({id:n.id,toKey:n.originalKey||n.key||"C"});b(d=>[...d,c])}function We(n){b(c=>c.filter(d=>d.uid!==n))}function me(n,c){b(d=>{const l=d.findIndex(I=>I.uid===n);if(l<0)return d;const f=l+(c==="up"?-1:1);if(f<0||f>=d.length)return d;const h=d.slice(),[P]=h.splice(l,1);return h.splice(f,0,P),h})}function Ye(n,c){b(d=>{if(c<0||c>=d.length)return d;const l=d.findIndex(P=>P.uid===n);if(l<0||l===c)return d;const f=d.slice(),[h]=f.splice(l,1);return f.splice(c,0,h),f})}function qe(n,c){b(d=>d.map(l=>l.uid===n?{...l,toKey:c}:l))}function he(n){ce(K()),W(n||"")}function ye(){F(null),r("New Setlist"),b([]),W("")}function He(){const n=a?.trim()||"New Setlist",c=window.prompt("Save set as:",n);if(c===null)return;const d=String(c).trim()||"New Setlist";let l=U;if(!l){const P=(K()||[]).find(I=>(I.name||"")===d);P&&(l=P.id)}const f=u.map(({id:P,toKey:I})=>({id:P,toKey:I})),h=Ee({id:l,name:d,items:f});r(h.name),F(h.id),he(h.id)}function Je(){const n=ue||de||"";if(!n){Y(!1);return}const c=Nt(n);c&&(F(c.id),r(c.name||"New Setlist"),b(J(c.items||[])),W(c.id)),Y(!1)}function Ve(){const n=O[0]?.id||"";pe(de||n),Y(!0)}function Ze(){U&&window.confirm(`Delete set "${a}"? This cannot be undone.`)&&(Tt(U),ye(),he(""))}async function ge(){A(!0);try{const{downloadMultiSongPdf:n}=await ke(),c=[];for(const d of u){const l=p.find(f=>f.id===d.id);if(l)try{const f=`./songs/${l.filename}`,h=await gt(f),P=xt(h),I=P.meta?.key||P.meta?.originalkey||l.originalKey||"C",R=wt(I,d.toKey||I),Ge=(P.sections||[]).map(be=>({section:be.label,lines:(be.lines||[]).map(_=>_.instrumental?{instrumental:St(_.instrumental,R)}:_.comment?{plain:_.comment,chordPositions:[],comment:_.comment}:{plain:_.lyrics||"",chordPositions:(_.chords||[]).map(je=>({sym:bt(je.sym,R),index:je.index}))})})),Qe=l.filename.replace(/\.chordpro$/i,""),et=jt({title:P.meta?.title||l.title||Qe,key:d.toKey||I,capo:P.meta?.capo,lyricsBlocks:Ge});c.push(et)}catch(f){console.error(f),D(`Failed to process ${l.filename}`)}}c.length&&await n(c)}finally{A(!1)}}function q(){ke()}async function xe(){try{const n=u.map(l=>l.id).join(","),c=u.map(l=>encodeURIComponent(l.toKey||"")).join(","),d=`${i.origin}${i.pathname}#/setlist/${n}?toKeys=${c}`;await navigator.clipboard.writeText(d);try{D?.("Link copied!")}catch{}}catch{alert("Failed to copy link")}}async function we(){if(g)return;C(`Bundling 0/${u.length}…`);const n=(await oe(async()=>{const{default:l}=await import("./jszip.min-BWVdNgT-.js").then(f=>f.j);return{default:l}},__vite__mapDeps([0,1,2]),import.meta.url)).default,c=new n;let d=0;for(let l=0;l<u.length;l++){const f=u[l],h=p.find(I=>I.id===f.id);if(!h){C(`Bundling ${l+1}/${u.length}…`);continue}C(`Bundling ${l+1}/${u.length}…`);const P=h.filename.replace(/\.chordpro$/i,"");if(k[P])try{const I=await fetch(`./pptx/${P}.pptx`);if(!I.ok)continue;const R=await I.blob();d++,c.file(`${String(d).padStart(2,"0")}-${P}.pptx`,R)}catch{}}if(d>0){const l=await c.generateAsync({type:"blob"}),f=new Date().toISOString().slice(0,10).replace(/-/g,""),h=document.createElement("a");h.href=URL.createObjectURL(l),h.download=`setlist-pptx-${f}.zip`,h.click(),URL.revokeObjectURL(h.href)}else try{D&&D("No PPTX files found for selected songs")||alert("No PPTX files found for selected songs")}catch{}C("")}async function Se(){if(!(T||g)){$("Combining…");try{const n=[];for(const c of u){const d=p.find(f=>f.id===c.id);if(!d)continue;const l=d.filename.replace(/\.chordpro$/i,"");k[l]&&n.push(d)}if(!n.length){try{D&&D("No PPTX files found for selected songs")||alert("No PPTX files found for selected songs")}catch{}return}await Ht({name:a||"Setlist",songs:n},{baseUrl:"./"})}catch(n){console.error(n);try{D&&D("Failed to combine PPTX files")||alert("Failed to combine PPTX files")}catch{}}finally{$("")}}}return t.jsxs(Pt,{children:[ze?t.jsx("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,.45)",zIndex:90},role:"dialog","aria-modal":"true",children:t.jsxs("div",{style:{background:"var(--card)",color:"var(--text)",border:"1px solid var(--line)",borderRadius:10,padding:16,width:"min(560px, 92vw)"},children:[t.jsx("h3",{style:{marginTop:0,marginBottom:8},children:"Load Set"}),O.length?t.jsxs("label",{style:{display:"block",margin:"8px 0"},children:["Select a saved set",t.jsx("select",{value:ue,onChange:n=>pe(n.target.value),style:{width:"100%"},children:O.map(n=>t.jsxs("option",{value:n.id,children:[n.name," · ",new Date(n.updatedAt).toLocaleString()]},n.id))})]}):t.jsx("div",{className:"meta",children:"No saved sets yet."}),t.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:8,marginTop:12},children:[t.jsx(v,{onClick:()=>Y(!1),children:"Cancel"}),t.jsx(v,{variant:"primary",onClick:Je,disabled:!O.length,children:"Load"})]})]})}):null,t.jsx(at,{busy:j}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:12,marginBottom:4},children:[t.jsx("div",{}),t.jsx("h1",{style:{margin:0},children:"Setlist Builder"}),t.jsx("div",{})]}),Xe?t.jsx(Pe,{className:"card",style:{marginTop:8,position:"static"},children:t.jsxs("div",{className:"setlist-actions--mobile",style:{width:"100%"},children:[t.jsx(v,{variant:"primary",onClick:ge,onMouseEnter:q,onFocus:q,disabled:j||u.length===0,title:"Export set as a single PDF",iconLeft:t.jsx(B,{}),children:"PDF"}),t.jsx(v,{onClick:we,disabled:u.length===0||!!T||!!g,title:u.length===0?"Add songs to export PPTX bundle":"Export PPTX bundle (ZIP) for selected songs",iconLeft:t.jsx(B,{}),children:"PPTX ZIP"}),t.jsx(v,{onClick:Se,disabled:u.length===0||!!T||!!g,title:u.length===0?"Add songs to combine PPTX files":"Combine PPTX files into a single presentation",iconLeft:t.jsx(B,{}),children:g||"Single PPTX"}),t.jsx(v,{onClick:xe,title:"Copy shareable link",iconLeft:t.jsx(ve,{}),disabled:u.length===0,children:"Share"}),t.jsx(v,{as:Ne,to:u.length?`/worship/${u.map(n=>n.id).join(",")}?toKeys=${u.map(n=>encodeURIComponent(n.toKey)).join(",")}`:"/worship",title:"Open Worship Mode",iconLeft:t.jsx(Te,{}),children:"Worship"})]})}):t.jsxs(Pe,{className:"card",style:{marginTop:8,position:"static"},children:[t.jsx("div",{style:{width:"100%",marginBottom:6},children:t.jsx("strong",{title:"Current set name",children:a||"New Setlist"})}),t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap",width:"100%"},children:[t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[t.jsxs(v,{size:"sm",variant:"secondary",onClick:He,title:"Save set",iconLeft:t.jsx(lt,{}),children:[" ",t.jsx("span",{className:"text-when-wide",children:"Save"})]}),t.jsxs(v,{size:"sm",variant:"secondary",onClick:Ve,title:"Load saved set",iconLeft:t.jsx(ct,{}),disabled:!O.length,children:[" ",t.jsx("span",{className:"text-when-wide",children:"Load"})]}),t.jsxs(v,{size:"sm",variant:"secondary",onClick:ye,title:"New set",iconLeft:t.jsx($e,{}),children:[" ",t.jsx("span",{className:"text-when-wide",children:"New"})]}),t.jsxs(v,{size:"sm",variant:"secondary",onClick:Ze,disabled:!U,title:"Delete set",iconLeft:t.jsx(dt,{}),children:[" ",t.jsx("span",{className:"text-when-wide",children:"Delete"})]})]}),t.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[t.jsx(v,{variant:"primary",size:"md",onClick:ge,onMouseEnter:q,onFocus:q,disabled:j||u.length===0,title:"Export set as a single PDF",iconLeft:t.jsx(B,{}),children:j?"Exporting…":t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-when-wide",children:"Export PDF"}),t.jsx("span",{className:"text-when-narrow",children:"PDF"})]})}),t.jsx(v,{variant:"primary",size:"md",onClick:we,disabled:u.length===0||!!T||!!g,title:u.length===0?"Add songs to export PPTX bundle":"Export PPTX bundle (ZIP) for selected songs",iconLeft:t.jsx(B,{}),children:T||t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-when-wide",children:"Export PPTX ZIP"}),t.jsx("span",{className:"text-when-narrow",children:"PPTX ZIP"})]})}),t.jsx(v,{variant:"primary",size:"md",onClick:Se,disabled:u.length===0||!!T||!!g,title:u.length===0?"Add songs to combine PPTX files":"Combine PPTX files into a single presentation",iconLeft:t.jsx(B,{}),children:g||t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-when-wide",children:"Single PPTX"}),t.jsx("span",{className:"text-when-narrow",children:"Single"})]})}),t.jsx(v,{variant:"primary",size:"md",onClick:xe,title:"Copy shareable link",iconLeft:t.jsx(ve,{}),disabled:u.length===0,children:"Share Set"}),t.jsxs(v,{variant:"primary",size:"md",as:Ne,to:u.length?`/worship/${u.map(n=>n.id).join(",")}?toKeys=${u.map(n=>encodeURIComponent(n.toKey)).join(",")}`:"/worship",title:"Open Worship Mode",iconLeft:t.jsx(Te,{}),children:[" ",t.jsx("span",{className:"text-when-wide",children:"Worship Mode"}),t.jsx("span",{className:"text-when-narrow",children:"Worship"})]})]})]})]}),t.jsxs("div",{className:"BuilderPage",style:{marginTop:8},children:[t.jsx("div",{className:"BuilderLeft",children:t.jsx("section",{className:"setlist-section setlist-add","data-role":"add",children:t.jsxs("div",{className:"card setlist-pane",children:[t.jsxs("div",{className:["BuilderHeader","section-header",z?"no-sticky":""].filter(Boolean).join(" "),style:{display:"flex",alignItems:"center",gap:8},children:[t.jsx("strong",{style:{whiteSpace:"nowrap"},children:"Add songs"}),t.jsx(ut,{value:m,onChange:n=>w(n.target.value),placeholder:"Search...",style:{flex:1,minWidth:0}}),t.jsxs("label",{className:"row",style:{gap:6,alignItems:"center"},children:[t.jsx("input",{type:"checkbox",checked:y,onChange:n=>N(n.target.checked)}),t.jsx("span",{className:"meta",title:"Limit results to songs tagged ICP",children:"ICP only"})]})]}),t.jsx("div",{className:["BuilderScroll","setlist-scroll","setlist-list",z?"no-pane-scroll":"pane-scroll","pane--addSongs"].join(" "),children:se?t.jsx("div",{style:{display:"grid",gap:".5rem",gridTemplateColumns:"repeat(auto-fill, minmax(320px, 1fr))",marginTop:6},children:Fe.map(n=>t.jsx(Ie,{title:n.title,subtitle:`${n.originalKey||""}${n.tags?.length?` • ${n.tags.join(", ")}`:""}`,rightSlot:t.jsx(v,{"aria-label":"Add",title:"Add to set",variant:"primary",iconLeft:t.jsx($e,{}),iconOnly:!0,onClick:c=>{c.stopPropagation(),fe(n)}}),onClick:()=>fe(n)},n.id))}):t.jsx("div",{children:"Loading search…"})})]})})}),t.jsx("div",{className:"BuilderRight",style:{minHeight:0,display:"flex",flexDirection:"column"},children:t.jsxs("section",{className:"setlist-section setlist-current","data-role":"current",children:[t.jsxs("div",{className:"card setlist-pane",children:[t.jsx("div",{className:["BuilderHeader","section-header",z?"no-sticky":""].filter(Boolean).join(" "),children:t.jsxs("strong",{children:["Current setlist (",u.length,")"]})}),t.jsx("div",{className:["BuilderScroll","setlist-scroll","setlist-list",z?"no-pane-scroll":"pane-scroll","pane--currentSet"].join(" "),style:{marginTop:6},children:u.map((n,c)=>{const d=p.find(l=>l.id===n.id);return d?t.jsx(Ie,{draggable:!0,onDragStart:l=>{l.dataTransfer.setData("text/plain",String(n.uid||n.id)),l.dataTransfer.effectAllowed="move"},onDragOver:l=>{l.preventDefault(),l.dataTransfer.dropEffect="move"},onDrop:l=>{l.preventDefault();const f=l.dataTransfer.getData("text/plain");Ye(f,c)},title:d.title,subtitle:`Original: ${d.originalKey||"—"}`,rightSlot:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[t.jsx(Jt,{value:n.toKey,onChange:l=>qe(n.uid,l.target.value),children:pt.map(l=>t.jsx("option",{value:l,children:l},l))}),t.jsx(v,{onClick:()=>me(n.uid,"up"),title:"Move up",iconLeft:t.jsx(ft,{})}),t.jsx(v,{onClick:()=>me(n.uid,"down"),title:"Move down",iconLeft:t.jsx(mt,{})}),t.jsx(v,{onClick:()=>We(n.uid),title:"Remove",iconLeft:t.jsx(ht,{}),iconOnly:!0,style:{color:"#b91c1c"}})]})},n.uid||`${n.id}-${c}`):null})})]}),t.jsxs("div",{className:"print-only",style:{marginTop:16},children:[t.jsx("h2",{style:{fontSize:"20pt",margin:"0 0 8pt 0"},children:a}),t.jsx("ol",{style:{fontSize:"12pt",lineHeight:1.4,paddingLeft:"1.2em"},children:u.map((n,c)=>{const d=p.find(l=>l.id===n.id);return d?t.jsxs("li",{children:[d.title," — ",n.toKey||d.originalKey||"—"]},n.uid||`${n.id}-${c}`):null})})]})]})})]})]})}export{en as default};
