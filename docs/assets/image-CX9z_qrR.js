import{chooseBestLayout as z}from"./pdfLayout-BTB5Jmxg.js";import{a as T}from"./fonts-OQpvcT7Z.js";function p(t,{pxWidth:o,pxHeight:s,dpi:f=150}){const i=document.createElement("canvas");i.width=o,i.height=s;const e=i.getContext("2d");e.fillStyle="#fff",e.fillRect(0,0,i.width,i.height);const h=f/72;e.scale(h,h);const n=t.margin,m=Math.max(22,t.lyricSizePt+6),x=Math.max(12,t.lyricSizePt-2);e.fillStyle="#000",e.font=`bold ${m}px ${t.lyricFamily}`,e.fillText(t.title,n,n+24),e.font=`italic ${x}px ${t.lyricFamily}`,e.fillText(`Key: ${t.key||"â€”"}`,n,n+40);const c=4,d=t.lyricSizePt,a=Math.round(t.lyricSizePt*.85),y=n+t.headerOffsetY;return(t.layout.pages||[])[0].columns.forEach(u=>{let g=u.x,l=y;u.blocks.forEach(r=>{var S;r.type==="section"?(l+=a,e.font=`bold ${d}px ${t.lyricFamily}`,e.fillText(`[${r.header}]`,g,l),l+=d+4):r.type==="line"&&((S=r.chords)!=null&&S.length&&(e.font=`bold ${t.chordSizePt}px ${t.chordFamily}`,r.chords.forEach(P=>e.fillText(P.sym,g+P.x,l)),l+=t.chordSizePt+c/2),e.font=`normal ${t.lyricSizePt}px ${t.lyricFamily}`,e.fillText(r.lyrics,g,l),l+=t.lyricSizePt+c)})}),i}async function v(t,o={}){const s=o.dpi||150,f=o.widthInches||8.5,i=o.heightInches||11,e=Math.round(f*s),h=Math.round(i*s),n=await T(),{lyricFamily:m,chordFamily:x}=n;let c=o.plan;if(c||(document.createElement("canvas").getContext("2d"),c=z(t).plan),c.layout.pages.length>1)return{error:"MULTI_PAGE",plan:c};const d=p(c,{pxWidth:e,pxHeight:h,dpi:s}),a=document.createElement("a"),y=(o.slug||t.slug||t.title||"untitled").replace(/\s+/g,"_");return a.href=d.toDataURL("image/jpeg",.92),a.download=`${y}.jpg`,a.click(),{plan:c}}export{v as downloadSingleSongJpg,T as ensureCanvasFonts,p as renderPlanToCanvas};
