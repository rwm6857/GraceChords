const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jszip.min-C4_oQeN8.js","assets/index-Cs553wRZ.js","assets/index-BLBeZ3GQ.css","assets/index-DitShVIo.js"])))=>i.map(i=>d[i]);
import{_ as ze,p as xe,Y as Kt,Z as Ut,$ as Ft,r as b,i as Xt,a0 as Wt,a1 as Vt,F as zt,a2 as Yt,j as n,a3 as P,a4 as qt,a5 as ot,a6 as ge,a7 as lt,L as ct,a8 as dt,a9 as Ht,aa as Jt,y as Ke,D as Zt,ab as Gt,ac as Ue,ad as Fe,ae as Xe,af as ut,ag as ft,ah as pt,ai as Qt,aj as en,ak as tn,al as Ce,am as ye,an as mt,s as Y,l as nn,m as sn,ao as rn,ap as an,aq as on,ar as ln}from"./index-Cs553wRZ.js";import{P as cn}from"./PageContainer-CjsnmwiY.js";const Tt="gracechords.sets.v1";function $e(){try{const e=localStorage.getItem(Tt);return e?JSON.parse(e):{sets:{}}}catch{return{sets:{}}}}function vt(e){localStorage.setItem(Tt,JSON.stringify(e))}function dn(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"id-"+Math.random().toString(36).slice(2)+Date.now().toString(36)}function ve(){const{sets:e}=$e();return Object.values(e).sort((s,r)=>(r.updatedAt||0)-(s.updatedAt||0))}function un(e){const{sets:s}=$e();return s[e]||null}function ht(e){const s=Date.now(),r={id:e.id||dn(),name:e.name?.trim()||"Untitled Set",items:Array.isArray(e.items)?e.items:[],createdAt:e.createdAt||s,updatedAt:s},d=$e();return d.sets[r.id]=r,vt(d),r}function fn(e){const s=$e();return s.sets[e]?(delete s.sets[e],vt(s),!0):!1}const pn="application/vnd.openxmlformats-officedocument.presentationml.slide+xml",gt="application/vnd.openxmlformats-officedocument.presentationml.slideMaster+xml",mn="application/vnd.openxmlformats-officedocument.presentationml.slideLayout+xml",hn="application/vnd.openxmlformats-officedocument.theme+xml",ee="http://schemas.openxmlformats.org/presentationml/2006/main",Ye="http://schemas.openxmlformats.org/officeDocument/2006/relationships",yt="application/vnd.openxmlformats-officedocument.presentationml.notesMaster+xml",gn=new DOMParser,yn=new XMLSerializer;function xn(e){const s="setlist",r=String(e).trim();return r&&r.replace(/\s+/g,"_").replace(/[^A-Za-z0-9_.-]/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"")||s}async function xt(e){const s=await fetch(e);if(!s.ok)throw new Error(`Failed to load PPTX: ${e}`);return s.arrayBuffer()}function le(e){const s=gn.parseFromString(e,"application/xml"),r=s.getElementsByTagName("parsererror")[0];if(r)throw new Error(r.textContent||"Failed to parse XML");return s}function Ne(e){return yn.serializeToString(e)}function q(e){const s=String(e||"").match(/(\d+)$/);return s?Number(s[1]):0}function me(e,s){let r=0;return e.filter(d=>s.test(d)).forEach(d=>{const i=d.name.match(s);if(!i)return;const f=Number(i[1]);Number.isNaN(f)||(r=Math.max(r,f))}),r}function jt(e,s,r){if(Array.from(e.getElementsByTagName("Override")).some(f=>f.getAttribute("PartName")===s))return;const i=e.createElement("Override");i.setAttribute("PartName",s),i.setAttribute("ContentType",r),e.documentElement.appendChild(i)}function we(e,s){if(!s)return null;if(s.startsWith("/"))return s.slice(1);const r=e.split("/");r.pop();const d=s.split("/");for(const i of d)if(i==="..")r.pop();else{if(i===".")continue;r.push(i)}return r.join("/")}function ce(e,s){const r=e.split("/");r.pop();const d=s.split("/");let i=0;for(;i<r.length&&i<d.length&&r[i]===d[i];)i++;const f=r.length-i,m=[];for(let g=0;g<f;g++)m.push("..");return m.push(...d.slice(i)),m.join("/")}function Nt(e){const s=e.match(/^(.*\/)([^/]*?)(\d+)(\.[^.]+)$/);return s?{dir:s[1],prefix:s[2],number:Number(s[3]),ext:s[4]}:null}function oe(e,s,r){const d=Number(e[s]||0);r>d&&(e[s]=r)}function Pt(e,s){const d=Number(e[s]||0)+1;return e[s]=d,d}function H(e,s){if(!e)return null;const r=e.file(s);return Array.isArray(r)?r.length?r[0]:null:r||null}function be(e){const s=e.lastIndexOf("/"),r=s>=0?e.slice(0,s+1):"",d=s>=0?e.slice(s+1):e;return`${r}_rels/${d}.rels`}function wn(e,s){if(!e||!s)return{contentType:"",fromOverride:!1,extension:""};const r=`/${s}`,i=Array.from(e.getElementsByTagName("Override")).find(y=>y.getAttribute("PartName")===r);if(i)return{contentType:i.getAttribute("ContentType")||"",fromOverride:!0,extension:s.split(".").pop()||""};const f=Array.from(e.getElementsByTagName("Default")),m=s.split(".").pop()||"",g=f.find(y=>y.getAttribute("Extension")===m);return g?{contentType:g.getAttribute("ContentType")||"",fromOverride:!1,extension:m}:{contentType:"",fromOverride:!1,extension:m}}function bn(e,s,r){if(!r||Array.from(e.getElementsByTagName("Default")).some(m=>m.getAttribute("Extension")===r))return;const i=Array.from(s?.getElementsByTagName?.("Default")||[]).find(m=>m.getAttribute("Extension")===r);if(!i)return;const f=e.createElement("Default");f.setAttribute("Extension",r),f.setAttribute("ContentType",i.getAttribute("ContentType")||""),e.documentElement.appendChild(f)}function Sn(e){return e?!/xml|text|application\/(.*\+xml)/i.test(e):!1}function Tn(e){const s=/(.*\D)(\d+)(\.\w+)$/,r=e&&e.match(s);if(r){const[,d,,i]=r;return f=>`${d}${f}${i}`}return d=>`slides/slide${d}.xml`}async function vn(e){const s="ppt/presentation.xml",r=H(e,s);if(!r)throw new Error("Base PPTX missing ppt/presentation.xml");const d=await r.async("string"),i=le(d),f=i.getElementsByTagNameNS(ee,"sldIdLst")[0]||i.getElementsByTagName("p:sldIdLst")[0],g=(f?Array.from(f.getElementsByTagNameNS(ee,"sldId")).concat(Array.from(f.getElementsByTagName("p:sldId"))):[]).reduce((w,j)=>{const M=Number(j.getAttribute("id"));return Number.isNaN(M)?w:Math.max(w,M)},255),y="ppt/_rels/presentation.xml.rels",I=H(e,y);if(!I)throw new Error("Base PPTX missing ppt/_rels/presentation.xml.rels");const T=await I.async("string"),D=le(T),p=Array.from(D.getElementsByTagName("Relationship")),R=p.reduce((w,j)=>{const M=q(j.getAttribute("Id"));return Math.max(w,M)},0),W=p.filter(w=>(w.getAttribute("Type")||"").endsWith("/slide")),C=W.length&&W[0].getAttribute("Target")||"",$=Tn(C),O=i.getElementsByTagNameNS(ee,"sldMasterIdLst")[0]||i.getElementsByTagName("p:sldMasterIdLst")[0]||null,_=(O?Array.from(O.getElementsByTagNameNS(ee,"sldMasterId")).concat(Array.from(O.getElementsByTagName("p:sldMasterId"))):[]).reduce((w,j)=>{const M=Number(j.getAttribute("id"));return Number.isNaN(M)?w:Math.max(w,M)},2147483647),te=i.getElementsByTagNameNS(ee,"notesMasterIdLst")[0]||i.getElementsByTagName("p:notesMasterIdLst")[0]||null;let J=null;const de=p.find(w=>(w.getAttribute("Type")||"").endsWith("/notesMaster"));if(de){const w=de.getAttribute("Target")||"";J=we("ppt/presentation.xml",w)}let ue=null;const Se=p.find(w=>(w.getAttribute("Type")||"").endsWith("/theme"));if(Se){const w=Se.getAttribute("Target")||"";ue=we("ppt/presentation.xml",w)}const se="[Content_Types].xml",fe=H(e,se);if(!fe)throw new Error("Base PPTX missing [Content_Types].xml");const Ae=await fe.async("string"),Pe=le(Ae),V={};e.filter(()=>!0).forEach(w=>{const j=Nt(w.name);if(!j)return;const M=`${j.dir}${j.prefix}`;oe(V,M,j.number)}),oe(V,"ppt/slides/slide",me(e,/^ppt\/slides\/slide(\d+)\.xml$/)),oe(V,"ppt/notesSlides/notesSlide",me(e,/^ppt\/notesSlides\/notesSlide(\d+)\.xml$/)),oe(V,"ppt/slideMasters/slideMaster",me(e,/^ppt\/slideMasters\/slideMaster(\d+)\.xml$/)),oe(V,"ppt/slideLayouts/slideLayout",me(e,/^ppt\/slideLayouts\/slideLayout(\d+)\.xml$/)),oe(V,"ppt/theme/theme",me(e,/^ppt\/theme\/theme(\d+)\.xml$/)),oe(V,"ppt/notesMasters/notesMaster",me(e,/^ppt\/notesMasters\/notesMaster(\d+)\.xml$/)),oe(V,"ppt/media/image",me(e,/^ppt\/media\/image(\d+)\.[^.]+$/));const re=e.file(/^ppt\/slides\/slide\d+\.xml$/).sort((w,j)=>q(w.name)-q(j.name));let Z="",K="",ne="";if(re.length){const w=re[0],j=H(e,be(w.name));if(j){const M=le(await j.async("string")),G=Array.from(M.getElementsByTagName("Relationship")).find(F=>(F.getAttribute("Type")||"").endsWith("/slideLayout"));if(G){Z=G.getAttribute("Target")||"";const F=we(w.name,Z);F&&H(e,F)&&(K=F)}}}if(K)!Z&&re.length&&(Z=ce(re[0].name,K));else{const w=e.file(/^ppt\/slideLayouts\/.*\.xml$/).sort((j,M)=>q(j.name)-q(M.name));w.length&&(K=w[0].name,Z=re.length?ce(re[0].name,K):"../slideLayouts/slideLayout1.xml")}if(K){const w=H(e,be(K));if(w){const j=le(await w.async("string")),Te=Array.from(j.getElementsByTagName("Relationship")).find(G=>(G.getAttribute("Type")||"").endsWith("/slideMaster"));if(Te){const G=Te.getAttribute("Target")||"",F=we(K,G);F&&H(e,F)&&(ne=F)}}}if(!ne){const w=e.file(/^ppt\/slideMasters\/.*\.xml$/).sort((j,M)=>q(j.name)-q(M.name));w.length&&(ne=w[0].name)}if(!J){const w=e.file(/^ppt\/notesMasters\/.*\.xml$/).sort((j,M)=>q(j.name)-q(M.name));w.length&&(J=w[0].name)}return{zip:e,presentationXmlPath:s,presentationDoc:i,sldIdList:f,sldMasterList:O,notesMasterList:te,presentationRelsPath:y,presentationRelsDoc:D,contentTypesPath:se,contentTypesDoc:Pe,nextSlideId:g,nextRelId:R,nextMasterId:_,counters:V,partMap:new Map,masterRelMap:new Map,notesMasterRelMap:new Map,getSlideTarget:$,defaultLayoutTarget:Z,defaultLayoutPath:K,defaultMasterPath:ne,defaultNotesMasterPath:J,defaultThemePath:ue}}function jn(e,s,r){const d=e.presentationRelsDoc.documentElement,i=e.presentationRelsDoc.createElement("Relationship");i.setAttribute("Id",r),i.setAttribute("Type","http://schemas.openxmlformats.org/officeDocument/2006/relationships/slide");const f=e.getSlideTarget?e.getSlideTarget(s):`slides/slide${s}.xml`;i.setAttribute("Target",f),d.appendChild(i)}function Nn(e,s){const r=e.presentationDoc,d=e.sldIdList||(()=>{const f=r.createElementNS(ee,"p:sldIdLst");return r.documentElement.appendChild(f),e.sldIdList=f,f})(),i=r.createElementNS(ee,"p:sldId");e.nextSlideId+=1,i.setAttribute("id",String(e.nextSlideId)),i.setAttributeNS(Ye,"r:id",s),d.appendChild(i)}function Pn(e,s){if(e.masterRelMap.has(s))return e.masterRelMap.get(s);const r=e.presentationDoc,d=e.presentationRelsDoc;let i=e.sldMasterList;if(!i){i=r.createElementNS(ee,"p:sldMasterIdLst");const y=r.documentElement.firstChild;y?r.documentElement.insertBefore(i,y):r.documentElement.appendChild(i),e.sldMasterList=i}e.nextMasterId=Number(e.nextMasterId||2147483647),e.nextMasterId+=1,e.nextRelId+=1;const f=`rId${e.nextRelId}`,m=r.createElementNS(ee,"p:sldMasterId");m.setAttribute("id",String(e.nextMasterId)),m.setAttributeNS(Ye,"r:id",f),i.appendChild(m);const g=d.createElement("Relationship");return g.setAttribute("Id",f),g.setAttribute("Type","http://schemas.openxmlformats.org/officeDocument/2006/relationships/slideMaster"),g.setAttribute("Target",ce("ppt/presentation.xml",s)),d.documentElement.appendChild(g),e.masterRelMap.set(s,f),f}function In(e,s){if(e.notesMasterRelMap.has(s))return e.notesMasterRelMap.get(s);const r=e.presentationDoc,d=e.presentationRelsDoc;let i=e.notesMasterList;if(!i){i=r.createElementNS(ee,"p:notesMasterIdLst");const y=r.documentElement,I=e.sldIdList||y.firstChild;I?y.insertBefore(i,I):y.appendChild(i),e.notesMasterList=i}e.nextRelId+=1;const f=`rId${e.nextRelId}`,m=r.createElementNS(ee,"p:notesMasterId");m.setAttributeNS(Ye,"r:id",f),i.appendChild(m);const g=d.createElement("Relationship");return g.setAttribute("Id",f),g.setAttribute("Type","http://schemas.openxmlformats.org/officeDocument/2006/relationships/notesMaster"),g.setAttribute("Target",ce("ppt/presentation.xml",s)),d.documentElement.appendChild(g),e.notesMasterRelMap.set(s,f),f}async function Me(e,s,r,d,i,f={}){if(!i)return null;const m=`${d}:${i}`;if(e.partMap.has(m))return e.partMap.get(m);const g=wn(r,i),y=H(s,i);if(!y)return null;if(g.contentType===mn&&e.defaultLayoutPath)return e.partMap.set(m,e.defaultLayoutPath),e.defaultLayoutPath;if(g.contentType===gt&&e.defaultMasterPath)return e.partMap.set(m,e.defaultMasterPath),e.defaultMasterPath;if(g.contentType===yt&&e.defaultNotesMasterPath)return e.partMap.set(m,e.defaultNotesMasterPath),e.defaultNotesMasterPath;if(g.contentType===hn&&e.defaultThemePath)return e.partMap.set(m,e.defaultThemePath),e.defaultThemePath;const I=Nt(i);let T;if(I){const W=`${I.dir}${I.prefix}`,C=Pt(e.counters,W);T=`${I.dir}${I.prefix}${C}${I.ext}`}else{if(H(e.zip,i))return e.partMap.set(m,i),i;T=i}e.partMap.set(m,T),g.fromOverride?jt(e.contentTypesDoc,`/${T}`,g.contentType):g.extension&&bn(e.contentTypesDoc,r,g.extension);const D=await y.async(Sn(g.contentType)?"uint8array":"string");e.zip.file(T,D);const p=be(i),R=H(s,p);if(R){const W=await R.async("string"),C=le(W),$=Array.from(C.getElementsByTagName("Relationship"));for(const A of $){if((A.getAttribute("TargetMode")||"").toLowerCase()==="external")continue;const te=A.getAttribute("Target")||"",J=we(i,te);if(!J)continue;let de=null;if(typeof f.relationshipMutator=="function"){const se=await f.relationshipMutator({node:A,type:A.getAttribute("Type")||"",absolutePath:J,newPartPath:T,originalPartPath:i});if(se===!1)continue;se&&se.targetPath&&(de=se.targetPath)}const ue=de||await Me(e,s,r,d,J);if(!ue)continue;const Se=ce(T,ue);A.setAttribute("Target",Se)}const O=be(T);e.zip.file(O,Ne(C))}return g.contentType===gt?Pn(e,T):g.contentType===yt&&In(e,T),T}async function En(e,s,r,d,i,f){const m=be(i),g=H(s,m);if(!g)return;const y=await g.async("string"),I=le(y),T=Array.from(I.getElementsByTagName("Relationship")),D=I.documentElement;let p=!1,R=T.reduce((C,$)=>{const O=$.getAttribute("Id")||"";return Math.max(C,q(O))},0);for(const C of T){const $=C.getAttribute("Type")||"",O=C.getAttribute("Target")||"";if(!O)continue;const A=we(i,O);if(A){if($.endsWith("/slideLayout")){e.defaultLayoutTarget?p?D.removeChild(C):(p=!0,C.setAttribute("Target",e.defaultLayoutTarget)):p?D.removeChild(C):p=!0;continue}if($.endsWith("/notesSlide")){const _=await Me(e,s,r,d,A,{relationshipMutator:({type:te})=>te.endsWith("/slide")?{targetPath:f}:null});if(!_)continue;C.setAttribute("Target",ce(f,_))}else if($.includes("/image")||$.includes("/audio")||$.includes("/video")){const _=await Me(e,s,r,d,A);if(!_)continue;C.setAttribute("Target",ce(f,_))}else{const _=await Me(e,s,r,d,A);if(!_)continue;C.setAttribute("Target",ce(f,_))}}}if(!p&&e.defaultLayoutTarget){const C=I.createElement("Relationship"),$=`rId${R+1||1}`;C.setAttribute("Id",$),C.setAttribute("Type","http://schemas.openxmlformats.org/officeDocument/2006/relationships/slideLayout"),C.setAttribute("Target",e.defaultLayoutTarget),D.appendChild(C)}const W=be(f);e.zip.file(W,Ne(I))}async function Cn(e,s,r){const d=s.file(/^ppt\/slides\/slide\d+\.xml$/).sort((m,g)=>{const y=q(m.name),I=q(g.name);return y-I});if(!d.length)return;const i=H(s,"[Content_Types].xml");if(!i)throw new Error("Source PPTX missing [Content_Types].xml");const f=le(await i.async("string"));for(const m of d){const g=Pt(e.counters,"ppt/slides/slide"),y=`ppt/slides/slide${g}.xml`,I=await m.async("string");e.zip.file(y,I),jt(e.contentTypesDoc,`/${y}`,pn),e.nextRelId+=1;const T=`rId${e.nextRelId}`;jn(e,g,T),Nn(e,T);const D=m.name;e.partMap.set(`${r}:${D}`,y),await En(e,s,f,r,D,y)}}function Mn(e){e.zip.file(e.presentationXmlPath,Ne(e.presentationDoc)),e.zip.file(e.presentationRelsPath,Ne(e.presentationRelsDoc)),e.zip.file(e.contentTypesPath,Ne(e.contentTypesDoc))}function $n(e,s){const r=document.createElement("a");r.href=URL.createObjectURL(e),r.download=s,r.rel="noopener",r.click(),URL.revokeObjectURL(r.href)}async function An(e=[],s="Setlist"){if(!Array.isArray(e)||e.length===0)throw new Error("No PPTX files to merge");const r=(await ze(async()=>{const{default:T}=await import("./jszip.min-C4_oQeN8.js").then(D=>D.j);return{default:T}},__vite__mapDeps([0,1,2]))).default,[d,...i]=e,f=await xt(d),m=await r.loadAsync(f),g=await vn(m);for(let T=0;T<i.length;T++){const D=await xt(i[T]),p=await r.loadAsync(D);await Cn(g,p,`src${T+1}`)}Mn(g);const y=await m.generateAsync({type:"blob"}),I=xn(s||"Setlist");$n(y,`${I}.pptx`)}function Ln(e){return e?e.slug?e.slug:e.filename?e.filename.replace(/\.chordpro$/i,""):e.title?e.title.trim().toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_.-]/g,""):"":""}async function Rn(e={},s={}){const{name:r="Setlist",songs:d=[]}=e||{},{availablePptxMap:i=null,onEmpty:f}=s,m=[];for(const g of d){const y=Ln(g);y&&(i&&!i[y]||m.push(xe(`pptx/${y}.pptx`)))}if(!m.length){typeof f=="function"&&f();return}await An(m,r)}let wt;const bt=()=>wt||(wt=ze(()=>import("./index-DitShVIo.js").then(e=>e.i),__vite__mapDeps([3,1,2])));function kn(){try{if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID()}catch{}return`sel-${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`}function Ve(e){if(!e)return null;const{id:s,toKey:r=""}=e;return s==null?null:{uid:kn(),id:s,toKey:r}}function je(e=[]){return e.map(s=>Ve(s)).filter(Boolean)}function St(e){try{return decodeURIComponent(e)}catch{return e}}function It(e){const s=String(e||"");if(!s.trim())return{bookPart:"",refPart:""};const r=s.indexOf(":");if(r>-1){let i=r-1;for(;i>=0&&/\d/.test(s[i]);)i-=1;const f=i+1;if(f<r)return{bookPart:s.slice(0,f).trim(),refPart:s.slice(f).trim()}}const d=s.match(/\s(\d+)(?=[\s:.,-]|$)/);return d&&typeof d.index=="number"?{bookPart:s.slice(0,d.index).trim(),refPart:s.slice(d.index+1).trim()}:{bookPart:s.trim(),refPart:""}}function We(e,s){if(!s)return null;const r=String(e||"");if(!r.trim())return null;const{bookPart:d,refPart:i}=It(r);if(!d)return null;const f=g=>String(g||"").toLowerCase().replace(/[^a-z0-9]/g,""),m=i?`${s} ${i}`:`${s} `;return!f(m).startsWith(f(r))||m.length<=r.length?null:{composed:m,prefix:r,remainder:m.slice(r.length)}}function On(){const{code:e,songIds:s}=Kt(),r=Ut(),d=Ft(),[i,f]=b.useState("New Setlist"),[m,g]=b.useState(""),[y,I]=b.useState([]),[T,D]=b.useState(()=>{try{return localStorage.getItem("pref:icpOnly")==="1"}catch{return!1}});b.useEffect(()=>{try{localStorage.setItem("pref:icpOnly",T?"1":"0")}catch{}},[T]);const[p,R]=b.useState([]),[W,C]=b.useState({}),[$,O]=b.useState(""),[A,_]=b.useState("");Object.keys(W).length;const[te,J]=b.useState(!1),[de,ue]=b.useState(()=>{try{return window.innerWidth<=640}catch{return!1}}),[Se,se]=b.useState(()=>{try{return window.innerWidth<=820}catch{return!1}}),[fe,Ae]=b.useState(()=>{try{return window.innerWidth<=900}catch{return!1}}),Pe=b.useRef(""),V=b.useRef(""),re=b.useRef(!1),[Z,K]=b.useState(null),[ne,w]=b.useState(()=>ve()),[j,M]=b.useState(""),[Te,G]=b.useState(!1),[F,Le]=b.useState(""),[Re,ke]=b.useState(!1),[ie,De]=b.useState(""),[Be,he]=b.useState(""),[Oe,Et]=b.useState(""),qe=b.useRef(new Map);b.useEffect(()=>{const t=Xt?.items||[],a=new Set,l=[];for(const o of t)a.has(o.id)||Wt(o)||(a.add(o.id),l.push(o));I(l)},[]),b.useEffect(()=>{let t=!1;async function a(){const l={};for(const o of p){const c=y.find(L=>L.id===o.id);if(!c)continue;const u=c.filename.replace(/\.chordpro$/i,""),h=xe(`pptx/${u}.pptx`);await en(h,u)&&(l[u]=!0)}t||C(l)}return a(),()=>{t=!0}},[p,y]),b.useEffect(()=>{try{const t=document.documentElement,a=document.body;Pe.current=t.style.overflowY||"",V.current=a.style.overflowY||"",getComputedStyle(t).overflowY==="hidden"&&(t.style.overflowY=""),getComputedStyle(a).overflowY==="hidden"&&(a.style.overflowY="")}catch{}return()=>{try{document.documentElement.style.overflowY=Pe.current,document.body.style.overflowY=V.current}catch{}}},[]),b.useEffect(()=>{if(!e)return;const{entries:t,error:a}=Vt(e);if(a){alert(a),d("/setlist",{replace:!0});return}const l=t.map(u=>({id:u.id,toKey:u.toKey}));R(je(l));const o=l.map(u=>encodeURIComponent(u.id)).join(","),c=l.map(u=>encodeURIComponent(u.toKey||"")).join(",");d(`/setlist/${o}?toKeys=${c}`,{replace:!0})},[e]),b.useEffect(()=>{if(!s)return;const t=(s||"").split(",").map(c=>St(c.trim())).filter(Boolean);if(!t.length)return;const l=(new URLSearchParams(r.search||"").get("toKeys")||"").split(",").map(c=>St(c)),o=t.map((c,u)=>({id:c,toKey:l[u]||""}));R(je(o))},[s,r.search]),b.useEffect(()=>{try{if(!Array.isArray(p))return;if(p.length===0){(e||s)&&d("/setlist",{replace:!0});return}const t=p.map(c=>encodeURIComponent(c.id)).join(","),a=p.map(c=>encodeURIComponent(c.toKey||"")).join(","),l=s||"",o=new URLSearchParams(r.search||"").get("toKeys")||"";(t!==l||a!==o)&&d(`/setlist/${t}?toKeys=${a}`,{replace:!0})}catch{}},[p.map(t=>`${t.id}:${t.toKey}`).join("|"),s,r.search,e]),b.useEffect(()=>{try{const t=localStorage.getItem("setlist");if(!t||ve().length>0)return;const a=JSON.parse(t);if(a?.name||(a?.list?.length||0)>0){const l=ht({name:a.name||"Imported Set",items:a.list||[]});w(ve()),K(l.id),f(l.name),R(je(l.items||[])),M(l.id)}}catch{}},[]),b.useEffect(()=>{function t(){try{const a=window.innerWidth;ue(a<=640),se(a<=820),Ae(a<=900)}catch{}}return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),b.useEffect(()=>{new URLSearchParams(r.search||"").get("icp")==="1"&&D(!0)},[r.search]),b.useEffect(()=>{if(re.current)return;const t=r.state?.quickAction;t&&y.length&&($t(t,y),re.current=!0,d(r.pathname+(r.search||""),{replace:!0,state:null}))},[r.state,y.map(t=>t.id).join("|")]);const _e=b.useMemo(()=>new zt(y,{keys:["title","tags"],threshold:.4}),[y]);function Ct(t){return!T||(Array.isArray(t.tags)?t.tags.includes("ICP"):t.tags==="ICP")}const Mt=b.useMemo(()=>(m?_e.search(m).map(a=>a.item):y.slice().sort((a,l)=>a.title.localeCompare(l.title))).filter(Ct),[m,_e,y,T]);function He(t){if(!t)return;const a=Ve({id:t.id,toKey:t.originalKey||t.key||"C"});R(l=>[...l,a])}async function Je(t){const a=tn(t);if(a.error)return he("Please check verse reference."),!1;const l=await Bt(a);if(!l.ok)return he(l.message),!1;const o=Ve({id:a.id,toKey:""});return o?(R(c=>[...c,o]),De(""),he(""),ke(!1),!0):!1}function Ze(t){R(a=>a.filter(l=>l.uid!==t))}function Ie(t,a){R(l=>{const o=l.findIndex(x=>x.uid===t);if(o<0)return l;const c=o+(a==="up"?-1:1);if(c<0||c>=l.length)return l;const u=l.slice(),[h]=u.splice(o,1);return u.splice(c,0,h),u})}function Ge(t,a){R(l=>{if(a<0||a>=l.length)return l;const o=l.findIndex(h=>h.uid===t);if(o<0||o===a)return l;const c=l.slice(),[u]=c.splice(o,1);return c.splice(a,0,u),c})}function $t(t,a){if(!t)return;function l(S){!S||!S.length||R(je(S.map(N=>({id:N.id,toKey:N.toKey}))))}function o(S){return S?{id:S.id,toKey:S.originalKey||S.key||"C"}:null}function c(S,N){return S.filter(v=>v&&!N.has(v.id))}function u(S,N){const v=c(S,N),B=v.length?mt(v):null;return B&&N.add(B.id),B}function h(){const S=Ce(a,"FAST"),N=[],v=new Set;if((S.length>=4?ye(S,4):S.slice()).forEach(E=>{E&&v.add(E.id),N.push(E)}),N.length<4){const E=ye(c(a,v),Math.min(4-N.length,Math.max(0,a.length-N.length)));N.push(...E)}return N.filter(Boolean).map(o).filter(Boolean).slice(0,4)}function x(){const S=new Set,N=Ce(a,"SLOW"),v=X=>N.filter(U=>(U?.originalKey||"").toUpperCase()===X.toUpperCase()),B=Ce(a,"FAST"),E=u(v("G"),S)||u(N,S)||u(a,S),Q=u(B,S)||u(a,S),z=u(v("A"),S)||u(N,S)||u(a,S);return[E,Q,z].filter(Boolean).map(o).filter(Boolean)}function L(){const N=mt(["CROSS","COMMITMENT","MISSION","MISSIONS","PRAISE","HYMN"]),v=Ce(a,N),B=new Set,E=[];v.length>=4?E.push(...ye(v,4)):v.length>=2?E.push(...ye(v,Math.min(4,v.length))):v.length&&E.push(...v),E.forEach(z=>z&&B.add(z.id));const Q=Math.max(0,2-E.length);if(Q>0){const z=ye(c(a,B),Math.min(Q,a.length-E.length));E.push(...z)}if(E.length<4){const z=ye(c(a,B),Math.min(4-E.length,a.length-E.length));E.push(...z)}return E.filter(Boolean).map(o).filter(Boolean).slice(0,4)}let k=[];t==="celebrationSet"?k=h():t==="threeSongFlow"?k=x():t==="randomThemeSet"&&(k=L()),k.length&&l(k)}function At(t,a){R(l=>l.map(o=>o.uid===t?{...o,toKey:a}:o))}function Qe(t){w(ve()),M(t||"")}function et(){K(null),f("New Setlist"),R([]),M("")}function Lt(){const t=i?.trim()||"New Setlist",a=window.prompt("Save set as:",t);if(a===null)return;const l=String(a).trim()||"New Setlist";let o=Z;if(!o){const h=(ve()||[]).find(x=>(x.name||"")===l);h&&(o=h.id)}const c=p.map(({id:h,toKey:x})=>({id:h,toKey:x})),u=ht({id:o,name:l,items:c});f(u.name),K(u.id),Qe(u.id)}function Rt(){const t=F||j||"";if(!t){G(!1);return}const a=un(t);a&&(K(a.id),f(a.name||"New Setlist"),R(je(a.items||[])),M(a.id)),G(!1)}function kt(){const t=ne[0]?.id||"";Le(j||t),G(!0)}function Dt(){Z&&window.confirm(`Delete set "${i}"? This cannot be undone.`)&&(fn(Z),et(),Qe(""))}async function tt(){J(!0);try{let t=function(u){return Object.keys(u?.verses||{}).map(h=>Number(h)).filter(h=>!Number.isNaN(h)).sort((h,x)=>h-x)};const{downloadMultiSongPdf:a}=await bt(),l=[],o=qe.current;async function c(u,h){const x=`${u}::${h}`;if(o.has(x))return o.get(x);try{const L=await fetch(xe(`esv/${encodeURIComponent(u)}/${h}.json`));if(!L.ok)throw new Error("Missing chapter");const k=await L.json();return o.set(x,k),k}catch{return o.set(x,null),null}}for(const u of p){if(Fe(u.id)){const x=Xe(u.id);if(!x){Y("Please check verse reference.");continue}try{const L=x.segments||[],k=L.length>1,S=[],N=new Set;for(const v of L){const B=await c(x.book,v.chapter);if(!B?.verses)continue;const E=B.verses||{},Q=t(B),z=Q.length?Q[Q.length-1]:0;if(!v.ranges){for(const X of Q){const U=`${v.chapter}:${X}`;if(N.has(U))continue;const pe=E[String(X)];if(!pe)continue;const ae=k?`${v.chapter}:${X}`:`${X}`;S.push({plain:`${ae} ${pe}`}),N.add(U)}continue}for(const X of v.ranges){const U=X.start,pe=X.end==null?z:X.end;for(let ae=U;ae<=pe;ae+=1){const it=`${v.chapter}:${ae}`;if(N.has(it))continue;const at=E[String(ae)];if(!at)continue;const _t=k?`${v.chapter}:${ae}`:`${ae}`;S.push({plain:`${_t} ${at}`}),N.add(it)}}}if(!S.length){Y(`No verses found for ${x.refDisplay}`);continue}l.push({title:x.refDisplay||x.id,key:"",pdfColumns:1,sections:[{label:"",lines:S}]})}catch(L){console.error(L),Y(`Failed to load ${x.refDisplay}`)}continue}const h=y.find(x=>x.id===u.id);if(h)try{const x=xe(`songs/${h.filename}`),L=await nn(x),k=sn(L),S=k.meta?.key||k.meta?.originalkey||h.originalKey||"C",N=rn(S,u.toKey||S),v=(String(S).match(/^([A-G][#b]?)/)||[,""])[1],B=!!(v&&/b$/.test(v)),E=(k.sections||[]).map(X=>({section:X.label,lines:(X.lines||[]).map(U=>U.instrumental?{instrumental:an(U.instrumental,N,B)}:U.comment?{plain:U.comment,chordPositions:[],comment:U.comment}:{plain:U.lyrics||"",chordPositions:(U.chords||[]).map(pe=>({sym:on(pe.sym,N,B),index:pe.index}))})})),Q=h.filename.replace(/\.chordpro$/i,""),z=ln({title:k.meta?.title||h.title||Q,key:u.toKey||S,capo:k.meta?.capo,lyricsBlocks:E});l.push(z)}catch(x){console.error(x),Y(`Failed to process ${h.filename}`)}}l.length&&await a(l)}finally{J(!1)}}function Ee(){bt()}async function nt(){try{const t=p.map(c=>encodeURIComponent(c.id)).join(","),a=p.map(c=>encodeURIComponent(c.toKey||"")).join(","),o=`${(()=>{try{if(typeof window<"u"&&window.location)return`${window.location.origin||""}/`}catch{}return""})()}setlist/${t}?toKeys=${a}`;await navigator.clipboard.writeText(o);try{Y?.("Link copied!")}catch{}}catch{alert("Failed to copy link")}}b.useEffect(()=>{if(!Re)return;const t=It(ie).bookPart,a=Yt(t);Et(a||"")},[ie,Re]);async function Bt(t){if(!t?.book||!t?.segments?.length)return{ok:!1,message:"Please check verse reference."};async function a(o,c){const u=`${o}::${c}`,h=qe.current;if(h.has(u))return h.get(u);try{const x=await fetch(xe(`esv/${encodeURIComponent(o)}/${c}.json`));if(!x.ok)throw new Error("Missing chapter");const L=await x.json();return h.set(u,L),L}catch{return h.set(u,null),null}}let l=!1;for(const o of t.segments){const c=await a(t.book,o.chapter);if(!c?.verses)return{ok:!1,message:"No verse found."};const u=c.verses||{},h=Object.keys(u);if(!o.ranges){h.length&&(l=!0);continue}for(const x of o.ranges){const L=x.start,k=x.end??L;if(!u[String(L)]||!u[String(k)])return{ok:!1,message:"Please check verse reference."};l=!0}}return l?{ok:!0}:{ok:!1,message:"No verse found."}}function Ot(){const t=We(ie,Oe);t&&De(t.composed)}async function st(){if(A)return;O(`Bundling 0/${p.length}…`);const t=(await ze(async()=>{const{default:o}=await import("./jszip.min-C4_oQeN8.js").then(c=>c.j);return{default:o}},__vite__mapDeps([0,1,2]))).default,a=new t;let l=0;for(let o=0;o<p.length;o++){const c=p[o],u=y.find(x=>x.id===c.id);if(!u){O(`Bundling ${o+1}/${p.length}…`);continue}O(`Bundling ${o+1}/${p.length}…`);const h=u.filename.replace(/\.chordpro$/i,"");if(W[h])try{const x=await fetch(xe(`pptx/${h}.pptx`));if(!x.ok)continue;const L=await x.blob();l++,a.file(`${String(l).padStart(2,"0")}-${h}.pptx`,L)}catch{}}if(l>0){const o=await a.generateAsync({type:"blob"}),c=new Date().toISOString().slice(0,10).replace(/-/g,""),u=document.createElement("a");u.href=URL.createObjectURL(o),u.download=`setlist-pptx-${c}.zip`,u.click(),URL.revokeObjectURL(u.href)}else try{Y&&Y("No PPTX files found for selected songs")||alert("No PPTX files found for selected songs")}catch{}O("")}async function rt(){if(!($||A)){_("Combining…");try{const t=[],a=[];for(const l of p){const o=y.find(u=>u.id===l.id);if(!o)continue;const c=o.filename.replace(/\.chordpro$/i,"");if(!W[c]){a.push(o.title||c);continue}t.push(o)}if(!t.length){try{Y&&Y("No PPTX files found for selected songs")||alert("No PPTX files found for selected songs")}catch{}return}if(a.length){const l=a.length===1?`${a[0]} PPT file unavailable`:`${a.length} songs missing PPT files`;try{Y?.(l)}catch{}}await Rn({name:i||"Setlist",songs:t},{})}catch(t){console.error(t);try{Y&&Y("Failed to combine PPTX files")||alert("Failed to combine PPTX files")}catch{}}finally{_("")}}}return n.jsxs(cn,{className:"is-setlist",children:[Te?n.jsx("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,.45)",zIndex:90},role:"dialog","aria-modal":"true",children:n.jsxs("div",{style:{background:"var(--card)",color:"var(--text)",border:"1px solid var(--line)",borderRadius:10,padding:16,width:"min(560px, 92vw)"},children:[n.jsx("h3",{style:{marginTop:0,marginBottom:8},children:"Load Set"}),ne.length?n.jsxs("label",{style:{display:"block",margin:"8px 0"},children:["Select a saved set",n.jsx("select",{value:F,onChange:t=>Le(t.target.value),style:{width:"100%"},children:ne.map(t=>n.jsxs("option",{value:t.id,children:[t.name," · ",new Date(t.updatedAt).toLocaleString()]},t.id))})]}):n.jsx("div",{className:"meta",children:"No saved sets yet."}),n.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:8,marginTop:12},children:[n.jsx(P,{onClick:()=>G(!1),children:"Cancel"}),n.jsx(P,{variant:"primary",onClick:Rt,disabled:!ne.length,children:"Load"})]})]})}):null,Re?n.jsx("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,.45)",zIndex:90},role:"dialog","aria-modal":"true",children:n.jsxs("div",{style:{background:"var(--card)",color:"var(--text)",border:"1px solid var(--line)",borderRadius:10,padding:16,width:"min(560px, 92vw)"},children:[n.jsx("h3",{style:{marginTop:0,marginBottom:8},children:"Add Verse"}),n.jsx("div",{className:"gc-field",style:{margin:"8px 0"},children:n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 140px",gap:8,alignItems:"center"},children:[n.jsx("label",{className:"gc-label",htmlFor:"verse-input",children:"Bible verse"}),n.jsx("label",{className:"gc-label",htmlFor:"verse-translation",children:"Translation"}),n.jsxs("div",{style:{position:"relative"},children:[(()=>{const t=We(ie,Oe);return t?n.jsxs("div",{"aria-hidden":!0,style:{position:"absolute",inset:0,padding:"10px 12px",fontFamily:"var(--gc-font-family)",color:"var(--gc-text-secondary)",lineHeight:"normal",whiteSpace:"pre",overflow:"hidden",textOverflow:"ellipsis",pointerEvents:"none"},children:[n.jsx("span",{style:{visibility:"hidden"},children:t.prefix}),n.jsx("span",{children:t.remainder})]}):null})(),n.jsx("input",{id:"verse-input",value:ie,onChange:t=>{De(t.target.value),Be&&he("")},placeholder:"John 3:16",onKeyDown:t=>{if(t.key==="Tab"&&We(ie,Oe)){t.preventDefault(),Ot();return}t.key==="Enter"&&(t.preventDefault(),Je(ie))},className:"gc-input",style:{width:"100%",background:"transparent",position:"relative",zIndex:1,lineHeight:"normal"}})]}),n.jsx("span",{className:"gc-select",style:{width:"100%"},children:n.jsx("select",{id:"verse-translation",disabled:!0,style:{width:"100%"},children:n.jsx("option",{children:"ESV"})})})]})}),Be?n.jsx("div",{className:"meta",style:{color:"var(--gc-danger)",marginTop:6},children:Be}):null,n.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:8,marginTop:12},children:[n.jsx(P,{onClick:()=>{ke(!1),he("")},children:"Cancel"}),n.jsx(P,{variant:"primary",onClick:()=>Je(ie),children:"Add Verse"})]})]})}):null,n.jsx(qt,{busy:te}),n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:12,marginBottom:4},children:[n.jsx("div",{}),n.jsx("h1",{style:{margin:0},children:"Setlist Builder"}),n.jsx("div",{})]}),de?n.jsx(ot,{className:"card",style:{marginTop:8,position:"static"},children:n.jsxs("div",{className:"setlist-actions--mobile",style:{width:"100%"},children:[n.jsx(P,{variant:"primary",onClick:tt,onMouseEnter:Ee,onFocus:Ee,disabled:te||p.length===0,title:"Export set as a single PDF",iconLeft:n.jsx(ge,{}),children:"PDF"}),n.jsx(P,{onClick:rt,disabled:p.length===0||!!$||!!A,title:p.length===0?"Add songs to combine PPTX files":"Combine PPTX files into a single presentation",iconLeft:n.jsx(ge,{}),children:A||"Export PPT"}),n.jsx(P,{onClick:st,disabled:p.length===0||!!$||!!A,title:p.length===0?"Add songs to export PPTX bundle":"Export PPTX bundle (ZIP) for selected songs",iconLeft:n.jsx(ge,{}),children:"PPT ZIP"}),n.jsx(P,{onClick:nt,title:"Copy shareable link",iconLeft:n.jsx(lt,{}),disabled:p.length===0,children:"Share"}),n.jsx(P,{as:ct,to:p.length?`/worship/${p.map(t=>encodeURIComponent(t.id)).join(",")}?toKeys=${p.map(t=>encodeURIComponent(t.toKey||"")).join(",")}`:"/worship",title:"Open Worship Mode",iconLeft:n.jsx(dt,{}),children:"Worship"})]})}):n.jsxs(ot,{className:"card",style:{marginTop:8,position:"static"},children:[n.jsx("div",{style:{width:"100%",marginBottom:6},children:n.jsx("strong",{title:"Current set name",children:i||"New Setlist"})}),n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap",width:"100%"},children:[n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[n.jsxs(P,{size:"sm",variant:"secondary",onClick:Lt,title:"Save set",iconLeft:n.jsx(Ht,{}),children:[" ",n.jsx("span",{className:"text-when-wide",children:"Save"})]}),n.jsxs(P,{size:"sm",variant:"secondary",onClick:kt,title:"Load saved set",iconLeft:n.jsx(Jt,{}),disabled:!ne.length,children:[" ",n.jsx("span",{className:"text-when-wide",children:"Load"})]}),n.jsxs(P,{size:"sm",variant:"secondary",onClick:et,title:"New set",iconLeft:n.jsx(Ke,{}),children:[" ",n.jsx("span",{className:"text-when-wide",children:"New"})]}),n.jsxs(P,{size:"sm",variant:"secondary",onClick:Dt,disabled:!Z,title:"Delete set",iconLeft:n.jsx(Zt,{}),children:[" ",n.jsx("span",{className:"text-when-wide",children:"Delete"})]}),n.jsxs(P,{size:"sm",variant:"secondary",onClick:nt,title:"Copy shareable link",iconLeft:n.jsx(lt,{}),disabled:p.length===0,children:[" ",n.jsx("span",{className:"text-when-wide",children:"Share Set"})]})]}),n.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[n.jsx(P,{variant:"primary",size:"md",onClick:tt,onMouseEnter:Ee,onFocus:Ee,disabled:te||p.length===0,title:"Export set as a single PDF",iconLeft:n.jsx(ge,{}),children:te?"Exporting…":n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"text-when-wide",children:"Export PDF"}),n.jsx("span",{className:"text-when-narrow",children:"PDF"})]})}),n.jsx(P,{variant:"primary",size:"md",onClick:rt,disabled:p.length===0||!!$||!!A,title:p.length===0?"Add songs to combine PPTX files":"Combine PPTX files into a single presentation",iconLeft:n.jsx(ge,{}),children:A||n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"text-when-wide",children:"Export PPT"}),n.jsx("span",{className:"text-when-narrow",children:"Export PPT"})]})}),n.jsx(P,{variant:"primary",size:"md",onClick:st,disabled:p.length===0||!!$||!!A,title:p.length===0?"Add songs to export PPTX bundle":"Export PPTX bundle (ZIP) for selected songs",iconLeft:n.jsx(ge,{}),children:$||n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"text-when-wide",children:"PPT ZIP"}),n.jsx("span",{className:"text-when-narrow",children:"PPT ZIP"})]})}),n.jsxs(P,{variant:"primary",size:"md",as:ct,to:p.length?`/worship/${p.map(t=>encodeURIComponent(t.id)).join(",")}?toKeys=${p.map(t=>encodeURIComponent(t.toKey||"")).join(",")}`:"/worship",title:"Open Worship Mode",iconLeft:n.jsx(dt,{}),children:[" ",n.jsx("span",{className:"text-when-wide",children:"Worship Mode"}),n.jsx("span",{className:"text-when-narrow",children:"Worship"})]})]})]})]}),n.jsxs("div",{className:"BuilderPage",style:{marginTop:8},children:[n.jsx("div",{className:"BuilderLeft",children:n.jsx("section",{className:"setlist-section setlist-add","data-role":"add",children:n.jsxs("div",{className:"card setlist-pane",children:[n.jsxs("div",{className:["BuilderHeader","section-header",fe?"no-sticky":""].filter(Boolean).join(" "),style:{display:"flex",alignItems:"center",gap:8},children:[n.jsx("strong",{style:{whiteSpace:"nowrap"},children:"Add songs"}),n.jsx(Gt,{value:m,onChange:t=>g(t.target.value),placeholder:"Search...",style:{flex:1,minWidth:0}}),n.jsxs("label",{className:"row",style:{gap:6,alignItems:"center"},children:[n.jsx("input",{type:"checkbox",checked:T,onChange:t=>D(t.target.checked)}),n.jsx("span",{className:"meta",title:"Limit results to songs tagged ICP",children:"ICP only"})]})]}),n.jsx("div",{className:["BuilderScroll","setlist-scroll","setlist-list",fe?"no-pane-scroll":"pane-scroll","pane--addSongs"].join(" "),children:_e?n.jsx("div",{style:{display:"grid",gap:".5rem",gridTemplateColumns:"repeat(auto-fill, minmax(320px, 1fr))",marginTop:6},children:Mt.map(t=>n.jsx(Ue,{title:t.title,subtitle:`${t.originalKey||""}${t.tags?.length?` • ${t.tags.join(", ")}`:""}`,rightSlot:n.jsx(P,{"aria-label":"Add",title:"Add to set",variant:"primary",iconLeft:n.jsx(Ke,{}),iconOnly:!0,onClick:a=>{a.stopPropagation(),He(t)}}),onClick:()=>He(t)},t.id))}):n.jsx("div",{children:"Loading search…"})})]})})}),n.jsx("div",{className:"BuilderRight",style:{minHeight:0,display:"flex",flexDirection:"column"},children:n.jsxs("section",{className:"setlist-section setlist-current","data-role":"current",children:[n.jsxs("div",{className:"card setlist-pane",children:[n.jsxs("div",{className:["BuilderHeader","section-header",fe?"no-sticky":""].filter(Boolean).join(" "),style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8},children:[n.jsxs("strong",{children:["Current setlist (",p.length,")"]}),n.jsx(P,{size:"sm",variant:"secondary",onClick:()=>{ke(!0),he("")},iconLeft:n.jsx(Ke,{}),children:"Add Verse"})]}),n.jsx("div",{className:["BuilderScroll","setlist-scroll","setlist-list",fe?"no-pane-scroll":"pane-scroll","pane--currentSet"].join(" "),style:{marginTop:6},children:p.map((t,a)=>{if(Fe(t.id)){const u=Xe(t.id)?.refDisplay||t.id;return n.jsx(Ue,{draggable:!0,onDragStart:h=>{h.dataTransfer.setData("text/plain",String(t.uid||t.id)),h.dataTransfer.effectAllowed="move"},onDragOver:h=>{h.preventDefault(),h.dataTransfer.dropEffect="move"},onDrop:h=>{h.preventDefault();const x=h.dataTransfer.getData("text/plain");Ge(x,a)},title:u,subtitle:"ESV",rightSlot:n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[n.jsx(P,{onClick:()=>Ie(t.uid,"up"),title:"Move up",iconLeft:n.jsx(ut,{})}),n.jsx(P,{onClick:()=>Ie(t.uid,"down"),title:"Move down",iconLeft:n.jsx(ft,{})}),n.jsx(P,{onClick:()=>Ze(t.uid),title:"Remove",iconLeft:n.jsx(pt,{}),iconOnly:!0,style:{color:"#b91c1c"}})]})},t.uid||`${t.id}-${a}`)}const o=y.find(c=>c.id===t.id);return o?n.jsx(Ue,{draggable:!0,onDragStart:c=>{c.dataTransfer.setData("text/plain",String(t.uid||t.id)),c.dataTransfer.effectAllowed="move"},onDragOver:c=>{c.preventDefault(),c.dataTransfer.dropEffect="move"},onDrop:c=>{c.preventDefault();const u=c.dataTransfer.getData("text/plain");Ge(u,a)},title:o.title,subtitle:`Original: ${o.originalKey||"—"}`,rightSlot:n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[n.jsx(Qt,{variant:"ui",baseKey:o.originalKey||"C",valueKey:t.toKey||o.originalKey||"C",onChange:c=>At(t.uid,c)}),n.jsx(P,{onClick:()=>Ie(t.uid,"up"),title:"Move up",iconLeft:n.jsx(ut,{})}),n.jsx(P,{onClick:()=>Ie(t.uid,"down"),title:"Move down",iconLeft:n.jsx(ft,{})}),n.jsx(P,{onClick:()=>Ze(t.uid),title:"Remove",iconLeft:n.jsx(pt,{}),iconOnly:!0,style:{color:"#b91c1c"}})]})},t.uid||`${t.id}-${a}`):null})})]}),n.jsxs("div",{className:"print-only",style:{marginTop:16},children:[n.jsx("h2",{style:{fontSize:"20pt",margin:"0 0 8pt 0"},children:i}),n.jsx("ol",{style:{fontSize:"12pt",lineHeight:1.4,paddingLeft:"1.2em"},children:p.map((t,a)=>{if(Fe(t.id)){const o=Xe(t.id);return n.jsx("li",{children:o?.refDisplay||t.id},t.uid||`${t.id}-${a}`)}const l=y.find(o=>o.id===t.id);return l?n.jsxs("li",{children:[l.title," — ",t.toKey||l.originalKey||"—"]},t.uid||`${t.id}-${a}`):null})})]})]})})]})]})}export{On as default};
