const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./jspdf.es.min-coK5eS-z.js","./index-CBAsPKxu.js","./index-CgYN5LtB.css"])))=>i.map(i=>d[i]);
import{_ as M}from"./index-CBAsPKxu.js";import{e as W}from"./fonts-OQpvcT7Z.js";import{normalizeSongInput as _,chooseBestLayout as E,DEFAULT_LAYOUT_OPT as v}from"./pdfLayout-B8mhuvOX.js";import{planSongLayout as K}from"./pdfLayout-B8mhuvOX.js";const L=typeof window<"u"&&(()=>{try{return localStorage.getItem("pdfDebug")==="1"}catch{return!1}})();async function b(){const{jsPDF:e}=await M(async()=>{const{jsPDF:t}=await import("./jspdf.es.min-coK5eS-z.js").then(a=>a.j);return{jsPDF:t}},__vite__mapDeps([0,1,2]),import.meta.url);return new e({unit:"pt",format:"letter"})}function C(e,t,a){const n=e.internal.pageSize.getWidth(),c=e.internal.pageSize.getHeight(),l={...v,...a,pageWidth:n,pageHeight:c};return E(t,l,i=>d=>(e.setFont(l.lyricFamily,"normal"),e.setFontSize(i),e.getTextWidth(d||"")),i=>d=>(e.setFont(l.chordFamily,"bold"),e.setFontSize(i),e.getTextWidth(d||"")))}function $(e,t,{title:a,key:n}){const c=String(t.lyricFamily||"Helvetica"),l=String(t.chordFamily||"Courier"),m=e.internal.pageSize.getWidth(),o=e.internal.pageSize.getHeight(),i=t.margin,d=Math.max(22,t.lyricSizePt+6),y=Math.max(12,t.lyricSizePt-2),P=4,z=t.lyricSizePt,k=Math.round(t.lyricSizePt*.85),u=i+t.headerOffsetY,w=m-i*2,r=t.columns===2?(w-t.gutter)/2:w;t.layout.pages.forEach((g,f)=>{f>0&&e.addPage(),e.setFont(c,"bold"),e.setFontSize(d),e.text(a,i,i+24),e.setFont(c,"italic"),e.setFontSize(y),e.text(`Key: ${n||"—"}`,i,i+40),L&&(e.setDrawColor(180),e.rect(i,u,r,o-i-u),t.columns===2&&e.rect(i+r+t.gutter,u,r,o-i-u),e.setFont(c,"normal"),e.setFontSize(9),e.text(`Plan: ${t.columns} col • size ${t.lyricSizePt}pt • family ${t.lyricFamily}/${t.chordFamily}`,i,o-i*.6)),g.columns.forEach(F=>{var x;let h=F.x,s=u;for(const S of F.blocks)if(S.type==="section")s+=k,e.setFont(c,"bold"),e.setFontSize(z),e.text(`[${S.header}]`,h,s),s+=z+4;else if(S.type==="line"){if((x=S.chords)!=null&&x.length){e.setFont(l,"bold"),e.setFontSize(t.chordSizePt);for(const T of S.chords)e.text(T.sym,h+T.x,s);s+=t.chordSizePt+P/2}e.setFont(c,"normal"),e.setFontSize(t.lyricSizePt),e.text(S.lyrics,h,s),s+=t.lyricSizePt+P}})})}async function A(e,t={}){const a=await b();let n={};try{n=await W(a)}catch{}const c={lyricFamily:n.lyricFamily||t.lyricFamily||"Helvetica",chordFamily:n.chordFamily||t.chordFamily||"Courier",...t};return C(a,_(e),c)}async function B(e,t){const a=await b();let n={};try{n=await W(a)}catch{}const c={lyricSizePt:Math.max(12,(t==null?void 0:t.lyricSizePt)||16),chordSizePt:Math.max(12,(t==null?void 0:t.chordSizePt)||16),margin:36,lyricFamily:n.lyricFamily||"Helvetica",chordFamily:n.chordFamily||"Courier",columns:(t==null?void 0:t.columns)===2?2:1},l=_(e),{plan:m}=C(a,l,c),o=e.title||l.title||"Untitled",i=e.key||l.key||"C";return $(a,m,{title:o,key:i}),a.setProperties({title:`${o} – GraceChords`}),a.save(`${o.replace(/\s+/g,"_")}.pdf`),{plan:m}}async function G(e,t={}){const a=await b();let n={};try{n=await W(a)}catch{}const c={lyricSizePt:Math.max(12,(t==null?void 0:t.lyricSizePt)||16),chordSizePt:Math.max(12,(t==null?void 0:t.chordSizePt)||16),margin:36,lyricFamily:n.lyricFamily||"Helvetica",chordFamily:n.chordFamily||"Courier",columns:(t==null?void 0:t.columns)===2?2:1},l=!!(t!=null&&t.includeTOC),m=t==null?void 0:t.coverImageDataUrl,o=e.map((r,g)=>{const f=_(r),{plan:F}=C(a,f,c),h=r.title||f.title||"Untitled",s=r.key||f.key||"C";return{raw:r,plan:F,title:h,key:s,num:r._songbookNum||g+1,origTitle:r._origTitle||h}}),i=a.internal.pageSize.getWidth(),d=a.internal.pageSize.getHeight(),y=c.margin,P=16,z=Math.floor((d-y*2-40)/P),k=l?Math.ceil(o.length/z):0;let u=1+(m?1:0)+k;const w=o.map(r=>{const g={num:r.num,title:r.origTitle,page:u};return u+=r.plan.layout.pages.length,g});if(m){try{a.addImage(m,"JPEG",0,0,i,d,void 0,"FAST")}catch{}(l||o.length)&&a.addPage()}if(l){a.setFont(c.lyricFamily,"bold"),a.setFontSize(24),a.text("Table of Contents",i/2,y+20,{align:"center"}),a.setFont(c.lyricFamily,"normal"),a.setFontSize(12);let r=y+40;w.forEach((g,f)=>{f>0&&f%z===0&&(a.addPage(),r=y);const F=`${g.num} ${g.title}`;a.text(F,y,r);const h=String(g.page),s=i-y,x=a.getTextWidth(F),S=a.getTextWidth(h),T=s-y-x-S-4;if(T>0){const D=a.getTextWidth("."),H=".".repeat(Math.max(0,Math.floor(T/D)));a.text(H,y+x+2,r)}a.text(h,s,r,{align:"right"}),r+=P}),o.length&&a.addPage()}o.forEach((r,g)=>{g>0&&a.addPage(),$(a,r.plan,{title:r.title,key:r.key})}),a.setProperties({title:(t==null?void 0:t.docTitle)||"GraceChords Setlist"}),a.save((t==null?void 0:t.fileName)||"GraceChords_Selection.pdf")}async function N(e,{includeTOC:t,coverImageDataUrl:a}={}){const n=e.map((l,m)=>({...l,title:`${m+1}. ${l.title}`,_songbookNum:m+1,_origTitle:l.title})),c=new Date().toISOString().slice(0,10).replace(/-/g,"");await G(n,{includeTOC:t,coverImageDataUrl:a,docTitle:"GraceChords Songbook",fileName:`songbook-${c}.pdf`})}export{A as chooseBestLayoutAuto,G as downloadMultiSongPdf,B as downloadSingleSongPdf,N as downloadSongbookPdf,K as planSongLayout};
