<<<<<<<< HEAD:docs/assets/Songbook-Mj_5Em8f.js
const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BWE3UUko.js","assets/index-BIPnHQbs.js","assets/index-U0wq2gRi.css"])))=>i.map(i=>d[i]);
import{r as l,a0 as se,i as ae,a1 as ne,a3 as re,a4 as R,a5 as ie,Z as le,$ as oe,a2 as ce,F as de,j as t,a9 as ue,P as ge,B as I,aC as he,ab as me,T as fe,C as D,ag as pe,y as _,f as xe,ah as O,ai as ye,I as H,an as Se,as as z,ar as je,_ as ve,p as we,l as be,m as Ce,ax as Ne,s as L,k as Ie}from"./index-BIPnHQbs.js";import{F as Le}from"./Field-BifDu3va.js";import{P as ke}from"./PageContainer-Dru5Oz3O.js";let U;const W=()=>U||(U=ve(()=>import("./index-BWE3UUko.js").then(u=>u.i),__vite__mapDeps([0,1,2])));function p(u,x){return Ie(u,x)}function Te(){const u=l.useMemo(()=>se(ae?.items||[]),[]),x=u.byId,y=u.translationLanguages||[],[h,$]=l.useState(()=>ne(y.length?y:u.allLanguages)),c=l.useMemo(()=>{const e=[];for(const s of u.groups||[]){let a=re(s,h);if(a){if(R(a)){const n=s.variants.find(r=>!R(r));if(!n)continue;a=n}e.push({...a,hasSelectedLanguage:ie(s,h),searchTitles:s.variants.map(n=>n.title||"").filter(Boolean),searchTags:Array.from(new Set(s.variants.flatMap(n=>n.tags||[]))),searchAuthors:Array.from(new Set(s.variants.flatMap(n=>n.authors||[])))})}}return e.slice().sort((s,a)=>s.hasSelectedLanguage!==a.hasSelectedLanguage?s.hasSelectedLanguage?-1:1:p(s,a))},[u.groups,h]),m=le(),q=oe(),k=l.useRef(!1);l.useEffect(()=>{ce(h)},[h]);const[S,G]=l.useState(""),A=l.useMemo(()=>new de(c,{keys:["title","tags","authors","searchTitles","searchTags","searchAuthors"],threshold:.4}),[c]),j=l.useMemo(()=>{const e=S?A.search(S).map(s=>s.item):c.slice();return e.sort((s,a)=>s.hasSelectedLanguage!==a.hasSelectedLanguage?s.hasSelectedLanguage?-1:1:p(s,a)),e},[c,A,S]),[v,g]=l.useState(()=>new Set),f=l.useMemo(()=>Array.from(v).map(e=>x.get(e)).filter(Boolean).slice().sort(p),[v,x]),B=j.length,Q=v.size;function b(e,s){g(a=>{const n=new Set(a);return s?n.add(e):n.delete(e),n})}function K(){j.length&&g(e=>{const s=new Set(e);for(const a of j)s.add(a.id);return s})}function V(){g(new Set)}function Z(e,s){if(!e)return;const a=s||[],n=r=>new Set(r.map(i=>i.id));if(e==="random10SongCollection"){const r=Math.min(10,a.length),i=r===a.length?a:z(a,r);g(n(i));return}if(e==="sendMeSongbook"){const r=["NATION","NATIONS","MISSION","MISSIONS","ICP"],i=a.filter(o=>r.some(N=>je([o],N).length));if(i.length)i.sort(p),g(n(i));else{const o=z(a,Math.min(5,a.length));g(n(o))}return}if(e==="graceChordsSongbook"){const r=a.slice().sort(p);g(n(r))}}const[J,w]=l.useState(null),[C,P]=l.useState(!1),[T,X]=l.useState(()=>{try{return window.innerWidth<=640}catch{return!1}});l.useEffect(()=>{function e(){try{X(window.innerWidth<=640)}catch{}}return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),l.useEffect(()=>{const s=new URLSearchParams(m.search||"").get("tags");if(!s)return;const a=s.split(",").map(r=>r.trim().toLowerCase()).filter(Boolean);if(!a.length)return;const n=c.filter(r=>(Array.isArray(r.tags)?r.tags.map(o=>String(o).toLowerCase()):[]).some(o=>a.includes(o)));n.length&&g(r=>{const i=new Set(r);return n.forEach(o=>i.add(o.id)),i})},[m.search,c]),l.useEffect(()=>{if(k.current)return;const e=m.state?.quickAction;e&&c.length&&(Z(e,c),k.current=!0,q(m.pathname+(m.search||""),{replace:!0,state:null}))},[m.state,c.map(e=>e.id).join("|")]);async function Y(){if(f.length){P(!0);try{const{downloadSongbookPdf:e}=await W(),s=[];for(const a of f)try{const n=we(`songs/${a.filename}`),r=await be(n),i=Ce(r),o=(i.sections||[]).map(E=>({section:E.label,lines:(E.lines||[]).map(d=>d.instrumental?{instrumental:{chords:Array.isArray(d.instrumental?.chords)?d.instrumental.chords.slice():[],repeat:typeof d.instrumental?.repeat=="number"?d.instrumental.repeat:void 0}}:d.comment?{plain:d.comment,chordPositions:[],comment:d.comment}:{plain:d.lyrics||"",chordPositions:(d.chords||[]).map(F=>({sym:F.sym,index:F.index}))})})),N=a.filename.replace(/\.chordpro$/,""),te=Ne({title:i.meta.title||a.title||N,key:i.meta.key||i.meta.originalkey||a.originalKey||"C",capo:i.meta?.capo,lyricsBlocks:o});s.push(te)}catch(n){console.error(n),L(`Failed to process ${a.filename}`)}s.length&&await e(s,{includeTOC:!0,coverImageDataUrl:J})}finally{P(!1)}}}function M(){W()}function ee(e){const s=e.target.files?.[0];if(!s){w(null);return}if(s.size>2*1024*1024){L("Image must be under 2 MB"),e.target.value="",w(null);return}if(!s.type.startsWith("image/")){L("File must be an image"),e.target.value="",w(null);return}const a=new FileReader;a.onload=()=>w(String(a.result||"")),a.readAsDataURL(s)}return c.length===0?t.jsxs("div",{className:"container",children:[t.jsx("h1",{children:"No songs found"}),t.jsx("p",{className:"Small",children:"The song index is empty or failed to load."})]}):t.jsxs(ke,{children:[t.jsx(ue,{busy:C}),t.jsx(ge,{title:"Songbook Builder",actions:t.jsxs("div",{className:"gc-toolbar__actions",children:[t.jsx(I,{onClick:V,disabled:!Q,title:"Clear selection",leftIcon:t.jsx(he,{}),children:t.jsx("span",{className:"text-when-wide",children:"Clear"})}),t.jsx(I,{variant:"primary",onClick:Y,onMouseEnter:M,onFocus:M,disabled:!f.length||C,loading:C,title:f.length?"Export PDF":"Select some songs first",leftIcon:t.jsx(me,{}),children:T?"PDF":t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-when-wide",children:"Export PDF"}),t.jsx("span",{className:"text-when-narrow",children:"PDF"})]})})]})}),t.jsx(fe,{className:"gc-songbook-toolbar",style:{marginTop:8},children:t.jsx(Le,{label:"Upload Cover Image",className:"gc-songbook-cover",style:{minWidth:0},children:t.jsx("input",{className:"CoverInput",type:"file",accept:"image/*",onChange:ee,style:T?{maxWidth:"50vw",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}:void 0})})}),t.jsxs("div",{className:"BuilderPage",style:{marginTop:8},children:[t.jsx("div",{className:"BuilderLeft",children:t.jsx("section",{className:"setlist-section songbook-add","data-role":"add",children:t.jsxs(D,{className:"setlist-pane",children:[t.jsxs("div",{className:["BuilderHeader","section-header"].filter(Boolean).join(" "),style:{display:"flex",alignItems:"center",gap:8},children:[t.jsx("strong",{style:{whiteSpace:"nowrap"},children:"Add songs"}),t.jsx(pe,{value:S,onChange:e=>G(e.target.value),placeholder:"Search...",style:{flex:1,minWidth:0}}),t.jsxs(I,{onClick:K,disabled:!B,title:"Add all filtered",leftIcon:t.jsx(_,{}),variant:"primary",style:{marginLeft:"auto"},children:[t.jsxs("span",{className:"text-when-wide",children:["Add all (",B,")"]}),t.jsx("span",{className:"text-when-narrow",children:"All"})]})]}),y.length>0?t.jsxs("div",{className:["BuilderHeader","section-header"].filter(Boolean).join(" "),style:{paddingTop:0,display:"flex",alignItems:"center",gap:8},children:[t.jsx("span",{className:"meta",children:"Language"}),t.jsx("div",{className:"tagbar",children:y.map(e=>t.jsx(xe,{variant:"filter",selected:h===e,onClick:()=>$(e),title:`Use ${O(e)} where available`,children:O(e)},e))})]}):null,t.jsx("div",{className:["BuilderScroll","setlist-scroll","pane--addSongs"].join(" "),style:{minHeight:0,flex:"1 1 auto",overflow:"auto",marginTop:6},role:"region","aria-label":"Song list",children:t.jsx("div",{className:"gc-list",style:{display:"grid",gap:".5rem",gridTemplateColumns:"repeat(auto-fill, minmax(320px, 1fr))"},children:j.map(e=>{const s=v.has(e.id),n=[(Array.isArray(e.authors)?e.authors.join(", "):e.authors||"")||"—",e.country].filter(Boolean).join(" • ");return t.jsx(ye,{title:e.title,subtitle:n,rightSlot:s?t.jsx(H,{variant:"destructive","aria-label":"Remove",title:"Remove",onClick:r=>{r.stopPropagation(),b(e.id,!1)},children:t.jsx(Se,{})}):t.jsx(H,{variant:"primary","aria-label":"Add",title:"Add",onClick:r=>{r.stopPropagation(),b(e.id,!0)},children:t.jsx(_,{})}),onClick:()=>b(e.id,!s)},e.id)})})})]})})}),t.jsx("div",{className:"BuilderRight",style:{minHeight:0,display:"flex",flexDirection:"column"},children:t.jsx("section",{className:"setlist-section songbook-current","data-role":"current",children:t.jsxs(D,{className:"setlist-pane",children:[t.jsx("div",{className:"BuilderHeader section-header",children:t.jsxs("strong",{children:["Current selection (",f.length,")"]})}),t.jsx("div",{className:"BuilderScroll pane--currentSet",role:"region","aria-label":"Selected songs",style:{minHeight:0,flex:"1 1 auto",overflow:"auto",marginTop:6},children:t.jsx("ol",{className:"List",style:{listStyle:"decimal inside",margin:0,padding:0},children:f.map(e=>t.jsxs("li",{children:[e.title,Array.isArray(e.authors)&&e.authors.length?t.jsxs("span",{className:"Small",children:[" — ",e.authors.join(", ")]}):null]},e.id))})})]})})})]})]})}export{Te as default};
========
const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-MUjP6nzs.js","assets/index-DFL5IfWW.js","assets/index-CXUYu8sg.css"])))=>i.map(i=>d[i]);
import{r as l,a0 as se,i as ae,a1 as ne,a3 as re,a4 as R,a5 as ie,Z as le,$ as oe,a2 as ce,F as de,j as t,a9 as ue,P as ge,B as I,aC as he,ab as me,T as fe,C as D,ag as pe,y as _,f as xe,ah as O,ai as ye,I as H,an as Se,as as z,ar as je,_ as ve,p as we,l as be,m as Ce,ax as Ne,s as L,k as Ie}from"./index-DFL5IfWW.js";import{F as Le}from"./Field-BYNWWCfd.js";import{P as ke}from"./PageContainer-BJbKOLHt.js";let U;const W=()=>U||(U=ve(()=>import("./index-MUjP6nzs.js").then(u=>u.i),__vite__mapDeps([0,1,2])));function p(u,x){return Ie(u,x)}function Te(){const u=l.useMemo(()=>se(ae?.items||[]),[]),x=u.byId,y=u.translationLanguages||[],[h,$]=l.useState(()=>ne(y.length?y:u.allLanguages)),c=l.useMemo(()=>{const e=[];for(const s of u.groups||[]){let a=re(s,h);if(a){if(R(a)){const n=s.variants.find(r=>!R(r));if(!n)continue;a=n}e.push({...a,hasSelectedLanguage:ie(s,h),searchTitles:s.variants.map(n=>n.title||"").filter(Boolean),searchTags:Array.from(new Set(s.variants.flatMap(n=>n.tags||[]))),searchAuthors:Array.from(new Set(s.variants.flatMap(n=>n.authors||[])))})}}return e.slice().sort((s,a)=>s.hasSelectedLanguage!==a.hasSelectedLanguage?s.hasSelectedLanguage?-1:1:p(s,a))},[u.groups,h]),m=le(),q=oe(),k=l.useRef(!1);l.useEffect(()=>{ce(h)},[h]);const[S,G]=l.useState(""),A=l.useMemo(()=>new de(c,{keys:["title","tags","authors","searchTitles","searchTags","searchAuthors"],threshold:.4}),[c]),j=l.useMemo(()=>{const e=S?A.search(S).map(s=>s.item):c.slice();return e.sort((s,a)=>s.hasSelectedLanguage!==a.hasSelectedLanguage?s.hasSelectedLanguage?-1:1:p(s,a)),e},[c,A,S]),[v,g]=l.useState(()=>new Set),f=l.useMemo(()=>Array.from(v).map(e=>x.get(e)).filter(Boolean).slice().sort(p),[v,x]),B=j.length,Q=v.size;function b(e,s){g(a=>{const n=new Set(a);return s?n.add(e):n.delete(e),n})}function K(){j.length&&g(e=>{const s=new Set(e);for(const a of j)s.add(a.id);return s})}function V(){g(new Set)}function Z(e,s){if(!e)return;const a=s||[],n=r=>new Set(r.map(i=>i.id));if(e==="random10SongCollection"){const r=Math.min(10,a.length),i=r===a.length?a:z(a,r);g(n(i));return}if(e==="sendMeSongbook"){const r=["NATION","NATIONS","MISSION","MISSIONS","ICP"],i=a.filter(o=>r.some(N=>je([o],N).length));if(i.length)i.sort(p),g(n(i));else{const o=z(a,Math.min(5,a.length));g(n(o))}return}if(e==="graceChordsSongbook"){const r=a.slice().sort(p);g(n(r))}}const[J,w]=l.useState(null),[C,P]=l.useState(!1),[T,X]=l.useState(()=>{try{return window.innerWidth<=640}catch{return!1}});l.useEffect(()=>{function e(){try{X(window.innerWidth<=640)}catch{}}return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),l.useEffect(()=>{const s=new URLSearchParams(m.search||"").get("tags");if(!s)return;const a=s.split(",").map(r=>r.trim().toLowerCase()).filter(Boolean);if(!a.length)return;const n=c.filter(r=>(Array.isArray(r.tags)?r.tags.map(o=>String(o).toLowerCase()):[]).some(o=>a.includes(o)));n.length&&g(r=>{const i=new Set(r);return n.forEach(o=>i.add(o.id)),i})},[m.search,c]),l.useEffect(()=>{if(k.current)return;const e=m.state?.quickAction;e&&c.length&&(Z(e,c),k.current=!0,q(m.pathname+(m.search||""),{replace:!0,state:null}))},[m.state,c.map(e=>e.id).join("|")]);async function Y(){if(f.length){P(!0);try{const{downloadSongbookPdf:e}=await W(),s=[];for(const a of f)try{const n=we(`songs/${a.filename}`),r=await be(n),i=Ce(r),o=(i.sections||[]).map(E=>({section:E.label,lines:(E.lines||[]).map(d=>d.instrumental?{instrumental:{chords:Array.isArray(d.instrumental?.chords)?d.instrumental.chords.slice():[],repeat:typeof d.instrumental?.repeat=="number"?d.instrumental.repeat:void 0}}:d.comment?{plain:d.comment,chordPositions:[],comment:d.comment}:{plain:d.lyrics||"",chordPositions:(d.chords||[]).map(F=>({sym:F.sym,index:F.index}))})})),N=a.filename.replace(/\.chordpro$/,""),te=Ne({title:i.meta.title||a.title||N,key:i.meta.key||i.meta.originalkey||a.originalKey||"C",capo:i.meta?.capo,lyricsBlocks:o});s.push(te)}catch(n){console.error(n),L(`Failed to process ${a.filename}`)}s.length&&await e(s,{includeTOC:!0,coverImageDataUrl:J})}finally{P(!1)}}}function M(){W()}function ee(e){const s=e.target.files?.[0];if(!s){w(null);return}if(s.size>2*1024*1024){L("Image must be under 2 MB"),e.target.value="",w(null);return}if(!s.type.startsWith("image/")){L("File must be an image"),e.target.value="",w(null);return}const a=new FileReader;a.onload=()=>w(String(a.result||"")),a.readAsDataURL(s)}return c.length===0?t.jsxs("div",{className:"container",children:[t.jsx("h1",{children:"No songs found"}),t.jsx("p",{className:"Small",children:"The song index is empty or failed to load."})]}):t.jsxs(ke,{children:[t.jsx(ue,{busy:C}),t.jsx(ge,{title:"Songbook Builder",actions:t.jsxs("div",{className:"gc-toolbar__actions",children:[t.jsx(I,{onClick:V,disabled:!Q,title:"Clear selection",leftIcon:t.jsx(he,{}),children:t.jsx("span",{className:"text-when-wide",children:"Clear"})}),t.jsx(I,{variant:"primary",onClick:Y,onMouseEnter:M,onFocus:M,disabled:!f.length||C,loading:C,title:f.length?"Export PDF":"Select some songs first",leftIcon:t.jsx(me,{}),children:T?"PDF":t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-when-wide",children:"Export PDF"}),t.jsx("span",{className:"text-when-narrow",children:"PDF"})]})})]})}),t.jsx(fe,{className:"gc-songbook-toolbar",style:{marginTop:8},children:t.jsx(Le,{label:"Upload Cover Image",className:"gc-songbook-cover",style:{minWidth:0},children:t.jsx("input",{className:"CoverInput",type:"file",accept:"image/*",onChange:ee,style:T?{maxWidth:"50vw",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"}:void 0})})}),t.jsxs("div",{className:"BuilderPage",style:{marginTop:8},children:[t.jsx("div",{className:"BuilderLeft",children:t.jsx("section",{className:"setlist-section songbook-add","data-role":"add",children:t.jsxs(D,{className:"setlist-pane",children:[t.jsxs("div",{className:["BuilderHeader","section-header"].filter(Boolean).join(" "),style:{display:"flex",alignItems:"center",gap:8},children:[t.jsx("strong",{style:{whiteSpace:"nowrap"},children:"Add songs"}),t.jsx(pe,{value:S,onChange:e=>G(e.target.value),placeholder:"Search...",style:{flex:1,minWidth:0}}),t.jsxs(I,{onClick:K,disabled:!B,title:"Add all filtered",leftIcon:t.jsx(_,{}),variant:"primary",style:{marginLeft:"auto"},children:[t.jsxs("span",{className:"text-when-wide",children:["Add all (",B,")"]}),t.jsx("span",{className:"text-when-narrow",children:"All"})]})]}),y.length>0?t.jsxs("div",{className:["BuilderHeader","section-header"].filter(Boolean).join(" "),style:{paddingTop:0,display:"flex",alignItems:"center",gap:8},children:[t.jsx("span",{className:"meta",children:"Language"}),t.jsx("div",{className:"tagbar",children:y.map(e=>t.jsx(xe,{variant:"filter",selected:h===e,onClick:()=>$(e),title:`Use ${O(e)} where available`,children:O(e)},e))})]}):null,t.jsx("div",{className:["BuilderScroll","setlist-scroll","pane--addSongs"].join(" "),style:{minHeight:0,flex:"1 1 auto",overflow:"auto",marginTop:6},role:"region","aria-label":"Song list",children:t.jsx("div",{className:"gc-list",style:{display:"grid",gap:".5rem",gridTemplateColumns:"repeat(auto-fill, minmax(320px, 1fr))"},children:j.map(e=>{const s=v.has(e.id),n=[(Array.isArray(e.authors)?e.authors.join(", "):e.authors||"")||"—",e.country].filter(Boolean).join(" • ");return t.jsx(ye,{title:e.title,subtitle:n,rightSlot:s?t.jsx(H,{variant:"destructive","aria-label":"Remove",title:"Remove",onClick:r=>{r.stopPropagation(),b(e.id,!1)},children:t.jsx(Se,{})}):t.jsx(H,{variant:"primary","aria-label":"Add",title:"Add",onClick:r=>{r.stopPropagation(),b(e.id,!0)},children:t.jsx(_,{})}),onClick:()=>b(e.id,!s)},e.id)})})})]})})}),t.jsx("div",{className:"BuilderRight",style:{minHeight:0,display:"flex",flexDirection:"column"},children:t.jsx("section",{className:"setlist-section songbook-current","data-role":"current",children:t.jsxs(D,{className:"setlist-pane",children:[t.jsx("div",{className:"BuilderHeader section-header",children:t.jsxs("strong",{children:["Current selection (",f.length,")"]})}),t.jsx("div",{className:"BuilderScroll pane--currentSet",role:"region","aria-label":"Selected songs",style:{minHeight:0,flex:"1 1 auto",overflow:"auto",marginTop:6},children:t.jsx("ol",{className:"List",style:{listStyle:"decimal inside",margin:0,padding:0},children:f.map(e=>t.jsxs("li",{children:[e.title,Array.isArray(e.authors)&&e.authors.length?t.jsxs("span",{className:"Small",children:[" — ",e.authors.join(", ")]}):null]},e.id))})})]})})})]})]})}export{Te as default};
>>>>>>>> 1f9e2802 (UI tweaks):docs/assets/Songbook-deQnIyfD.js
