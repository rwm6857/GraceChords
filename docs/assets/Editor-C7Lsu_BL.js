import{r as i,j as e,I as Y,B as N,C as ie,A as le,v as re,s as $,i as ce,p as J,P as Q,T as se,a as de,S as ue,g as X,c as he,b as me,d as ge,t as pe,e as xe,K as M,k as fe,f as je,h as ye,l as be,m as Se,n as Z,o as ve,q as we}from"./index-CLyAo-Xa.js";import{R as Ce}from"./AdminResources-eRadeHlp.js";import"./markdown-DhTLSAy7.js";const ke="10401040",ee=`{title: }
{key: }
{authors: }
{country: }
{tags: }
{youtube: }
{mp3: }

`;function Fe(){const[l,r]=i.useState(()=>{try{return localStorage.getItem("editor:author")||""}catch{return""}}),[d,a]=i.useState(""),[p,x]=i.useState(!1),[m,j]=i.useState("");i.useEffect(()=>{try{localStorage.setItem("editor:author",l||"")}catch{}},[l]);function v(h){if(h.preventDefault(),j(""),!l.trim()){j("Author name is required.");return}d===ke?x(!0):j("Invalid password.")}return p?e.jsx(Ne,{authorName:l.trim()}):e.jsxs("div",{className:"container",style:{maxWidth:520},children:[e.jsx("h1",{children:"GraceChords Editor"}),e.jsx("p",{children:"Enter your author name and password to continue."}),e.jsxs("form",{onSubmit:v,className:"card",style:{display:"grid",gap:10,padding:16},children:[e.jsxs("label",{children:["Author name",e.jsx(Y,{value:l,onChange:h=>r(h.target.value),placeholder:"Your name",required:!0})]}),e.jsxs("label",{children:["Password",e.jsx(Y,{type:"password",value:d,onChange:h=>a(h.target.value),placeholder:"Password",required:!0})]}),m?e.jsx("div",{className:"alert error Small",children:m}):null,e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",gap:8},children:e.jsx(N,{variant:"primary",type:"submit",children:"Enter"})})]})]})}function Ne({authorName:l}){const[r,d]=i.useState("songs"),[a,p]=i.useState(()=>{try{const o=sessionStorage.getItem("editor:staged");return o?JSON.parse(o):[]}catch{return[]}});i.useEffect(()=>{try{a.length?sessionStorage.setItem("editor:staged",JSON.stringify(a)):sessionStorage.removeItem("editor:staged")}catch{}},[a]);const[x,m]=i.useState(!1),[j,v]=i.useState(!1),[h,g]=i.useState("main"),[E,f]=i.useState(null);function R(o){o?.length&&p(S=>[...S,...o])}function _(o){o?.length&&p(S=>[...S,...o])}function P(o){p(S=>S.filter((B,y)=>y!==o))}function F(){p([])}async function A(){try{const o=await re();f(o),$?.(`Token OK: ${o.login}`)??alert(`Token OK: ${o.login}`)}catch(o){f(null),$?.(String(o.message||o))??alert(String(o.message||o))}}function w(){const o=prompt("Paste GitHub token (repo scope):","");o!==null&&localStorage.setItem("ghToken",o.trim())}function D(){localStorage.removeItem("ghToken"),f(null)}async function q(){if(!a.length){$?.("Stage at least one change first.")??alert("Stage at least one change first.");return}if(!l){$?.("Author name required to open a PR.")??alert("Author name required to open a PR.");return}try{const{default_branch:o}=await X({owner:"rwm6857",repo:"GraceChords"});g(o||"main"),m(!0)}catch(o){$?.(String(o.message||o))??alert(String(o.message||o))}}async function L({branchName:o,prTitle:S,prBody:B}){v(!0);try{const y="rwm6857",I="GraceChords",{sha:K}=await X({owner:y,repo:I});await he({owner:y,repo:I,fromSha:K,newBranch:o});for(const k of a){if(k.action==="delete-request")continue;const H=`${k.kind==="song"?"public/songs":"public/resources"}/${k.filename}`,z=await me({owner:y,repo:I,path:H,ref:o}),W=k.action==="add"?`add: ${k.filename}`:`update: ${k.filename}`;await ge({owner:y,repo:I,branch:o,path:H,contentBase64:pe(k.content||""),message:W,sha:z})}const C=await xe({owner:y,repo:I,head:o,base:h,title:S,body:B});try{sessionStorage.removeItem("editor:staged")}catch{}p([]),m(!1),window.open(C.html_url,"_blank","noopener")}catch(y){throw $?.(String(y.message||y))??alert(String(y.message||y)),y}finally{v(!1)}}return e.jsxs("div",{className:"container gc-editor",children:[e.jsx($e,{activeTab:r}),e.jsxs("header",{className:"gc-editor__header",children:[e.jsxs("div",{className:"gc-editor__title",children:[e.jsx("h1",{children:"GraceChords Editor"}),e.jsxs("span",{className:"gc-editor__author",children:["Author: ",l]})]}),e.jsxs("nav",{className:"gc-editor__tabs","aria-label":"Editor tabs",children:[e.jsx("button",{className:`gc-editor__tab ${r==="songs"?"is-active":""}`,onClick:()=>d("songs"),children:"ðŸŽµ Songs"}),e.jsx("button",{className:`gc-editor__tab ${r==="posts"?"is-active":""}`,onClick:()=>d("posts"),children:"ðŸ“„ Posts"})]})]}),e.jsx("div",{className:"card gc-editor__github",children:e.jsxs("div",{className:"Row Small",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsx("strong",{children:"GitHub:"}),e.jsxs("span",{children:["Token: ",E?`@${E.login}`:localStorage.getItem("ghToken")?"set":"not set"]}),e.jsx("button",{className:"btn",onClick:w,children:"Set token"}),e.jsx("button",{className:"btn",onClick:D,children:"Clear"}),e.jsx("button",{className:"btn",onClick:A,children:"Validate"})]})}),r==="songs"?e.jsx(Ee,{onStageSong:R}):e.jsx(Te,{onStagePost:_}),e.jsxs("section",{className:"card gc-staged-card",children:[e.jsxs("div",{className:"Row",style:{alignItems:"center",gap:8},children:[e.jsxs("h3",{style:{margin:0},children:["Staged changes ",e.jsxs("span",{className:"Small",children:["(",a.length,")"]})]}),e.jsx("div",{className:"spacer"}),e.jsx(N,{onClick:F,disabled:!a.length,children:"Clear all"}),e.jsxs(N,{variant:"primary",onClick:q,disabled:!a.length,children:[e.jsx(ie,{})," Open PR"]})]}),e.jsx("div",{style:{width:"100%",marginTop:8,overflow:"auto"},children:e.jsxs("table",{className:"Table Small",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Kind"}),e.jsx("th",{children:"Action"}),e.jsx("th",{children:"Title"}),e.jsx("th",{children:"Filename"}),e.jsx("th",{children:"Details"}),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[a.map((o,S)=>e.jsxs("tr",{children:[e.jsx("td",{children:o.kind}),e.jsx("td",{children:o.action}),e.jsx("td",{children:o.title}),e.jsx("td",{children:e.jsx("code",{children:o.filename})}),e.jsx("td",{children:o.changeSummary||o.deleteReason||""}),e.jsx("td",{children:e.jsx("button",{className:"btn small",onClick:()=>P(S),children:"Remove"})})]},`${o.filename}-${S}`)),!a.length&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"Small",style:{textAlign:"center",padding:12},children:"Nothing staged yet."})})]})]})})]}),a.length>0&&e.jsxs("button",{className:"gc-staged-floating",onClick:q,children:["Staged: ",a.length," â€“ Review / Open PR"]}),e.jsx(le,{open:x,onClose:()=>m(!1),defaultBranch:h,staged:a,authorName:l,onCreate:L,busy:j})]})}function Ee({onStageSong:l}){const[r,d]=i.useState(ee),[a,p]=i.useState({});i.useEffect(()=>{p(te(r))},[r]);const x=i.useRef(null),[m,j]=i.useState(()=>{try{return localStorage.getItem("editor:showPreview")!=="0"}catch{return!0}});i.useEffect(()=>{try{localStorage.setItem("editor:showPreview",m?"1":"0")}catch{}},[m]);const v=i.useMemo(()=>{const t=ce?.items||[],s=new Set,c=[];for(const n of t)s.has(n.id)||(s.add(n.id),c.push(n));return c},[]),[h,g]=i.useState(""),[E,f]=i.useState(null),[R,_]=i.useState(""),[P,F]=i.useState(""),[A,w]=i.useState(!1),[D,q]=i.useState(""),L=i.useMemo(()=>{const t=P.trim().toLowerCase();return t?v.filter(s=>{const c=String(s.title||"").toLowerCase(),n=(s.tags||[]).map(b=>String(b).toLowerCase()).join(" "),u=(s.authors||[]).map(b=>String(b).toLowerCase()).join(" ");return c.includes(t)||n.includes(t)||u.includes(t)}).slice(0,12):[]},[v,P]);async function o(t){if(t)try{const c=`${"./".replace(/\/+$/,"")+"/"}songs/${t.filename}`,n=await je(c);if(n){d(n);const u=te(n),b=O(n,u,t.filename);g(t.filename),f(u),_(b?.content||""),F("")}}catch(s){console.error(s),alert(`Failed to load ${t.filename}`)}}function S(){g(""),f(null),_(""),d(ee)}function B(t){const s=x.current;if(!s){d(u=>(u||"")+t);return}const c=s.selectionStart??0,n=s.selectionEnd??c;d(u=>{const b=u.slice(0,c),T=u.slice(n);return b+t+T}),setTimeout(()=>{try{s.focus();const u=c+t.length;s.setSelectionRange(u,u)}catch{}},0)}function y(t){const s={Verse:{start:`{sov Verse}
`,end:`{eov}
`},Chorus:{start:`{soc Chorus}
`,end:`{eoc}
`},Bridge:{start:`{sob Bridge}
`,end:`{eob}
`}}[t]||{start:`{start_of_${t.toLowerCase()}}:
`,end:`{end_of_${t.toLowerCase()}}
`};B(`${s.start}${s.end}`)}function I(t){const s=[0,2,4,5,7,9],c=new Set([1,2,5]),n=String(t||"").toUpperCase(),u=M.indexOf(n),b=u>=0?u:M.indexOf("G"),T=[];for(let G=0;G<s.length;G++){const oe=(b+s[G])%M.length,V=M[oe];T.push(c.has(G)?`${V}m`:V)}return T}function K(t){const s=String(t).trim();if(!s)return"G";const c=/^([A-Ga-g][#b]?)(m|min)?$/i.exec(s);if(!c)return"G";const n=fe(c[1]),u=M.indexOf(n);if(u<0)return"G";const T=!!c[2]?(u+3)%M.length:u;return M[T]}const C=i.useMemo(()=>{try{const t=J(r||""),s=(t.sections||[]).map(c=>({section:c.label,lines:(c.lines||[]).map(n=>({text:n.instrumental?"":n.comment||n.lyrics||"",chords:n.instrumental?[]:n.chords||[],comment:!!n.comment,instrumental:n.instrumental||null}))}));return{meta:t.meta,blocks:s}}catch{return{meta:{},blocks:[]}}},[r]),k=i.useMemo(()=>I(K(a.key||"G")),[a.key]);i.useEffect(()=>{function t(s){if(A||!s.altKey)return;const c=s.key;if(!/^([1-6])$/.test(c))return;const n=parseInt(c,10)-1,u=k[n];u&&(s.preventDefault(),B(`[${u}]`))}return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[k,A]);function O(t=r,s=a,c=h){try{const{text:n,docTitle:u,docKey:b}=be(t,{country:s.country||"",tags:s.tags||"",youtube:s.youtube||"",mp3:s.mp3||""}),T=c||Se(u),G=Z(n);return{filename:T,title:u||s.title||"Untitled",content:G,key:b||s.key||""}}catch{}try{const n=J(t);n.meta.title=s.title||n.meta.title||"",n.meta.key=s.key||n.meta.key||"",n.meta.meta={...n.meta.meta||{},authors:s.authors||n.meta.meta?.authors||"",country:s.country||n.meta.meta?.country||"",tags:s.tags||n.meta.meta?.tags||"",youtube:s.youtube||n.meta.meta?.youtube||"",mp3:s.mp3||n.meta.meta?.mp3||""};let u=ve(n,{useDirectives:!0});u=Z(u);const b=we(s.id||n.meta.title||"untitled");return{filename:c||`${b}.chordpro`,title:n.meta.title||"Untitled",content:u,key:n.meta.key||""}}catch(n){return console.error(n),null}}const H=(r||"").replace(/\s+/g,"").replace(/\{[^}]*\}/g,""),z=!!((a.title||"").trim()||H),W=!!h;function ne(){const t=O();if(!t)return;if(!W){l([{kind:"song",action:"add",title:t.title,filename:t.filename,content:t.content}]),S();return}const s=[];(a.title||"").trim()!==(E?.title||"").trim()&&s.push("Title"),["authors","tags","key","country","youtube"].some(b=>(a[b]||"").trim()!==(E?.[b]||"").trim())&&s.push("Metadata"),(t.content||"")!==(R||"")&&s.push("Content");const u=s.length?s.join(" + "):"Minor edit";l([{kind:"song",action:"edit",title:t.title,filename:h,content:t.content,changeSummary:u}]),S()}function ae(t){h&&(l([{kind:"song",action:"delete-request",title:a.title||"Untitled",filename:h,deleteReason:t}]),q(""),w(!1),S())}return e.jsxs("div",{className:"card gc-song-editor",children:[e.jsxs("div",{className:"gc-song-selector",children:[e.jsx(N,{onClick:S,iconLeft:e.jsx(Q,{}),children:"New Song"}),e.jsxs("div",{className:"gc-song-selector__search",children:[e.jsx("input",{type:"search",placeholder:"Search existing songsâ€¦",value:P,onChange:t=>F(t.target.value),onKeyDown:t=>{t.key==="Enter"&&L.length&&(t.preventDefault(),o(L[0]))}}),L.length>0&&e.jsx("ul",{className:"gc-song-selector__results",children:L.map(t=>e.jsx("li",{onMouseDown:()=>o(t),children:t.title},t.id))})]}),h?e.jsxs("span",{className:"badge",style:{background:"#fde68a",color:"#92400e"},children:["Editing ",h]}):e.jsx("span",{className:"badge",style:{background:"#d1fae5",color:"#065f46"},children:"New song"})]}),e.jsxs("div",{className:"card",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginTop:12},children:[e.jsxs("label",{children:["Title",e.jsx("input",{value:a.title||"",onChange:t=>d(s=>U(s,"title",t.target.value))})]}),e.jsxs("label",{children:["Original Key",e.jsx("input",{value:a.key||"",onChange:t=>d(s=>U(s,"key",t.target.value)),placeholder:"e.g., C, Am, Dm, F#m"})]}),e.jsxs("label",{children:["Authors",e.jsx("input",{value:a.authors||"",onChange:t=>d(s=>U(s,"authors",t.target.value))})]}),e.jsxs("label",{children:["Country",e.jsx("input",{value:a.country||"",onChange:t=>d(s=>U(s,"country",t.target.value))})]}),e.jsxs("label",{children:["Tags",e.jsx("input",{value:a.tags||"",onChange:t=>d(s=>U(s,"tags",t.target.value)),placeholder:"Fast, Slow, Hymn, Holiday"})]}),e.jsxs("label",{children:["YouTube (ID or URL)",e.jsx("input",{value:a.youtube||"",onChange:t=>d(s=>U(s,"youtube",t.target.value)),placeholder:"e.g. dQw4w9WgXcQ or https://youtu.be/..."})]})]}),e.jsxs("div",{className:"gc-editor-toolbar",children:[e.jsxs("div",{className:"gc-quick-row",children:[e.jsx("strong",{children:"Quick chords"}),e.jsxs("span",{className:"Small",children:["(Key: ",a.key||"G",")"]}),k.map((t,s)=>e.jsx("button",{className:"gc-btn gc-btn--sm",onClick:()=>B(`[${t}]`),title:`Insert [${t}] (Alt+${s+1})`,children:t},t))]}),e.jsxs("div",{className:"gc-quick-sections",children:[e.jsx("span",{className:"Small",children:"Quick sections:"}),e.jsx("button",{className:"gc-btn gc-btn--sm",onClick:()=>y("Verse"),children:"Verse"}),e.jsx("button",{className:"gc-btn gc-btn--sm",onClick:()=>y("Chorus"),children:"Chorus"}),e.jsx("button",{className:"gc-btn gc-btn--sm",onClick:()=>y("Bridge"),children:"Bridge"})]}),e.jsxs("label",{className:"gc-preview-toggle",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:t=>j(t.target.checked)})," Preview"]})]}),e.jsxs("div",{className:`gc-editor-split ${m?"":"is-single"}`,children:[e.jsx("div",{className:"gc-editor-pane gc-editor-pane--input",children:e.jsx("textarea",{ref:x,value:r,onChange:t=>d(t.target.value),style:{width:"100%",minHeight:"60vh",fontFamily:'"Roboto Mono", ui-monospace, Menlo, Consolas, monospace',fontSize:m?void 0:"calc(1rem + 2pt)"}})}),m&&e.jsxs("div",{className:"gc-editor-pane gc-editor-pane--preview",children:[e.jsx("strong",{children:"Preview"}),e.jsx("div",{className:"Small",style:{marginTop:6,fontFamily:'"Roboto Mono", ui-monospace, Menlo, Consolas, monospace'},children:(()=>{const t={title:C?.meta?.title,key:C?.meta?.key||C?.meta?.originalkey,capo:C?.meta?.capo,authors:C?.meta?.meta?.authors,country:C?.meta?.meta?.country,tags:C?.meta?.meta?.tags,youtube:C?.meta?.meta?.youtube,mp3:C?.meta?.meta?.mp3};return Object.entries(t).filter(([,s])=>s!=null&&String(s).trim()!=="").map(([s,c])=>e.jsxs("div",{children:[e.jsx("strong",{children:s}),": ",String(c)]},s))})()}),e.jsx("div",{style:{marginTop:8},children:(C.blocks||[]).map((t,s)=>e.jsxs("div",{children:[e.jsx("div",{className:"section",children:t.section||""}),(t.lines||[]).map((c,n)=>c.instrumental?e.jsx(Re,{spec:c.instrumental},`${s}-${n}`):e.jsx(Ie,{plain:c.text,chords:c.chords||[],comment:c.comment},`${s}-${n}`))]},s))})]})]}),e.jsxs("div",{className:"gc-stage-actions",children:[e.jsx(N,{variant:"primary",onClick:ne,disabled:!z,children:"Add Changes"}),W&&e.jsx(N,{onClick:()=>w(!0),iconLeft:e.jsx(se,{}),children:"Request Deletion"}),e.jsx("span",{className:"Small",style:{marginLeft:"auto"},children:"Files save as .chordpro"})]}),A&&e.jsx("div",{className:"modal",children:e.jsxs("div",{className:"modal-body",children:[e.jsx("h3",{children:"Request Deletion"}),e.jsxs("label",{children:["Why should this song be removed?",e.jsx("textarea",{rows:3,value:D,onChange:t=>q(t.target.value),placeholder:"Reason for deletion"})]}),e.jsxs("div",{className:"Row",style:{justifyContent:"flex-end",gap:8},children:[e.jsx("button",{className:"btn",onClick:()=>{w(!1),q("")},children:"Cancel"}),e.jsx("button",{className:"btn primary",onClick:()=>ae(D),disabled:!D.trim(),children:"Submit request"})]})]})})]})}function Te({onStagePost:l}){const[r,d]=i.useState(null),[a,p]=i.useState(""),[x,m]=i.useState("");function j(g){if(g){if(g.isExisting){$?.("Use Stage Edit for existing posts.")??alert("Use Stage Edit for existing posts.");return}l([{kind:"post",action:"add",title:g.meta?.title||"Untitled",filename:g.filename,content:g.content}])}}function v(g){if(!g?.isExisting){$?.("Load an existing post to stage an edit.")??alert("Load an existing post to stage an edit.");return}l([{kind:"post",action:"edit",title:g.meta?.title||"Untitled",filename:g.filename,content:g.content,changeSummary:a||""}])}function h(g){if(!g?.isExisting){$?.("Load an existing post to request deletion.")??alert("Load an existing post to request deletion.");return}l([{kind:"post",action:"delete-request",title:g.meta?.title||"Untitled",filename:g.filename,deleteReason:x||""}])}return e.jsx(Ce,{heading:"Posts",showGhTools:!1,wrapInContainer:!1,onDraftChange:d,actions:({draft:g,newPost:E})=>{const f=g||r;return e.jsxs(de,{style:{position:"sticky",bottom:0,marginTop:12,display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsxs(N,{onClick:E,children:[e.jsx(Q,{})," New"]}),e.jsxs(N,{onClick:()=>j(f),disabled:!f,children:[e.jsx(Q,{})," Stage Add"]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,minWidth:0},children:[e.jsxs("label",{className:"Small",style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("span",{children:"Filename"}),e.jsx("input",{readOnly:!0,value:f?.filename||"",style:{width:240},placeholder:"slug.md"})]}),f?.isExisting?e.jsx("span",{className:"badge",style:{background:"#fde68a",color:"#92400e"},title:"Editing existing file",children:"Editing"}):e.jsx("span",{className:"badge",style:{background:"#d1fae5",color:"#065f46"},title:"New file will be created",children:"New"})]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[e.jsxs("label",{className:"Small",style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("span",{children:"What changed?"}),e.jsx("input",{value:a,onChange:R=>p(R.target.value),placeholder:"Content, tagsâ€¦",disabled:!f?.isExisting})]}),e.jsxs(N,{className:"gc-btn gc-btn--primary",onClick:()=>v(f),disabled:!f?.isExisting,children:[e.jsx(ue,{})," Stage Edit"]}),e.jsxs("label",{className:"Small",style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("span",{children:"Removal reason"}),e.jsx("input",{value:x,onChange:R=>m(R.target.value),placeholder:"Why remove this post?",disabled:!f?.isExisting})]}),e.jsxs(N,{className:"gc-btn gc-btn--primary",onClick:()=>h(f),disabled:!f?.isExisting,children:[e.jsx(se,{})," Stage Deletion"]})]})]})}})}function $e({activeTab:l}){const[r,d]=i.useState(""),a=l==="posts"?"Resource Help":"ChordPro Help",p=[{id:"editor",label:"Editor Help",title:"Editor Help",content:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Fill in metadata (title, key, authors, country, tags, YouTube). Use quick chords and quick sections to speed up typing."}),e.jsx("p",{children:"New Song + search lets you start fresh or load an existing song to edit."})]})},{id:"chordpro",label:a,title:a,content:e.jsx(e.Fragment,{children:l==="posts"?e.jsx("p",{children:"Resources use Markdown with frontmatter (title, author, date, tags, summary) followed by body content."}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Use chords in square brackets: ",e.jsx("code",{children:"[G]"}),". Section headers use short codes like ",e.jsx("code",{children:"{sov Verse}"})," â€¦ ",e.jsx("code",{children:"{eov}"}),"."]}),e.jsx("pre",{className:"Small",style:{whiteSpace:"pre-wrap"},children:`{title: Example}
{key: G}
{sov Verse}
[G]Amazing [C]grace
{eov}`})]})})},{id:"staging",label:"Staging Help",title:"Staging Help",content:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"â€œAdd Changesâ€ stages the current song (new or edited) for the PR. Deletion requests log a reason without deleting files."}),e.jsx("p",{children:"Use the floating staged pill or the table to review and open the PR."})]})}],x=p.find(m=>m.id===r);return e.jsxs("div",{className:"gc-help",children:[e.jsx("div",{className:"gc-help__tabs","aria-label":"Help tabs",children:p.map(m=>e.jsx("button",{className:`gc-help__tab ${r===m.id?"is-open":""}`,onClick:()=>d(r===m.id?"":m.id),children:e.jsx("span",{children:m.label})},m.id))}),x&&e.jsx("div",{className:"gc-help__drawer",children:e.jsxs("div",{className:"gc-help__drawer-inner",children:[e.jsxs("div",{className:"Row",style:{justifyContent:"space-between",alignItems:"center",gap:8},children:[e.jsx("strong",{children:x.title}),e.jsx("button",{className:"btn small",onClick:()=>d(""),children:"Close"})]}),e.jsx("div",{className:"gc-help__content Small",children:x.content})]})})]})}function Re({spec:l}){const r=ye(l||{},{split:!1});return r.length?e.jsx("div",{style:{marginBottom:10},children:r.map((d,a)=>e.jsx("div",{style:{whiteSpace:"pre",fontFamily:"'Fira Mono', ui-monospace, SFMono-Regular, Menlo, Consolas, monospace",fontWeight:700,fontSize:"inherit",lineHeight:1.35},children:d},a))}):null}function Ie({plain:l,chords:r,comment:d}){if(d)return e.jsx("div",{className:"comment",children:l});const a=i.useRef(null),p=i.useRef(null),[x,m]=i.useState({offsets:[],padTop:0,chordTop:0});return i.useEffect(()=>{if(!a.current)return;if(!p.current){const w=document.createElement("canvas");w.width=1,w.height=1,p.current=w}const j=p.current.getContext("2d"),v=a.current.querySelector(".lyrics"),h=window.getComputedStyle(v);j.font=`${h.fontStyle} ${h.fontWeight} ${h.fontSize} ${h.fontFamily}`;const g=(r||[]).map(w=>({left:j.measureText(l.slice(0,w.index)).width,sym:w.sym})),E="'Fira Mono', ui-monospace, SFMono-Regular, Menlo, Consolas, monospace",f=h.fontSize;j.font=`${h.fontStyle} 700 ${f} ${E}`;const _=j.measureText("Mg").actualBoundingBoxAscent||parseFloat(h.fontSize)*.8,F=Math.ceil(_+4);m({offsets:g,padTop:F,chordTop:0})},[l,r]),e.jsxs("div",{ref:a,style:{position:"relative",marginBottom:10,paddingTop:x.padTop},children:[x.offsets.length>0&&e.jsx("div",{"aria-hidden":!0,className:"chord-layer",style:{position:"absolute",left:0,right:0,top:x.chordTop},children:x.offsets.map((j,v)=>e.jsx("span",{style:{position:"absolute",left:`${j.left}px`,fontFamily:"'Fira Mono', ui-monospace, SFMono-Regular, Menlo, Consolas, monospace",fontWeight:700},children:j.sym},v))}),e.jsx("div",{className:"lyrics",children:l})]})}function U(l,r,d){const a=new RegExp(`\\{\\s*${r}\\s*:[^}]*\\}`,"i");return a.test(l)?l.replace(a,`{${r}: ${d}}`):/\{\s*title\s*:[^}]*\}/i.test(l)?l.replace(/\{\s*title\s*:[^}]*\}\s*/,p=>p+`
{${r}: ${d}}
`):`{${r}: ${d}}
`+l}function te(l){const r={},d=/^\{\s*([^:}]+)\s*:\s*([^}]*)\s*\}\s*$/gm;let a;for(;a=d.exec(l);){const p=a[1].trim().toLowerCase(),x=a[2];r[p]=x}return r}export{Fe as default};
