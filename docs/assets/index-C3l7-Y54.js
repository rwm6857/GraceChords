const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./jspdf.es.min-CryNqyta.js","./index-Bj6olqP9.js","./index-Wri8gDRg.css"])))=>i.map(i=>d[i]);
import{_ as L}from"./index-Bj6olqP9.js";import{e as _}from"./fonts-OQpvcT7Z.js";import{n as H,c as D,m as $,D as b}from"./pdfLayout-DCwZplMJ.js";import{p as J}from"./pdfLayout-DCwZplMJ.js";const G=typeof window<"u"&&(()=>{try{return localStorage.getItem("pdfDebug")==="1"}catch{return!1}})();async function M(){const{jsPDF:a}=await L(async()=>{const{jsPDF:e}=await import("./jspdf.es.min-CryNqyta.js").then(t=>t.j);return{jsPDF:e}},__vite__mapDeps([0,1,2]),import.meta.url);return new a({unit:"pt",format:"letter"})}function E(a,e,t){var s;const n=a.internal.pageSize.getWidth(),o=a.internal.pageSize.getHeight(),i={...b,...t,pageWidth:n,pageHeight:o};(s=e==null?void 0:e.meta)!=null&&s.capo&&(t==null?void 0:t.showCapo)!==!1&&(i.headerOffsetY=(i.headerOffsetY||b.headerOffsetY)+14);const l=$(a,i.lyricFamily,"normal"),m=$(a,i.chordFamily,"bold");return D(e,i,l,m)}function v(a,e,{title:t,key:n,capo:o,showCapo:i=!0}){const l=String(e.lyricFamily||"Helvetica"),m=String(e.chordFamily||"Courier"),s=a.internal.pageSize.getWidth(),f=a.internal.pageSize.getHeight(),c=e.margin,y=Math.max(22,e.lyricSizePt+6),h=Math.max(12,e.lyricSizePt-2),W=4,C=e.lyricSizePt,k=Math.round(e.lyricSizePt*.85),r=c+e.headerOffsetY,d=s-c*2,u=e.columns===2?(d-e.gutter)/2:d;e.layout.pages.forEach((w,P)=>{P>0&&a.addPage(),a.setFont(l,"bold"),a.setFontSize(y),a.text(t,c,c+24),a.setFont(l,"italic"),a.setFontSize(h),a.text(`Key: ${n||"—"}`,c,c+40),i&&typeof o=="number"&&a.text(`Capo: ${o}`,c,c+54),G&&(a.setDrawColor(180),a.rect(c,r,u,f-c-r),e.columns===2&&a.rect(c+u+e.gutter,r,u,f-c-r),a.setFont(l,"normal"),a.setFontSize(9),a.text(`Plan: ${e.columns} col • size ${e.lyricSizePt}pt • singlePage=${e.layout.pages.length===1?"yes":"no"} • ${e.lyricFamily}/${e.chordFamily}`,c,f-c*.6)),w.columns.forEach(z=>{var T;let F=z.x,g=r;for(const S of z.blocks)if(S.type==="section")g+=k,a.setFont(l,"bold"),a.setFontSize(C),a.text(`[${S.header}]`,F,g),g+=C+4;else if(S.type==="line")if(S.comment){const x=Math.max(10,e.lyricSizePt-2);a.setFont(l,"italic"),a.setFontSize(x),a.setTextColor(120),a.text(S.comment,F,g),a.setTextColor(0),g+=x+3}else{if((T=S.chords)!=null&&T.length){a.setFont(m,"bold"),a.setFontSize(e.chordSizePt);for(const x of S.chords)a.text(x.sym,F+x.x,g);g+=e.chordSizePt+W/2}a.setFont(l,"normal"),a.setFontSize(e.lyricSizePt),a.text(S.lyrics,F,g),g+=e.lyricSizePt+W}})})}async function B(a,e={}){const t=await M();let n={};try{n=await _(t)}catch{}const o={lyricFamily:n.lyricFamily||e.lyricFamily||"Helvetica",chordFamily:n.chordFamily||e.chordFamily||"Courier",...e},i=t.internal.pageSize.getWidth(),l=t.internal.pageSize.getHeight(),m=y=>h=>h?h.length*(y*.6):0,s=y=>h=>{try{return t.setFont(o.lyricFamily,"normal"),t.setFontSize(y),t.getTextWidth(h||"")}catch{return m(y)(h)}},f=y=>h=>{try{return t.setFont(o.chordFamily,"bold"),t.setFontSize(y),t.getTextWidth(h||"")}catch{return m(y)(h)}},c=H(a);return D(c,{...o,pageWidth:i,pageHeight:l},s,f)}async function N(a,e){var f;const t=await M();let n={};try{n=await _(t)}catch{}const o={lyricSizePt:Math.max(12,(e==null?void 0:e.lyricSizePt)||16),chordSizePt:Math.max(12,(e==null?void 0:e.chordSizePt)||16),margin:36,lyricFamily:n.lyricFamily||"Helvetica",chordFamily:n.chordFamily||"Courier",columns:(e==null?void 0:e.columns)===2?2:1,showCapo:e==null?void 0:e.showCapo},i=H(a),{plan:l}=E(t,i,o),m=a.title||i.title||"Untitled",s=a.key||i.key||"C";return v(t,l,{title:m,key:s,capo:(f=i.meta)==null?void 0:f.capo,showCapo:(e==null?void 0:e.showCapo)!==!1}),t.setProperties({title:`${m} – GraceChords`}),t.save(`${m.replace(/\s+/g,"_")}.pdf`),{plan:l}}async function I(a,e={}){const t=await M();let n={};try{n=await _(t)}catch{}const o={lyricSizePt:Math.max(12,(e==null?void 0:e.lyricSizePt)||16),chordSizePt:Math.max(12,(e==null?void 0:e.chordSizePt)||16),margin:36,lyricFamily:n.lyricFamily||"Helvetica",chordFamily:n.chordFamily||"Courier",columns:(e==null?void 0:e.columns)===2?2:1,showCapo:e==null?void 0:e.showCapo},i=!!(e!=null&&e.includeTOC),l=e==null?void 0:e.coverImageDataUrl,m=a.map((r,d)=>{var g;const u=H(r),{plan:w}=E(t,u,o),P=r.title||u.title||"Untitled",z=r.key||u.key||"C",F=(g=u.meta)==null?void 0:g.capo;return{raw:r,plan:w,title:P,key:z,capo:F,num:r._songbookNum||d+1,origTitle:r._origTitle||P}}),s=t.internal.pageSize.getWidth(),f=t.internal.pageSize.getHeight(),c=o.margin,y=16,h=Math.floor((f-c*2-40)/y),W=i?Math.ceil(m.length/h):0;let C=1+(l?1:0)+W;const k=m.map(r=>{const d={num:r.num,title:r.origTitle,page:C};return C+=r.plan.layout.pages.length,d});if(l){try{t.addImage(l,"JPEG",0,0,s,f,void 0,"FAST")}catch{}(i||m.length)&&t.addPage()}if(i){t.setFont(o.lyricFamily,"bold"),t.setFontSize(24),t.text("Table of Contents",s/2,c+20,{align:"center"}),t.setFont(o.lyricFamily,"normal"),t.setFontSize(12);let r=c+40;k.forEach((d,u)=>{u>0&&u%h===0&&(t.addPage(),r=c);const w=`${d.num} ${d.title}`;t.text(w,c,r);const P=String(d.page),z=s-c,F=t.getTextWidth(w),g=t.getTextWidth(P),T=z-c-F-g-4;if(T>0){const S=t.getTextWidth("."),x=".".repeat(Math.max(0,Math.floor(T/S)));t.text(x,c+F+2,r)}t.text(P,z,r,{align:"right"}),r+=y}),m.length&&t.addPage()}m.forEach((r,d)=>{d>0&&t.addPage(),v(t,r.plan,{title:r.title,key:r.key,capo:r.capo,showCapo:(e==null?void 0:e.showCapo)!==!1})}),t.setProperties({title:(e==null?void 0:e.docTitle)||"GraceChords Setlist"}),t.save((e==null?void 0:e.fileName)||"GraceChords_Selection.pdf")}async function O(a,{includeTOC:e,coverImageDataUrl:t}={}){const n=a.map((i,l)=>({...i,title:`${l+1}. ${i.title}`,_songbookNum:l+1,_origTitle:i.title})),o=new Date().toISOString().slice(0,10).replace(/-/g,"");await I(n,{includeTOC:e,coverImageDataUrl:t,docTitle:"GraceChords Songbook",fileName:`songbook-${o}.pdf`})}export{D as chooseBestLayout,B as chooseBestLayoutAuto,I as downloadMultiSongPdf,N as downloadSingleSongPdf,O as downloadSongbookPdf,H as normalizeSongInput,J as planSongLayout};
