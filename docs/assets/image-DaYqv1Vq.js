import{d as P}from"./index-Bo_CfB2t.js";let S=null;async function N(){if(S)return S;const t="./".replace(/\/+$/,"/"),n=[{family:"NotoSans",weight:"400",style:"normal",file:"NotoSans-Regular.ttf"},{family:"NotoSans",weight:"700",style:"normal",file:"NotoSans-Bold.ttf"},{family:"NotoSans",weight:"400",style:"italic",file:"NotoSans-Italic.ttf"},{family:"NotoSans",weight:"700",style:"italic",file:"NotoSans-BoldItalic.ttf"},{family:"NotoSansMono",weight:"400",style:"normal",file:"NotoSansMono-Regular.ttf"},{family:"NotoSansMono",weight:"700",style:"normal",file:"NotoSansMono-Bold.ttf"}];return S=Promise.all(n.map(async a=>{const i=await new FontFace(a.family,`url(${t}fonts/${a.file})`,{weight:a.weight,style:a.style}).load();document.fonts.add(i)})).then(()=>({lyricFamily:"NotoSans",chordFamily:"NotoSansMono"})).catch(()=>({lyricFamily:"Helvetica",chordFamily:"Courier"})),S}function p(t,{pxWidth:n,pxHeight:a,dpi:y=150}){const i=document.createElement("canvas");i.width=n,i.height=a;const e=i.getContext("2d");e.fillStyle="#fff",e.fillRect(0,0,i.width,i.height);const h=y/72;e.scale(h,h);const s=t.margin,d=Math.max(22,t.lyricSizePt+6),m=Math.max(12,t.lyricSizePt-2);e.fillStyle="#000",e.font=`bold ${d}px ${t.lyricFamily}`,e.fillText(t.title,s,s+24),e.font=`italic ${m}px ${t.lyricFamily}`,e.fillText(`Key: ${t.key||"â€”"}`,s,s+40);const c=4,u=t.lyricSizePt,r=Math.round(t.lyricSizePt*.85),x=s+t.headerOffsetY;return(t.layout.pages||[])[0].columns.forEach($=>{let g=$.x,o=x;$.blocks.forEach(l=>{var w;l.type==="section"?(o+=r,e.font=`bold ${u}px ${t.lyricFamily}`,e.fillText(`[${l.header}]`,g,o),o+=u+4):l.type==="line"&&((w=l.chords)!=null&&w.length&&(e.font=`bold ${t.chordSizePt}px ${t.chordFamily}`,l.chords.forEach(F=>e.fillText(F.sym,g+F.x,o)),o+=t.chordSizePt+c/2),e.font=`normal ${t.lyricSizePt}px ${t.lyricFamily}`,e.fillText(l.lyrics,g,o),o+=t.lyricSizePt+c)})}),i}async function z(t,n={}){const a=n.dpi||150,y=n.widthInches||8.5,i=n.heightInches||11,e=Math.round(y*a),h=Math.round(i*a),s=await N(),{lyricFamily:d,chordFamily:m}=s;let c=n.plan;if(!c){const f=document.createElement("canvas").getContext("2d");c=P(t,{lyricFamily:d,chordFamily:m},o=>l=>(f.font=`${o}px ${d}`,f.measureText(l||"").width),o=>l=>(f.font=`bold ${o}px ${m}`,f.measureText(l||"").width)).plan}if(c.layout.pages.length>1)return{error:"MULTI_PAGE",plan:c};const u=p(c,{pxWidth:e,pxHeight:h,dpi:a}),r=document.createElement("a"),x=(n.slug||t.slug||t.title||"untitled").replace(/\s+/g,"_");return r.href=u.toDataURL("image/jpeg",.92),r.download=`${x}.jpg`,r.click(),{plan:c}}export{z as downloadSingleSongJpg,N as ensureCanvasFonts,p as renderPlanToCanvas};
