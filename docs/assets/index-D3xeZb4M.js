const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./jspdf.es.min-odsSi2VU.js","./index-D7OucmPk.js","./index-Wri8gDRg.css"])))=>i.map(i=>d[i]);
import{_ as v}from"./index-D7OucmPk.js";import{e as w}from"./fonts-OQpvcT7Z.js";import{n as b,c as H,m as C,D as L}from"./pdfLayout-Drze1wlE.js";import{p as J}from"./pdfLayout-Drze1wlE.js";const G=typeof window<"u"&&(()=>{try{return localStorage.getItem("pdfDebug")==="1"}catch{return!1}})();async function _(){const{jsPDF:a}=await v(async()=>{const{jsPDF:t}=await import("./jspdf.es.min-odsSi2VU.js").then(e=>e.j);return{jsPDF:t}},__vite__mapDeps([0,1,2]),import.meta.url);return new a({unit:"pt",format:"letter"})}function M(a,t,e){const o=a.internal.pageSize.getWidth(),i=a.internal.pageSize.getHeight(),n={...L,...e,pageWidth:o,pageHeight:i},s=C(a,n.lyricFamily,"normal"),l=C(a,n.chordFamily,"bold");return H(t,n,s,l)}function $(a,t,{title:e,key:o}){const i=String(t.lyricFamily||"Helvetica"),n=String(t.chordFamily||"Courier"),s=a.internal.pageSize.getWidth(),l=a.internal.pageSize.getHeight(),c=t.margin,z=Math.max(22,t.lyricSizePt+6),y=Math.max(12,t.lyricSizePt-2),m=4,g=t.lyricSizePt,k=Math.round(t.lyricSizePt*.85),f=c+t.headerOffsetY,W=s-c*2,r=t.columns===2?(W-t.gutter)/2:W;t.layout.pages.forEach((d,S)=>{S>0&&a.addPage(),a.setFont(i,"bold"),a.setFontSize(z),a.text(e,c,c+24),a.setFont(i,"italic"),a.setFontSize(y),a.text(`Key: ${o||"—"}`,c,c+40),G&&(a.setDrawColor(180),a.rect(c,f,r,l-c-f),t.columns===2&&a.rect(c+r+t.gutter,f,r,l-c-f),a.setFont(i,"normal"),a.setFontSize(9),a.text(`Plan: ${t.columns} col • size ${t.lyricSizePt}pt • singlePage=${t.layout.pages.length===1?"yes":"no"} • ${t.lyricFamily}/${t.chordFamily}`,c,l-c*.6)),d.columns.forEach(P=>{var x;let u=P.x,h=f;for(const F of P.blocks)if(F.type==="section")h+=k,a.setFont(i,"bold"),a.setFontSize(g),a.text(`[${F.header}]`,u,h),h+=g+4;else if(F.type==="line"){if((x=F.chords)!=null&&x.length){a.setFont(n,"bold"),a.setFontSize(t.chordSizePt);for(const T of F.chords)a.text(T.sym,u+T.x,h);h+=t.chordSizePt+m/2}a.setFont(i,"normal"),a.setFontSize(t.lyricSizePt),a.text(F.lyrics,u,h),h+=t.lyricSizePt+m}})})}async function B(a,t={}){const e=await _();let o={};try{o=await w(e)}catch{}const i={lyricFamily:o.lyricFamily||t.lyricFamily||"Helvetica",chordFamily:o.chordFamily||t.chordFamily||"Courier",...t},n=e.internal.pageSize.getWidth(),s=e.internal.pageSize.getHeight(),l=m=>g=>g?g.length*(m*.6):0,c=m=>g=>{try{return e.setFont(i.lyricFamily,"normal"),e.setFontSize(m),e.getTextWidth(g||"")}catch{return l(m)(g)}},z=m=>g=>{try{return e.setFont(i.chordFamily,"bold"),e.setFontSize(m),e.getTextWidth(g||"")}catch{return l(m)(g)}},y=b(a);return H(y,{...i,pageWidth:n,pageHeight:s},c,z)}async function N(a,t){const e=await _();let o={};try{o=await w(e)}catch{}const i={lyricSizePt:Math.max(12,(t==null?void 0:t.lyricSizePt)||16),chordSizePt:Math.max(12,(t==null?void 0:t.chordSizePt)||16),margin:36,lyricFamily:o.lyricFamily||"Helvetica",chordFamily:o.chordFamily||"Courier",columns:(t==null?void 0:t.columns)===2?2:1},n=b(a),{plan:s}=M(e,n,i),l=a.title||n.title||"Untitled",c=a.key||n.key||"C";return $(e,s,{title:l,key:c}),e.setProperties({title:`${l} – GraceChords`}),e.save(`${l.replace(/\s+/g,"_")}.pdf`),{plan:s}}async function I(a,t={}){const e=await _();let o={};try{o=await w(e)}catch{}const i={lyricSizePt:Math.max(12,(t==null?void 0:t.lyricSizePt)||16),chordSizePt:Math.max(12,(t==null?void 0:t.chordSizePt)||16),margin:36,lyricFamily:o.lyricFamily||"Helvetica",chordFamily:o.chordFamily||"Courier",columns:(t==null?void 0:t.columns)===2?2:1},n=!!(t!=null&&t.includeTOC),s=t==null?void 0:t.coverImageDataUrl,l=a.map((r,d)=>{const S=b(r),{plan:P}=M(e,S,i),u=r.title||S.title||"Untitled",h=r.key||S.key||"C";return{raw:r,plan:P,title:u,key:h,num:r._songbookNum||d+1,origTitle:r._origTitle||u}}),c=e.internal.pageSize.getWidth(),z=e.internal.pageSize.getHeight(),y=i.margin,m=16,g=Math.floor((z-y*2-40)/m),k=n?Math.ceil(l.length/g):0;let f=1+(s?1:0)+k;const W=l.map(r=>{const d={num:r.num,title:r.origTitle,page:f};return f+=r.plan.layout.pages.length,d});if(s){try{e.addImage(s,"JPEG",0,0,c,z,void 0,"FAST")}catch{}(n||l.length)&&e.addPage()}if(n){e.setFont(i.lyricFamily,"bold"),e.setFontSize(24),e.text("Table of Contents",c/2,y+20,{align:"center"}),e.setFont(i.lyricFamily,"normal"),e.setFontSize(12);let r=y+40;W.forEach((d,S)=>{S>0&&S%g===0&&(e.addPage(),r=y);const P=`${d.num} ${d.title}`;e.text(P,y,r);const u=String(d.page),h=c-y,x=e.getTextWidth(P),F=e.getTextWidth(u),T=h-y-x-F-4;if(T>0){const D=e.getTextWidth("."),E=".".repeat(Math.max(0,Math.floor(T/D)));e.text(E,y+x+2,r)}e.text(u,h,r,{align:"right"}),r+=m}),l.length&&e.addPage()}l.forEach((r,d)=>{d>0&&e.addPage(),$(e,r.plan,{title:r.title,key:r.key})}),e.setProperties({title:(t==null?void 0:t.docTitle)||"GraceChords Setlist"}),e.save((t==null?void 0:t.fileName)||"GraceChords_Selection.pdf")}async function j(a,{includeTOC:t,coverImageDataUrl:e}={}){const o=a.map((n,s)=>({...n,title:`${s+1}. ${n.title}`,_songbookNum:s+1,_origTitle:n.title})),i=new Date().toISOString().slice(0,10).replace(/-/g,"");await I(o,{includeTOC:t,coverImageDataUrl:e,docTitle:"GraceChords Songbook",fileName:`songbook-${i}.pdf`})}export{H as chooseBestLayout,B as chooseBestLayoutAuto,I as downloadMultiSongPdf,N as downloadSingleSongPdf,j as downloadSongbookPdf,b as normalizeSongInput,J as planSongLayout};
