import{r as n,j as t,a8 as ge,a0 as m,v as he,x as B,a2 as pe,aq as xe,h as fe,A as ye,p as je,k as Se,D as L,E as ve,F as be,J as we,K as Ce,N as ke}from"./index-1rz22gtK.js";import V from"./resources-C6m4Eyon.js";import{m as Te,s as R,p as Ne}from"./markdown-CnzcVNz0.js";const Ie="10401040";function Be(){const[g,h]=n.useState(!1),[f,C]=n.useState("");return g?t.jsx(Ae,{}):t.jsxs("div",{className:"container",style:{maxWidth:480},children:[t.jsx("h1",{children:"Admin: Resources"}),t.jsx("p",{children:"Enter password to continue."}),t.jsxs("form",{onSubmit:p=>{p.preventDefault(),h(f===Ie)},children:[t.jsx(ge,{id:"adminPw",type:"password",value:f,onChange:p=>C(p.target.value),placeholder:"Password"}),t.jsx("div",{style:{marginTop:8,display:"flex",justifyContent:"flex-end"},children:t.jsx(m,{variant:"primary",type:"submit",children:"Enter"})})]})]})}function Ae({actions:g,onDraftChange:h,showGhTools:f=!0,heading:C="Admin: Resources",wrapInContainer:p=!0,panelize:q=!1,prefill:r=null}){const[y]=n.useState(()=>(V?.items||[]).slice().sort((e,s)=>(s.date||"").localeCompare(e.date||""))),[j,S]=n.useState(""),[a,o]=n.useState({title:"",author:"",date:new Date().toISOString().slice(0,10),tags:[],summary:""}),[d,k]=n.useState(""),[x,Y]=n.useState(()=>{try{return localStorage.getItem("admin:editsAuthor")||""}catch{return""}});n.useEffect(()=>{try{localStorage.setItem("admin:editsAuthor",x||"")}catch{}},[x]);function v(){S(""),o({title:"",author:"",date:new Date().toISOString().slice(0,10),tags:[],summary:""}),k("")}async function O(e){if(!e)return;const s=je(`resources/${e.slug}.md`),i=await Se(s),l=Ne(i);S(e.slug),o({title:String(l.meta.title||e.title||""),author:String(l.meta.author||e.author||""),date:String(l.meta.date||e.date||new Date().toISOString().slice(0,10)),tags:Array.isArray(l.meta.tags)?l.meta.tags:[],summary:String(l.meta.summary||e.summary||"")}),k(l.content||"")}function z(e){o(s=>({...s,title:e})),j||S(R(e))}function Q(e){o(s=>({...s,author:e}))}function X(e){o(s=>({...s,date:e}))}function Z(e){const s=String(e||"").split(/[,;]/).map(i=>i.trim()).filter(Boolean);o(i=>({...i,tags:s}))}function ee(e){o(s=>({...s,summary:e}))}const te=n.useMemo(()=>Te(d),[d]),[T,D]=n.useState([]),[se,N]=n.useState(!1),[ae,F]=n.useState(!1),[M,ne]=n.useState("main"),[W,I]=n.useState(null),[H,b]=n.useState(!1);n.useEffect(()=>{b(!1)},[r?.slug,r?.kind]);function G(e=a,s=d){return["---",`title: "${(e.title||"").replace(/"/g,'\\"')}"`,`author: "${(e.author||"").replace(/"/g,'\\"')}"`,`date: "${e.date||""}"`,`tags: ${JSON.stringify(e.tags||[])} `,`summary: "${(e.summary||"").replace(/"/g,'\\"')}"`,"---",""].join(`
`)+(s||"")}function A(){const e=j||R(a.title||"untitled"),s=`${e}.md`,i=G(),l={filename:s,content:i,title:a.title,commitMsg:`${V?.items?.some(c=>c.slug===e)?"update":"add"}: ${s}`};D([l])}async function le(){try{const{default_branch:e}=await L({owner:"rwm6857",repo:"GraceChords"});if(ne(e||"main"),!String(x||"").trim()){alert("Please enter your name in the Edits Author field before submitting.");return}T.length||A(),N(!0)}catch(e){alert(String(e?.message||e))}}async function ie({branchName:e,prTitle:s,prBody:i}){F(!0);try{const l="rwm6857",c="GraceChords",{sha:oe}=await L({owner:l,repo:c});await ve({owner:l,repo:c,fromSha:oe,newBranch:e});for(const u of T){const J=`public/resources/${u.filename}`,ue=await be({owner:l,repo:c,path:J,ref:e}),me=u.commitMsg&&u.commitMsg.trim()?u.commitMsg.trim():`add: ${u.filename}`;await we({owner:l,repo:c,branch:e,path:J,contentBase64:Ce(u.content),message:me,sha:ue})}const ce=`${i||""}${i?`

`:""}Submitted by: ${String(x||"").trim()}`,de=await ke({owner:l,repo:c,head:e,base:M,title:s,body:ce});window.open(de.html_url,"_blank","noopener"),D([]),N(!1)}finally{F(!1)}}const w=j||R(a.title||"untitled"),P=`${w}.md`,_=G(),U=y.some(e=>e.slug===w),$=n.useMemo(()=>({slug:w,filename:P,meta:a,body:d,content:_,isExisting:U}),[w,P,a,d,_,U]);n.useEffect(()=>{typeof h=="function"&&h($)},[$,h]),n.useEffect(()=>{if(!H&&r){if(r.kind==="existing"&&r.slug){const e=y.find(s=>s.slug===r.slug);if(e){O(e),b(!0);return}b(!0);return}r.kind==="new"&&(v(),b(!0))}},[r,H,y]);const re=typeof g=="function"?g({draft:$,newPost:v}):g,E=q?"gc-editor-panel":"card",K=t.jsxs(t.Fragment,{children:[t.jsx("h1",{children:C}),f&&t.jsx("div",{className:E,style:{marginTop:12},children:t.jsxs("div",{className:"Row",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[t.jsx("strong",{children:"GitHub:"}),t.jsxs("span",{children:["Token: ",W?`@${W.login}`:localStorage.getItem("ghToken")?"set":"not set"]}),t.jsx("button",{className:"btn",onClick:()=>{const e=prompt("Paste GitHub token (repo scope):","");e!==null&&localStorage.setItem("ghToken",e.trim())},children:"Set token"}),t.jsx("button",{className:"btn",onClick:()=>{localStorage.removeItem("ghToken"),I(null)},children:"Clear token"}),t.jsx("button",{className:"btn",onClick:async()=>{try{const e=await he();I(e),alert(`Token OK: ${e.login}`)}catch(e){I(null),alert(String(e?.message||e))}},children:"Validate"}),t.jsx("div",{className:"spacer"}),t.jsxs("label",{className:"Small",style:{display:"flex",alignItems:"center",gap:6},children:[t.jsxs("span",{children:["Edits Author ",t.jsx("span",{"aria-hidden":!0,style:{color:"#ef4444"},children:"*"})]}),t.jsx("input",{value:x,onChange:e=>Y(e.target.value),placeholder:"Your name",style:{minWidth:180}})]})]})}),t.jsxs("div",{className:E,style:{marginTop:12},children:[t.jsx("strong",{children:"Existing posts"}),t.jsxs("div",{className:"Row Small",style:{marginTop:6,gap:8,flexWrap:"wrap"},children:[y.map(e=>t.jsx("button",{className:"gc-btn gc-btn--sm",onClick:()=>O(e),title:`Edit ${e.title}`,children:e.title},e.slug)),t.jsx("span",{className:"spacer"}),t.jsx(m,{onClick:v,iconLeft:t.jsx(B,{}),children:"New Post"})]})]}),t.jsxs("div",{className:E,style:{marginTop:12},children:[t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[t.jsxs("label",{children:["Title",t.jsx("input",{value:a.title,onChange:e=>z(e.target.value)})]}),t.jsxs("label",{children:["Author",t.jsx("input",{value:a.author,onChange:e=>Q(e.target.value)})]}),t.jsxs("label",{children:["Date",t.jsx("input",{type:"date",value:a.date,onChange:e=>X(e.target.value)})]}),t.jsxs("label",{children:["Tags (comma-separated)",t.jsx("input",{value:(a.tags||[]).join(", "),onChange:e=>Z(e.target.value),placeholder:"leadership, vocals"})]}),t.jsxs("label",{children:["Summary",t.jsx("input",{value:a.summary,onChange:e=>ee(e.target.value)})]}),t.jsxs("label",{children:["Slug",t.jsx("input",{value:j,onChange:e=>S(e.target.value),placeholder:"auto from title"})]})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginTop:10},children:[t.jsxs("div",{children:[t.jsx("div",{className:"Row Small",style:{justifyContent:"space-between"},children:t.jsx("strong",{children:"Content (Markdown)"})}),t.jsx("textarea",{value:d,onChange:e=>k(e.target.value),style:{width:"100%",minHeight:"50vh",fontFamily:'"Roboto Mono", ui-monospace, Menlo, Consolas, monospace'}})]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Preview"}),t.jsxs("div",{className:"card",style:{minHeight:"50vh",overflow:"auto",padding:10},children:[t.jsxs("div",{className:"Small",style:{opacity:.9,marginBottom:6},children:[a.title?t.jsx("div",{children:t.jsx("strong",{children:a.title})}):null,t.jsxs("div",{children:["by ",a.author||"—"," • ",a.date||"—"]}),a.tags?.length?t.jsx("div",{className:"Small",style:{display:"flex",gap:6,flexWrap:"wrap",marginTop:4},children:a.tags.map(e=>t.jsx("span",{className:"gc-tag gc-tag--gray",children:e},e))}):null,a.summary?t.jsx("div",{style:{marginTop:4},children:a.summary}):null]}),t.jsx("div",{className:"PostBody",dangerouslySetInnerHTML:{__html:te}})]})]})]})]}),re||t.jsxs(pe,{style:{position:"sticky",bottom:0,marginTop:12,display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[t.jsxs(m,{onClick:v,children:[t.jsx(B,{})," New"]}),t.jsxs(m,{onClick:A,children:[t.jsx(xe,{})," Validate"]}),t.jsxs(m,{onClick:A,children:[t.jsx(B,{})," Stage"]})]}),t.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,minWidth:0},children:t.jsxs("label",{className:"Small",style:{display:"flex",alignItems:"center",gap:6},children:[t.jsx("span",{children:"Filename"}),t.jsx("input",{readOnly:!0,value:P,style:{width:320}})]})}),t.jsx("div",{style:{display:"flex",gap:8,alignItems:"center"},children:t.jsxs(m,{className:"gc-btn gc-btn--primary",onClick:le,children:[t.jsx(fe,{})," Publish"]})})]}),t.jsx(ye,{open:se,onClose:()=>N(!1),defaultBranch:M,staged:T,onCreate:ie,busy:ae})]});return p?t.jsx("div",{className:"container",style:{maxWidth:1100},children:K}):K}export{Be as default};
