const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./jszip.min-DFYCKLms.js","./index-eygIe8hM.js","./index-BDqcYvTh.css","./index-BipF-amb.js"])))=>i.map(i=>d[i]);
import{_ as le,j as n,u as st,a as it,b as rt,r as x,i as ot,d as at,F as lt,B as N,c as ct,T as ve,D as z,L as Pe,e as Ie,M as Ee,S as dt,C as ut,P as Ce,f as pt,I as mt,g as Ae,K as ft,A as ht,h as gt,k as yt,l as xt,m as wt,p as St,s as bt,t as jt,n as Nt,o as Tt,q as k}from"./index-eygIe8hM.js";import{P as vt}from"./PageContainer-DA1Jt1Ro.js";const ke="gracechords.sets.v1";function re(){try{const e=localStorage.getItem(ke);return e?JSON.parse(e):{sets:{}}}catch{return{sets:{}}}}function De(e){localStorage.setItem(ke,JSON.stringify(e))}function Pt(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"id-"+Math.random().toString(36).slice(2)+Date.now().toString(36)}function q(){const{sets:e}=re();return Object.values(e).sort((t,i)=>(i.updatedAt||0)-(t.updatedAt||0))}function It(e){const{sets:t}=re();return t[e]||null}function $e(e){const t=Date.now(),i={id:e.id||Pt(),name:e.name?.trim()||"Untitled Set",items:Array.isArray(e.items)?e.items:[],createdAt:e.createdAt||t,updatedAt:t},c=re();return c.sets[i.id]=i,De(c),i}function Et(e){const t=re();return t.sets[e]?(delete t.sets[e],De(t),!0):!1}const Ct="application/vnd.openxmlformats-officedocument.presentationml.slide+xml",At="application/vnd.openxmlformats-officedocument.presentationml.slideMaster+xml",B="http://schemas.openxmlformats.org/presentationml/2006/main",Be="http://schemas.openxmlformats.org/officeDocument/2006/relationships",$t=new DOMParser,Lt=new XMLSerializer;function Mt(e){const t="setlist",i=String(e).trim();return i&&i.replace(/\s+/g,"_").replace(/[^A-Za-z0-9_.-]/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"")||t}async function Le(e){const t=await fetch(e);if(!t.ok)throw new Error(`Failed to load PPTX: ${e}`);return t.arrayBuffer()}function F(e){const t=$t.parseFromString(e,"application/xml"),i=t.getElementsByTagName("parsererror")[0];if(i)throw new Error(i.textContent||"Failed to parse XML");return t}function H(e){return Lt.serializeToString(e)}function ae(e){const t=String(e||"").match(/(\d+)$/);return t?Number(t[1]):0}function X(e,t){let i=0;return e.filter(c=>t.test(c)).forEach(c=>{const r=c.name.match(t);if(!r)return;const u=Number(r[1]);Number.isNaN(u)||(i=Math.max(i,u))}),i}function _e(e,t,i){if(Array.from(e.getElementsByTagName("Override")).some(u=>u.getAttribute("PartName")===t))return;const r=e.createElement("Override");r.setAttribute("PartName",t),r.setAttribute("ContentType",i),e.documentElement.appendChild(r)}function Oe(e,t){if(!t)return null;if(t.startsWith("/"))return t.slice(1);const i=e.split("/");i.pop();const c=t.split("/");for(const r of c)if(r==="..")i.pop();else{if(r===".")continue;i.push(r)}return i.join("/")}function J(e,t){const i=e.split("/");i.pop();const c=t.split("/");let r=0;for(;r<i.length&&r<c.length&&i[r]===c[r];)r++;const u=i.length-r,f=[];for(let y=0;y<u;y++)f.push("..");return f.push(...c.slice(r)),f.join("/")}function Xe(e){const t=e.match(/^(.*\/)([^/]*?)(\d+)(\.[^.]+)$/);return t?{dir:t[1],prefix:t[2],number:Number(t[3]),ext:t[4]}:null}function D(e,t,i){const c=Number(e[t]||0);i>c&&(e[t]=i)}function Ke(e,t){const c=Number(e[t]||0)+1;return e[t]=c,c}function _(e,t){if(!e)return null;const i=e.file(t);return Array.isArray(i)?i.length?i[0]:null:i||null}function ie(e){const t=e.lastIndexOf("/"),i=t>=0?e.slice(0,t+1):"",c=t>=0?e.slice(t+1):e;return`${i}_rels/${c}.rels`}function Rt(e,t){if(!e||!t)return{contentType:"",fromOverride:!1,extension:""};const i=`/${t}`,r=Array.from(e.getElementsByTagName("Override")).find(p=>p.getAttribute("PartName")===i);if(r)return{contentType:r.getAttribute("ContentType")||"",fromOverride:!0,extension:t.split(".").pop()||""};const u=Array.from(e.getElementsByTagName("Default")),f=t.split(".").pop()||"",y=u.find(p=>p.getAttribute("Extension")===f);return y?{contentType:y.getAttribute("ContentType")||"",fromOverride:!1,extension:f}:{contentType:"",fromOverride:!1,extension:f}}function kt(e,t,i){if(!i||Array.from(e.getElementsByTagName("Default")).some(f=>f.getAttribute("Extension")===i))return;const r=Array.from(t?.getElementsByTagName?.("Default")||[]).find(f=>f.getAttribute("Extension")===i);if(!r)return;const u=e.createElement("Default");u.setAttribute("Extension",i),u.setAttribute("ContentType",r.getAttribute("ContentType")||""),e.documentElement.appendChild(u)}function Dt(e){return e?!/xml|text|application\/(.*\+xml)/i.test(e):!1}async function Bt(e){const t="ppt/presentation.xml",i=_(e,t);if(!i)throw new Error("Base PPTX missing ppt/presentation.xml");const c=await i.async("string"),r=F(c),u=r.getElementsByTagNameNS(B,"sldIdLst")[0]||r.getElementsByTagName("p:sldIdLst")[0],y=(u?Array.from(u.getElementsByTagNameNS(B,"sldId")).concat(Array.from(u.getElementsByTagName("p:sldId"))):[]).reduce((A,E)=>{const L=Number(E.getAttribute("id"));return Number.isNaN(L)?A:Math.max(A,L)},255),p="ppt/_rels/presentation.xml.rels",w=_(e,p);if(!w)throw new Error("Base PPTX missing ppt/_rels/presentation.xml.rels");const h=await w.async("string"),P=F(h),S=Array.from(P.getElementsByTagName("Relationship")).reduce((A,E)=>{const L=ae(E.getAttribute("Id"));return Math.max(A,L)},0),I=r.getElementsByTagNameNS(B,"sldMasterIdLst")[0]||r.getElementsByTagName("p:sldMasterIdLst")[0]||null,b=(I?Array.from(I.getElementsByTagNameNS(B,"sldMasterId")).concat(Array.from(I.getElementsByTagName("p:sldMasterId"))):[]).reduce((A,E)=>{const L=Number(E.getAttribute("id"));return Number.isNaN(L)?A:Math.max(A,L)},2147483647),M="[Content_Types].xml",T=_(e,M);if(!T)throw new Error("Base PPTX missing [Content_Types].xml");const W=await T.async("string"),R=F(W),v={};return e.filter(()=>!0).forEach(A=>{const E=Xe(A.name);if(!E)return;const L=`${E.dir}${E.prefix}`;D(v,L,E.number)}),D(v,"ppt/slides/slide",X(e,/^ppt\/slides\/slide(\d+)\.xml$/)),D(v,"ppt/notesSlides/notesSlide",X(e,/^ppt\/notesSlides\/notesSlide(\d+)\.xml$/)),D(v,"ppt/slideMasters/slideMaster",X(e,/^ppt\/slideMasters\/slideMaster(\d+)\.xml$/)),D(v,"ppt/slideLayouts/slideLayout",X(e,/^ppt\/slideLayouts\/slideLayout(\d+)\.xml$/)),D(v,"ppt/theme/theme",X(e,/^ppt\/theme\/theme(\d+)\.xml$/)),D(v,"ppt/notesMasters/notesMaster",X(e,/^ppt\/notesMasters\/notesMaster(\d+)\.xml$/)),D(v,"ppt/media/image",X(e,/^ppt\/media\/image(\d+)\.[^.]+$/)),{zip:e,presentationXmlPath:t,presentationDoc:r,sldIdList:u,sldMasterList:I,presentationRelsPath:p,presentationRelsDoc:P,contentTypesPath:M,contentTypesDoc:R,nextSlideId:y,nextRelId:S,nextMasterId:b,counters:v,partMap:new Map,masterRelMap:new Map}}function _t(e,t,i){const c=e.presentationRelsDoc.documentElement,r=e.presentationRelsDoc.createElement("Relationship");r.setAttribute("Id",i),r.setAttribute("Type","http://schemas.openxmlformats.org/officeDocument/2006/relationships/slide"),r.setAttribute("Target",`slides/slide${t}.xml`),c.appendChild(r)}function Ot(e,t){const i=e.presentationDoc,c=e.sldIdList||(()=>{const u=i.createElementNS(B,"p:sldIdLst");return i.documentElement.appendChild(u),e.sldIdList=u,u})(),r=i.createElementNS(B,"p:sldId");e.nextSlideId+=1,r.setAttribute("id",String(e.nextSlideId)),r.setAttributeNS(Be,"r:id",t),c.appendChild(r)}function Xt(e,t){if(e.masterRelMap.has(t))return e.masterRelMap.get(t);const i=e.presentationDoc,c=e.presentationRelsDoc;let r=e.sldMasterList;if(!r){r=i.createElementNS(B,"p:sldMasterIdLst");const p=i.documentElement.firstChild;p?i.documentElement.insertBefore(r,p):i.documentElement.appendChild(r),e.sldMasterList=r}e.nextMasterId=Number(e.nextMasterId||2147483647),e.nextMasterId+=1,e.nextRelId+=1;const u=`rId${e.nextRelId}`,f=i.createElementNS(B,"p:sldMasterId");f.setAttribute("id",String(e.nextMasterId)),f.setAttributeNS(Be,"r:id",u),r.appendChild(f);const y=c.createElement("Relationship");return y.setAttribute("Id",u),y.setAttribute("Type","http://schemas.openxmlformats.org/officeDocument/2006/relationships/slideMaster"),y.setAttribute("Target",J("ppt/presentation.xml",t)),c.documentElement.appendChild(y),e.masterRelMap.set(t,u),u}async function se(e,t,i,c,r,u={}){if(!r)return null;const f=`${c}:${r}`;if(e.partMap.has(f))return e.partMap.get(f);const y=_(t,r);if(!y)return null;const p=Xe(r),w=Rt(i,r);let h;if(p){const I=`${p.dir}${p.prefix}`,$=Ke(e.counters,I);h=`${p.dir}${p.prefix}${$}${p.ext}`}else{if(_(e.zip,r))return e.partMap.set(f,r),r;h=r}e.partMap.set(f,h),w.fromOverride?_e(e.contentTypesDoc,`/${h}`,w.contentType):w.extension&&kt(e.contentTypesDoc,i,w.extension);const P=await y.async(Dt(w.contentType)?"uint8array":"string");e.zip.file(h,P);const d=ie(r),S=_(t,d);if(S){const I=await S.async("string"),$=F(I),b=Array.from($.getElementsByTagName("Relationship"));for(const T of b){if((T.getAttribute("TargetMode")||"").toLowerCase()==="external")continue;const R=T.getAttribute("Target")||"",v=Oe(r,R);if(!v)continue;let A=null;if(typeof u.relationshipMutator=="function"){const K=await u.relationshipMutator({node:T,type:T.getAttribute("Type")||"",absolutePath:v,newPartPath:h,originalPartPath:r});if(K===!1)continue;K&&K.targetPath&&(A=K.targetPath)}const E=A||await se(e,t,i,c,v);if(!E)continue;const L=J(h,E);T.setAttribute("Target",L)}const M=ie(h);e.zip.file(M,H($))}return w.contentType===At&&Xt(e,h),h}async function Kt(e,t,i,c,r,u){const f=ie(r),y=_(t,f);if(!y)return;const p=await y.async("string"),w=F(p),h=Array.from(w.getElementsByTagName("Relationship"));for(const d of h){const S=d.getAttribute("Type")||"",I=d.getAttribute("Target")||"";if(!I)continue;const $=Oe(r,I);if($)if(S.endsWith("/notesSlide")){const b=await se(e,t,i,c,$,{relationshipMutator:({type:M})=>M.endsWith("/slide")?{targetPath:u}:null});if(!b)continue;d.setAttribute("Target",J(u,b))}else if(S.includes("/image")||S.includes("/audio")||S.includes("/video")){const b=await se(e,t,i,c,$);if(!b)continue;d.setAttribute("Target",J(u,b))}else{const b=await se(e,t,i,c,$);if(!b)continue;d.setAttribute("Target",J(u,b))}}const P=ie(u);e.zip.file(P,H(w))}async function Ut(e,t,i){const c=t.file(/^ppt\/slides\/slide\d+\.xml$/).sort((f,y)=>{const p=ae(f.name),w=ae(y.name);return p-w});if(!c.length)return;const r=_(t,"[Content_Types].xml");if(!r)throw new Error("Source PPTX missing [Content_Types].xml");const u=F(await r.async("string"));for(const f of c){const y=Ke(e.counters,"ppt/slides/slide"),p=`ppt/slides/slide${y}.xml`,w=await f.async("string");e.zip.file(p,w),_e(e.contentTypesDoc,`/${p}`,Ct),e.nextRelId+=1;const h=`rId${e.nextRelId}`;_t(e,y,h),Ot(e,h);const P=f.name;e.partMap.set(`${i}:${P}`,p),await Kt(e,t,u,i,P,p)}}function zt(e){e.zip.file(e.presentationXmlPath,H(e.presentationDoc)),e.zip.file(e.presentationRelsPath,H(e.presentationRelsDoc)),e.zip.file(e.contentTypesPath,H(e.contentTypesDoc))}function Ft(e,t){const i=document.createElement("a");i.href=URL.createObjectURL(e),i.download=t,i.rel="noopener",i.click(),URL.revokeObjectURL(i.href)}async function Wt(e=[],t="Setlist"){if(!Array.isArray(e)||e.length===0)throw new Error("No PPTX files to merge");const i=(await le(async()=>{const{default:h}=await import("./jszip.min-DFYCKLms.js").then(P=>P.j);return{default:h}},__vite__mapDeps([0,1,2]),import.meta.url)).default,[c,...r]=e,u=await Le(c),f=await i.loadAsync(u),y=await Bt(f);for(let h=0;h<r.length;h++){const P=await Le(r[h]),d=await i.loadAsync(P);await Ut(y,d,`src${h+1}`)}zt(y);const p=await f.generateAsync({type:"blob"}),w=Mt(t||"Setlist");Ft(p,`${w}.pptx`)}function Yt(e){const t=e||"/";return t.endsWith("/")?t:`${t}/`}function qt(e){return e?e.slug?e.slug:e.filename?e.filename.replace(/\.chordpro$/i,""):e.title?e.title.trim().toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_.-]/g,""):"":""}async function Ht(e={},t={}){const{name:i="Setlist",songs:c=[]}=e||{},{availablePptxMap:r=null,baseUrl:u="./",onEmpty:f}=t,y=Yt(u),p=[];for(const w of c){const h=qt(w);h&&(r&&!r[h]||p.push(`${y}pptx/${h}.pptx`))}if(!p.length){typeof f=="function"&&f();return}await Wt(p,i)}function Jt({label:e,id:t,children:i,className:c="",...r}){return n.jsxs("label",{className:"gc-field",htmlFor:t,children:[e?n.jsx("span",{className:"gc-label",children:e}):null,n.jsx("span",{className:"gc-select",children:n.jsx("select",{id:t,className:c,...r,children:i})})]})}let Me;const Re=()=>Me||(Me=le(()=>import("./index-BipF-amb.js").then(e=>e.i),__vite__mapDeps([3,1,2]),import.meta.url));function Zt(){try{if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID()}catch{}return`sel-${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`}function Ue(e){if(!e)return null;const{id:t,toKey:i=""}=e;return t==null?null:{uid:Zt(),id:t,toKey:i}}function ne(e=[]){return e.map(t=>Ue(t)).filter(Boolean)}function Qt(){const{code:e,songIds:t}=st(),i=it(),c=rt(),[r,u]=x.useState("New Setlist"),[f,y]=x.useState(""),[p,w]=x.useState([]),[h,P]=x.useState(()=>{try{return localStorage.getItem("pref:icpOnly")==="1"}catch{return!1}});x.useEffect(()=>{try{localStorage.setItem("pref:icpOnly",h?"1":"0")}catch{}},[h]);const[d,S]=x.useState([]),[I,$]=x.useState({}),[b,M]=x.useState(""),[T,W]=x.useState("");Object.keys(I).length;const[R,v]=x.useState(!1),[A,E]=x.useState(()=>{try{return window.innerWidth<=640}catch{return!1}}),[L,K]=x.useState(()=>{try{return window.innerWidth<=820}catch{return!1}}),[Z,ze]=x.useState(()=>{try{return window.innerWidth<=900}catch{return!1}}),ce=x.useRef(""),de=x.useRef(""),[V,G]=x.useState(null),[Y,ue]=x.useState(()=>q()),[pe,Q]=x.useState(""),[Fe,ee]=x.useState(!1),[me,fe]=x.useState("");x.useEffect(()=>{const s=ot?.items||[],a=new Set,l=[];for(const o of s)a.has(o.id)||(a.add(o.id),l.push(o));w(l)},[]),x.useEffect(()=>{let s=!1;async function a(){const l={};for(const o of d){const m=p.find(U=>U.id===o.id);if(!m)continue;const g=m.filename.replace(/\.chordpro$/i,""),j=`./pptx/${g}.pptx`;await xt(j,g)&&(l[g]=!0)}s||$(l)}return a(),()=>{s=!0}},[d,p]),x.useEffect(()=>{try{const s=document.documentElement,a=document.body;ce.current=s.style.overflowY||"",de.current=a.style.overflowY||"",getComputedStyle(s).overflowY==="hidden"&&(s.style.overflowY=""),getComputedStyle(a).overflowY==="hidden"&&(a.style.overflowY="")}catch{}return()=>{try{document.documentElement.style.overflowY=ce.current,document.body.style.overflowY=de.current}catch{}}},[]),x.useEffect(()=>{if(!e)return;const{entries:s,error:a}=at(e);if(a){alert(a),c("/setlist",{replace:!0});return}const l=s.map(g=>({id:g.id,toKey:g.toKey}));S(ne(l));const o=l.map(g=>g.id).join(","),m=l.map(g=>encodeURIComponent(g.toKey||"")).join(",");c(`/setlist/${o}?toKeys=${m}`,{replace:!0})},[e]),x.useEffect(()=>{if(!t)return;const s=(t||"").split(",").map(m=>m.trim()).filter(Boolean);if(!s.length)return;const l=(new URLSearchParams(i.search||"").get("toKeys")||"").split(",").map(m=>decodeURIComponent(m)).filter(Boolean),o=s.map((m,g)=>({id:m,toKey:l[g]||""}));S(ne(o))},[t,i.search]),x.useEffect(()=>{try{if(!Array.isArray(d))return;if(d.length===0){(e||t)&&c("/setlist",{replace:!0});return}const s=d.map(m=>m.id).join(","),a=d.map(m=>encodeURIComponent(m.toKey||"")).join(","),l=t||"",o=new URLSearchParams(i.search||"").get("toKeys")||"";(s!==l||a!==o)&&c(`/setlist/${s}?toKeys=${a}`,{replace:!0})}catch{}},[d.map(s=>`${s.id}:${s.toKey}`).join("|"),t,i.search,e]),x.useEffect(()=>{try{const s=localStorage.getItem("setlist");if(!s||q().length>0)return;const a=JSON.parse(s);if(a?.name||(a?.list?.length||0)>0){const l=$e({name:a.name||"Imported Set",items:a.list||[]});ue(q()),G(l.id),u(l.name),S(ne(l.items||[])),Q(l.id)}}catch{}},[]),x.useEffect(()=>{function s(){try{const a=window.innerWidth;E(a<=640),K(a<=820),ze(a<=900)}catch{}}return window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]);const oe=x.useMemo(()=>new lt(p,{keys:["title","tags"],threshold:.4}),[p]);function We(s){return!h||(Array.isArray(s.tags)?s.tags.includes("ICP"):s.tags==="ICP")}const Ye=x.useMemo(()=>(f?oe.search(f).map(a=>a.item):p.slice().sort((a,l)=>a.title.localeCompare(l.title))).filter(We),[f,oe,p,h]);function he(s){if(!s)return;const a=Ue({id:s.id,toKey:s.originalKey||s.key||"C"});S(l=>[...l,a])}function qe(s){S(a=>a.filter(l=>l.uid!==s))}function ge(s,a){S(l=>{const o=l.findIndex(C=>C.uid===s);if(o<0)return l;const m=o+(a==="up"?-1:1);if(m<0||m>=l.length)return l;const g=l.slice(),[j]=g.splice(o,1);return g.splice(m,0,j),g})}function He(s,a){S(l=>{if(a<0||a>=l.length)return l;const o=l.findIndex(j=>j.uid===s);if(o<0||o===a)return l;const m=l.slice(),[g]=m.splice(o,1);return m.splice(a,0,g),m})}function Je(s,a){S(l=>l.map(o=>o.uid===s?{...o,toKey:a}:o))}function ye(s){ue(q()),Q(s||"")}function xe(){G(null),u("New Setlist"),S([]),Q("")}function Ze(){const s=r?.trim()||"New Setlist",a=window.prompt("Save set as:",s);if(a===null)return;const l=String(a).trim()||"New Setlist";let o=V;if(!o){const j=(q()||[]).find(C=>(C.name||"")===l);j&&(o=j.id)}const m=d.map(({id:j,toKey:C})=>({id:j,toKey:C})),g=$e({id:o,name:l,items:m});u(g.name),G(g.id),ye(g.id)}function Ve(){const s=me||pe||"";if(!s){ee(!1);return}const a=It(s);a&&(G(a.id),u(a.name||"New Setlist"),S(ne(a.items||[])),Q(a.id)),ee(!1)}function Ge(){const s=Y[0]?.id||"";fe(pe||s),ee(!0)}function Qe(){V&&window.confirm(`Delete set "${r}"? This cannot be undone.`)&&(Et(V),xe(),ye(""))}async function we(){v(!0);try{const{downloadMultiSongPdf:s}=await Re(),a=[];for(const l of d){const o=p.find(m=>m.id===l.id);if(o)try{const m=`./songs/${o.filename}`,g=await wt(m),j=St(g),C=j.meta?.key||j.meta?.originalkey||o.originalKey||"C",U=bt(C,l.toKey||C),et=(j.sections||[]).map(Ne=>({section:Ne.label,lines:(Ne.lines||[]).map(O=>O.instrumental?{instrumental:jt(O.instrumental,U)}:O.comment?{plain:O.comment,chordPositions:[],comment:O.comment}:{plain:O.lyrics||"",chordPositions:(O.chords||[]).map(Te=>({sym:Nt(Te.sym,U),index:Te.index}))})})),tt=o.filename.replace(/\.chordpro$/i,""),nt=Tt({title:j.meta?.title||o.title||tt,key:l.toKey||C,capo:j.meta?.capo,lyricsBlocks:et});a.push(nt)}catch(m){console.error(m),k(`Failed to process ${o.filename}`)}}a.length&&await s(a)}finally{v(!1)}}function te(){Re()}async function Se(){try{const s=d.map(o=>o.id).join(","),a=d.map(o=>encodeURIComponent(o.toKey||"")).join(","),l=`${i.origin}${i.pathname}#/setlist/${s}?toKeys=${a}`;await navigator.clipboard.writeText(l);try{k?.("Link copied!")}catch{}}catch{alert("Failed to copy link")}}async function be(){if(T)return;M(`Bundling 0/${d.length}…`);const s=(await le(async()=>{const{default:o}=await import("./jszip.min-DFYCKLms.js").then(m=>m.j);return{default:o}},__vite__mapDeps([0,1,2]),import.meta.url)).default,a=new s;let l=0;for(let o=0;o<d.length;o++){const m=d[o],g=p.find(C=>C.id===m.id);if(!g){M(`Bundling ${o+1}/${d.length}…`);continue}M(`Bundling ${o+1}/${d.length}…`);const j=g.filename.replace(/\.chordpro$/i,"");if(I[j])try{const C=await fetch(`./pptx/${j}.pptx`);if(!C.ok)continue;const U=await C.blob();l++,a.file(`${String(l).padStart(2,"0")}-${j}.pptx`,U)}catch{}}if(l>0){const o=await a.generateAsync({type:"blob"}),m=new Date().toISOString().slice(0,10).replace(/-/g,""),g=document.createElement("a");g.href=URL.createObjectURL(o),g.download=`setlist-pptx-${m}.zip`,g.click(),URL.revokeObjectURL(g.href)}else try{k&&k("No PPTX files found for selected songs")||alert("No PPTX files found for selected songs")}catch{}M("")}async function je(){if(!(b||T)){W("Combining…");try{const s=[];for(const a of d){const l=p.find(m=>m.id===a.id);if(!l)continue;const o=l.filename.replace(/\.chordpro$/i,"");I[o]&&s.push(l)}if(!s.length){try{k&&k("No PPTX files found for selected songs")||alert("No PPTX files found for selected songs")}catch{}return}await Ht({name:r||"Setlist",songs:s},{baseUrl:"./"})}catch(s){console.error(s);try{k&&k("Failed to combine PPTX files")||alert("Failed to combine PPTX files")}catch{}}finally{W("")}}}return n.jsxs(vt,{children:[Fe?n.jsx("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,.45)",zIndex:90},role:"dialog","aria-modal":"true",children:n.jsxs("div",{style:{background:"var(--card)",color:"var(--text)",border:"1px solid var(--line)",borderRadius:10,padding:16,width:"min(560px, 92vw)"},children:[n.jsx("h3",{style:{marginTop:0,marginBottom:8},children:"Load Set"}),Y.length?n.jsxs("label",{style:{display:"block",margin:"8px 0"},children:["Select a saved set",n.jsx("select",{value:me,onChange:s=>fe(s.target.value),style:{width:"100%"},children:Y.map(s=>n.jsxs("option",{value:s.id,children:[s.name," · ",new Date(s.updatedAt).toLocaleString()]},s.id))})]}):n.jsx("div",{className:"meta",children:"No saved sets yet."}),n.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:8,marginTop:12},children:[n.jsx(N,{onClick:()=>ee(!1),children:"Cancel"}),n.jsx(N,{variant:"primary",onClick:Ve,disabled:!Y.length,children:"Load"})]})]})}):null,n.jsx(ct,{busy:R}),n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:12,marginBottom:4},children:[n.jsx("div",{}),n.jsx("h1",{style:{margin:0},children:"Setlist Builder"}),n.jsx("div",{})]}),A?n.jsx(ve,{className:"card",style:{marginTop:8,position:"static"},children:n.jsxs("div",{className:"setlist-actions--mobile",style:{width:"100%"},children:[n.jsx(N,{variant:"primary",onClick:we,onMouseEnter:te,onFocus:te,disabled:R||d.length===0,title:"Export set as a single PDF",iconLeft:n.jsx(z,{}),children:"PDF"}),n.jsx(N,{onClick:be,disabled:d.length===0||!!b||!!T,title:d.length===0?"Add songs to export PPTX bundle":"Export PPTX bundle (ZIP) for selected songs",iconLeft:n.jsx(z,{}),children:"PPTX ZIP"}),n.jsx(N,{onClick:je,disabled:d.length===0||!!b||!!T,title:d.length===0?"Add songs to combine PPTX files":"Combine PPTX files into a single presentation",iconLeft:n.jsx(z,{}),children:T||"Single PPTX"}),n.jsx(N,{onClick:Se,title:"Copy shareable link",iconLeft:n.jsx(Pe,{}),disabled:d.length===0,children:"Share"}),n.jsx(N,{as:Ie,to:d.length?`/worship/${d.map(s=>s.id).join(",")}?toKeys=${d.map(s=>encodeURIComponent(s.toKey)).join(",")}`:"/worship",title:"Open Worship Mode",iconLeft:n.jsx(Ee,{}),children:"Worship"})]})}):n.jsxs(ve,{className:"card",style:{marginTop:8,position:"static"},children:[n.jsx("div",{style:{width:"100%",marginBottom:6},children:n.jsx("strong",{title:"Current set name",children:r||"New Setlist"})}),n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap",width:"100%"},children:[n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[n.jsxs(N,{size:"sm",variant:"secondary",onClick:Ze,title:"Save set",iconLeft:n.jsx(dt,{}),children:[" ",n.jsx("span",{className:"text-when-wide",children:"Save"})]}),n.jsxs(N,{size:"sm",variant:"secondary",onClick:Ge,title:"Load saved set",iconLeft:n.jsx(ut,{}),disabled:!Y.length,children:[" ",n.jsx("span",{className:"text-when-wide",children:"Load"})]}),n.jsxs(N,{size:"sm",variant:"secondary",onClick:xe,title:"New set",iconLeft:n.jsx(Ce,{}),children:[" ",n.jsx("span",{className:"text-when-wide",children:"New"})]}),n.jsxs(N,{size:"sm",variant:"secondary",onClick:Qe,disabled:!V,title:"Delete set",iconLeft:n.jsx(pt,{}),children:[" ",n.jsx("span",{className:"text-when-wide",children:"Delete"})]})]}),n.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[n.jsx(N,{variant:"primary",size:"md",onClick:we,onMouseEnter:te,onFocus:te,disabled:R||d.length===0,title:"Export set as a single PDF",iconLeft:n.jsx(z,{}),children:R?"Exporting…":n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"text-when-wide",children:"Export PDF"}),n.jsx("span",{className:"text-when-narrow",children:"PDF"})]})}),n.jsx(N,{variant:"primary",size:"md",onClick:be,disabled:d.length===0||!!b||!!T,title:d.length===0?"Add songs to export PPTX bundle":"Export PPTX bundle (ZIP) for selected songs",iconLeft:n.jsx(z,{}),children:b||n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"text-when-wide",children:"Export PPTX ZIP"}),n.jsx("span",{className:"text-when-narrow",children:"PPTX ZIP"})]})}),n.jsx(N,{variant:"primary",size:"md",onClick:je,disabled:d.length===0||!!b||!!T,title:d.length===0?"Add songs to combine PPTX files":"Combine PPTX files into a single presentation",iconLeft:n.jsx(z,{}),children:T||n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"text-when-wide",children:"Single PPTX"}),n.jsx("span",{className:"text-when-narrow",children:"Single"})]})}),n.jsx(N,{variant:"primary",size:"md",onClick:Se,title:"Copy shareable link",iconLeft:n.jsx(Pe,{}),disabled:d.length===0,children:"Share Set"}),n.jsxs(N,{variant:"primary",size:"md",as:Ie,to:d.length?`/worship/${d.map(s=>s.id).join(",")}?toKeys=${d.map(s=>encodeURIComponent(s.toKey)).join(",")}`:"/worship",title:"Open Worship Mode",iconLeft:n.jsx(Ee,{}),children:[" ",n.jsx("span",{className:"text-when-wide",children:"Worship Mode"}),n.jsx("span",{className:"text-when-narrow",children:"Worship"})]})]})]})]}),n.jsxs("div",{className:"BuilderPage",style:{marginTop:8},children:[n.jsx("div",{className:"BuilderLeft",children:n.jsx("section",{className:"setlist-section setlist-add","data-role":"add",children:n.jsxs("div",{className:"card setlist-pane",children:[n.jsxs("div",{className:["BuilderHeader","section-header",Z?"no-sticky":""].filter(Boolean).join(" "),style:{display:"flex",alignItems:"center",gap:8},children:[n.jsx("strong",{style:{whiteSpace:"nowrap"},children:"Add songs"}),n.jsx(mt,{value:f,onChange:s=>y(s.target.value),placeholder:"Search...",style:{flex:1,minWidth:0}}),n.jsxs("label",{className:"row",style:{gap:6,alignItems:"center"},children:[n.jsx("input",{type:"checkbox",checked:h,onChange:s=>P(s.target.checked)}),n.jsx("span",{className:"meta",title:"Limit results to songs tagged ICP",children:"ICP only"})]})]}),n.jsx("div",{className:["BuilderScroll","setlist-scroll","setlist-list",Z?"no-pane-scroll":"pane-scroll","pane--addSongs"].join(" "),children:oe?n.jsx("div",{style:{display:"grid",gap:".5rem",gridTemplateColumns:"repeat(auto-fill, minmax(320px, 1fr))",marginTop:6},children:Ye.map(s=>n.jsx(Ae,{title:s.title,subtitle:`${s.originalKey||""}${s.tags?.length?` • ${s.tags.join(", ")}`:""}`,rightSlot:n.jsx(N,{"aria-label":"Add",title:"Add to set",variant:"primary",iconLeft:n.jsx(Ce,{}),iconOnly:!0,onClick:a=>{a.stopPropagation(),he(s)}}),onClick:()=>he(s)},s.id))}):n.jsx("div",{children:"Loading search…"})})]})})}),n.jsx("div",{className:"BuilderRight",style:{minHeight:0,display:"flex",flexDirection:"column"},children:n.jsxs("section",{className:"setlist-section setlist-current","data-role":"current",children:[n.jsxs("div",{className:"card setlist-pane",children:[n.jsx("div",{className:["BuilderHeader","section-header",Z?"no-sticky":""].filter(Boolean).join(" "),children:n.jsxs("strong",{children:["Current setlist (",d.length,")"]})}),n.jsx("div",{className:["BuilderScroll","setlist-scroll","setlist-list",Z?"no-pane-scroll":"pane-scroll","pane--currentSet"].join(" "),style:{marginTop:6},children:d.map((s,a)=>{const l=p.find(o=>o.id===s.id);return l?n.jsx(Ae,{draggable:!0,onDragStart:o=>{o.dataTransfer.setData("text/plain",String(s.uid||s.id)),o.dataTransfer.effectAllowed="move"},onDragOver:o=>{o.preventDefault(),o.dataTransfer.dropEffect="move"},onDrop:o=>{o.preventDefault();const m=o.dataTransfer.getData("text/plain");He(m,a)},title:l.title,subtitle:`Original: ${l.originalKey||"—"}`,rightSlot:n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[n.jsx(Jt,{value:s.toKey,onChange:o=>Je(s.uid,o.target.value),children:ft.map(o=>n.jsx("option",{value:o,children:o},o))}),n.jsx(N,{onClick:()=>ge(s.uid,"up"),title:"Move up",iconLeft:n.jsx(ht,{})}),n.jsx(N,{onClick:()=>ge(s.uid,"down"),title:"Move down",iconLeft:n.jsx(gt,{})}),n.jsx(N,{onClick:()=>qe(s.uid),title:"Remove",iconLeft:n.jsx(yt,{}),iconOnly:!0,style:{color:"#b91c1c"}})]})},s.uid||`${s.id}-${a}`):null})})]}),n.jsxs("div",{className:"print-only",style:{marginTop:16},children:[n.jsx("h2",{style:{fontSize:"20pt",margin:"0 0 8pt 0"},children:r}),n.jsx("ol",{style:{fontSize:"12pt",lineHeight:1.4,paddingLeft:"1.2em"},children:d.map((s,a)=>{const l=p.find(o=>o.id===s.id);return l?n.jsxs("li",{children:[l.title," — ",s.toKey||l.originalKey||"—"]},s.uid||`${s.id}-${a}`):null})})]})]})})]})]})}export{Qt as default};
