const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-Co7bu5GL.js","./index-gdatOOj8.js","./index-D2dSZYaL.css"])))=>i.map(i=>d[i]);
import{r as n,i as J,j as t,B as Q,P as X,d as Y,D as Z,a as ee,_ as te,f as se,p as ae,n as le,e as b,g as ne}from"./index-gdatOOj8.js";let L;const B=()=>L||(L=te(()=>import("./index-Co7bu5GL.js").then(l=>l.i),__vite__mapDeps([0,1,2]),import.meta.url));function S(l,o){return ne(l,o)}function C(l){return[...new Set(l.filter(Boolean))].sort((o,f)=>String(o).localeCompare(String(f),void 0,{sensitivity:"base"}))}function ie(){const l=n.useMemo(()=>(J?.items||[]).slice().sort(S),[]),[o,f]=n.useState(""),[u,E]=n.useState("All"),[x,M]=n.useState("All"),[m,D]=n.useState("All"),_=n.useMemo(()=>C(l.flatMap(e=>Array.isArray(e.tags)?e.tags:e.tags?[e.tags]:[])),[l]),R=n.useMemo(()=>C(l.map(e=>e.country).filter(Boolean)),[l]),O=n.useMemo(()=>C(l.flatMap(e=>Array.isArray(e.authors)?e.authors:e.authors?[e.authors]:[])),[l]),d=n.useMemo(()=>{const e=o.trim().toLowerCase();let a=l;return e&&(a=a.filter(s=>{const r=(s.title||"").toLowerCase(),g=(Array.isArray(s.authors)?s.authors.join(", "):s.authors||"").toLowerCase();return r.includes(e)||g.includes(e)})),u!=="All"&&(a=a.filter(s=>Array.isArray(s.tags)?s.tags.includes(u):s.tags===u)),x!=="All"&&(a=a.filter(s=>s.country===x)),m!=="All"&&(a=a.filter(s=>Array.isArray(s.authors)?s.authors.includes(m):s.authors===m)),a.slice().sort(S)},[l,o,u,x,m]),[p,y]=n.useState(()=>new Set),c=n.useMemo(()=>d.filter(e=>p.has(e.id)).slice().sort(S),[d,p]),w=d.length,A=p.size;function N(e,a){y(s=>{const r=new Set(s);return a?r.add(e):r.delete(e),r})}function $(){d.length&&y(e=>{const a=new Set(e);for(const s of d)a.add(s.id);return a})}function H(){y(new Set)}const[F,z]=n.useState(!0),[W,j]=n.useState(null),[v,k]=n.useState(!1);async function q(){if(c.length){k(!0);try{const{downloadSongbookPdf:e}=await B(),a=[];for(const s of c)try{const r=`./songs/${s.filename}`,g=await se(r),i=ae(g),K=(i.sections||[]).map(P=>({section:P.label,lines:(P.lines||[]).map(h=>({plain:h.comment?h.comment:h.lyrics||"",chordPositions:(h.chords||[]).map(I=>({sym:I.sym,index:I.index})),comment:h.comment?h.comment:void 0}))})),V=s.filename.replace(/\.chordpro$/,""),G=le({title:i.meta.title||s.title||V,key:i.meta.key||i.meta.originalkey||s.originalKey||"C",capo:i.meta?.capo,lyricsBlocks:K});a.push(G)}catch(r){console.error(r),b(`Failed to process ${s.filename}`)}a.length&&await e(a,{includeTOC:F,coverImageDataUrl:W})}finally{k(!1)}}}function T(){B()}function U(e){const a=e.target.files?.[0];if(!a){j(null);return}if(a.size>2*1024*1024){b("Image must be under 2 MB"),e.target.value="",j(null);return}if(!a.type.startsWith("image/")){b("File must be an image"),e.target.value="",j(null);return}const s=new FileReader;s.onload=()=>j(String(s.result||"")),s.readAsDataURL(a)}return l.length===0?t.jsxs("div",{className:"container",children:[t.jsx("h1",{children:"No songs found"}),t.jsx("p",{className:"Small",children:"The song index is empty or failed to load."})]}):t.jsxs("div",{className:"container",children:[t.jsx(Q,{busy:v}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("div",{}),t.jsx("h1",{style:{margin:0},children:"Songbook Builder"}),t.jsx("div",{})]}),t.jsxs("div",{className:"card toolbar",style:{marginTop:12},children:[t.jsxs("div",{className:"Field",children:[t.jsx("input",{id:"sb-toc",type:"checkbox",checked:F,onChange:e=>z(e.target.checked)}),t.jsx("label",{htmlFor:"sb-toc",children:"Include table of contents"})]}),t.jsxs("div",{className:"Field",children:[t.jsx("label",{htmlFor:"sb-cover",children:"Cover page (image):"}),t.jsx("input",{id:"sb-cover",className:"CoverInput",type:"file",accept:"image/*",onChange:U})]}),t.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:6},children:[t.jsxs("button",{className:"btn iconbtn",onClick:$,disabled:!w,title:"Select all filtered",children:[t.jsx(X,{}),t.jsxs("span",{className:"text-when-wide",children:["Select all (",w,")"]}),t.jsx("span",{className:"text-when-narrow",children:"All"})]}),t.jsxs("button",{className:"btn iconbtn",onClick:H,disabled:!A,title:"Clear selection",children:[t.jsx(Y,{}),t.jsx("span",{className:"text-when-wide",children:"Clear"})]}),t.jsx("button",{className:"btn primary iconbtn",onClick:q,onMouseEnter:T,onFocus:T,disabled:!c.length||v,title:c.length?"Export PDF":"Select some songs first",children:v?"Exporting…":t.jsxs(t.Fragment,{children:[t.jsx(Z,{}),t.jsxs("span",{className:"text-when-wide",children:["Export PDF (",c.length,")"]}),t.jsx("span",{className:"text-when-narrow",children:"PDF"})]})})]})]}),t.jsxs("div",{className:"BuilderPage",style:{marginTop:12},children:[t.jsx("div",{className:"BuilderLeft",children:t.jsxs("div",{className:"card",children:[t.jsxs("div",{className:"Row",style:{gap:"1rem",alignItems:"flex-end",flexWrap:"wrap",marginTop:8},children:[t.jsxs("div",{className:"Field",style:{minWidth:220},children:[t.jsx("label",{htmlFor:"sb-search",children:"Search:"}),t.jsx("input",{id:"sb-search",type:"search",placeholder:"Title or author",value:o,onChange:e=>f(e.target.value),style:{width:"100%"}})]}),t.jsxs("div",{className:"Field",children:[t.jsx("label",{htmlFor:"sb-tag",children:"Tag:"}),t.jsxs("select",{id:"sb-tag",value:u,onChange:e=>E(e.target.value),children:[t.jsx("option",{children:"All"}),_.map(e=>t.jsx("option",{value:e,children:e},e))]})]}),t.jsxs("div",{className:"Field",children:[t.jsx("label",{htmlFor:"sb-country",children:"Country:"}),t.jsxs("select",{id:"sb-country",value:x,onChange:e=>M(e.target.value),children:[t.jsx("option",{children:"All"}),R.map(e=>t.jsx("option",{value:e,children:e},e))]})]}),t.jsxs("div",{className:"Field",children:[t.jsx("label",{htmlFor:"sb-author",children:"Author:"}),t.jsxs("select",{id:"sb-author",value:m,onChange:e=>D(e.target.value),children:[t.jsx("option",{children:"All"}),O.map(e=>t.jsx("option",{value:e,children:e},e))]})]})]}),t.jsxs("div",{className:"Row Small",style:{marginTop:".5rem"},children:[t.jsx("strong",{children:A})," selected"]}),t.jsx("div",{className:"SongList",role:"region","aria-label":"Song list",style:{minHeight:0,maxHeight:300,overflow:"auto",marginTop:6},children:t.jsx("div",{className:"gc-list",children:d.map(e=>{const a=p.has(e.id),s=Array.isArray(e.authors)?e.authors.join(", "):e.authors||"",r=Array.isArray(e.tags)?e.tags:e.tags?String(e.tags).split(",").map(i=>i.trim()):[],g=[s||"—",e.country].filter(Boolean).join(" • ");return t.jsx(ee,{title:e.title,subtitle:g,tags:r,leftSlot:t.jsx("input",{type:"checkbox",checked:a,onChange:i=>N(e.id,i.target.checked),onClick:i=>i.stopPropagation(),"aria-label":`Select ${e.title}`}),onClick:()=>N(e.id,!a)},e.id)})})})]})}),t.jsx("div",{className:"BuilderRight",children:t.jsxs("div",{className:"card",children:[t.jsxs("strong",{children:["Current selection (",c.length,")"]}),t.jsx("div",{className:"PreviewList",role:"region","aria-label":"Selected songs",style:{minHeight:0,maxHeight:360,overflow:"auto",marginTop:6},children:t.jsx("ol",{className:"List",style:{listStyle:"decimal inside"},children:c.map(e=>t.jsxs("li",{children:[e.title,Array.isArray(e.authors)&&e.authors.length?t.jsxs("span",{className:"Small",children:[" — ",e.authors.join(", ")]}):null]},e.id))})})]})})]})]})}export{ie as default};
