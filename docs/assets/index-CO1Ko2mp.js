const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./jspdf.es.min-DJc9uTeO.js","./index-Dsb9GHyL.js","./index-Wri8gDRg.css"])))=>i.map(i=>d[i]);
import{_ as D}from"./index-Dsb9GHyL.js";import{e as k}from"./fonts-OQpvcT7Z.js";import{chooseBestLayout as $,normalizeSongInput as _,DEFAULT_LAYOUT_OPT as H}from"./pdfLayout-Di6FuHgv.js";import{planSongLayout as K}from"./pdfLayout-Di6FuHgv.js";const E=typeof window<"u"&&(()=>{try{return localStorage.getItem("pdfDebug")==="1"}catch{return!1}})();async function M(){const{jsPDF:t}=await D(async()=>{const{jsPDF:e}=await import("./jspdf.es.min-DJc9uTeO.js").then(r=>r.j);return{jsPDF:e}},__vite__mapDeps([0,1,2]),import.meta.url);return new t({unit:"pt",format:"letter"})}function A(t,e,r){var C,T,b;t.internal.pageSize.getWidth();const s=t.internal.pageSize.getHeight(),n={...H,...r};(C=e==null?void 0:e.meta)!=null&&C.capo&&(r==null?void 0:r.showCapo)!==!1&&(n.headerOffsetY=(n.headerOffsetY||H.headerOffsetY)+14);const m=(n.margin||36)+(n.headerOffsetY||0),o=s-m-(n.margin||36),S=(c=>{if(Array.isArray(c==null?void 0:c.sections))return c.sections;if(Array.isArray(c==null?void 0:c.blocks)){const x=[];let a=null;for(const l of c.blocks){if(l.type==="section"){a={header:l.header||l.name||"Section",lines:[]},x.push(a);continue}a||(a={header:"Section",lines:[]},x.push(a)),l.type==="line"&&a.lines.push(l)}return x}return typeof(c==null?void 0:c.body)=="string"?c.body.split(/\n\s*\n/).map(a=>a.trim()).filter(Boolean).map((a,l)=>({header:`S${l+1}`,lines:a.split(/\r?\n/).filter(y=>y.trim().length)})):[{header:"S1",lines:[]}]})(e),F=c=>{const a=Math.round(c*.85);return S.map((l,y)=>{let u=a;const w=Array.isArray(l.lines)?l.lines:[];for(const h of w){const d=Array.isArray(h.chords)?h.chords.map(P=>P.sym).join(" "):"";d&&(t.setFont(n.chordFamily,"bold"),t.setFontSize(c),t.getTextWidth(d),u+=c+4/2);const f=typeof h.lyrics=="string"?h.lyrics:typeof h.text=="string"?h.text:"";t.setFont(n.lyricFamily,"normal"),t.setFontSize(c),t.getTextWidth(f),u+=c+4}return u<a+c&&(u=a+c),{id:y+1,type:"section",height:u}})};return $({pageContentHeight:o,hasColumnsHint:((T=e==null?void 0:e.meta)==null?void 0:T.columns)===2||((b=e==null?void 0:e.hints)==null?void 0:b.columns)===2,honorColumnBreaks:!0,measureSectionsForPt:F})}function v(t,e,{title:r,key:s,capo:n,showCapo:m=!0}){const o=String(e.lyricFamily||"Helvetica"),g=String(e.chordFamily||"Courier"),S=t.internal.pageSize.getWidth(),F=t.internal.pageSize.getHeight(),i=e.margin,C=Math.max(22,e.lyricSizePt+6),T=Math.max(12,e.lyricSizePt-2),b=4,c=e.lyricSizePt,x=Math.round(e.lyricSizePt*.85),a=i+e.headerOffsetY,l=S-i*2,y=e.columns===2?(l-e.gutter)/2:l;e.layout.pages.forEach((u,w)=>{if(w>0&&t.addPage(),t.setFont(o,"bold"),t.setFontSize(C),t.text(r,i,i+24),t.setFont(o,"italic"),t.setFontSize(T),t.text(`Key: ${s||"—"}`,i,i+40),m&&typeof n=="number"&&t.text(`Capo: ${n}`,i,i+54),E){t.setDrawColor(180),t.rect(i,a,y,F-i-a),e.columns===2&&t.rect(i+y+e.gutter,a,y,F-i-a),e.layout.pages.length,e.columns,t.setFont(o,"normal"),t.setFontSize(9);const h=e.debugFooter?e.debugFooter:`Plan: ${e.columns} col • size ${e.lyricSizePt}pt • singlePage=${e.layout.pages.length===1?"yes":"no"}`;t.text(h,i,F-i*.6)}u.columns.forEach(h=>{var P;let d=h.x,f=a;for(const z of h.blocks)if(z.type==="section")f+=x,t.setFont(o,"bold"),t.setFontSize(c),t.text(`[${z.header}]`,d,f),f+=c+4;else if(z.type==="line")if(z.comment){const W=Math.max(10,e.lyricSizePt-2);t.setFont(o,"italic"),t.setFontSize(W),t.setTextColor(120),t.text(z.comment,d,f),t.setTextColor(0),f+=W+3}else{if((P=z.chords)!=null&&P.length){t.setFont(g,"bold"),t.setFontSize(e.chordSizePt);for(const W of z.chords)t.text(W.sym,d+W.x,f);f+=e.chordSizePt+b/2}t.setFont(o,"normal"),t.setFontSize(e.lyricSizePt),t.text(z.lyrics,d,f),f+=e.lyricSizePt+b}})})}async function L(t,e={}){const r=await M();let s={};try{s=await k(r)}catch{}({lyricFamily:s.lyricFamily||e.lyricFamily,chordFamily:s.chordFamily||e.chordFamily,...e},r.internal.pageSize.getWidth()),r.internal.pageSize.getHeight();const n=_(t);return $(n)}async function N(t,e){var i;const r=await M();let s={};try{s=await k(r)}catch{}const n={lyricSizePt:Math.max(12,(e==null?void 0:e.lyricSizePt)||16),chordSizePt:Math.max(12,(e==null?void 0:e.chordSizePt)||16),margin:36,lyricFamily:s.lyricFamily||"Helvetica",chordFamily:s.chordFamily||"Courier",columns:(e==null?void 0:e.columns)===2?2:1,showCapo:e==null?void 0:e.showCapo},m=_(t),o=A(r,m,n),g=o&&o.plan?o.plan:o,S=t.title||m.title||"Untitled",F=t.key||m.key||"C";return v(r,g,{title:S,key:F,capo:(i=m.meta)==null?void 0:i.capo,showCapo:(e==null?void 0:e.showCapo)!==!1}),r.setProperties({title:`${S} – GraceChords`}),r.save(`${S.replace(/\s+/g,"_")}.pdf`),{plan:g}}async function G(t,e={}){const r=await M();let s={};try{s=await k(r)}catch{}const n={lyricSizePt:Math.max(12,(e==null?void 0:e.lyricSizePt)||16),chordSizePt:Math.max(12,(e==null?void 0:e.chordSizePt)||16),margin:36,lyricFamily:s.lyricFamily||"Helvetica",chordFamily:s.chordFamily||"Courier",columns:(e==null?void 0:e.columns)===2?2:1,showCapo:e==null?void 0:e.showCapo},m=!!(e!=null&&e.includeTOC),o=e==null?void 0:e.coverImageDataUrl,g=t.map((a,l)=>{var P;const y=_(a),u=A(r,y,n),w=u&&u.plan?u.plan:u,h=a.title||y.title||"Untitled",d=a.key||y.key||"C",f=(P=y.meta)==null?void 0:P.capo;return{raw:a,plan:w,title:h,key:d,capo:f,num:a._songbookNum||l+1,origTitle:a._origTitle||h}}),S=r.internal.pageSize.getWidth(),F=r.internal.pageSize.getHeight(),i=n.margin,C=16,T=Math.floor((F-i*2-40)/C),b=m?Math.ceil(g.length/T):0;let c=1+(o?1:0)+b;const x=g.map(a=>{const l={num:a.num,title:a.origTitle,page:c};return c+=a.plan.layout.pages.length,l});if(o){try{r.addImage(o,"JPEG",0,0,S,F,void 0,"FAST")}catch{}(m||g.length)&&r.addPage()}if(m){r.setFont(n.lyricFamily,"bold"),r.setFontSize(24),r.text("Table of Contents",S/2,i+20,{align:"center"}),r.setFont(n.lyricFamily,"normal"),r.setFontSize(12);let a=i+40;x.forEach((l,y)=>{y>0&&y%T===0&&(r.addPage(),a=i);const u=`${l.num} ${l.title}`;r.text(u,i,a);const w=String(l.page),h=S-i,d=r.getTextWidth(u),f=r.getTextWidth(w),P=h-i-d-f-4;if(P>0){const z=r.getTextWidth("."),W=".".repeat(Math.max(0,Math.floor(P/z)));r.text(W,i+d+2,a)}r.text(w,h,a,{align:"right"}),a+=C}),g.length&&r.addPage()}g.forEach((a,l)=>{l>0&&r.addPage(),v(r,a.plan,{title:a.title,key:a.key,capo:a.capo,showCapo:(e==null?void 0:e.showCapo)!==!1})}),r.setProperties({title:(e==null?void 0:e.docTitle)||"GraceChords Setlist"}),r.save((e==null?void 0:e.fileName)||"GraceChords_Selection.pdf")}async function U(t,{includeTOC:e,coverImageDataUrl:r}={}){const s=t.map((m,o)=>({...m,title:`${o+1}. ${m.title}`,_songbookNum:o+1,_origTitle:m.title})),n=new Date().toISOString().slice(0,10).replace(/-/g,"");await G(s,{includeTOC:e,coverImageDataUrl:r,docTitle:"GraceChords Songbook",fileName:`songbook-${n}.pdf`})}function O(t,e,r={lyrics:"Noto Sans",chords:"Noto Sans Mono",chordWeight:"bold"}){return _measureSection(t,{fontSize:e,lyricFamily:r.lyrics,chordFamily:r.chords,chordWeight:r.chordWeight||"bold"})}export{$ as chooseBestLayout,L as chooseBestLayoutAuto,G as downloadMultiSongPdf,N as downloadSingleSongPdf,U as downloadSongbookPdf,O as measureSection,_ as normalizeSongInput,K as planSongLayout};
