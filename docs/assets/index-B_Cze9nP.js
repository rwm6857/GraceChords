const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./jspdf.es.min-B94Av4SW.js","./index-Db6tRx2a.js","./index-Wri8gDRg.css"])))=>i.map(i=>d[i]);
import{_ as v}from"./index-Db6tRx2a.js";import{e as $}from"./fonts-OQpvcT7Z.js";import{chooseBestLayout as D,normalizeSongInput as b,DEFAULT_LAYOUT_OPT as M}from"./pdfLayout-Di6FuHgv.js";import{planSongLayout as J}from"./pdfLayout-Di6FuHgv.js";const G=typeof window<"u"&&(()=>{try{return localStorage.getItem("pdfDebug")==="1"}catch{return!1}})();async function k(){const{jsPDF:a}=await v(async()=>{const{jsPDF:e}=await import("./jspdf.es.min-B94Av4SW.js").then(t=>t.j);return{jsPDF:e}},__vite__mapDeps([0,1,2]),import.meta.url);return new a({unit:"pt",format:"letter"})}function E(a,e,t){var l;a.internal.pageSize.getWidth(),a.internal.pageSize.getHeight();const i={...M,...t};return(l=e==null?void 0:e.meta)!=null&&l.capo&&(t==null?void 0:t.showCapo)!==!1&&(i.headerOffsetY=(i.headerOffsetY||M.headerOffsetY)+14),D(e)}function H(a,e,{title:t,key:i,capo:l,showCapo:m=!0}){const n=String(e.lyricFamily||"Helvetica"),g=String(e.chordFamily||"Courier"),S=a.internal.pageSize.getWidth(),f=a.internal.pageSize.getHeight(),c=e.margin,C=Math.max(22,e.lyricSizePt+6),T=Math.max(12,e.lyricSizePt-2),W=4,x=e.lyricSizePt,_=Math.round(e.lyricSizePt*.85),r=c+e.headerOffsetY,h=S-c*2,s=e.columns===2?(h-e.gutter)/2:h;e.layout.pages.forEach((z,F)=>{if(F>0&&a.addPage(),a.setFont(n,"bold"),a.setFontSize(C),a.text(t,c,c+24),a.setFont(n,"italic"),a.setFontSize(T),a.text(`Key: ${i||"—"}`,c,c+40),m&&typeof l=="number"&&a.text(`Capo: ${l}`,c,c+54),G){a.setDrawColor(180),a.rect(c,r,s,f-c-r),e.columns===2&&a.rect(c+s+e.gutter,r,s,f-c-r);const u=e.layout.pages.length===1?.64:1.02,y=e.columns===2?.95:1,o=` • occ=${u.toFixed(2)} • bal=${y.toFixed(2)}`;a.setFont(n,"normal"),a.setFontSize(9),a.text(`Plan: ${e.columns} col • size ${e.lyricSizePt}pt • singlePage=${e.layout.pages.length===1?"yes":"no"}${o}`,c,f-c*.6)}z.columns.forEach(u=>{var w;let y=u.x,o=r;for(const d of u.blocks)if(d.type==="section")o+=_,a.setFont(n,"bold"),a.setFontSize(x),a.text(`[${d.header}]`,y,o),o+=x+4;else if(d.type==="line")if(d.comment){const P=Math.max(10,e.lyricSizePt-2);a.setFont(n,"italic"),a.setFontSize(P),a.setTextColor(120),a.text(d.comment,y,o),a.setTextColor(0),o+=P+3}else{if((w=d.chords)!=null&&w.length){a.setFont(g,"bold"),a.setFontSize(e.chordSizePt);for(const P of d.chords)a.text(P.sym,y+P.x,o);o+=e.chordSizePt+W/2}a.setFont(n,"normal"),a.setFontSize(e.lyricSizePt),a.text(d.lyrics,y,o),o+=e.lyricSizePt+W}})})}async function Y(a,e={}){const t=await k();let i={};try{i=await $(t)}catch{}({lyricFamily:i.lyricFamily||e.lyricFamily,chordFamily:i.chordFamily||e.chordFamily,...e},t.internal.pageSize.getWidth()),t.internal.pageSize.getHeight();const l=b(a);return D(l)}async function A(a,e){var f;const t=await k();let i={};try{i=await $(t)}catch{}const l={lyricSizePt:Math.max(12,(e==null?void 0:e.lyricSizePt)||16),chordSizePt:Math.max(12,(e==null?void 0:e.chordSizePt)||16),margin:36,lyricFamily:i.lyricFamily||"Helvetica",chordFamily:i.chordFamily||"Courier",columns:(e==null?void 0:e.columns)===2?2:1,showCapo:e==null?void 0:e.showCapo},m=b(a),{plan:n}=E(t,m,l),g=a.title||m.title||"Untitled",S=a.key||m.key||"C";return H(t,n,{title:g,key:S,capo:(f=m.meta)==null?void 0:f.capo,showCapo:(e==null?void 0:e.showCapo)!==!1}),t.setProperties({title:`${g} – GraceChords`}),t.save(`${g.replace(/\s+/g,"_")}.pdf`),{plan:n}}async function I(a,e={}){const t=await k();let i={};try{i=await $(t)}catch{}const l={lyricSizePt:Math.max(12,(e==null?void 0:e.lyricSizePt)||16),chordSizePt:Math.max(12,(e==null?void 0:e.chordSizePt)||16),margin:36,lyricFamily:i.lyricFamily||"Helvetica",chordFamily:i.chordFamily||"Courier",columns:(e==null?void 0:e.columns)===2?2:1,showCapo:e==null?void 0:e.showCapo},m=!!(e!=null&&e.includeTOC),n=e==null?void 0:e.coverImageDataUrl,g=a.map((r,h)=>{var o;const s=b(r),{plan:z}=E(t,s,l),F=r.title||s.title||"Untitled",u=r.key||s.key||"C",y=(o=s.meta)==null?void 0:o.capo;return{raw:r,plan:z,title:F,key:u,capo:y,num:r._songbookNum||h+1,origTitle:r._origTitle||F}}),S=t.internal.pageSize.getWidth(),f=t.internal.pageSize.getHeight(),c=l.margin,C=16,T=Math.floor((f-c*2-40)/C),W=m?Math.ceil(g.length/T):0;let x=1+(n?1:0)+W;const _=g.map(r=>{const h={num:r.num,title:r.origTitle,page:x};return x+=r.plan.layout.pages.length,h});if(n){try{t.addImage(n,"JPEG",0,0,S,f,void 0,"FAST")}catch{}(m||g.length)&&t.addPage()}if(m){t.setFont(l.lyricFamily,"bold"),t.setFontSize(24),t.text("Table of Contents",S/2,c+20,{align:"center"}),t.setFont(l.lyricFamily,"normal"),t.setFontSize(12);let r=c+40;_.forEach((h,s)=>{s>0&&s%T===0&&(t.addPage(),r=c);const z=`${h.num} ${h.title}`;t.text(z,c,r);const F=String(h.page),u=S-c,y=t.getTextWidth(z),o=t.getTextWidth(F),w=u-c-y-o-4;if(w>0){const d=t.getTextWidth("."),P=".".repeat(Math.max(0,Math.floor(w/d)));t.text(P,c+y+2,r)}t.text(F,u,r,{align:"right"}),r+=C}),g.length&&t.addPage()}g.forEach((r,h)=>{h>0&&t.addPage(),H(t,r.plan,{title:r.title,key:r.key,capo:r.capo,showCapo:(e==null?void 0:e.showCapo)!==!1})}),t.setProperties({title:(e==null?void 0:e.docTitle)||"GraceChords Setlist"}),t.save((e==null?void 0:e.fileName)||"GraceChords_Selection.pdf")}async function B(a,{includeTOC:e,coverImageDataUrl:t}={}){const i=a.map((m,n)=>({...m,title:`${n+1}. ${m.title}`,_songbookNum:n+1,_origTitle:m.title})),l=new Date().toISOString().slice(0,10).replace(/-/g,"");await I(i,{includeTOC:e,coverImageDataUrl:t,docTitle:"GraceChords Songbook",fileName:`songbook-${l}.pdf`})}function O(a,e,t={lyrics:"Noto Sans",chords:"Noto Sans Mono",chordWeight:"bold"}){return _measureSection(a,{fontSize:e,lyricFamily:t.lyrics,chordFamily:t.chords,chordWeight:t.chordWeight||"bold"})}export{D as chooseBestLayout,Y as chooseBestLayoutAuto,I as downloadMultiSongPdf,A as downloadSingleSongPdf,B as downloadSongbookPdf,O as measureSection,b as normalizeSongInput,J as planSongLayout};
