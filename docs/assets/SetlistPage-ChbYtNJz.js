const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jszip.min-xDVYXPgY.js","assets/index-DyMCvJez.js","assets/index-C9AobQEo.css","assets/index-XfZOjV_e.js"])))=>i.map(i=>d[i]);
import{_ as Je,p as $e,Y as tn,Z as nn,$ as sn,r as g,a0 as rn,i as an,a1 as on,a2 as ln,a3 as cn,a4 as dn,a5 as un,a6 as fn,a7 as ht,a8 as pn,a9 as mn,F as hn,aa as gn,j as n,ab as E,ac as yn,ad as gt,ae as xe,af as yt,L as xt,ag as bt,ah as xn,ai as bn,y as Ve,D as Sn,aj as wn,f as Tn,ak as St,al as ze,am as Ye,an as He,ao as wt,ap as Tt,aq as vt,ar as jt,as as vn,at as jn,au as Nn,av as Pn,aw as In,ax as Ae,ay as be,az as Nt,aA as Pt,s as q,l as En,m as Cn,aB as Ln,aC as Mn,aD as An,aE as $n}from"./index-DyMCvJez.js";import{b as kn,B as Rn}from"./BibleTranslationPicker-Bd6hnJLt.js";import{P as Dn}from"./PageContainer-BSBVHVOF.js";const kt="gracechords.sets.v1";function Re(){try{const e=localStorage.getItem(kt);return e?JSON.parse(e):{sets:{}}}catch{return{sets:{}}}}function Rt(e){localStorage.setItem(kt,JSON.stringify(e))}function Bn(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"id-"+Math.random().toString(36).slice(2)+Date.now().toString(36)}function je(){const{sets:e}=Re();return Object.values(e).sort((s,r)=>(r.updatedAt||0)-(s.updatedAt||0))}function On(e){const{sets:s}=Re();return s[e]||null}function It(e){const s=Date.now(),r={id:e.id||Bn(),name:e.name?.trim()||"Untitled Set",items:Array.isArray(e.items)?e.items:[],createdAt:e.createdAt||s,updatedAt:s},d=Re();return d.sets[r.id]=r,Rt(d),r}function _n(e){const s=Re();return s.sets[e]?(delete s.sets[e],Rt(s),!0):!1}const Kn="application/vnd.openxmlformats-officedocument.presentationml.slide+xml",Et="application/vnd.openxmlformats-officedocument.presentationml.slideMaster+xml",Un="application/vnd.openxmlformats-officedocument.presentationml.slideLayout+xml",Fn="application/vnd.openxmlformats-officedocument.theme+xml",ee="http://schemas.openxmlformats.org/presentationml/2006/main",Ze="http://schemas.openxmlformats.org/officeDocument/2006/relationships",Ct="application/vnd.openxmlformats-officedocument.presentationml.notesMaster+xml",Xn=new DOMParser,Wn=new XMLSerializer;function Vn(e){const s="setlist",r=String(e).trim();return r&&r.replace(/\s+/g,"_").replace(/[^A-Za-z0-9_.-]/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"")||s}async function Lt(e){const s=await fetch(e);if(!s.ok)throw new Error(`Failed to load PPTX: ${e}`);return s.arrayBuffer()}function ce(e){const s=Xn.parseFromString(e,"application/xml"),r=s.getElementsByTagName("parsererror")[0];if(r)throw new Error(r.textContent||"Failed to parse XML");return s}function Pe(e){return Wn.serializeToString(e)}function G(e){const s=String(e||"").match(/(\d+)$/);return s?Number(s[1]):0}function he(e,s){let r=0;return e.filter(d=>s.test(d)).forEach(d=>{const a=d.name.match(s);if(!a)return;const u=Number(a[1]);Number.isNaN(u)||(r=Math.max(r,u))}),r}function Dt(e,s,r){if(Array.from(e.getElementsByTagName("Override")).some(u=>u.getAttribute("PartName")===s))return;const a=e.createElement("Override");a.setAttribute("PartName",s),a.setAttribute("ContentType",r),e.documentElement.appendChild(a)}function Se(e,s){if(!s)return null;if(s.startsWith("/"))return s.slice(1);const r=e.split("/");r.pop();const d=s.split("/");for(const a of d)if(a==="..")r.pop();else{if(a===".")continue;r.push(a)}return r.join("/")}function de(e,s){const r=e.split("/");r.pop();const d=s.split("/");let a=0;for(;a<r.length&&a<d.length&&r[a]===d[a];)a++;const u=r.length-a,p=[];for(let m=0;m<u;m++)p.push("..");return p.push(...d.slice(a)),p.join("/")}function Bt(e){const s=e.match(/^(.*\/)([^/]*?)(\d+)(\.[^.]+)$/);return s?{dir:s[1],prefix:s[2],number:Number(s[3]),ext:s[4]}:null}function le(e,s,r){const d=Number(e[s]||0);r>d&&(e[s]=r)}function Ot(e,s){const d=Number(e[s]||0)+1;return e[s]=d,d}function J(e,s){if(!e)return null;const r=e.file(s);return Array.isArray(r)?r.length?r[0]:null:r||null}function we(e){const s=e.lastIndexOf("/"),r=s>=0?e.slice(0,s+1):"",d=s>=0?e.slice(s+1):e;return`${r}_rels/${d}.rels`}function zn(e,s){if(!e||!s)return{contentType:"",fromOverride:!1,extension:""};const r=`/${s}`,a=Array.from(e.getElementsByTagName("Override")).find(w=>w.getAttribute("PartName")===r);if(a)return{contentType:a.getAttribute("ContentType")||"",fromOverride:!0,extension:s.split(".").pop()||""};const u=Array.from(e.getElementsByTagName("Default")),p=s.split(".").pop()||"",m=u.find(w=>w.getAttribute("Extension")===p);return m?{contentType:m.getAttribute("ContentType")||"",fromOverride:!1,extension:p}:{contentType:"",fromOverride:!1,extension:p}}function Yn(e,s,r){if(!r||Array.from(e.getElementsByTagName("Default")).some(p=>p.getAttribute("Extension")===r))return;const a=Array.from(s?.getElementsByTagName?.("Default")||[]).find(p=>p.getAttribute("Extension")===r);if(!a)return;const u=e.createElement("Default");u.setAttribute("Extension",r),u.setAttribute("ContentType",a.getAttribute("ContentType")||""),e.documentElement.appendChild(u)}function Hn(e){return e?!/xml|text|application\/(.*\+xml)/i.test(e):!1}function qn(e){const s=/(.*\D)(\d+)(\.\w+)$/,r=e&&e.match(s);if(r){const[,d,,a]=r;return u=>`${d}${u}${a}`}return d=>`slides/slide${d}.xml`}async function Gn(e){const s="ppt/presentation.xml",r=J(e,s);if(!r)throw new Error("Base PPTX missing ppt/presentation.xml");const d=await r.async("string"),a=ce(d),u=a.getElementsByTagNameNS(ee,"sldIdLst")[0]||a.getElementsByTagName("p:sldIdLst")[0],m=(u?Array.from(u.getElementsByTagNameNS(ee,"sldId")).concat(Array.from(u.getElementsByTagName("p:sldId"))):[]).reduce((b,N)=>{const M=Number(N.getAttribute("id"));return Number.isNaN(M)?b:Math.max(b,M)},255),w="ppt/_rels/presentation.xml.rels",j=J(e,w);if(!j)throw new Error("Base PPTX missing ppt/_rels/presentation.xml.rels");const T=await j.async("string"),$=ce(T),D=Array.from($.getElementsByTagName("Relationship")),U=D.reduce((b,N)=>{const M=G(N.getAttribute("Id"));return Math.max(b,M)},0),te=D.filter(b=>(b.getAttribute("Type")||"").endsWith("/slide")),P=te.length&&te[0].getAttribute("Target")||"",B=qn(P),h=a.getElementsByTagNameNS(ee,"sldMasterIdLst")[0]||a.getElementsByTagName("p:sldMasterIdLst")[0]||null,_=(h?Array.from(h.getElementsByTagNameNS(ee,"sldMasterId")).concat(Array.from(h.getElementsByTagName("p:sldMasterId"))):[]).reduce((b,N)=>{const M=Number(N.getAttribute("id"));return Number.isNaN(M)?b:Math.max(b,M)},2147483647),ue=a.getElementsByTagNameNS(ee,"notesMasterIdLst")[0]||a.getElementsByTagName("p:notesMasterIdLst")[0]||null;let O=null;const ne=D.find(b=>(b.getAttribute("Type")||"").endsWith("/notesMaster"));if(ne){const b=ne.getAttribute("Target")||"";O=Se("ppt/presentation.xml",b)}let K=null;const fe=D.find(b=>(b.getAttribute("Type")||"").endsWith("/theme"));if(fe){const b=fe.getAttribute("Target")||"";K=Se("ppt/presentation.xml",b)}const V="[Content_Types].xml",Te=J(e,V);if(!Te)throw new Error("Base PPTX missing [Content_Types].xml");const De=await Te.async("string"),Be=ce(De),se={};e.filter(()=>!0).forEach(b=>{const N=Bt(b.name);if(!N)return;const M=`${N.dir}${N.prefix}`;le(se,M,N.number)}),le(se,"ppt/slides/slide",he(e,/^ppt\/slides\/slide(\d+)\.xml$/)),le(se,"ppt/notesSlides/notesSlide",he(e,/^ppt\/notesSlides\/notesSlide(\d+)\.xml$/)),le(se,"ppt/slideMasters/slideMaster",he(e,/^ppt\/slideMasters\/slideMaster(\d+)\.xml$/)),le(se,"ppt/slideLayouts/slideLayout",he(e,/^ppt\/slideLayouts\/slideLayout(\d+)\.xml$/)),le(se,"ppt/theme/theme",he(e,/^ppt\/theme\/theme(\d+)\.xml$/)),le(se,"ppt/notesMasters/notesMaster",he(e,/^ppt\/notesMasters\/notesMaster(\d+)\.xml$/)),le(se,"ppt/media/image",he(e,/^ppt\/media\/image(\d+)\.[^.]+$/));const re=e.file(/^ppt\/slides\/slide\d+\.xml$/).sort((b,N)=>G(b.name)-G(N.name));let z="",Z="",pe="";if(re.length){const b=re[0],N=J(e,we(b.name));if(N){const M=ce(await N.async("string")),Y=Array.from(M.getElementsByTagName("Relationship")).find(X=>(X.getAttribute("Type")||"").endsWith("/slideLayout"));if(Y){z=Y.getAttribute("Target")||"";const X=Se(b.name,z);X&&J(e,X)&&(Z=X)}}}if(Z)!z&&re.length&&(z=de(re[0].name,Z));else{const b=e.file(/^ppt\/slideLayouts\/.*\.xml$/).sort((N,M)=>G(N.name)-G(M.name));b.length&&(Z=b[0].name,z=re.length?de(re[0].name,Z):"../slideLayouts/slideLayout1.xml")}if(Z){const b=J(e,we(Z));if(b){const N=ce(await b.async("string")),ie=Array.from(N.getElementsByTagName("Relationship")).find(Y=>(Y.getAttribute("Type")||"").endsWith("/slideMaster"));if(ie){const Y=ie.getAttribute("Target")||"",X=Se(Z,Y);X&&J(e,X)&&(pe=X)}}}if(!pe){const b=e.file(/^ppt\/slideMasters\/.*\.xml$/).sort((N,M)=>G(N.name)-G(M.name));b.length&&(pe=b[0].name)}if(!O){const b=e.file(/^ppt\/notesMasters\/.*\.xml$/).sort((N,M)=>G(N.name)-G(M.name));b.length&&(O=b[0].name)}return{zip:e,presentationXmlPath:s,presentationDoc:a,sldIdList:u,sldMasterList:h,notesMasterList:ue,presentationRelsPath:w,presentationRelsDoc:$,contentTypesPath:V,contentTypesDoc:Be,nextSlideId:m,nextRelId:U,nextMasterId:_,counters:se,partMap:new Map,masterRelMap:new Map,notesMasterRelMap:new Map,getSlideTarget:B,defaultLayoutTarget:z,defaultLayoutPath:Z,defaultMasterPath:pe,defaultNotesMasterPath:O,defaultThemePath:K}}function Jn(e,s,r){const d=e.presentationRelsDoc.documentElement,a=e.presentationRelsDoc.createElement("Relationship");a.setAttribute("Id",r),a.setAttribute("Type","http://schemas.openxmlformats.org/officeDocument/2006/relationships/slide");const u=e.getSlideTarget?e.getSlideTarget(s):`slides/slide${s}.xml`;a.setAttribute("Target",u),d.appendChild(a)}function Zn(e,s){const r=e.presentationDoc,d=e.sldIdList||(()=>{const u=r.createElementNS(ee,"p:sldIdLst");return r.documentElement.appendChild(u),e.sldIdList=u,u})(),a=r.createElementNS(ee,"p:sldId");e.nextSlideId+=1,a.setAttribute("id",String(e.nextSlideId)),a.setAttributeNS(Ze,"r:id",s),d.appendChild(a)}function Qn(e,s){if(e.masterRelMap.has(s))return e.masterRelMap.get(s);const r=e.presentationDoc,d=e.presentationRelsDoc;let a=e.sldMasterList;if(!a){a=r.createElementNS(ee,"p:sldMasterIdLst");const w=r.documentElement.firstChild;w?r.documentElement.insertBefore(a,w):r.documentElement.appendChild(a),e.sldMasterList=a}e.nextMasterId=Number(e.nextMasterId||2147483647),e.nextMasterId+=1,e.nextRelId+=1;const u=`rId${e.nextRelId}`,p=r.createElementNS(ee,"p:sldMasterId");p.setAttribute("id",String(e.nextMasterId)),p.setAttributeNS(Ze,"r:id",u),a.appendChild(p);const m=d.createElement("Relationship");return m.setAttribute("Id",u),m.setAttribute("Type","http://schemas.openxmlformats.org/officeDocument/2006/relationships/slideMaster"),m.setAttribute("Target",de("ppt/presentation.xml",s)),d.documentElement.appendChild(m),e.masterRelMap.set(s,u),u}function es(e,s){if(e.notesMasterRelMap.has(s))return e.notesMasterRelMap.get(s);const r=e.presentationDoc,d=e.presentationRelsDoc;let a=e.notesMasterList;if(!a){a=r.createElementNS(ee,"p:notesMasterIdLst");const w=r.documentElement,j=e.sldIdList||w.firstChild;j?w.insertBefore(a,j):w.appendChild(a),e.notesMasterList=a}e.nextRelId+=1;const u=`rId${e.nextRelId}`,p=r.createElementNS(ee,"p:notesMasterId");p.setAttributeNS(Ze,"r:id",u),a.appendChild(p);const m=d.createElement("Relationship");return m.setAttribute("Id",u),m.setAttribute("Type","http://schemas.openxmlformats.org/officeDocument/2006/relationships/notesMaster"),m.setAttribute("Target",de("ppt/presentation.xml",s)),d.documentElement.appendChild(m),e.notesMasterRelMap.set(s,u),u}async function ke(e,s,r,d,a,u={}){if(!a)return null;const p=`${d}:${a}`;if(e.partMap.has(p))return e.partMap.get(p);const m=zn(r,a),w=J(s,a);if(!w)return null;if(m.contentType===Un&&e.defaultLayoutPath)return e.partMap.set(p,e.defaultLayoutPath),e.defaultLayoutPath;if(m.contentType===Et&&e.defaultMasterPath)return e.partMap.set(p,e.defaultMasterPath),e.defaultMasterPath;if(m.contentType===Ct&&e.defaultNotesMasterPath)return e.partMap.set(p,e.defaultNotesMasterPath),e.defaultNotesMasterPath;if(m.contentType===Fn&&e.defaultThemePath)return e.partMap.set(p,e.defaultThemePath),e.defaultThemePath;const j=Bt(a);let T;if(j){const te=`${j.dir}${j.prefix}`,P=Ot(e.counters,te);T=`${j.dir}${j.prefix}${P}${j.ext}`}else{if(J(e.zip,a))return e.partMap.set(p,a),a;T=a}e.partMap.set(p,T),m.fromOverride?Dt(e.contentTypesDoc,`/${T}`,m.contentType):m.extension&&Yn(e.contentTypesDoc,r,m.extension);const $=await w.async(Hn(m.contentType)?"uint8array":"string");e.zip.file(T,$);const D=we(a),U=J(s,D);if(U){const te=await U.async("string"),P=ce(te),B=Array.from(P.getElementsByTagName("Relationship"));for(const L of B){if((L.getAttribute("TargetMode")||"").toLowerCase()==="external")continue;const ue=L.getAttribute("Target")||"",O=Se(a,ue);if(!O)continue;let ne=null;if(typeof u.relationshipMutator=="function"){const V=await u.relationshipMutator({node:L,type:L.getAttribute("Type")||"",absolutePath:O,newPartPath:T,originalPartPath:a});if(V===!1)continue;V&&V.targetPath&&(ne=V.targetPath)}const K=ne||await ke(e,s,r,d,O);if(!K)continue;const fe=de(T,K);L.setAttribute("Target",fe)}const h=we(T);e.zip.file(h,Pe(P))}return m.contentType===Et?Qn(e,T):m.contentType===Ct&&es(e,T),T}async function ts(e,s,r,d,a,u){const p=we(a),m=J(s,p);if(!m)return;const w=await m.async("string"),j=ce(w),T=Array.from(j.getElementsByTagName("Relationship")),$=j.documentElement;let D=!1,U=T.reduce((P,B)=>{const h=B.getAttribute("Id")||"";return Math.max(P,G(h))},0);for(const P of T){const B=P.getAttribute("Type")||"",h=P.getAttribute("Target")||"";if(!h)continue;const L=Se(a,h);if(L){if(B.endsWith("/slideLayout")){e.defaultLayoutTarget?D?$.removeChild(P):(D=!0,P.setAttribute("Target",e.defaultLayoutTarget)):D?$.removeChild(P):D=!0;continue}if(B.endsWith("/notesSlide")){const _=await ke(e,s,r,d,L,{relationshipMutator:({type:ue})=>ue.endsWith("/slide")?{targetPath:u}:null});if(!_)continue;P.setAttribute("Target",de(u,_))}else if(B.includes("/image")||B.includes("/audio")||B.includes("/video")){const _=await ke(e,s,r,d,L);if(!_)continue;P.setAttribute("Target",de(u,_))}else{const _=await ke(e,s,r,d,L);if(!_)continue;P.setAttribute("Target",de(u,_))}}}if(!D&&e.defaultLayoutTarget){const P=j.createElement("Relationship"),B=`rId${U+1||1}`;P.setAttribute("Id",B),P.setAttribute("Type","http://schemas.openxmlformats.org/officeDocument/2006/relationships/slideLayout"),P.setAttribute("Target",e.defaultLayoutTarget),$.appendChild(P)}const te=we(u);e.zip.file(te,Pe(j))}async function ns(e,s,r){const d=s.file(/^ppt\/slides\/slide\d+\.xml$/).sort((p,m)=>{const w=G(p.name),j=G(m.name);return w-j});if(!d.length)return;const a=J(s,"[Content_Types].xml");if(!a)throw new Error("Source PPTX missing [Content_Types].xml");const u=ce(await a.async("string"));for(const p of d){const m=Ot(e.counters,"ppt/slides/slide"),w=`ppt/slides/slide${m}.xml`,j=await p.async("string");e.zip.file(w,j),Dt(e.contentTypesDoc,`/${w}`,Kn),e.nextRelId+=1;const T=`rId${e.nextRelId}`;Jn(e,m,T),Zn(e,T);const $=p.name;e.partMap.set(`${r}:${$}`,w),await ts(e,s,u,r,$,w)}}function ss(e){e.zip.file(e.presentationXmlPath,Pe(e.presentationDoc)),e.zip.file(e.presentationRelsPath,Pe(e.presentationRelsDoc)),e.zip.file(e.contentTypesPath,Pe(e.contentTypesDoc))}function rs(e,s){const r=document.createElement("a");r.href=URL.createObjectURL(e),r.download=s,r.rel="noopener",r.click(),URL.revokeObjectURL(r.href)}async function is(e=[],s="Setlist"){if(!Array.isArray(e)||e.length===0)throw new Error("No PPTX files to merge");const r=(await Je(async()=>{const{default:T}=await import("./jszip.min-xDVYXPgY.js").then($=>$.j);return{default:T}},__vite__mapDeps([0,1,2]))).default,[d,...a]=e,u=await Lt(d),p=await r.loadAsync(u),m=await Gn(p);for(let T=0;T<a.length;T++){const $=await Lt(a[T]),D=await r.loadAsync($);await ns(m,D,`src${T+1}`)}ss(m);const w=await p.generateAsync({type:"blob"}),j=Vn(s||"Setlist");rs(w,`${j}.pptx`)}function as(e){return e?e.slug?e.slug:e.filename?e.filename.replace(/\.chordpro$/i,""):e.title?e.title.trim().toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_.-]/g,""):"":""}async function os(e={},s={}){const{name:r="Setlist",songs:d=[]}=e||{},{availablePptxMap:a=null,onEmpty:u}=s,p=[];for(const m of d){const w=as(m);w&&(a&&!a[w]||p.push($e(`pptx/${w}.pptx`)))}if(!p.length){typeof u=="function"&&u();return}await is(p,r)}let Mt;const At=()=>Mt||(Mt=Je(()=>import("./index-XfZOjV_e.js").then(e=>e.i),__vite__mapDeps([3,1,2])));function ls(){try{if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID()}catch{}return`sel-${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`}function Ge(e){if(!e)return null;const{id:s,toKey:r=""}=e;return s==null?null:{uid:ls(),id:s,toKey:r}}function Ne(e=[]){return e.map(s=>Ge(s)).filter(Boolean)}function $t(e){try{return decodeURIComponent(e)}catch{return e}}function _t(e){const s=String(e||"");if(!s.trim())return{bookPart:"",refPart:""};const r=s.indexOf(":");if(r>-1){let a=r-1;for(;a>=0&&/\d/.test(s[a]);)a-=1;const u=a+1;if(u<r)return{bookPart:s.slice(0,u).trim(),refPart:s.slice(u).trim()}}const d=s.match(/\s(\d+)(?=[\s:.,-]|$)/);return d&&typeof d.index=="number"?{bookPart:s.slice(0,d.index).trim(),refPart:s.slice(d.index+1).trim()}:{bookPart:s.trim(),refPart:""}}function qe(e,s){if(!s)return null;const r=String(e||"");if(!r.trim())return null;const{bookPart:d,refPart:a}=_t(r);if(!d)return null;const u=m=>String(m||"").toLowerCase().replace(/[^a-z0-9]/g,""),p=a?`${s} ${a}`:`${s} `;return!u(p).startsWith(u(r))||p.length<=r.length?null:{composed:p,prefix:r,remainder:p.slice(r.length)}}function fs(){const{code:e,songIds:s}=tn(),r=nn(),d=sn(),a=g.useMemo(()=>rn(an?.items||[]),[]),u=a.byId,p=a.translationLanguages||[],[m,w]=g.useState(()=>on(p.length?p:a.allLanguages)),[j,T]=g.useState("New Setlist"),[$,D]=g.useState(""),[U,te]=g.useState([]),[P,B]=g.useState(()=>{try{return localStorage.getItem("pref:icpOnly")==="1"}catch{return!1}});g.useEffect(()=>{try{localStorage.setItem("pref:icpOnly",P?"1":"0")}catch{}},[P]);const[h,L]=g.useState([]),[_,ue]=g.useState({}),[O,ne]=g.useState(""),[K,fe]=g.useState("");Object.keys(_).length;const[V,Te]=g.useState(!1),[De,Be]=g.useState(()=>{try{return window.innerWidth<=640}catch{return!1}}),[se,re]=g.useState(()=>{try{return window.innerWidth<=820}catch{return!1}}),[z,Z]=g.useState(()=>{try{return window.innerWidth<=900}catch{return!1}}),pe=g.useRef(""),b=g.useRef(""),N=g.useRef(!1),[M,ie]=g.useState(null),[Y,X]=g.useState(()=>je()),[Oe,Ie]=g.useState(""),[Kt,Ee]=g.useState(!1),[Qe,et]=g.useState(""),[_e,Ke]=g.useState(!1),[ae,Ue]=g.useState(""),[Fe,ge]=g.useState(""),[Xe,Ut]=g.useState(""),[Ce,Ft]=g.useState(()=>ln()),[ve,tt]=g.useState(()=>cn()),nt=g.useRef(new Map),Xt=g.useMemo(()=>kn(Ce),[Ce]);g.useEffect(()=>{dn(m)},[m]),g.useEffect(()=>{let t=!1;async function i(){const l=await jn();t||(Ft(l.translations),tt(o=>Nn(o,l.translations,l.defaultTranslationId)))}return i(),()=>{t=!0}},[]),g.useEffect(()=>{ve&&un(ve)},[ve]),g.useEffect(()=>{const t=[];for(const i of a.groups||[]){let l=fn(i,m);if(l){if(ht(l)){const o=i.variants.find(c=>!ht(c));if(!o)continue;l=o}t.push({...l,hasSelectedLanguage:pn(i,m),searchTitles:i.variants.map(o=>o.title||"").filter(Boolean),searchTags:Array.from(new Set(i.variants.flatMap(o=>o.tags||[]))),searchAuthors:Array.from(new Set(i.variants.flatMap(o=>o.authors||[])))})}}te(t)},[a.groups,m]);function ye(t){return t&&u.get(String(t))||null}g.useEffect(()=>{let t=!1;async function i(){const l={};for(const o of h){const c=ye(o.id);if(!c)continue;const f=c.filename.replace(/\.chordpro$/i,""),x=$e(`pptx/${f}.pptx`);await Pn(x,f)&&(l[f]=!0)}t||ue(l)}return i(),()=>{t=!0}},[h,u]),g.useEffect(()=>{try{const t=document.documentElement,i=document.body;pe.current=t.style.overflowY||"",b.current=i.style.overflowY||"",getComputedStyle(t).overflowY==="hidden"&&(t.style.overflowY=""),getComputedStyle(i).overflowY==="hidden"&&(i.style.overflowY="")}catch{}return()=>{try{document.documentElement.style.overflowY=pe.current,document.body.style.overflowY=b.current}catch{}}},[]),g.useEffect(()=>{if(!e)return;const{entries:t,error:i}=mn(e);if(i){alert(i),d("/setlist",{replace:!0});return}const l=t.map(f=>({id:f.id,toKey:f.toKey}));L(Ne(l));const o=l.map(f=>encodeURIComponent(f.id)).join(","),c=l.map(f=>encodeURIComponent(f.toKey||"")).join(",");d(`/setlist/${o}?toKeys=${c}`,{replace:!0})},[e]),g.useEffect(()=>{if(!s)return;const t=(s||"").split(",").map(c=>$t(c.trim())).filter(Boolean);if(!t.length)return;const l=(new URLSearchParams(r.search||"").get("toKeys")||"").split(",").map(c=>$t(c)),o=t.map((c,f)=>({id:c,toKey:l[f]||""}));L(Ne(o))},[s,r.search]),g.useEffect(()=>{try{if(!Array.isArray(h))return;if(h.length===0){(e||s)&&d("/setlist",{replace:!0});return}const t=h.map(c=>encodeURIComponent(c.id)).join(","),i=h.map(c=>encodeURIComponent(c.toKey||"")).join(","),l=s||"",o=new URLSearchParams(r.search||"").get("toKeys")||"";(t!==l||i!==o)&&d(`/setlist/${t}?toKeys=${i}`,{replace:!0})}catch{}},[h.map(t=>`${t.id}:${t.toKey}`).join("|"),s,r.search,e]),g.useEffect(()=>{try{const t=localStorage.getItem("setlist");if(!t||je().length>0)return;const i=JSON.parse(t);if(i?.name||(i?.list?.length||0)>0){const l=It({name:i.name||"Imported Set",items:i.list||[]});X(je()),ie(l.id),T(l.name),L(Ne(l.items||[])),Ie(l.id)}}catch{}},[]),g.useEffect(()=>{function t(){try{const i=window.innerWidth;Be(i<=640),re(i<=820),Z(i<=900)}catch{}}return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),g.useEffect(()=>{new URLSearchParams(r.search||"").get("icp")==="1"&&B(!0)},[r.search]),g.useEffect(()=>{if(N.current)return;const t=r.state?.quickAction;t&&U.length&&(zt(t,U),N.current=!0,d(r.pathname+(r.search||""),{replace:!0,state:null}))},[r.state,U.map(t=>t.id).join("|")]);const We=g.useMemo(()=>new hn(U,{keys:["title","tags","searchTitles","searchTags","searchAuthors"],threshold:.4}),[U]);function Wt(t){return!P||(Array.isArray(t.tags)?t.tags.includes("ICP"):t.tags==="ICP")}const Vt=g.useMemo(()=>{const i=($?We.search($).map(l=>l.item):U.slice()).filter(Wt);return i.sort((l,o)=>l.hasSelectedLanguage!==o.hasSelectedLanguage?l.hasSelectedLanguage?-1:1:String(l.title||"").localeCompare(String(o.title||""),void 0,{sensitivity:"base"})),i},[$,We,U,P]);function st(t){if(!t)return;const i=Ge({id:t.id,toKey:t.originalKey||t.key||"C"});L(l=>[...l,i])}async function rt(t){const i=In(t,{translation:ve});if(i.error)return ge("Please check verse reference."),!1;const l=await Zt(i);if(!l.ok)return ge(l.message),!1;const o=Ge({id:i.id,toKey:""});return o?(L(c=>[...c,o]),Ue(""),ge(""),Ke(!1),!0):!1}function it(t){L(i=>i.filter(l=>l.uid!==t))}function Le(t,i){L(l=>{const o=l.findIndex(y=>y.uid===t);if(o<0)return l;const c=o+(i==="up"?-1:1);if(c<0||c>=l.length)return l;const f=l.slice(),[x]=f.splice(o,1);return f.splice(c,0,x),f})}function at(t,i){L(l=>{if(i<0||i>=l.length)return l;const o=l.findIndex(x=>x.uid===t);if(o<0||o===i)return l;const c=l.slice(),[f]=c.splice(o,1);return c.splice(i,0,f),c})}function zt(t,i){if(!t)return;function l(S){!S||!S.length||L(Ne(S.map(I=>({id:I.id,toKey:I.toKey}))))}function o(S){return S?{id:S.id,toKey:S.originalKey||S.key||"C"}:null}function c(S,I){return S.filter(v=>v&&!I.has(v.id))}function f(S,I){const v=c(S,I),R=v.length?Nt(v):null;return R&&I.add(R.id),R}function x(){const S=Ae(i,"FAST"),I=[],v=new Set;if((S.length>=4?be(S,4):S.slice()).forEach(C=>{C&&v.add(C.id),I.push(C)}),I.length<4){const C=be(c(i,v),Math.min(4-I.length,Math.max(0,i.length-I.length)));I.push(...C)}return I.filter(Boolean).map(o).filter(Boolean).slice(0,4)}function y(){const S=new Set,I=Ae(i,"SLOW"),v=W=>I.filter(F=>(F?.originalKey||"").toUpperCase()===W.toUpperCase()),R=Ae(i,"FAST"),C=f(v("G"),S)||f(I,S)||f(i,S),Q=f(R,S)||f(i,S),H=f(v("A"),S)||f(I,S)||f(i,S);return[C,Q,H].filter(Boolean).map(o).filter(Boolean)}function A(){const I=Nt(["CROSS","COMMITMENT","MISSION","MISSIONS","PRAISE","HYMN"]),v=Ae(i,I),R=new Set,C=[];v.length>=4?C.push(...be(v,4)):v.length>=2?C.push(...be(v,Math.min(4,v.length))):v.length&&C.push(...v),C.forEach(H=>H&&R.add(H.id));const Q=Math.max(0,2-C.length);if(Q>0){const H=be(c(i,R),Math.min(Q,i.length-C.length));C.push(...H)}if(C.length<4){const H=be(c(i,R),Math.min(4-C.length,i.length-C.length));C.push(...H)}return C.filter(Boolean).map(o).filter(Boolean).slice(0,4)}let k=[];t==="celebrationSet"?k=x():t==="threeSongFlow"?k=y():t==="randomThemeSet"&&(k=A()),k.length&&l(k)}function Yt(t,i){L(l=>l.map(o=>o.uid===t?{...o,toKey:i}:o))}function ot(t){X(je()),Ie(t||"")}function lt(){ie(null),T("New Setlist"),L([]),Ie("")}function Ht(){const t=j?.trim()||"New Setlist",i=window.prompt("Save set as:",t);if(i===null)return;const l=String(i).trim()||"New Setlist";let o=M;if(!o){const x=(je()||[]).find(y=>(y.name||"")===l);x&&(o=x.id)}const c=h.map(({id:x,toKey:y})=>({id:x,toKey:y})),f=It({id:o,name:l,items:c});T(f.name),ie(f.id),ot(f.id)}function qt(){const t=Qe||Oe||"";if(!t){Ee(!1);return}const i=On(t);i&&(ie(i.id),T(i.name||"New Setlist"),L(Ne(i.items||[])),Ie(i.id)),Ee(!1)}function Gt(){const t=Y[0]?.id||"";et(Oe||t),Ee(!0)}function Jt(){M&&window.confirm(`Delete set "${j}"? This cannot be undone.`)&&(_n(M),lt(),ot(""))}async function ct(){Te(!0);try{let t=function(f){return Object.keys(f?.verses||{}).map(x=>Number(x)).filter(x=>!Number.isNaN(x)).sort((x,y)=>x-y)};const{downloadMultiSongPdf:i}=await At(),l=[],o=nt.current;async function c(f,x,y){const A=`${f}::${x}::${y}`;if(o.has(A))return o.get(A);try{const k=await Pt({translationId:f,book:x,chapter:y});return o.set(A,k),k}catch{return o.set(A,null),null}}for(const f of h){if(Ye(f.id)){const y=He(f.id);if(!y){q("Please check verse reference.");continue}try{const A=y.segments||[],k=A.length>1,S=[],I=new Set;for(const v of A){const R=await c(y.translation,String(y.bookNumber),v.chapter);if(!R?.verses)continue;const C=R.verses||{},Q=t(R),H=Q.length?Q[Q.length-1]:0;if(!v.ranges){for(const W of Q){const F=`${v.chapter}:${W}`;if(I.has(F))continue;const me=C[String(W)];if(!me)continue;const oe=k?`${v.chapter}:${W}`:`${W}`;S.push({plain:`${oe} ${me}`}),I.add(F)}continue}for(const W of v.ranges){const F=W.start,me=W.end==null?H:W.end;for(let oe=F;oe<=me;oe+=1){const pt=`${v.chapter}:${oe}`;if(I.has(pt))continue;const mt=C[String(oe)];if(!mt)continue;const en=k?`${v.chapter}:${oe}`:`${oe}`;S.push({plain:`${en} ${mt}`}),I.add(pt)}}}if(!S.length){q(`No verses found for ${y.refDisplay}`);continue}l.push({title:y.refDisplay||y.id,key:"",pdfColumns:1,sections:[{label:"",lines:S}]})}catch(A){console.error(A),q(`Failed to load ${y.refDisplay}`)}continue}const x=ye(f.id);if(x)try{const y=$e(`songs/${x.filename}`),A=await En(y),k=Cn(A),S=k.meta?.key||k.meta?.originalkey||x.originalKey||"C",I=Ln(S,f.toKey||S),v=(String(S).match(/^([A-G][#b]?)/)||[,""])[1],R=!!(v&&/b$/.test(v)),C=(k.sections||[]).map(W=>({section:W.label,lines:(W.lines||[]).map(F=>F.instrumental?{instrumental:Mn(F.instrumental,I,R)}:F.comment?{plain:F.comment,chordPositions:[],comment:F.comment}:{plain:F.lyrics||"",chordPositions:(F.chords||[]).map(me=>({sym:An(me.sym,I,R),index:me.index}))})})),Q=x.filename.replace(/\.chordpro$/i,""),H=$n({title:k.meta?.title||x.title||Q,key:f.toKey||S,capo:k.meta?.capo,lyricsBlocks:C});l.push(H)}catch(y){console.error(y),q(`Failed to process ${x.filename}`)}}l.length&&await i(l)}finally{Te(!1)}}function Me(){At()}async function dt(){try{const t=h.map(c=>encodeURIComponent(c.id)).join(","),i=h.map(c=>encodeURIComponent(c.toKey||"")).join(","),o=`${(()=>{try{if(typeof window<"u"&&window.location)return`${window.location.origin||""}/`}catch{}return""})()}setlist/${t}?toKeys=${i}`;await navigator.clipboard.writeText(o);try{q?.("Link copied!")}catch{}}catch{alert("Failed to copy link")}}g.useEffect(()=>{if(!_e)return;const t=_t(ae).bookPart,i=gn(t);Ut(i||"")},[ae,_e]);async function Zt(t){if(!t?.book||!t?.segments?.length)return{ok:!1,message:"Please check verse reference."};async function i(o,c,f){const x=`${o}::${c}::${f}`,y=nt.current;if(y.has(x))return y.get(x);try{const A=await Pt({translationId:o,book:c,chapter:f});return y.set(x,A),A}catch{return y.set(x,null),null}}let l=!1;for(const o of t.segments){const c=await i(t.translation,String(t.bookNumber),o.chapter);if(!c?.verses)return{ok:!1,message:"No verse found."};const f=c.verses||{},x=Object.keys(f);if(!o.ranges){x.length&&(l=!0);continue}for(const y of o.ranges){const A=y.start,k=y.end??A;if(!f[String(A)]||!f[String(k)])return{ok:!1,message:"Please check verse reference."};l=!0}}return l?{ok:!0}:{ok:!1,message:"No verse found."}}function Qt(){const t=qe(ae,Xe);t&&Ue(t.composed)}async function ut(){if(K)return;ne(`Bundling 0/${h.length}…`);const t=(await Je(async()=>{const{default:o}=await import("./jszip.min-xDVYXPgY.js").then(c=>c.j);return{default:o}},__vite__mapDeps([0,1,2]))).default,i=new t;let l=0;for(let o=0;o<h.length;o++){const c=h[o],f=ye(c.id);if(!f){ne(`Bundling ${o+1}/${h.length}…`);continue}ne(`Bundling ${o+1}/${h.length}…`);const x=f.filename.replace(/\.chordpro$/i,"");if(_[x])try{const y=await fetch($e(`pptx/${x}.pptx`));if(!y.ok)continue;const A=await y.blob();l++,i.file(`${String(l).padStart(2,"0")}-${x}.pptx`,A)}catch{}}if(l>0){const o=await i.generateAsync({type:"blob"}),c=new Date().toISOString().slice(0,10).replace(/-/g,""),f=document.createElement("a");f.href=URL.createObjectURL(o),f.download=`setlist-pptx-${c}.zip`,f.click(),URL.revokeObjectURL(f.href)}else try{q&&q("No PPTX files found for selected songs")||alert("No PPTX files found for selected songs")}catch{}ne("")}async function ft(){if(!(O||K)){fe("Combining…");try{const t=[],i=[];for(const l of h){const o=ye(l.id);if(!o)continue;const c=o.filename.replace(/\.chordpro$/i,"");if(!_[c]){i.push(o.title||c);continue}t.push(o)}if(!t.length){try{q&&q("No PPTX files found for selected songs")||alert("No PPTX files found for selected songs")}catch{}return}if(i.length){const l=i.length===1?`${i[0]} PPT file unavailable`:`${i.length} songs missing PPT files`;try{q?.(l)}catch{}}await os({name:j||"Setlist",songs:t},{})}catch(t){console.error(t);try{q&&q("Failed to combine PPTX files")||alert("Failed to combine PPTX files")}catch{}}finally{fe("")}}}return n.jsxs(Dn,{className:"is-setlist",children:[Kt?n.jsx("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,.45)",zIndex:90},role:"dialog","aria-modal":"true",children:n.jsxs("div",{style:{background:"var(--card)",color:"var(--text)",border:"1px solid var(--line)",borderRadius:10,padding:16,width:"min(560px, 92vw)"},children:[n.jsx("h3",{style:{marginTop:0,marginBottom:8},children:"Load Set"}),Y.length?n.jsxs("label",{style:{display:"block",margin:"8px 0"},children:["Select a saved set",n.jsx("select",{value:Qe,onChange:t=>et(t.target.value),style:{width:"100%"},children:Y.map(t=>n.jsxs("option",{value:t.id,children:[t.name," · ",new Date(t.updatedAt).toLocaleString()]},t.id))})]}):n.jsx("div",{className:"meta",children:"No saved sets yet."}),n.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:8,marginTop:12},children:[n.jsx(E,{onClick:()=>Ee(!1),children:"Cancel"}),n.jsx(E,{variant:"primary",onClick:qt,disabled:!Y.length,children:"Load"})]})]})}):null,_e?n.jsx("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,.45)",zIndex:90},role:"dialog","aria-modal":"true",children:n.jsxs("div",{style:{background:"var(--card)",color:"var(--text)",border:"1px solid var(--line)",borderRadius:10,padding:16,width:"min(560px, 92vw)"},children:[n.jsx("h3",{style:{marginTop:0,marginBottom:8},children:"Add Verse"}),n.jsx("div",{className:"gc-field",style:{margin:"8px 0"},children:n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr minmax(220px, 34%)",gap:8,alignItems:"center"},children:[n.jsx("label",{className:"gc-label",htmlFor:"verse-input",children:"Bible verse"}),n.jsx("label",{className:"gc-label",htmlFor:"verse-translation",children:"Translation"}),n.jsxs("div",{style:{position:"relative"},children:[(()=>{const t=qe(ae,Xe);return t?n.jsxs("div",{"aria-hidden":!0,style:{position:"absolute",inset:0,padding:"10px 12px",fontFamily:"var(--gc-font-family)",color:"var(--gc-text-secondary)",lineHeight:"normal",whiteSpace:"pre",overflow:"hidden",textOverflow:"ellipsis",pointerEvents:"none"},children:[n.jsx("span",{style:{visibility:"hidden"},children:t.prefix}),n.jsx("span",{children:t.remainder})]}):null})(),n.jsx("input",{id:"verse-input",value:ae,onChange:t=>{Ue(t.target.value),Fe&&ge("")},placeholder:"John 3:16",onKeyDown:t=>{if(t.key==="Tab"&&qe(ae,Xe)){t.preventDefault(),Qt();return}t.key==="Enter"&&(t.preventDefault(),rt(ae))},className:"gc-input",style:{width:"100%",background:"transparent",position:"relative",zIndex:1,lineHeight:"normal"}})]}),n.jsx(Rn,{id:"verse-translation",value:ve,groups:Xt,onChange:tt,ariaLabel:"Choose Bible translation",fullWidth:!0})]})}),Fe?n.jsx("div",{className:"meta",style:{color:"var(--gc-danger)",marginTop:6},children:Fe}):null,n.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:8,marginTop:12},children:[n.jsx(E,{onClick:()=>{Ke(!1),ge("")},children:"Cancel"}),n.jsx(E,{variant:"primary",onClick:()=>rt(ae),children:"Add Verse"})]})]})}):null,n.jsx(yn,{busy:V}),n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:12,marginBottom:4},children:[n.jsx("div",{}),n.jsx("h1",{style:{margin:0},children:"Setlist Builder"}),n.jsx("div",{})]}),De?n.jsx(gt,{className:"card",style:{marginTop:8,position:"static"},children:n.jsxs("div",{className:"setlist-actions--mobile",style:{width:"100%"},children:[n.jsx(E,{variant:"primary",onClick:ct,onMouseEnter:Me,onFocus:Me,disabled:V||h.length===0,title:"Export set as a single PDF",iconLeft:n.jsx(xe,{}),children:"PDF"}),n.jsx(E,{onClick:ft,disabled:h.length===0||!!O||!!K,title:h.length===0?"Add songs to combine PPTX files":"Combine PPTX files into a single presentation",iconLeft:n.jsx(xe,{}),children:K||"Export PPT"}),n.jsx(E,{onClick:ut,disabled:h.length===0||!!O||!!K,title:h.length===0?"Add songs to export PPTX bundle":"Export PPTX bundle (ZIP) for selected songs",iconLeft:n.jsx(xe,{}),children:"PPT ZIP"}),n.jsx(E,{onClick:dt,title:"Copy shareable link",iconLeft:n.jsx(yt,{}),disabled:h.length===0,children:"Share"}),n.jsx(E,{as:xt,to:h.length?`/worship/${h.map(t=>encodeURIComponent(t.id)).join(",")}?toKeys=${h.map(t=>encodeURIComponent(t.toKey||"")).join(",")}`:"/worship",title:"Open Worship Mode",iconLeft:n.jsx(bt,{}),children:"Worship"})]})}):n.jsxs(gt,{className:"card",style:{marginTop:8,position:"static"},children:[n.jsx("div",{style:{width:"100%",marginBottom:6},children:n.jsx("strong",{title:"Current set name",children:j||"New Setlist"})}),n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap",width:"100%"},children:[n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[n.jsxs(E,{size:"sm",variant:"secondary",onClick:Ht,title:"Save set",iconLeft:n.jsx(xn,{}),children:[" ",n.jsx("span",{className:"text-when-wide",children:"Save"})]}),n.jsxs(E,{size:"sm",variant:"secondary",onClick:Gt,title:"Load saved set",iconLeft:n.jsx(bn,{}),disabled:!Y.length,children:[" ",n.jsx("span",{className:"text-when-wide",children:"Load"})]}),n.jsxs(E,{size:"sm",variant:"secondary",onClick:lt,title:"New set",iconLeft:n.jsx(Ve,{}),children:[" ",n.jsx("span",{className:"text-when-wide",children:"New"})]}),n.jsxs(E,{size:"sm",variant:"secondary",onClick:Jt,disabled:!M,title:"Delete set",iconLeft:n.jsx(Sn,{}),children:[" ",n.jsx("span",{className:"text-when-wide",children:"Delete"})]}),n.jsxs(E,{size:"sm",variant:"secondary",onClick:dt,title:"Copy shareable link",iconLeft:n.jsx(yt,{}),disabled:h.length===0,children:[" ",n.jsx("span",{className:"text-when-wide",children:"Share Set"})]})]}),n.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[n.jsx(E,{variant:"primary",size:"md",onClick:ct,onMouseEnter:Me,onFocus:Me,disabled:V||h.length===0,title:"Export set as a single PDF",iconLeft:n.jsx(xe,{}),children:V?"Exporting…":n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"text-when-wide",children:"Export PDF"}),n.jsx("span",{className:"text-when-narrow",children:"PDF"})]})}),n.jsx(E,{variant:"primary",size:"md",onClick:ft,disabled:h.length===0||!!O||!!K,title:h.length===0?"Add songs to combine PPTX files":"Combine PPTX files into a single presentation",iconLeft:n.jsx(xe,{}),children:K||n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"text-when-wide",children:"Export PPT"}),n.jsx("span",{className:"text-when-narrow",children:"Export PPT"})]})}),n.jsx(E,{variant:"primary",size:"md",onClick:ut,disabled:h.length===0||!!O||!!K,title:h.length===0?"Add songs to export PPTX bundle":"Export PPTX bundle (ZIP) for selected songs",iconLeft:n.jsx(xe,{}),children:O||n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"text-when-wide",children:"PPT ZIP"}),n.jsx("span",{className:"text-when-narrow",children:"PPT ZIP"})]})}),n.jsxs(E,{variant:"primary",size:"md",as:xt,to:h.length?`/worship/${h.map(t=>encodeURIComponent(t.id)).join(",")}?toKeys=${h.map(t=>encodeURIComponent(t.toKey||"")).join(",")}`:"/worship",title:"Open Worship Mode",iconLeft:n.jsx(bt,{}),children:[" ",n.jsx("span",{className:"text-when-wide",children:"Worship Mode"}),n.jsx("span",{className:"text-when-narrow",children:"Worship"})]})]})]})]}),n.jsxs("div",{className:"BuilderPage",style:{marginTop:8},children:[n.jsx("div",{className:"BuilderLeft",children:n.jsx("section",{className:"setlist-section setlist-add","data-role":"add",children:n.jsxs("div",{className:"card setlist-pane",children:[n.jsxs("div",{className:["BuilderHeader","section-header",z?"no-sticky":""].filter(Boolean).join(" "),style:{display:"flex",alignItems:"center",gap:8},children:[n.jsx("strong",{style:{whiteSpace:"nowrap"},children:"Add songs"}),n.jsx(wn,{value:$,onChange:t=>D(t.target.value),placeholder:"Search...",style:{flex:1,minWidth:0}}),n.jsxs("label",{className:"row",style:{gap:6,alignItems:"center"},children:[n.jsx("input",{type:"checkbox",checked:P,onChange:t=>B(t.target.checked)}),n.jsx("span",{className:"meta",title:"Limit results to songs tagged ICP",children:"ICP only"})]})]}),p.length>0?n.jsxs("div",{className:["BuilderHeader","section-header",z?"no-sticky":""].filter(Boolean).join(" "),style:{paddingTop:0,display:"flex",alignItems:"center",gap:8},children:[n.jsx("span",{className:"meta",children:"Language"}),n.jsx("div",{className:"tagbar",children:p.map(t=>n.jsx(Tn,{variant:"filter",selected:m===t,onClick:()=>w(t),title:`Use ${St(t)} where available`,children:St(t)},t))})]}):null,n.jsx("div",{className:["BuilderScroll","setlist-scroll","setlist-list",z?"no-pane-scroll":"pane-scroll","pane--addSongs"].join(" "),children:We?n.jsx("div",{style:{display:"grid",gap:".5rem",gridTemplateColumns:"repeat(auto-fill, minmax(320px, 1fr))",marginTop:6},children:Vt.map(t=>n.jsx(ze,{title:t.title,subtitle:`${t.originalKey||""}${t.tags?.length?` • ${t.tags.join(", ")}`:""}`,rightSlot:n.jsx(E,{"aria-label":"Add",title:"Add to set",variant:"primary",iconLeft:n.jsx(Ve,{}),iconOnly:!0,onClick:i=>{i.stopPropagation(),st(t)}}),onClick:()=>st(t)},t.id))}):n.jsx("div",{children:"Loading search…"})})]})})}),n.jsx("div",{className:"BuilderRight",style:{minHeight:0,display:"flex",flexDirection:"column"},children:n.jsxs("section",{className:"setlist-section setlist-current","data-role":"current",children:[n.jsxs("div",{className:"card setlist-pane",children:[n.jsxs("div",{className:["BuilderHeader","section-header",z?"no-sticky":""].filter(Boolean).join(" "),style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8},children:[n.jsxs("strong",{children:["Current setlist (",h.length,")"]}),n.jsx(E,{size:"sm",variant:"secondary",onClick:()=>{Ke(!0),ge("")},iconLeft:n.jsx(Ve,{}),children:"Add Verse"})]}),n.jsx("div",{className:["BuilderScroll","setlist-scroll","setlist-list",z?"no-pane-scroll":"pane-scroll","pane--currentSet"].join(" "),style:{marginTop:6},children:h.map((t,i)=>{if(Ye(t.id)){const c=He(t.id),f=c?.refDisplay||t.id,x=wt(c?.translation,Ce);return n.jsx(ze,{draggable:!0,onDragStart:y=>{y.dataTransfer.setData("text/plain",String(t.uid||t.id)),y.dataTransfer.effectAllowed="move"},onDragOver:y=>{y.preventDefault(),y.dataTransfer.dropEffect="move"},onDrop:y=>{y.preventDefault();const A=y.dataTransfer.getData("text/plain");at(A,i)},title:f,subtitle:x,rightSlot:n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[n.jsx(E,{onClick:()=>Le(t.uid,"up"),title:"Move up",iconLeft:n.jsx(Tt,{})}),n.jsx(E,{onClick:()=>Le(t.uid,"down"),title:"Move down",iconLeft:n.jsx(vt,{})}),n.jsx(E,{onClick:()=>it(t.uid),title:"Remove",iconLeft:n.jsx(jt,{}),iconOnly:!0,style:{color:"#b91c1c"}})]})},t.uid||`${t.id}-${i}`)}const o=ye(t.id);return o?n.jsx(ze,{draggable:!0,onDragStart:c=>{c.dataTransfer.setData("text/plain",String(t.uid||t.id)),c.dataTransfer.effectAllowed="move"},onDragOver:c=>{c.preventDefault(),c.dataTransfer.dropEffect="move"},onDrop:c=>{c.preventDefault();const f=c.dataTransfer.getData("text/plain");at(f,i)},title:o.title,subtitle:`Original: ${o.originalKey||"—"}`,rightSlot:n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[n.jsx(vn,{variant:"ui",baseKey:o.originalKey||"C",valueKey:t.toKey||o.originalKey||"C",onChange:c=>Yt(t.uid,c)}),n.jsx(E,{onClick:()=>Le(t.uid,"up"),title:"Move up",iconLeft:n.jsx(Tt,{})}),n.jsx(E,{onClick:()=>Le(t.uid,"down"),title:"Move down",iconLeft:n.jsx(vt,{})}),n.jsx(E,{onClick:()=>it(t.uid),title:"Remove",iconLeft:n.jsx(jt,{}),iconOnly:!0,style:{color:"#b91c1c"}})]})},t.uid||`${t.id}-${i}`):null})})]}),n.jsxs("div",{className:"print-only",style:{marginTop:16},children:[n.jsx("h2",{style:{fontSize:"20pt",margin:"0 0 8pt 0"},children:j}),n.jsx("ol",{style:{fontSize:"12pt",lineHeight:1.4,paddingLeft:"1.2em"},children:h.map((t,i)=>{if(Ye(t.id)){const o=He(t.id),c=wt(o?.translation,Ce);return n.jsxs("li",{children:[o?.refDisplay||t.id," (",c,")"]},t.uid||`${t.id}-${i}`)}const l=ye(t.id);return l?n.jsxs("li",{children:[l.title," — ",t.toKey||l.originalKey||"—"]},t.uid||`${t.id}-${i}`):null})})]})]})})]})]})}export{fs as default};
