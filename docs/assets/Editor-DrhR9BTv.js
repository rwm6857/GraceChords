import{r as o,j as e,I as te,B as N,c as X,v as ce,s as $,L as de,H as ue,S as he,M as ge,t as me,C as pe,A as fe,i as xe,p as se,P as Z,T as le,a as je,b as ye,g as ne,d as be,e as Se,f as ve,h as ke,k as we,K as A,l as Ce,m as Ne,n as Te,o as Ee,q as Ie,u as ae,w as Me,x as $e}from"./index-CXrPXL6k.js";import{R as Re}from"./AdminResources-ATpNcHpv.js";import"./markdown-DhTLSAy7.js";const Pe="10401040",oe=`{title: }
{key: }
{authors: }
{country: }
{tags: }
{youtube: }
{mp3: }

`;function Ke(){const[l,r]=o.useState(()=>{try{return localStorage.getItem("editor:author")||""}catch{return""}}),[c,a]=o.useState(""),[g,j]=o.useState(!1),[y,f]=o.useState("");o.useEffect(()=>{try{localStorage.setItem("editor:author",l||"")}catch{}},[l]);function k(h){if(h.preventDefault(),f(""),!l.trim()){f("Author name is required.");return}c===Pe?j(!0):f("Invalid password.")}return g?e.jsx(_e,{authorName:l.trim()}):e.jsxs("div",{className:"container",style:{maxWidth:520},children:[e.jsx("h1",{children:"GraceChords Editor"}),e.jsx("p",{children:"Enter your author name and password to continue."}),e.jsxs("form",{onSubmit:k,className:"card",style:{display:"grid",gap:10,padding:16},children:[e.jsxs("label",{children:["Author name",e.jsx(te,{value:l,onChange:h=>r(h.target.value),placeholder:"Your name",required:!0})]}),e.jsxs("label",{children:["Password",e.jsx(te,{type:"password",value:c,onChange:h=>a(h.target.value),placeholder:"Password",required:!0})]}),y?e.jsx("div",{className:"alert error Small",children:y}):null,e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",gap:8},children:e.jsx(N,{variant:"primary",type:"submit",children:"Enter"})})]})]})}function _e({authorName:l}){const[r,c]=o.useState("songs"),[a,g]=o.useState(()=>{try{const i=sessionStorage.getItem("editor:staged");return i?JSON.parse(i):[]}catch{return[]}});o.useEffect(()=>{try{a.length?sessionStorage.setItem("editor:staged",JSON.stringify(a)):sessionStorage.removeItem("editor:staged")}catch{}},[a]);const[j,y]=o.useState(!1),[f,k]=o.useState(!1),[h,m]=o.useState("main"),[T,b]=o.useState(null),[R,C]=o.useState(!1),[_,E]=o.useState(""),[q,x]=o.useState(""),[K,L]=o.useState(!1),[,O]=o.useState(0),B=X&&typeof X=="function"?X()==="dark":!1;o.useEffect(()=>{const i=localStorage.getItem("ghToken");i?(E(i),G(i,{silent:!0})):C(!0)},[]);function P(i){i?.length&&g(v=>[...v,...i])}function z(i){i?.length&&g(v=>[...v,...i])}function D(i){g(v=>v.filter((F,p)=>p!==i))}function W(){g([])}async function G(i,{silent:v=!1}={}){const F=(i||"").trim();if(!F){x("Token cannot be empty");return}L(!0),x("");try{localStorage.setItem("ghToken",F);const p=await ce();if(b(p),!v){const w=`GitHub token OK: ${p.login}`;typeof $=="function"?$(w):alert(w)}C(!1),E("")}catch(p){localStorage.removeItem("ghToken"),b(null),x(p?.message||String(p)),C(!0)}finally{L(!1)}}function V(){if(!localStorage.getItem("ghToken")){E(""),x(""),C(!0);return}Q()}async function Q(){if(!a.length){$?.("Stage at least one change first.")??alert("Stage at least one change first.");return}if(!l){$?.("Author name required to open a PR.")??alert("Author name required to open a PR.");return}try{const{default_branch:i}=await ne({owner:"rwm6857",repo:"GraceChords"});m(i||"main"),y(!0)}catch(i){$?.(String(i.message||i))??alert(String(i.message||i))}}async function I({branchName:i,prTitle:v,prBody:F}){k(!0);try{const p="rwm6857",w="GraceChords",{sha:Y}=await ne({owner:p,repo:w});await be({owner:p,repo:w,fromSha:Y,newBranch:i});for(const t of a){if(t.action==="delete-request")continue;const d=`${t.kind==="song"?"public/songs":"public/resources"}/${t.filename}`,n=await Se({owner:p,repo:w,path:d,ref:i}),u=t.action==="add"?`add: ${t.filename}`:`update: ${t.filename}`;await ve({owner:p,repo:w,branch:i,path:d,contentBase64:ke(t.content||""),message:u,sha:n})}const J=await we({owner:p,repo:w,head:i,base:h,title:v,body:F});try{sessionStorage.removeItem("editor:staged")}catch{}g([]),y(!1),window.open(J.html_url,"_blank","noopener")}catch(p){throw $?.(String(p.message||p))??alert(String(p.message||p)),p}finally{k(!1)}}return e.jsx("div",{className:"gc-editor-page",children:e.jsxs("div",{className:"container gc-editor",children:[e.jsx(qe,{}),e.jsxs("header",{className:"gc-editor__header",children:[e.jsxs("div",{className:"gc-editor__title",children:[e.jsx("h1",{children:"GraceChords Editor"}),e.jsxs("span",{className:"gc-editor__author",children:["Author: ",l,e.jsxs("span",{style:{marginLeft:8,display:"inline-flex",alignItems:"center",gap:4},children:["Token ",T?e.jsx("span",{title:`Token OK: ${T.login}`,style:{color:"var(--primary)"},children:"âœ”"}):e.jsx("span",{title:"Token missing or invalid",style:{color:"#ef4444"},children:"âœ˜"})]})]})]}),e.jsxs("nav",{className:"gc-editor__tabs","aria-label":"Editor tabs",children:[e.jsx("button",{className:`gc-editor__tab ${r==="songs"?"is-active":""}`,onClick:()=>c("songs"),children:"ðŸŽµ Song Editor"}),e.jsx("button",{className:`gc-editor__tab ${r==="posts"?"is-active":""}`,onClick:()=>c("posts"),children:"ðŸ“„ Post Editor"})]}),e.jsxs("div",{className:"gc-editor__actions",children:[e.jsx(de,{to:"/",className:"gc-editor__iconbtn",title:"Back to home","aria-label":"Back to home",children:e.jsx(ue,{size:18})}),e.jsx("button",{className:"gc-editor__iconbtn","aria-label":"Toggle theme",onClick:()=>{me(),O(i=>i+1)},title:B?"Switch to light mode":"Switch to dark mode",children:B?e.jsx(he,{size:18}):e.jsx(ge,{size:18})})]})]}),e.jsxs("div",{className:"gc-editor-shell",children:[r==="songs"?e.jsx(Fe,{onStageSong:P}):e.jsx(Ae,{onStagePost:z}),e.jsxs("section",{className:"gc-editor-panel gc-editor-panel--staged gc-staged-card",children:[e.jsxs("div",{className:"Row",style:{alignItems:"center",gap:8},children:[e.jsxs("h3",{style:{margin:0},children:["Staged changes ",e.jsxs("span",{className:"Small",children:["(",a.length,")"]})]}),e.jsx("div",{className:"spacer"}),e.jsx(N,{onClick:W,disabled:!a.length,children:"Clear all"}),e.jsxs(N,{variant:"primary",onClick:V,disabled:!a.length,children:[e.jsx(pe,{})," Open PR"]})]}),e.jsx("div",{style:{width:"100%",marginTop:8,overflow:"auto"},children:e.jsxs("table",{className:"Table Small",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Kind"}),e.jsx("th",{children:"Action"}),e.jsx("th",{children:"Title"}),e.jsx("th",{children:"Filename"}),e.jsx("th",{children:"Details"}),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[a.map((i,v)=>e.jsxs("tr",{children:[e.jsx("td",{children:i.kind}),e.jsx("td",{children:i.action}),e.jsx("td",{children:i.title}),e.jsx("td",{children:e.jsx("code",{children:i.filename})}),e.jsx("td",{children:i.changeSummary||i.deleteReason||""}),e.jsx("td",{children:e.jsx("button",{className:"btn small",onClick:()=>D(v),children:"Remove"})})]},`${i.filename}-${v}`)),!a.length&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"Small",style:{textAlign:"center",padding:12},children:"Nothing staged yet."})})]})]})})]})]}),a.length>0&&e.jsxs("button",{className:"gc-staged-floating",onClick:V,children:["Staged: ",a.length," â€“ Review / Open PR"]}),e.jsx(fe,{open:j,onClose:()=>y(!1),defaultBranch:h,staged:a,authorName:l,onCreate:I,busy:f}),e.jsx(Le,{open:R,tokenInput:_,setTokenInput:E,tokenError:q,validating:K,onSubmit:G,onClose:()=>{C(!1),x("")}})]})})}function Fe({onStageSong:l}){const[r,c]=o.useState(oe),[a,g]=o.useState({});o.useEffect(()=>{g(ie(r))},[r]);const j=o.useRef(null),[y,f]=o.useState(()=>{try{return localStorage.getItem("editor:showPreview")!=="0"}catch{return!0}});o.useEffect(()=>{try{localStorage.setItem("editor:showPreview",y?"1":"0")}catch{}},[y]);const k=o.useMemo(()=>{const t=xe?.items||[],s=new Set,d=[];for(const n of t)s.has(n.id)||(s.add(n.id),d.push(n));return d},[]),[h,m]=o.useState(""),[T,b]=o.useState(null),[R,C]=o.useState(""),[_,E]=o.useState(""),[q,x]=o.useState(-1),[K,L]=o.useState(!1),[O,B]=o.useState(""),P=o.useMemo(()=>{const t=_.trim().toLowerCase();return t?k.filter(s=>{const d=String(s.title||"").toLowerCase(),n=(s.tags||[]).map(S=>String(S).toLowerCase()).join(" "),u=(s.authors||[]).map(S=>String(S).toLowerCase()).join(" ");return d.includes(t)||n.includes(t)||u.includes(t)}).slice(0,12):[]},[k,_]);o.useEffect(()=>{x(-1)},[_]);async function z(t){if(t)try{const d=`${"./".replace(/\/+$/,"")+"/"}songs/${t.filename}`,n=await Ne(d);if(n){c(n);const u=ie(n),S=v(n,u,t.filename);m(t.filename),b(u),C(S?.content||""),E(""),x(-1)}}catch(s){console.error(s),alert(`Failed to load ${t.filename}`)}}function D(){m(""),b(null),C(""),c(oe)}function W(t){const s=j.current;if(!s){c(u=>(u||"")+t);return}const d=s.selectionStart??0,n=s.selectionEnd??d;c(u=>{const S=u.slice(0,d),M=u.slice(n);return S+t+M}),setTimeout(()=>{try{s.focus();const u=d+t.length;s.setSelectionRange(u,u)}catch{}},0)}function G(t){const s={Verse:{start:`{sov Verse}
`,end:`{eov}
`},Chorus:{start:`{soc Chorus}
`,end:`{eoc}
`},Bridge:{start:`{sob Bridge}
`,end:`{eob}
`}}[t]||{start:`{start_of_${t.toLowerCase()}}:
`,end:`{end_of_${t.toLowerCase()}}
`};W(`${s.start}${s.end}`)}function V(t){const s=[0,2,4,5,7,9],d=new Set([1,2,5]),n=String(t||"").toUpperCase(),u=A.indexOf(n),S=u>=0?u:A.indexOf("G"),M=[];for(let U=0;U<s.length;U++){const re=(S+s[U])%A.length,ee=A[re];M.push(d.has(U)?`${ee}m`:ee)}return M}function Q(t){const s=String(t).trim();if(!s)return"G";const d=/^([A-Ga-g][#b]?)(m|min)?$/i.exec(s);if(!d)return"G";const n=Ce(d[1]),u=A.indexOf(n);if(u<0)return"G";const M=!!d[2]?(u+3)%A.length:u;return A[M]}const I=o.useMemo(()=>{try{const t=se(r||""),s=(t.sections||[]).map(d=>({section:d.label,lines:(d.lines||[]).map(n=>({text:n.instrumental?"":n.comment||n.lyrics||"",chords:n.instrumental?[]:n.chords||[],comment:!!n.comment,instrumental:n.instrumental||null}))}));return{meta:t.meta,blocks:s}}catch{return{meta:{},blocks:[]}}},[r]),i=o.useMemo(()=>V(Q(a.key||"G")),[a.key]);o.useEffect(()=>{function t(s){if(K||!s.altKey)return;const d=s.key;if(!/^([1-6])$/.test(d))return;const n=parseInt(d,10)-1,u=i[n];u&&(s.preventDefault(),W(`[${u}]`))}return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[i,K]);function v(t=r,s=a,d=h){try{const{text:n,docTitle:u,docKey:S}=Ee(t,{country:s.country||"",tags:s.tags||"",youtube:s.youtube||"",mp3:s.mp3||""}),M=d||Ie(u),U=ae(n);return{filename:M,title:u||s.title||"Untitled",content:U,key:S||s.key||""}}catch{}try{const n=se(t);n.meta.title=s.title||n.meta.title||"",n.meta.key=s.key||n.meta.key||"",n.meta.meta={...n.meta.meta||{},authors:s.authors||n.meta.meta?.authors||"",country:s.country||n.meta.meta?.country||"",tags:s.tags||n.meta.meta?.tags||"",youtube:s.youtube||n.meta.meta?.youtube||"",mp3:s.mp3||n.meta.meta?.mp3||""};let u=Me(n,{useDirectives:!0});u=ae(u);const S=$e(s.id||n.meta.title||"untitled");return{filename:d||`${S}.chordpro`,title:n.meta.title||"Untitled",content:u,key:n.meta.key||""}}catch(n){return console.error(n),null}}const F=(r||"").replace(/\s+/g,"").replace(/\{[^}]*\}/g,""),p=!!((a.title||"").trim()||F),w=!!h;function Y(){const t=v();if(!t)return;if(!w){l([{kind:"song",action:"add",title:t.title,filename:t.filename,content:t.content}]),D();return}const s=[];(a.title||"").trim()!==(T?.title||"").trim()&&s.push("Title"),["authors","tags","key","country","youtube"].some(S=>(a[S]||"").trim()!==(T?.[S]||"").trim())&&s.push("Metadata"),(t.content||"")!==(R||"")&&s.push("Content");const u=s.length?s.join(" + "):"Minor edit";l([{kind:"song",action:"edit",title:t.title,filename:h,content:t.content,changeSummary:u}]),D()}function J(t){h&&(l([{kind:"song",action:"delete-request",title:a.title||"Untitled",filename:h,deleteReason:t}]),B(""),L(!1),D())}return e.jsxs("div",{className:"gc-song-editor",children:[e.jsx("section",{className:"gc-editor-panel gc-editor-panel--selector",children:e.jsxs("div",{className:"gc-song-selector",children:[e.jsx(N,{onClick:D,iconLeft:e.jsx(Z,{}),children:"New Song"}),e.jsxs("div",{className:"gc-song-selector__search",children:[e.jsx("input",{type:"search",placeholder:"Search existing songsâ€¦",value:_,onChange:t=>E(t.target.value),onKeyDown:t=>{if(P.length)if(t.key==="ArrowDown")t.preventDefault(),x(s=>Math.min(s+1,P.length-1));else if(t.key==="ArrowUp")t.preventDefault(),x(s=>Math.max(s-1,0));else if(t.key==="Enter"){t.preventDefault();const s=q>=0?P[q]:P[0];z(s)}else t.key==="Escape"&&x(-1)}}),P.length>0&&e.jsx("ul",{className:"gc-song-selector__results",children:P.map((t,s)=>e.jsx("li",{className:q===s?"is-active":"",onMouseEnter:()=>x(s),onMouseDown:()=>z(t),children:t.title},t.id))})]}),h?e.jsxs("span",{className:"badge",style:{background:"#fde68a",color:"#92400e"},children:["Editing ",h]}):e.jsx("span",{className:"badge",style:{background:"#d1fae5",color:"#065f46"},children:"New song"})]})}),e.jsxs("section",{className:"gc-editor-panel gc-editor-panel--meta",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginTop:12},children:[e.jsxs("label",{children:["Title",e.jsx("input",{value:a.title||"",onChange:t=>c(s=>H(s,"title",t.target.value))})]}),e.jsxs("label",{children:["Original Key",e.jsx("input",{value:a.key||"",onChange:t=>c(s=>H(s,"key",t.target.value)),placeholder:"e.g., C, Am, Dm, F#m"})]}),e.jsxs("label",{children:["Authors",e.jsx("input",{value:a.authors||"",onChange:t=>c(s=>H(s,"authors",t.target.value))})]}),e.jsxs("label",{children:["Country",e.jsx("input",{value:a.country||"",onChange:t=>c(s=>H(s,"country",t.target.value))})]}),e.jsxs("label",{children:["Tags",e.jsx("input",{value:a.tags||"",onChange:t=>c(s=>H(s,"tags",t.target.value)),placeholder:"Fast, Slow, Hymn, Holiday"})]}),e.jsxs("label",{children:["YouTube (ID or URL)",e.jsx("input",{value:a.youtube||"",onChange:t=>c(s=>H(s,"youtube",t.target.value)),placeholder:"e.g. dQw4w9WgXcQ or https://youtu.be/..."})]})]}),e.jsxs("section",{className:"gc-editor-panel gc-editor-panel--body",style:{marginTop:12},children:[e.jsxs("div",{className:"gc-editor-toolbar",children:[e.jsxs("div",{className:"gc-quick-row",children:[e.jsx("strong",{children:"Quick Chords"}),i.map((t,s)=>e.jsx("button",{className:"gc-btn gc-btn--sm",onClick:()=>W(`[${t}]`),title:`Insert [${t}] (Alt+${s+1})`,children:t},t))]}),e.jsxs("div",{className:"gc-quick-sections",children:[e.jsx("strong",{children:"Quick Sections"}),e.jsx("button",{className:"gc-btn gc-btn--sm",onClick:()=>G("Verse"),children:"Verse"}),e.jsx("button",{className:"gc-btn gc-btn--sm",onClick:()=>G("Chorus"),children:"Chorus"}),e.jsx("button",{className:"gc-btn gc-btn--sm",onClick:()=>G("Bridge"),children:"Bridge"})]}),e.jsxs("label",{className:"gc-preview-toggle",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:t=>f(t.target.checked)})," Preview"]})]}),e.jsxs("div",{className:`gc-editor-split ${y?"":"is-single"}`,children:[e.jsx("div",{className:"gc-editor-pane gc-editor-pane--input",children:e.jsx("textarea",{ref:j,value:r,onChange:t=>c(t.target.value),style:{width:"100%",minHeight:"70vh",height:"70vh",fontFamily:'"Roboto Mono", ui-monospace, Menlo, Consolas, monospace'}})}),y&&e.jsxs("div",{className:"gc-editor-pane gc-editor-pane--preview",children:[e.jsxs("div",{className:"Small",style:{marginBottom:8,fontFamily:'"Roboto Mono", ui-monospace, Menlo, Consolas, monospace'},children:[I?.meta?.title?e.jsx("div",{style:{fontWeight:700},children:I.meta.title}):null,I?.meta?.key||I?.meta?.originalkey?e.jsxs("div",{style:{fontStyle:"italic"},children:["Key of ",I.meta.key||I.meta.originalkey]}):null]}),e.jsx("div",{style:{marginTop:8},children:(I.blocks||[]).map((t,s)=>e.jsxs("div",{children:[e.jsx("div",{className:"section",children:t.section||""}),(t.lines||[]).map((d,n)=>d.instrumental?e.jsx(Be,{spec:d.instrumental},`${s}-${n}`):e.jsx(De,{plain:d.text,chords:d.chords||[],comment:d.comment},`${s}-${n}`))]},s))})]})]}),e.jsxs("div",{className:"gc-stage-actions",children:[e.jsx(N,{variant:"primary",onClick:Y,disabled:!p,children:"Add Changes"}),w&&e.jsx(N,{onClick:()=>L(!0),iconLeft:e.jsx(le,{}),children:"Request Deletion"}),e.jsx("span",{className:"Small",style:{marginLeft:"auto"},children:"Files save as .chordpro"})]})]}),K&&e.jsx("div",{className:"modal",children:e.jsxs("div",{className:"modal-body",children:[e.jsx("h3",{children:"Request Deletion"}),e.jsxs("label",{children:["Why should this song be removed?",e.jsx("textarea",{rows:3,value:O,onChange:t=>B(t.target.value),placeholder:"Reason for deletion"})]}),e.jsxs("div",{className:"Row",style:{justifyContent:"flex-end",gap:8},children:[e.jsx("button",{className:"btn",onClick:()=>{L(!1),B("")},children:"Cancel"}),e.jsx("button",{className:"btn primary",onClick:()=>J(O),disabled:!O.trim(),children:"Submit request"})]})]})})]})}function Ae({onStagePost:l}){const[r,c]=o.useState(null),[a,g]=o.useState(""),[j,y]=o.useState("");function f(m){if(m){if(m.isExisting){$?.("Use Stage Edit for existing posts.")??alert("Use Stage Edit for existing posts.");return}l([{kind:"post",action:"add",title:m.meta?.title||"Untitled",filename:m.filename,content:m.content}])}}function k(m){if(!m?.isExisting){$?.("Load an existing post to stage an edit.")??alert("Load an existing post to stage an edit.");return}l([{kind:"post",action:"edit",title:m.meta?.title||"Untitled",filename:m.filename,content:m.content,changeSummary:a||""}])}function h(m){if(!m?.isExisting){$?.("Load an existing post to request deletion.")??alert("Load an existing post to request deletion.");return}l([{kind:"post",action:"delete-request",title:m.meta?.title||"Untitled",filename:m.filename,deleteReason:j||""}])}return e.jsx(Re,{heading:"Posts",showGhTools:!1,wrapInContainer:!1,panelize:!0,onDraftChange:c,actions:({draft:m,newPost:T})=>{const b=m||r;return e.jsxs(je,{style:{position:"sticky",bottom:0,marginTop:12,display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsxs(N,{onClick:T,children:[e.jsx(Z,{})," New"]}),e.jsxs(N,{onClick:()=>f(b),disabled:!b,children:[e.jsx(Z,{})," Stage Add"]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,minWidth:0},children:[e.jsxs("label",{className:"Small",style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("span",{children:"Filename"}),e.jsx("input",{readOnly:!0,value:b?.filename||"",style:{width:240},placeholder:"slug.md"})]}),b?.isExisting?e.jsx("span",{className:"badge",style:{background:"#fde68a",color:"#92400e"},title:"Editing existing file",children:"Editing"}):e.jsx("span",{className:"badge",style:{background:"#d1fae5",color:"#065f46"},title:"New file will be created",children:"New"})]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[e.jsxs("label",{className:"Small",style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("span",{children:"What changed?"}),e.jsx("input",{value:a,onChange:R=>g(R.target.value),placeholder:"Content, tagsâ€¦",disabled:!b?.isExisting})]}),e.jsxs(N,{className:"gc-btn gc-btn--primary",onClick:()=>k(b),disabled:!b?.isExisting,children:[e.jsx(ye,{})," Stage Edit"]}),e.jsxs("label",{className:"Small",style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("span",{children:"Removal reason"}),e.jsx("input",{value:j,onChange:R=>y(R.target.value),placeholder:"Why remove this post?",disabled:!b?.isExisting})]}),e.jsxs(N,{className:"gc-btn gc-btn--primary",onClick:()=>h(b),disabled:!b?.isExisting,children:[e.jsx(le,{})," Stage Deletion"]})]})]})}})}function qe(){const[l,r]=o.useState(!1);return o.useEffect(()=>{if(!l)return;function c(a){a.key==="Escape"&&r(!1)}return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[l]),e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"gc-editor-help-tab",onClick:()=>r(c=>!c),"aria-expanded":l,"aria-label":"Open editor help",children:" Editor Help "}),l&&e.jsxs("div",{className:"gc-editor-help-drawer",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[e.jsx("strong",{children:"Editor Help"}),e.jsx("button",{className:"btn small",onClick:()=>r(!1),"aria-label":"Close help",children:"âœ•"})]}),e.jsxs("div",{className:"gc-help__content Small",style:{marginTop:8},children:[e.jsx("h3",{children:"Editor basics"}),e.jsx("p",{children:"Fill metadata (title, key, authors, country, tags, YouTube). Use quick chords and quick sections to speed up typing."}),e.jsx("p",{children:"New Song + search lets you start fresh or load an existing song to edit."}),e.jsx("h3",{children:"ChordPro tips"}),e.jsxs("p",{children:["Place chords in square brackets like ",e.jsx("code",{children:"[G]"}),". Section headers use short codes such as ",e.jsx("code",{children:"{sov Verse}"})," â€¦ ",e.jsx("code",{children:"{eov}"}),"."]}),e.jsx("pre",{className:"Small",style:{whiteSpace:"pre-wrap"},children:`{title: Example}
{key: G}
{sov Verse}
[G]Amazing [C]grace
{eov}`}),e.jsx("h3",{children:"Staging & PRs"}),e.jsx("p",{children:"â€œAdd Changesâ€ stages the current song (new or edited) for the PR. Deletion requests log a reason without deleting files."}),e.jsx("p",{children:"Use the staged table or floating pill to review and open the PR; a maintainer will review and merge."})]})]})]})}function Le({open:l,tokenInput:r,setTokenInput:c,tokenError:a,validating:g,onSubmit:j,onClose:y}){return l?e.jsx("div",{className:"modal",children:e.jsxs("div",{className:"modal-body",children:[e.jsx("h3",{children:"GitHub token required"}),e.jsx("p",{className:"Small",style:{opacity:.85},children:"Paste a GitHub personal access token (repo scope) to send changes as a pull request. It is stored only in this browser."}),e.jsxs("label",{children:["Token",e.jsx("input",{type:"password",value:r,onChange:f=>c(f.target.value),placeholder:"ghp_...",autoFocus:!0})]}),a?e.jsx("div",{className:"alert error Small",children:a}):null,e.jsxs("div",{className:"Row",style:{justifyContent:"flex-end",gap:8},children:[e.jsx("button",{className:"btn",onClick:y,disabled:g,children:"Cancel"}),e.jsx("button",{className:"btn primary",onClick:()=>j(r),disabled:g,children:g?"Validatingâ€¦":"Save token"})]})]})}):null}function Be({spec:l}){const r=Te(l||{},{split:!1});return r.length?e.jsx("div",{style:{marginBottom:10},children:r.map((c,a)=>e.jsx("div",{style:{whiteSpace:"pre",fontFamily:"'Fira Mono', ui-monospace, SFMono-Regular, Menlo, Consolas, monospace",fontWeight:700,fontSize:"inherit",lineHeight:1.35},children:c},a))}):null}function De({plain:l,chords:r,comment:c}){if(c)return e.jsx("div",{className:"comment",children:l});const a=o.useRef(null),g=o.useRef(null),[j,y]=o.useState({offsets:[],padTop:0,chordTop:0});return o.useEffect(()=>{if(!a.current)return;if(!g.current){const x=document.createElement("canvas");x.width=1,x.height=1,g.current=x}const f=g.current.getContext("2d"),k=a.current.querySelector(".lyrics"),h=window.getComputedStyle(k);f.font=`${h.fontStyle} ${h.fontWeight} ${h.fontSize} ${h.fontFamily}`;const m=(r||[]).map(x=>({left:f.measureText(l.slice(0,x.index)).width,sym:x.sym})),T="'Fira Mono', ui-monospace, SFMono-Regular, Menlo, Consolas, monospace",b=h.fontSize;f.font=`${h.fontStyle} 700 ${b} ${T}`;const C=f.measureText("Mg").actualBoundingBoxAscent||parseFloat(h.fontSize)*.8,E=Math.ceil(C+2);y({offsets:m,padTop:E,chordTop:0})},[l,r]),e.jsxs("div",{ref:a,style:{position:"relative",marginBottom:10,paddingTop:j.padTop},children:[j.offsets.length>0&&e.jsx("div",{"aria-hidden":!0,className:"chord-layer",style:{position:"absolute",left:0,right:0,top:j.chordTop},children:j.offsets.map((f,k)=>e.jsx("span",{style:{position:"absolute",left:`${f.left}px`,fontFamily:"'Fira Mono', ui-monospace, SFMono-Regular, Menlo, Consolas, monospace",fontWeight:700},children:f.sym},k))}),e.jsx("div",{className:"lyrics",children:l})]})}function H(l,r,c){const a=new RegExp(`\\{\\s*${r}\\s*:[^}]*\\}`,"i");return a.test(l)?l.replace(a,`{${r}: ${c}}`):/\{\s*title\s*:[^}]*\}/i.test(l)?l.replace(/\{\s*title\s*:[^}]*\}\s*/,g=>g+`
{${r}: ${c}}
`):`{${r}: ${c}}
`+l}function ie(l){const r={},c=/^\{\s*([^:}]+)\s*:\s*([^}]*)\s*\}\s*$/gm;let a;for(;a=c.exec(l);){const g=a[1].trim().toLowerCase(),j=a[2];r[g]=j}return r}export{Ke as default};
