import{r as l,j as e,I as q,B as u,w as Q,P as v,T as X,x as Z,y as ee,z as te,m as se,E as $,G as ae,H as ne,J as le,N as ie,O as re}from"./index-CcOG2vra.js";import{r as P,m as oe,a as b,p as ce}from"./markdown-DhTLSAy7.js";const de="10401040";function he(){const[p,d]=l.useState(!1),[c,s]=l.useState("");return p?e.jsx(me,{}):e.jsxs("div",{className:"container",style:{maxWidth:480},children:[e.jsx("h1",{children:"Admin: Resources"}),e.jsx("p",{children:"Enter password to continue."}),e.jsxs("form",{onSubmit:i=>{i.preventDefault(),d(c===de)},children:[e.jsx(q,{id:"adminPw",type:"password",value:c,onChange:i=>s(i.target.value),placeholder:"Password"}),e.jsx("div",{style:{marginTop:8,display:"flex",justifyContent:"flex-end"},children:e.jsx(u,{variant:"primary",type:"submit",children:"Enter"})})]})]})}function me(){const[p]=l.useState(()=>(P?.items||[]).slice().sort((t,a)=>(a.date||"").localeCompare(t.date||""))),[d,c]=l.useState(""),[s,i]=l.useState({title:"",author:"",date:new Date().toISOString().slice(0,10),tags:[],summary:""}),[h,x]=l.useState(""),[g,A]=l.useState(()=>{try{return localStorage.getItem("admin:editsAuthor")||""}catch{return""}});l.useEffect(()=>{try{localStorage.setItem("admin:editsAuthor",g||"")}catch{}},[g]);function w(){c(""),i({title:"",author:"",date:new Date().toISOString().slice(0,10),tags:[],summary:""}),x("")}async function B(t){if(!t)return;const r=`${"./".replace(/\/+$/,"")+"/"}resources/${t.slug}.md`,o=await se(r),n=ce(o);c(t.slug),i({title:String(n.meta.title||t.title||""),author:String(n.meta.author||t.author||""),date:String(n.meta.date||t.date||new Date().toISOString().slice(0,10)),tags:Array.isArray(n.meta.tags)?n.meta.tags:[],summary:String(n.meta.summary||t.summary||"")}),x(n.content||"")}function E(t){i(a=>({...a,title:t})),d||c(b(t))}function R(t){i(a=>({...a,author:t}))}function M(t){i(a=>({...a,date:t}))}function O(t){const a=String(t||"").split(/[,;]/).map(r=>r.trim()).filter(Boolean);i(r=>({...r,tags:a}))}function D(t){i(a=>({...a,summary:t}))}const H=l.useMemo(()=>oe(h),[h]),[y,C]=l.useState([]),[W,j]=l.useState(!1),[F,T]=l.useState(!1),[k,G]=l.useState("main"),[N,f]=l.useState(null);function _(){return["---",`title: "${(s.title||"").replace(/"/g,'\\"')}"`,`author: "${(s.author||"").replace(/"/g,'\\"')}"`,`date: "${s.date||""}"`,`tags: ${JSON.stringify(s.tags||[])} `,`summary: "${(s.summary||"").replace(/"/g,'\\"')}"`,"---",""].join(`
`)+(h||"")}function S(){const t=d||b(s.title||"untitled"),a=`${t}.md`,r=_(),o={filename:a,content:r,title:s.title,commitMsg:`${P?.items?.some(n=>n.slug===t)?"update":"add"}: ${a}`};C([o])}async function U(){try{const{default_branch:t}=await $({owner:"rwm6857",repo:"GraceChords"});if(G(t||"main"),!String(g||"").trim()){alert("Please enter your name in the Edits Author field before submitting.");return}y.length||S(),j(!0)}catch(t){alert(String(t?.message||t))}}async function J({branchName:t,prTitle:a,prBody:r}){T(!0);try{const o="rwm6857",n="GraceChords",{sha:K}=await $({owner:o,repo:n});await ae({owner:o,repo:n,fromSha:K,newBranch:t});for(const m of y){const I=`public/resources/${m.filename}`,z=await ne({owner:o,repo:n,path:I,ref:t}),Y=m.commitMsg&&m.commitMsg.trim()?m.commitMsg.trim():`add: ${m.filename}`;await le({owner:o,repo:n,branch:t,path:I,contentBase64:ie(m.content),message:Y,sha:z})}const L=`${r||""}${r?`

`:""}Submitted by: ${String(g||"").trim()}`,V=await re({owner:o,repo:n,head:t,base:k,title:a,body:L});window.open(V.html_url,"_blank","noopener"),C([]),j(!1)}finally{T(!1)}}return e.jsxs("div",{className:"container",style:{maxWidth:1100},children:[e.jsx("h1",{children:"Admin: Resources"}),e.jsx("div",{className:"card",style:{marginTop:12},children:e.jsxs("div",{className:"Row",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsx("strong",{children:"GitHub:"}),e.jsxs("span",{children:["Token: ",N?`@${N.login}`:localStorage.getItem("ghToken")?"set":"not set"]}),e.jsx("button",{className:"btn",onClick:()=>{const t=prompt("Paste GitHub token (repo scope):","");t!==null&&localStorage.setItem("ghToken",t.trim())},children:"Set token"}),e.jsx("button",{className:"btn",onClick:()=>{localStorage.removeItem("ghToken"),f(null)},children:"Clear token"}),e.jsx("button",{className:"btn",onClick:async()=>{try{const t=await Q();f(t),alert(`Token OK: ${t.login}`)}catch(t){f(null),alert(String(t?.message||t))}},children:"Validate"}),e.jsx("div",{className:"spacer"}),e.jsxs("label",{className:"Small",style:{display:"flex",alignItems:"center",gap:6},children:[e.jsxs("span",{children:["Edits Author ",e.jsx("span",{"aria-hidden":!0,style:{color:"#ef4444"},children:"*"})]}),e.jsx("input",{value:g,onChange:t=>A(t.target.value),placeholder:"Your name",style:{minWidth:180}})]})]})}),e.jsxs("div",{className:"card",style:{marginTop:12},children:[e.jsx("strong",{children:"Existing posts"}),e.jsxs("div",{className:"Row Small",style:{marginTop:6,gap:8,flexWrap:"wrap"},children:[p.map(t=>e.jsx("button",{className:"gc-btn gc-btn--sm",onClick:()=>B(t),title:`Edit ${t.title}`,children:t.title},t.slug)),e.jsx("span",{className:"spacer"}),e.jsx(u,{onClick:w,iconLeft:e.jsx(v,{}),children:"New Post"})]})]}),e.jsxs("div",{className:"card",style:{marginTop:12},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsxs("label",{children:["Title",e.jsx("input",{value:s.title,onChange:t=>E(t.target.value)})]}),e.jsxs("label",{children:["Author",e.jsx("input",{value:s.author,onChange:t=>R(t.target.value)})]}),e.jsxs("label",{children:["Date",e.jsx("input",{type:"date",value:s.date,onChange:t=>M(t.target.value)})]}),e.jsxs("label",{children:["Tags (comma-separated)",e.jsx("input",{value:(s.tags||[]).join(", "),onChange:t=>O(t.target.value),placeholder:"leadership, vocals"})]}),e.jsxs("label",{children:["Summary",e.jsx("input",{value:s.summary,onChange:t=>D(t.target.value)})]}),e.jsxs("label",{children:["Slug",e.jsx("input",{value:d,onChange:t=>c(t.target.value),placeholder:"auto from title"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginTop:10},children:[e.jsxs("div",{children:[e.jsx("div",{className:"Row Small",style:{justifyContent:"space-between"},children:e.jsx("strong",{children:"Content (Markdown)"})}),e.jsx("textarea",{value:h,onChange:t=>x(t.target.value),style:{width:"100%",minHeight:"50vh",fontFamily:'"Roboto Mono", ui-monospace, Menlo, Consolas, monospace'}})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Preview"}),e.jsxs("div",{className:"card",style:{minHeight:"50vh",overflow:"auto",padding:10},children:[e.jsxs("div",{className:"Small",style:{opacity:.9,marginBottom:6},children:[s.title?e.jsx("div",{children:e.jsx("strong",{children:s.title})}):null,e.jsxs("div",{children:["by ",s.author||"—"," • ",s.date||"—"]}),s.tags?.length?e.jsx("div",{className:"Small",style:{display:"flex",gap:6,flexWrap:"wrap",marginTop:4},children:s.tags.map(t=>e.jsx("span",{className:"gc-tag gc-tag--gray",children:t},t))}):null,s.summary?e.jsx("div",{style:{marginTop:4},children:s.summary}):null]}),e.jsx("div",{className:"PostBody",dangerouslySetInnerHTML:{__html:H}})]})]})]})]}),e.jsxs(X,{style:{position:"sticky",bottom:0,marginTop:12,display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsxs(u,{onClick:w,children:[e.jsx(v,{})," New"]}),e.jsxs(u,{onClick:S,children:[e.jsx(Z,{})," Validate"]}),e.jsxs(u,{onClick:S,children:[e.jsx(v,{})," Stage"]})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,minWidth:0},children:e.jsxs("label",{className:"Small",style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("span",{children:"Filename"}),e.jsx("input",{readOnly:!0,value:`${d||b(s.title||"untitled")}.md`,style:{width:320}})]})}),e.jsx("div",{style:{display:"flex",gap:8,alignItems:"center"},children:e.jsxs(u,{className:"gc-btn gc-btn--primary",onClick:U,children:[e.jsx(ee,{})," Publish"]})})]}),e.jsx(te,{open:W,onClose:()=>j(!1),defaultBranch:k,staged:y,onCreate:J,busy:F})]})}export{he as default};
