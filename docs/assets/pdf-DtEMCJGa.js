const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./jspdf.es.min-BKtztfWp.js","./index-DTpzNi10.js","./index-CgYN5LtB.css"])))=>i.map(i=>d[i]);
import{_ as O}from"./index-DTpzNi10.js";import{e as w}from"./fonts-OQpvcT7Z.js";import{normalizeSongInput as b,computeLayout as D,DEFAULT_LAYOUT_OPT as $,planSongLayout as U}from"./pdf-plan-DduNKW6E.js";const L=typeof window<"u"&&(()=>{try{return localStorage.getItem("pdfDebug")==="1"}catch{return!1}})();async function H(){const{jsPDF:e}=await O(async()=>{const{jsPDF:t}=await import("./jspdf.es.min-BKtztfWp.js").then(a=>a.j);return{jsPDF:t}},__vite__mapDeps([0,1,2]),import.meta.url);return new e({unit:"pt",format:"letter"})}function E(e,t,a){return l=>(e.setFont(t,"normal"),e.setFontSize(a),e.getTextWidth(l||""))}function v(e,t,a){const l=String(a.lyricFamily||"Helvetica"),i=String(a.chordFamily||"Courier"),g=e.internal.pageSize.getWidth(),y=e.internal.pageSize.getHeight(),r={...$,...a,pageWidth:g,pageHeight:y},c=r.margin,k=Math.max(22,r.lyricSizePt+6),f=Math.max(12,r.lyricSizePt-2);e.setFont(l,"bold"),e.setFontSize(k),e.text(r.title,c,c+24),e.setFont(l,"italic"),e.setFontSize(f),e.text(`Key: ${r.key||"—"}`,c,c+40);const W=E(e,l,r.lyricSizePt),h=D(t,r,W),d=4,T=r.lyricSizePt,n=Math.round(r.lyricSizePt*.85),m=c+r.headerOffsetY,s=g-c*2,F=r.columns===2?(s-r.gutter)/2:s;h.pages.forEach((z,C)=>{C>0&&e.addPage(),L&&(e.setDrawColor(180),e.rect(c,m,F,y-c-m),r.columns===2&&e.rect(c+F+r.gutter,m,F,y-c-m),e.setFont(l,"normal"),e.setFontSize(9),e.text(`Plan: ${r.columns} col • size ${r.lyricSizePt}pt • family ${r.lyricFamily}/${r.chordFamily}`,c,y-c*.6)),z.columns.forEach(x=>{var o;let P=x.x,u=m;for(const S of x.blocks)if(S.type==="section")u+=n,e.setFont(l,"bold"),e.setFontSize(T),e.text(`[${S.header}]`,P,u),u+=T+4;else if(S.type==="line"){if((o=S.chords)!=null&&o.length){e.setFont(i,"bold"),e.setFontSize(r.chordSizePt);for(const M of S.chords)e.text(M.sym,P+M.x,u);u+=r.chordSizePt+d/2}e.setFont(l,"normal"),e.setFontSize(r.lyricSizePt),e.text(S.lyrics,P,u),u+=r.lyricSizePt+d}})})}async function _(e,t,a={}){const l=e.internal.pageSize.getWidth(),i=e.internal.pageSize.getHeight(),g={...$,...a,pageWidth:l,pageHeight:i};let y={};try{y=await w(e)}catch{}const r=y.lyricFamily||g.lyricFamily||"Helvetica",c=y.chordFamily||g.chordFamily||"Courier",k=h=>d=>(e.setFont(r,"normal"),e.setFontSize(h),e.getTextWidth(d||"")),f=h=>d=>(e.setFont(c,"bold"),e.setFontSize(h),e.getTextWidth(d||""));return U(t,{...g,lyricFamily:r,chordFamily:c},k,f)}async function j(e,t){const a=await H();let l={};try{l=await w(a)}catch{}const i=await _(a,b(e),{lyricSizePt:Math.max(12,(t==null?void 0:t.lyricSizePt)||16),chordSizePt:Math.max(12,(t==null?void 0:t.chordSizePt)||16),title:(t==null?void 0:t.title)||e.title||"Untitled",key:(t==null?void 0:t.key)||e.key||"C",margin:36,lyricFamily:l.lyricFamily||"Helvetica",chordFamily:l.chordFamily||"Courier"});return v(a,e,{...i,title:i.title||(t==null?void 0:t.title)||e.title,key:i.key||(t==null?void 0:t.key)||e.key}),a}async function Y(e,t){const a=await H();let l={};try{l=await w(a)}catch{}const i={lyricSizePt:Math.max(12,(t==null?void 0:t.lyricSizePt)||16),chordSizePt:Math.max(12,(t==null?void 0:t.chordSizePt)||16),title:(t==null?void 0:t.title)||e.title||"Untitled",key:(t==null?void 0:t.key)||e.key||"C",margin:36,lyricFamily:l.lyricFamily||"Helvetica",chordFamily:l.chordFamily||"Courier"},g=await _(a,b(e),i);return v(a,e,{...i,...g}),a.save(`${i.title.replace(/\s+/g,"_")}.pdf`),{plan:g}}async function B(e,t){const a=await H();let l={};try{l=await w(a)}catch{}const i={lyricSizePt:Math.max(12,(t==null?void 0:t.lyricSizePt)||16),chordSizePt:Math.max(12,(t==null?void 0:t.chordSizePt)||16),margin:36,lyricFamily:l.lyricFamily||"Helvetica",chordFamily:l.chordFamily||"Courier"};let g=!0;for(const y of e){g||a.addPage(),g=!1;const r=b(y),c=await _(a,r,{...i,title:y.title||"Untitled",key:y.key||"C"});v(a,y,{...i,...c,title:y.title||"Untitled",key:y.key||"C"})}a.save("GraceChords_Selection.pdf")}async function K(e,t={}){const a=await H();let l={};try{l=await w(a)}catch{}const i={lyricSizePt:Math.max(12,(t==null?void 0:t.lyricSizePt)||16),chordSizePt:Math.max(12,(t==null?void 0:t.chordSizePt)||16),margin:36,lyricFamily:l.lyricFamily||"Helvetica",chordFamily:l.chordFamily||"Courier",columns:(t==null?void 0:t.columns)===2?2:1},g=!!(t!=null&&t.includeTOC),y=t==null?void 0:t.cover,r=E(a,i.lyricFamily,i.lyricSizePt),c=e.map(n=>({raw:n,norm:b(n),layout:D(n,{...i},r)}));let f=1+(y?1:0)+(g?1:0);const W=c.map((n,m)=>{const s={num:m+1,title:n.norm.title||"Untitled",page:f};return n.start=f,f+=n.layout.pages.length,s}),h=a.internal.pageSize.getWidth(),d=a.internal.pageSize.getHeight();if(y){try{a.addImage(y,"JPEG",0,0,h,d,void 0,"FAST")}catch{}(g||c.length)&&a.addPage()}if(g){const n=i.margin;a.setFont(i.lyricFamily,"bold"),a.setFontSize(24),a.text("Table of Contents",h/2,n+20,{align:"center"}),a.setFont(i.lyricFamily,"normal"),a.setFontSize(12);let m=n+40;const s=16,F=h-n;W.forEach(z=>{m>d-n&&(a.addPage(),m=n);const C=`${z.num} ${z.title}`;a.text(C,n,m);const x=String(z.page),P=a.getTextWidth(C),u=a.getTextWidth(x),o=F-n-P-u-4;if(o>0){const S=a.getTextWidth("."),M=".".repeat(Math.max(0,Math.floor(o/S)));a.text(M,n+P+2,m)}a.text(x,F,m,{align:"right"}),m+=s}),c.length&&a.addPage()}c.forEach((n,m)=>{v(a,n.raw,{...i,title:`${m+1}. ${n.norm.title||"Untitled"}`,key:n.norm.key||"C",columns:i.columns}),m<c.length-1&&a.addPage()});const T=`songbook-${new Date().toISOString().slice(0,10).replace(/-/g,"")}.pdf`;a.save(T)}export{B as downloadMultiSongPdf,Y as downloadSingleSongPdf,K as downloadSongbookPdf,j as songToPdfDoc};
