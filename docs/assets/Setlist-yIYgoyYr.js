const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jszip.min-Cxfv_sq3.js","assets/index-CFMmyTcL.js","assets/index-C2Li7hIZ.css","assets/index-BgLpJ0Hx.js"])))=>i.map(i=>d[i]);
import{_ as qe,p as be,Y as Ht,Z as qt,$ as Jt,r as y,a0 as Gt,i as Zt,a1 as Qt,a2 as en,a3 as tn,a4 as ft,a5 as nn,a6 as sn,F as rn,a7 as an,j as n,a8 as E,a9 as on,aa as pt,ab as xe,ac as mt,L as ht,ad as gt,ae as ln,af as cn,y as Xe,D as dn,ag as un,f as fn,ah as yt,ai as We,aj as Ve,ak as ze,al as xt,am as wt,an as bt,ao as pn,ap as mn,aq as hn,ar as Le,as as we,at as St,s as q,l as gn,m as yn,au as xn,av as wn,aw as bn,ax as Sn}from"./index-CFMmyTcL.js";import{P as vn}from"./PageContainer-H5eYmuD2.js";const Ct="gracechords.sets.v1";function $e(){try{const e=localStorage.getItem(Ct);return e?JSON.parse(e):{sets:{}}}catch{return{sets:{}}}}function Mt(e){localStorage.setItem(Ct,JSON.stringify(e))}function Tn(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"id-"+Math.random().toString(36).slice(2)+Date.now().toString(36)}function je(){const{sets:e}=$e();return Object.values(e).sort((s,r)=>(r.updatedAt||0)-(s.updatedAt||0))}function jn(e){const{sets:s}=$e();return s[e]||null}function vt(e){const s=Date.now(),r={id:e.id||Tn(),name:e.name?.trim()||"Untitled Set",items:Array.isArray(e.items)?e.items:[],createdAt:e.createdAt||s,updatedAt:s},d=$e();return d.sets[r.id]=r,Mt(d),r}function Nn(e){const s=$e();return s.sets[e]?(delete s.sets[e],Mt(s),!0):!1}const In="application/vnd.openxmlformats-officedocument.presentationml.slide+xml",Tt="application/vnd.openxmlformats-officedocument.presentationml.slideMaster+xml",Pn="application/vnd.openxmlformats-officedocument.presentationml.slideLayout+xml",En="application/vnd.openxmlformats-officedocument.theme+xml",ee="http://schemas.openxmlformats.org/presentationml/2006/main",Je="http://schemas.openxmlformats.org/officeDocument/2006/relationships",jt="application/vnd.openxmlformats-officedocument.presentationml.notesMaster+xml",Cn=new DOMParser,Mn=new XMLSerializer;function Ln(e){const s="setlist",r=String(e).trim();return r&&r.replace(/\s+/g,"_").replace(/[^A-Za-z0-9_.-]/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"")||s}async function Nt(e){const s=await fetch(e);if(!s.ok)throw new Error(`Failed to load PPTX: ${e}`);return s.arrayBuffer()}function ce(e){const s=Cn.parseFromString(e,"application/xml"),r=s.getElementsByTagName("parsererror")[0];if(r)throw new Error(r.textContent||"Failed to parse XML");return s}function Ie(e){return Mn.serializeToString(e)}function J(e){const s=String(e||"").match(/(\d+)$/);return s?Number(s[1]):0}function he(e,s){let r=0;return e.filter(d=>s.test(d)).forEach(d=>{const a=d.name.match(s);if(!a)return;const f=Number(a[1]);Number.isNaN(f)||(r=Math.max(r,f))}),r}function Lt(e,s,r){if(Array.from(e.getElementsByTagName("Override")).some(f=>f.getAttribute("PartName")===s))return;const a=e.createElement("Override");a.setAttribute("PartName",s),a.setAttribute("ContentType",r),e.documentElement.appendChild(a)}function Se(e,s){if(!s)return null;if(s.startsWith("/"))return s.slice(1);const r=e.split("/");r.pop();const d=s.split("/");for(const a of d)if(a==="..")r.pop();else{if(a===".")continue;r.push(a)}return r.join("/")}function de(e,s){const r=e.split("/");r.pop();const d=s.split("/");let a=0;for(;a<r.length&&a<d.length&&r[a]===d[a];)a++;const f=r.length-a,p=[];for(let m=0;m<f;m++)p.push("..");return p.push(...d.slice(a)),p.join("/")}function At(e){const s=e.match(/^(.*\/)([^/]*?)(\d+)(\.[^.]+)$/);return s?{dir:s[1],prefix:s[2],number:Number(s[3]),ext:s[4]}:null}function le(e,s,r){const d=Number(e[s]||0);r>d&&(e[s]=r)}function $t(e,s){const d=Number(e[s]||0)+1;return e[s]=d,d}function G(e,s){if(!e)return null;const r=e.file(s);return Array.isArray(r)?r.length?r[0]:null:r||null}function ve(e){const s=e.lastIndexOf("/"),r=s>=0?e.slice(0,s+1):"",d=s>=0?e.slice(s+1):e;return`${r}_rels/${d}.rels`}function An(e,s){if(!e||!s)return{contentType:"",fromOverride:!1,extension:""};const r=`/${s}`,a=Array.from(e.getElementsByTagName("Override")).find(S=>S.getAttribute("PartName")===r);if(a)return{contentType:a.getAttribute("ContentType")||"",fromOverride:!0,extension:s.split(".").pop()||""};const f=Array.from(e.getElementsByTagName("Default")),p=s.split(".").pop()||"",m=f.find(S=>S.getAttribute("Extension")===p);return m?{contentType:m.getAttribute("ContentType")||"",fromOverride:!1,extension:p}:{contentType:"",fromOverride:!1,extension:p}}function $n(e,s,r){if(!r||Array.from(e.getElementsByTagName("Default")).some(p=>p.getAttribute("Extension")===r))return;const a=Array.from(s?.getElementsByTagName?.("Default")||[]).find(p=>p.getAttribute("Extension")===r);if(!a)return;const f=e.createElement("Default");f.setAttribute("Extension",r),f.setAttribute("ContentType",a.getAttribute("ContentType")||""),e.documentElement.appendChild(f)}function Rn(e){return e?!/xml|text|application\/(.*\+xml)/i.test(e):!1}function kn(e){const s=/(.*\D)(\d+)(\.\w+)$/,r=e&&e.match(s);if(r){const[,d,,a]=r;return f=>`${d}${f}${a}`}return d=>`slides/slide${d}.xml`}async function Dn(e){const s="ppt/presentation.xml",r=G(e,s);if(!r)throw new Error("Base PPTX missing ppt/presentation.xml");const d=await r.async("string"),a=ce(d),f=a.getElementsByTagNameNS(ee,"sldIdLst")[0]||a.getElementsByTagName("p:sldIdLst")[0],m=(f?Array.from(f.getElementsByTagNameNS(ee,"sldId")).concat(Array.from(f.getElementsByTagName("p:sldId"))):[]).reduce((x,N)=>{const L=Number(N.getAttribute("id"));return Number.isNaN(L)?x:Math.max(x,L)},255),S="ppt/_rels/presentation.xml.rels",j=G(e,S);if(!j)throw new Error("Base PPTX missing ppt/_rels/presentation.xml.rels");const v=await j.async("string"),A=ce(v),D=Array.from(A.getElementsByTagName("Relationship")),U=D.reduce((x,N)=>{const L=J(N.getAttribute("Id"));return Math.max(x,L)},0),te=D.filter(x=>(x.getAttribute("Type")||"").endsWith("/slide")),I=te.length&&te[0].getAttribute("Target")||"",B=kn(I),h=a.getElementsByTagNameNS(ee,"sldMasterIdLst")[0]||a.getElementsByTagName("p:sldMasterIdLst")[0]||null,_=(h?Array.from(h.getElementsByTagNameNS(ee,"sldMasterId")).concat(Array.from(h.getElementsByTagName("p:sldMasterId"))):[]).reduce((x,N)=>{const L=Number(N.getAttribute("id"));return Number.isNaN(L)?x:Math.max(x,L)},2147483647),ue=a.getElementsByTagNameNS(ee,"notesMasterIdLst")[0]||a.getElementsByTagName("p:notesMasterIdLst")[0]||null;let O=null;const ne=D.find(x=>(x.getAttribute("Type")||"").endsWith("/notesMaster"));if(ne){const x=ne.getAttribute("Target")||"";O=Se("ppt/presentation.xml",x)}let K=null;const fe=D.find(x=>(x.getAttribute("Type")||"").endsWith("/theme"));if(fe){const x=fe.getAttribute("Target")||"";K=Se("ppt/presentation.xml",x)}const V="[Content_Types].xml",Te=G(e,V);if(!Te)throw new Error("Base PPTX missing [Content_Types].xml");const Re=await Te.async("string"),ke=ce(Re),se={};e.filter(()=>!0).forEach(x=>{const N=At(x.name);if(!N)return;const L=`${N.dir}${N.prefix}`;le(se,L,N.number)}),le(se,"ppt/slides/slide",he(e,/^ppt\/slides\/slide(\d+)\.xml$/)),le(se,"ppt/notesSlides/notesSlide",he(e,/^ppt\/notesSlides\/notesSlide(\d+)\.xml$/)),le(se,"ppt/slideMasters/slideMaster",he(e,/^ppt\/slideMasters\/slideMaster(\d+)\.xml$/)),le(se,"ppt/slideLayouts/slideLayout",he(e,/^ppt\/slideLayouts\/slideLayout(\d+)\.xml$/)),le(se,"ppt/theme/theme",he(e,/^ppt\/theme\/theme(\d+)\.xml$/)),le(se,"ppt/notesMasters/notesMaster",he(e,/^ppt\/notesMasters\/notesMaster(\d+)\.xml$/)),le(se,"ppt/media/image",he(e,/^ppt\/media\/image(\d+)\.[^.]+$/));const re=e.file(/^ppt\/slides\/slide\d+\.xml$/).sort((x,N)=>J(x.name)-J(N.name));let z="",Z="",pe="";if(re.length){const x=re[0],N=G(e,ve(x.name));if(N){const L=ce(await N.async("string")),Y=Array.from(L.getElementsByTagName("Relationship")).find(X=>(X.getAttribute("Type")||"").endsWith("/slideLayout"));if(Y){z=Y.getAttribute("Target")||"";const X=Se(x.name,z);X&&G(e,X)&&(Z=X)}}}if(Z)!z&&re.length&&(z=de(re[0].name,Z));else{const x=e.file(/^ppt\/slideLayouts\/.*\.xml$/).sort((N,L)=>J(N.name)-J(L.name));x.length&&(Z=x[0].name,z=re.length?de(re[0].name,Z):"../slideLayouts/slideLayout1.xml")}if(Z){const x=G(e,ve(Z));if(x){const N=ce(await x.async("string")),ie=Array.from(N.getElementsByTagName("Relationship")).find(Y=>(Y.getAttribute("Type")||"").endsWith("/slideMaster"));if(ie){const Y=ie.getAttribute("Target")||"",X=Se(Z,Y);X&&G(e,X)&&(pe=X)}}}if(!pe){const x=e.file(/^ppt\/slideMasters\/.*\.xml$/).sort((N,L)=>J(N.name)-J(L.name));x.length&&(pe=x[0].name)}if(!O){const x=e.file(/^ppt\/notesMasters\/.*\.xml$/).sort((N,L)=>J(N.name)-J(L.name));x.length&&(O=x[0].name)}return{zip:e,presentationXmlPath:s,presentationDoc:a,sldIdList:f,sldMasterList:h,notesMasterList:ue,presentationRelsPath:S,presentationRelsDoc:A,contentTypesPath:V,contentTypesDoc:ke,nextSlideId:m,nextRelId:U,nextMasterId:_,counters:se,partMap:new Map,masterRelMap:new Map,notesMasterRelMap:new Map,getSlideTarget:B,defaultLayoutTarget:z,defaultLayoutPath:Z,defaultMasterPath:pe,defaultNotesMasterPath:O,defaultThemePath:K}}function Bn(e,s,r){const d=e.presentationRelsDoc.documentElement,a=e.presentationRelsDoc.createElement("Relationship");a.setAttribute("Id",r),a.setAttribute("Type","http://schemas.openxmlformats.org/officeDocument/2006/relationships/slide");const f=e.getSlideTarget?e.getSlideTarget(s):`slides/slide${s}.xml`;a.setAttribute("Target",f),d.appendChild(a)}function On(e,s){const r=e.presentationDoc,d=e.sldIdList||(()=>{const f=r.createElementNS(ee,"p:sldIdLst");return r.documentElement.appendChild(f),e.sldIdList=f,f})(),a=r.createElementNS(ee,"p:sldId");e.nextSlideId+=1,a.setAttribute("id",String(e.nextSlideId)),a.setAttributeNS(Je,"r:id",s),d.appendChild(a)}function _n(e,s){if(e.masterRelMap.has(s))return e.masterRelMap.get(s);const r=e.presentationDoc,d=e.presentationRelsDoc;let a=e.sldMasterList;if(!a){a=r.createElementNS(ee,"p:sldMasterIdLst");const S=r.documentElement.firstChild;S?r.documentElement.insertBefore(a,S):r.documentElement.appendChild(a),e.sldMasterList=a}e.nextMasterId=Number(e.nextMasterId||2147483647),e.nextMasterId+=1,e.nextRelId+=1;const f=`rId${e.nextRelId}`,p=r.createElementNS(ee,"p:sldMasterId");p.setAttribute("id",String(e.nextMasterId)),p.setAttributeNS(Je,"r:id",f),a.appendChild(p);const m=d.createElement("Relationship");return m.setAttribute("Id",f),m.setAttribute("Type","http://schemas.openxmlformats.org/officeDocument/2006/relationships/slideMaster"),m.setAttribute("Target",de("ppt/presentation.xml",s)),d.documentElement.appendChild(m),e.masterRelMap.set(s,f),f}function Kn(e,s){if(e.notesMasterRelMap.has(s))return e.notesMasterRelMap.get(s);const r=e.presentationDoc,d=e.presentationRelsDoc;let a=e.notesMasterList;if(!a){a=r.createElementNS(ee,"p:notesMasterIdLst");const S=r.documentElement,j=e.sldIdList||S.firstChild;j?S.insertBefore(a,j):S.appendChild(a),e.notesMasterList=a}e.nextRelId+=1;const f=`rId${e.nextRelId}`,p=r.createElementNS(ee,"p:notesMasterId");p.setAttributeNS(Je,"r:id",f),a.appendChild(p);const m=d.createElement("Relationship");return m.setAttribute("Id",f),m.setAttribute("Type","http://schemas.openxmlformats.org/officeDocument/2006/relationships/notesMaster"),m.setAttribute("Target",de("ppt/presentation.xml",s)),d.documentElement.appendChild(m),e.notesMasterRelMap.set(s,f),f}async function Ae(e,s,r,d,a,f={}){if(!a)return null;const p=`${d}:${a}`;if(e.partMap.has(p))return e.partMap.get(p);const m=An(r,a),S=G(s,a);if(!S)return null;if(m.contentType===Pn&&e.defaultLayoutPath)return e.partMap.set(p,e.defaultLayoutPath),e.defaultLayoutPath;if(m.contentType===Tt&&e.defaultMasterPath)return e.partMap.set(p,e.defaultMasterPath),e.defaultMasterPath;if(m.contentType===jt&&e.defaultNotesMasterPath)return e.partMap.set(p,e.defaultNotesMasterPath),e.defaultNotesMasterPath;if(m.contentType===En&&e.defaultThemePath)return e.partMap.set(p,e.defaultThemePath),e.defaultThemePath;const j=At(a);let v;if(j){const te=`${j.dir}${j.prefix}`,I=$t(e.counters,te);v=`${j.dir}${j.prefix}${I}${j.ext}`}else{if(G(e.zip,a))return e.partMap.set(p,a),a;v=a}e.partMap.set(p,v),m.fromOverride?Lt(e.contentTypesDoc,`/${v}`,m.contentType):m.extension&&$n(e.contentTypesDoc,r,m.extension);const A=await S.async(Rn(m.contentType)?"uint8array":"string");e.zip.file(v,A);const D=ve(a),U=G(s,D);if(U){const te=await U.async("string"),I=ce(te),B=Array.from(I.getElementsByTagName("Relationship"));for(const M of B){if((M.getAttribute("TargetMode")||"").toLowerCase()==="external")continue;const ue=M.getAttribute("Target")||"",O=Se(a,ue);if(!O)continue;let ne=null;if(typeof f.relationshipMutator=="function"){const V=await f.relationshipMutator({node:M,type:M.getAttribute("Type")||"",absolutePath:O,newPartPath:v,originalPartPath:a});if(V===!1)continue;V&&V.targetPath&&(ne=V.targetPath)}const K=ne||await Ae(e,s,r,d,O);if(!K)continue;const fe=de(v,K);M.setAttribute("Target",fe)}const h=ve(v);e.zip.file(h,Ie(I))}return m.contentType===Tt?_n(e,v):m.contentType===jt&&Kn(e,v),v}async function Un(e,s,r,d,a,f){const p=ve(a),m=G(s,p);if(!m)return;const S=await m.async("string"),j=ce(S),v=Array.from(j.getElementsByTagName("Relationship")),A=j.documentElement;let D=!1,U=v.reduce((I,B)=>{const h=B.getAttribute("Id")||"";return Math.max(I,J(h))},0);for(const I of v){const B=I.getAttribute("Type")||"",h=I.getAttribute("Target")||"";if(!h)continue;const M=Se(a,h);if(M){if(B.endsWith("/slideLayout")){e.defaultLayoutTarget?D?A.removeChild(I):(D=!0,I.setAttribute("Target",e.defaultLayoutTarget)):D?A.removeChild(I):D=!0;continue}if(B.endsWith("/notesSlide")){const _=await Ae(e,s,r,d,M,{relationshipMutator:({type:ue})=>ue.endsWith("/slide")?{targetPath:f}:null});if(!_)continue;I.setAttribute("Target",de(f,_))}else if(B.includes("/image")||B.includes("/audio")||B.includes("/video")){const _=await Ae(e,s,r,d,M);if(!_)continue;I.setAttribute("Target",de(f,_))}else{const _=await Ae(e,s,r,d,M);if(!_)continue;I.setAttribute("Target",de(f,_))}}}if(!D&&e.defaultLayoutTarget){const I=j.createElement("Relationship"),B=`rId${U+1||1}`;I.setAttribute("Id",B),I.setAttribute("Type","http://schemas.openxmlformats.org/officeDocument/2006/relationships/slideLayout"),I.setAttribute("Target",e.defaultLayoutTarget),A.appendChild(I)}const te=ve(f);e.zip.file(te,Ie(j))}async function Fn(e,s,r){const d=s.file(/^ppt\/slides\/slide\d+\.xml$/).sort((p,m)=>{const S=J(p.name),j=J(m.name);return S-j});if(!d.length)return;const a=G(s,"[Content_Types].xml");if(!a)throw new Error("Source PPTX missing [Content_Types].xml");const f=ce(await a.async("string"));for(const p of d){const m=$t(e.counters,"ppt/slides/slide"),S=`ppt/slides/slide${m}.xml`,j=await p.async("string");e.zip.file(S,j),Lt(e.contentTypesDoc,`/${S}`,In),e.nextRelId+=1;const v=`rId${e.nextRelId}`;Bn(e,m,v),On(e,v);const A=p.name;e.partMap.set(`${r}:${A}`,S),await Un(e,s,f,r,A,S)}}function Xn(e){e.zip.file(e.presentationXmlPath,Ie(e.presentationDoc)),e.zip.file(e.presentationRelsPath,Ie(e.presentationRelsDoc)),e.zip.file(e.contentTypesPath,Ie(e.contentTypesDoc))}function Wn(e,s){const r=document.createElement("a");r.href=URL.createObjectURL(e),r.download=s,r.rel="noopener",r.click(),URL.revokeObjectURL(r.href)}async function Vn(e=[],s="Setlist"){if(!Array.isArray(e)||e.length===0)throw new Error("No PPTX files to merge");const r=(await qe(async()=>{const{default:v}=await import("./jszip.min-Cxfv_sq3.js").then(A=>A.j);return{default:v}},__vite__mapDeps([0,1,2]))).default,[d,...a]=e,f=await Nt(d),p=await r.loadAsync(f),m=await Dn(p);for(let v=0;v<a.length;v++){const A=await Nt(a[v]),D=await r.loadAsync(A);await Fn(m,D,`src${v+1}`)}Xn(m);const S=await p.generateAsync({type:"blob"}),j=Ln(s||"Setlist");Wn(S,`${j}.pptx`)}function zn(e){return e?e.slug?e.slug:e.filename?e.filename.replace(/\.chordpro$/i,""):e.title?e.title.trim().toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_.-]/g,""):"":""}async function Yn(e={},s={}){const{name:r="Setlist",songs:d=[]}=e||{},{availablePptxMap:a=null,onEmpty:f}=s,p=[];for(const m of d){const S=zn(m);S&&(a&&!a[S]||p.push(be(`pptx/${S}.pptx`)))}if(!p.length){typeof f=="function"&&f();return}await Vn(p,r)}let It;const Pt=()=>It||(It=qe(()=>import("./index-BgLpJ0Hx.js").then(e=>e.i),__vite__mapDeps([3,1,2])));function Hn(){try{if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID()}catch{}return`sel-${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`}function He(e){if(!e)return null;const{id:s,toKey:r=""}=e;return s==null?null:{uid:Hn(),id:s,toKey:r}}function Ne(e=[]){return e.map(s=>He(s)).filter(Boolean)}function Et(e){try{return decodeURIComponent(e)}catch{return e}}function Rt(e){const s=String(e||"");if(!s.trim())return{bookPart:"",refPart:""};const r=s.indexOf(":");if(r>-1){let a=r-1;for(;a>=0&&/\d/.test(s[a]);)a-=1;const f=a+1;if(f<r)return{bookPart:s.slice(0,f).trim(),refPart:s.slice(f).trim()}}const d=s.match(/\s(\d+)(?=[\s:.,-]|$)/);return d&&typeof d.index=="number"?{bookPart:s.slice(0,d.index).trim(),refPart:s.slice(d.index+1).trim()}:{bookPart:s.trim(),refPart:""}}function Ye(e,s){if(!s)return null;const r=String(e||"");if(!r.trim())return null;const{bookPart:d,refPart:a}=Rt(r);if(!d)return null;const f=m=>String(m||"").toLowerCase().replace(/[^a-z0-9]/g,""),p=a?`${s} ${a}`:`${s} `;return!f(p).startsWith(f(r))||p.length<=r.length?null:{composed:p,prefix:r,remainder:p.slice(r.length)}}function Gn(){const{code:e,songIds:s}=Ht(),r=qt(),d=Jt(),a=y.useMemo(()=>Gt(Zt?.items||[]),[]),f=a.byId,p=a.translationLanguages||[],[m,S]=y.useState(()=>Qt(p.length?p:a.allLanguages)),[j,v]=y.useState("New Setlist"),[A,D]=y.useState(""),[U,te]=y.useState([]),[I,B]=y.useState(()=>{try{return localStorage.getItem("pref:icpOnly")==="1"}catch{return!1}});y.useEffect(()=>{try{localStorage.setItem("pref:icpOnly",I?"1":"0")}catch{}},[I]);const[h,M]=y.useState([]),[_,ue]=y.useState({}),[O,ne]=y.useState(""),[K,fe]=y.useState("");Object.keys(_).length;const[V,Te]=y.useState(!1),[Re,ke]=y.useState(()=>{try{return window.innerWidth<=640}catch{return!1}}),[se,re]=y.useState(()=>{try{return window.innerWidth<=820}catch{return!1}}),[z,Z]=y.useState(()=>{try{return window.innerWidth<=900}catch{return!1}}),pe=y.useRef(""),x=y.useRef(""),N=y.useRef(!1),[L,ie]=y.useState(null),[Y,X]=y.useState(()=>je()),[De,Pe]=y.useState(""),[kt,Ee]=y.useState(!1),[Ge,Ze]=y.useState(""),[Be,Oe]=y.useState(!1),[ae,_e]=y.useState(""),[Ke,ge]=y.useState(""),[Ue,Dt]=y.useState(""),Qe=y.useRef(new Map);y.useEffect(()=>{en(m)},[m]),y.useEffect(()=>{const t=[];for(const i of a.groups||[]){let l=tn(i,m);if(l){if(ft(l)){const o=i.variants.find(c=>!ft(c));if(!o)continue;l=o}t.push({...l,hasSelectedLanguage:nn(i,m),searchTitles:i.variants.map(o=>o.title||"").filter(Boolean),searchTags:Array.from(new Set(i.variants.flatMap(o=>o.tags||[]))),searchAuthors:Array.from(new Set(i.variants.flatMap(o=>o.authors||[])))})}}te(t)},[a.groups,m]);function ye(t){return t&&f.get(String(t))||null}y.useEffect(()=>{let t=!1;async function i(){const l={};for(const o of h){const c=ye(o.id);if(!c)continue;const u=c.filename.replace(/\.chordpro$/i,""),g=be(`pptx/${u}.pptx`);await mn(g,u)&&(l[u]=!0)}t||ue(l)}return i(),()=>{t=!0}},[h,f]),y.useEffect(()=>{try{const t=document.documentElement,i=document.body;pe.current=t.style.overflowY||"",x.current=i.style.overflowY||"",getComputedStyle(t).overflowY==="hidden"&&(t.style.overflowY=""),getComputedStyle(i).overflowY==="hidden"&&(i.style.overflowY="")}catch{}return()=>{try{document.documentElement.style.overflowY=pe.current,document.body.style.overflowY=x.current}catch{}}},[]),y.useEffect(()=>{if(!e)return;const{entries:t,error:i}=sn(e);if(i){alert(i),d("/setlist",{replace:!0});return}const l=t.map(u=>({id:u.id,toKey:u.toKey}));M(Ne(l));const o=l.map(u=>encodeURIComponent(u.id)).join(","),c=l.map(u=>encodeURIComponent(u.toKey||"")).join(",");d(`/setlist/${o}?toKeys=${c}`,{replace:!0})},[e]),y.useEffect(()=>{if(!s)return;const t=(s||"").split(",").map(c=>Et(c.trim())).filter(Boolean);if(!t.length)return;const l=(new URLSearchParams(r.search||"").get("toKeys")||"").split(",").map(c=>Et(c)),o=t.map((c,u)=>({id:c,toKey:l[u]||""}));M(Ne(o))},[s,r.search]),y.useEffect(()=>{try{if(!Array.isArray(h))return;if(h.length===0){(e||s)&&d("/setlist",{replace:!0});return}const t=h.map(c=>encodeURIComponent(c.id)).join(","),i=h.map(c=>encodeURIComponent(c.toKey||"")).join(","),l=s||"",o=new URLSearchParams(r.search||"").get("toKeys")||"";(t!==l||i!==o)&&d(`/setlist/${t}?toKeys=${i}`,{replace:!0})}catch{}},[h.map(t=>`${t.id}:${t.toKey}`).join("|"),s,r.search,e]),y.useEffect(()=>{try{const t=localStorage.getItem("setlist");if(!t||je().length>0)return;const i=JSON.parse(t);if(i?.name||(i?.list?.length||0)>0){const l=vt({name:i.name||"Imported Set",items:i.list||[]});X(je()),ie(l.id),v(l.name),M(Ne(l.items||[])),Pe(l.id)}}catch{}},[]),y.useEffect(()=>{function t(){try{const i=window.innerWidth;ke(i<=640),re(i<=820),Z(i<=900)}catch{}}return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),y.useEffect(()=>{new URLSearchParams(r.search||"").get("icp")==="1"&&B(!0)},[r.search]),y.useEffect(()=>{if(N.current)return;const t=r.state?.quickAction;t&&U.length&&(_t(t,U),N.current=!0,d(r.pathname+(r.search||""),{replace:!0,state:null}))},[r.state,U.map(t=>t.id).join("|")]);const Fe=y.useMemo(()=>new rn(U,{keys:["title","tags","searchTitles","searchTags","searchAuthors"],threshold:.4}),[U]);function Bt(t){return!I||(Array.isArray(t.tags)?t.tags.includes("ICP"):t.tags==="ICP")}const Ot=y.useMemo(()=>{const i=(A?Fe.search(A).map(l=>l.item):U.slice()).filter(Bt);return i.sort((l,o)=>l.hasSelectedLanguage!==o.hasSelectedLanguage?l.hasSelectedLanguage?-1:1:String(l.title||"").localeCompare(String(o.title||""),void 0,{sensitivity:"base"})),i},[A,Fe,U,I]);function et(t){if(!t)return;const i=He({id:t.id,toKey:t.originalKey||t.key||"C"});M(l=>[...l,i])}async function tt(t){const i=hn(t);if(i.error)return ge("Please check verse reference."),!1;const l=await Vt(i);if(!l.ok)return ge(l.message),!1;const o=He({id:i.id,toKey:""});return o?(M(c=>[...c,o]),_e(""),ge(""),Oe(!1),!0):!1}function nt(t){M(i=>i.filter(l=>l.uid!==t))}function Ce(t,i){M(l=>{const o=l.findIndex(w=>w.uid===t);if(o<0)return l;const c=o+(i==="up"?-1:1);if(c<0||c>=l.length)return l;const u=l.slice(),[g]=u.splice(o,1);return u.splice(c,0,g),u})}function st(t,i){M(l=>{if(i<0||i>=l.length)return l;const o=l.findIndex(g=>g.uid===t);if(o<0||o===i)return l;const c=l.slice(),[u]=c.splice(o,1);return c.splice(i,0,u),c})}function _t(t,i){if(!t)return;function l(b){!b||!b.length||M(Ne(b.map(P=>({id:P.id,toKey:P.toKey}))))}function o(b){return b?{id:b.id,toKey:b.originalKey||b.key||"C"}:null}function c(b,P){return b.filter(T=>T&&!P.has(T.id))}function u(b,P){const T=c(b,P),k=T.length?St(T):null;return k&&P.add(k.id),k}function g(){const b=Le(i,"FAST"),P=[],T=new Set;if((b.length>=4?we(b,4):b.slice()).forEach(C=>{C&&T.add(C.id),P.push(C)}),P.length<4){const C=we(c(i,T),Math.min(4-P.length,Math.max(0,i.length-P.length)));P.push(...C)}return P.filter(Boolean).map(o).filter(Boolean).slice(0,4)}function w(){const b=new Set,P=Le(i,"SLOW"),T=W=>P.filter(F=>(F?.originalKey||"").toUpperCase()===W.toUpperCase()),k=Le(i,"FAST"),C=u(T("G"),b)||u(P,b)||u(i,b),Q=u(k,b)||u(i,b),H=u(T("A"),b)||u(P,b)||u(i,b);return[C,Q,H].filter(Boolean).map(o).filter(Boolean)}function $(){const P=St(["CROSS","COMMITMENT","MISSION","MISSIONS","PRAISE","HYMN"]),T=Le(i,P),k=new Set,C=[];T.length>=4?C.push(...we(T,4)):T.length>=2?C.push(...we(T,Math.min(4,T.length))):T.length&&C.push(...T),C.forEach(H=>H&&k.add(H.id));const Q=Math.max(0,2-C.length);if(Q>0){const H=we(c(i,k),Math.min(Q,i.length-C.length));C.push(...H)}if(C.length<4){const H=we(c(i,k),Math.min(4-C.length,i.length-C.length));C.push(...H)}return C.filter(Boolean).map(o).filter(Boolean).slice(0,4)}let R=[];t==="celebrationSet"?R=g():t==="threeSongFlow"?R=w():t==="randomThemeSet"&&(R=$()),R.length&&l(R)}function Kt(t,i){M(l=>l.map(o=>o.uid===t?{...o,toKey:i}:o))}function rt(t){X(je()),Pe(t||"")}function it(){ie(null),v("New Setlist"),M([]),Pe("")}function Ut(){const t=j?.trim()||"New Setlist",i=window.prompt("Save set as:",t);if(i===null)return;const l=String(i).trim()||"New Setlist";let o=L;if(!o){const g=(je()||[]).find(w=>(w.name||"")===l);g&&(o=g.id)}const c=h.map(({id:g,toKey:w})=>({id:g,toKey:w})),u=vt({id:o,name:l,items:c});v(u.name),ie(u.id),rt(u.id)}function Ft(){const t=Ge||De||"";if(!t){Ee(!1);return}const i=jn(t);i&&(ie(i.id),v(i.name||"New Setlist"),M(Ne(i.items||[])),Pe(i.id)),Ee(!1)}function Xt(){const t=Y[0]?.id||"";Ze(De||t),Ee(!0)}function Wt(){L&&window.confirm(`Delete set "${j}"? This cannot be undone.`)&&(Nn(L),it(),rt(""))}async function at(){Te(!0);try{let t=function(u){return Object.keys(u?.verses||{}).map(g=>Number(g)).filter(g=>!Number.isNaN(g)).sort((g,w)=>g-w)};const{downloadMultiSongPdf:i}=await Pt(),l=[],o=Qe.current;async function c(u,g){const w=`${u}::${g}`;if(o.has(w))return o.get(w);try{const $=await fetch(be(`esv/${encodeURIComponent(u)}/${g}.json`));if(!$.ok)throw new Error("Missing chapter");const R=await $.json();return o.set(w,R),R}catch{return o.set(w,null),null}}for(const u of h){if(Ve(u.id)){const w=ze(u.id);if(!w){q("Please check verse reference.");continue}try{const $=w.segments||[],R=$.length>1,b=[],P=new Set;for(const T of $){const k=await c(w.book,T.chapter);if(!k?.verses)continue;const C=k.verses||{},Q=t(k),H=Q.length?Q[Q.length-1]:0;if(!T.ranges){for(const W of Q){const F=`${T.chapter}:${W}`;if(P.has(F))continue;const me=C[String(W)];if(!me)continue;const oe=R?`${T.chapter}:${W}`:`${W}`;b.push({plain:`${oe} ${me}`}),P.add(F)}continue}for(const W of T.ranges){const F=W.start,me=W.end==null?H:W.end;for(let oe=F;oe<=me;oe+=1){const dt=`${T.chapter}:${oe}`;if(P.has(dt))continue;const ut=C[String(oe)];if(!ut)continue;const Yt=R?`${T.chapter}:${oe}`:`${oe}`;b.push({plain:`${Yt} ${ut}`}),P.add(dt)}}}if(!b.length){q(`No verses found for ${w.refDisplay}`);continue}l.push({title:w.refDisplay||w.id,key:"",pdfColumns:1,sections:[{label:"",lines:b}]})}catch($){console.error($),q(`Failed to load ${w.refDisplay}`)}continue}const g=ye(u.id);if(g)try{const w=be(`songs/${g.filename}`),$=await gn(w),R=yn($),b=R.meta?.key||R.meta?.originalkey||g.originalKey||"C",P=xn(b,u.toKey||b),T=(String(b).match(/^([A-G][#b]?)/)||[,""])[1],k=!!(T&&/b$/.test(T)),C=(R.sections||[]).map(W=>({section:W.label,lines:(W.lines||[]).map(F=>F.instrumental?{instrumental:wn(F.instrumental,P,k)}:F.comment?{plain:F.comment,chordPositions:[],comment:F.comment}:{plain:F.lyrics||"",chordPositions:(F.chords||[]).map(me=>({sym:bn(me.sym,P,k),index:me.index}))})})),Q=g.filename.replace(/\.chordpro$/i,""),H=Sn({title:R.meta?.title||g.title||Q,key:u.toKey||b,capo:R.meta?.capo,lyricsBlocks:C});l.push(H)}catch(w){console.error(w),q(`Failed to process ${g.filename}`)}}l.length&&await i(l)}finally{Te(!1)}}function Me(){Pt()}async function ot(){try{const t=h.map(c=>encodeURIComponent(c.id)).join(","),i=h.map(c=>encodeURIComponent(c.toKey||"")).join(","),o=`${(()=>{try{if(typeof window<"u"&&window.location)return`${window.location.origin||""}/`}catch{}return""})()}setlist/${t}?toKeys=${i}`;await navigator.clipboard.writeText(o);try{q?.("Link copied!")}catch{}}catch{alert("Failed to copy link")}}y.useEffect(()=>{if(!Be)return;const t=Rt(ae).bookPart,i=an(t);Dt(i||"")},[ae,Be]);async function Vt(t){if(!t?.book||!t?.segments?.length)return{ok:!1,message:"Please check verse reference."};async function i(o,c){const u=`${o}::${c}`,g=Qe.current;if(g.has(u))return g.get(u);try{const w=await fetch(be(`esv/${encodeURIComponent(o)}/${c}.json`));if(!w.ok)throw new Error("Missing chapter");const $=await w.json();return g.set(u,$),$}catch{return g.set(u,null),null}}let l=!1;for(const o of t.segments){const c=await i(t.book,o.chapter);if(!c?.verses)return{ok:!1,message:"No verse found."};const u=c.verses||{},g=Object.keys(u);if(!o.ranges){g.length&&(l=!0);continue}for(const w of o.ranges){const $=w.start,R=w.end??$;if(!u[String($)]||!u[String(R)])return{ok:!1,message:"Please check verse reference."};l=!0}}return l?{ok:!0}:{ok:!1,message:"No verse found."}}function zt(){const t=Ye(ae,Ue);t&&_e(t.composed)}async function lt(){if(K)return;ne(`Bundling 0/${h.length}…`);const t=(await qe(async()=>{const{default:o}=await import("./jszip.min-Cxfv_sq3.js").then(c=>c.j);return{default:o}},__vite__mapDeps([0,1,2]))).default,i=new t;let l=0;for(let o=0;o<h.length;o++){const c=h[o],u=ye(c.id);if(!u){ne(`Bundling ${o+1}/${h.length}…`);continue}ne(`Bundling ${o+1}/${h.length}…`);const g=u.filename.replace(/\.chordpro$/i,"");if(_[g])try{const w=await fetch(be(`pptx/${g}.pptx`));if(!w.ok)continue;const $=await w.blob();l++,i.file(`${String(l).padStart(2,"0")}-${g}.pptx`,$)}catch{}}if(l>0){const o=await i.generateAsync({type:"blob"}),c=new Date().toISOString().slice(0,10).replace(/-/g,""),u=document.createElement("a");u.href=URL.createObjectURL(o),u.download=`setlist-pptx-${c}.zip`,u.click(),URL.revokeObjectURL(u.href)}else try{q&&q("No PPTX files found for selected songs")||alert("No PPTX files found for selected songs")}catch{}ne("")}async function ct(){if(!(O||K)){fe("Combining…");try{const t=[],i=[];for(const l of h){const o=ye(l.id);if(!o)continue;const c=o.filename.replace(/\.chordpro$/i,"");if(!_[c]){i.push(o.title||c);continue}t.push(o)}if(!t.length){try{q&&q("No PPTX files found for selected songs")||alert("No PPTX files found for selected songs")}catch{}return}if(i.length){const l=i.length===1?`${i[0]} PPT file unavailable`:`${i.length} songs missing PPT files`;try{q?.(l)}catch{}}await Yn({name:j||"Setlist",songs:t},{})}catch(t){console.error(t);try{q&&q("Failed to combine PPTX files")||alert("Failed to combine PPTX files")}catch{}}finally{fe("")}}}return n.jsxs(vn,{className:"is-setlist",children:[kt?n.jsx("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,.45)",zIndex:90},role:"dialog","aria-modal":"true",children:n.jsxs("div",{style:{background:"var(--card)",color:"var(--text)",border:"1px solid var(--line)",borderRadius:10,padding:16,width:"min(560px, 92vw)"},children:[n.jsx("h3",{style:{marginTop:0,marginBottom:8},children:"Load Set"}),Y.length?n.jsxs("label",{style:{display:"block",margin:"8px 0"},children:["Select a saved set",n.jsx("select",{value:Ge,onChange:t=>Ze(t.target.value),style:{width:"100%"},children:Y.map(t=>n.jsxs("option",{value:t.id,children:[t.name," · ",new Date(t.updatedAt).toLocaleString()]},t.id))})]}):n.jsx("div",{className:"meta",children:"No saved sets yet."}),n.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:8,marginTop:12},children:[n.jsx(E,{onClick:()=>Ee(!1),children:"Cancel"}),n.jsx(E,{variant:"primary",onClick:Ft,disabled:!Y.length,children:"Load"})]})]})}):null,Be?n.jsx("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,.45)",zIndex:90},role:"dialog","aria-modal":"true",children:n.jsxs("div",{style:{background:"var(--card)",color:"var(--text)",border:"1px solid var(--line)",borderRadius:10,padding:16,width:"min(560px, 92vw)"},children:[n.jsx("h3",{style:{marginTop:0,marginBottom:8},children:"Add Verse"}),n.jsx("div",{className:"gc-field",style:{margin:"8px 0"},children:n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 140px",gap:8,alignItems:"center"},children:[n.jsx("label",{className:"gc-label",htmlFor:"verse-input",children:"Bible verse"}),n.jsx("label",{className:"gc-label",htmlFor:"verse-translation",children:"Translation"}),n.jsxs("div",{style:{position:"relative"},children:[(()=>{const t=Ye(ae,Ue);return t?n.jsxs("div",{"aria-hidden":!0,style:{position:"absolute",inset:0,padding:"10px 12px",fontFamily:"var(--gc-font-family)",color:"var(--gc-text-secondary)",lineHeight:"normal",whiteSpace:"pre",overflow:"hidden",textOverflow:"ellipsis",pointerEvents:"none"},children:[n.jsx("span",{style:{visibility:"hidden"},children:t.prefix}),n.jsx("span",{children:t.remainder})]}):null})(),n.jsx("input",{id:"verse-input",value:ae,onChange:t=>{_e(t.target.value),Ke&&ge("")},placeholder:"John 3:16",onKeyDown:t=>{if(t.key==="Tab"&&Ye(ae,Ue)){t.preventDefault(),zt();return}t.key==="Enter"&&(t.preventDefault(),tt(ae))},className:"gc-input",style:{width:"100%",background:"transparent",position:"relative",zIndex:1,lineHeight:"normal"}})]}),n.jsx("span",{className:"gc-select",style:{width:"100%"},children:n.jsx("select",{id:"verse-translation",disabled:!0,style:{width:"100%"},children:n.jsx("option",{children:"ESV"})})})]})}),Ke?n.jsx("div",{className:"meta",style:{color:"var(--gc-danger)",marginTop:6},children:Ke}):null,n.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:8,marginTop:12},children:[n.jsx(E,{onClick:()=>{Oe(!1),ge("")},children:"Cancel"}),n.jsx(E,{variant:"primary",onClick:()=>tt(ae),children:"Add Verse"})]})]})}):null,n.jsx(on,{busy:V}),n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:12,marginBottom:4},children:[n.jsx("div",{}),n.jsx("h1",{style:{margin:0},children:"Setlist Builder"}),n.jsx("div",{})]}),Re?n.jsx(pt,{className:"card",style:{marginTop:8,position:"static"},children:n.jsxs("div",{className:"setlist-actions--mobile",style:{width:"100%"},children:[n.jsx(E,{variant:"primary",onClick:at,onMouseEnter:Me,onFocus:Me,disabled:V||h.length===0,title:"Export set as a single PDF",iconLeft:n.jsx(xe,{}),children:"PDF"}),n.jsx(E,{onClick:ct,disabled:h.length===0||!!O||!!K,title:h.length===0?"Add songs to combine PPTX files":"Combine PPTX files into a single presentation",iconLeft:n.jsx(xe,{}),children:K||"Export PPT"}),n.jsx(E,{onClick:lt,disabled:h.length===0||!!O||!!K,title:h.length===0?"Add songs to export PPTX bundle":"Export PPTX bundle (ZIP) for selected songs",iconLeft:n.jsx(xe,{}),children:"PPT ZIP"}),n.jsx(E,{onClick:ot,title:"Copy shareable link",iconLeft:n.jsx(mt,{}),disabled:h.length===0,children:"Share"}),n.jsx(E,{as:ht,to:h.length?`/worship/${h.map(t=>encodeURIComponent(t.id)).join(",")}?toKeys=${h.map(t=>encodeURIComponent(t.toKey||"")).join(",")}`:"/worship",title:"Open Worship Mode",iconLeft:n.jsx(gt,{}),children:"Worship"})]})}):n.jsxs(pt,{className:"card",style:{marginTop:8,position:"static"},children:[n.jsx("div",{style:{width:"100%",marginBottom:6},children:n.jsx("strong",{title:"Current set name",children:j||"New Setlist"})}),n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap",width:"100%"},children:[n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[n.jsxs(E,{size:"sm",variant:"secondary",onClick:Ut,title:"Save set",iconLeft:n.jsx(ln,{}),children:[" ",n.jsx("span",{className:"text-when-wide",children:"Save"})]}),n.jsxs(E,{size:"sm",variant:"secondary",onClick:Xt,title:"Load saved set",iconLeft:n.jsx(cn,{}),disabled:!Y.length,children:[" ",n.jsx("span",{className:"text-when-wide",children:"Load"})]}),n.jsxs(E,{size:"sm",variant:"secondary",onClick:it,title:"New set",iconLeft:n.jsx(Xe,{}),children:[" ",n.jsx("span",{className:"text-when-wide",children:"New"})]}),n.jsxs(E,{size:"sm",variant:"secondary",onClick:Wt,disabled:!L,title:"Delete set",iconLeft:n.jsx(dn,{}),children:[" ",n.jsx("span",{className:"text-when-wide",children:"Delete"})]}),n.jsxs(E,{size:"sm",variant:"secondary",onClick:ot,title:"Copy shareable link",iconLeft:n.jsx(mt,{}),disabled:h.length===0,children:[" ",n.jsx("span",{className:"text-when-wide",children:"Share Set"})]})]}),n.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[n.jsx(E,{variant:"primary",size:"md",onClick:at,onMouseEnter:Me,onFocus:Me,disabled:V||h.length===0,title:"Export set as a single PDF",iconLeft:n.jsx(xe,{}),children:V?"Exporting…":n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"text-when-wide",children:"Export PDF"}),n.jsx("span",{className:"text-when-narrow",children:"PDF"})]})}),n.jsx(E,{variant:"primary",size:"md",onClick:ct,disabled:h.length===0||!!O||!!K,title:h.length===0?"Add songs to combine PPTX files":"Combine PPTX files into a single presentation",iconLeft:n.jsx(xe,{}),children:K||n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"text-when-wide",children:"Export PPT"}),n.jsx("span",{className:"text-when-narrow",children:"Export PPT"})]})}),n.jsx(E,{variant:"primary",size:"md",onClick:lt,disabled:h.length===0||!!O||!!K,title:h.length===0?"Add songs to export PPTX bundle":"Export PPTX bundle (ZIP) for selected songs",iconLeft:n.jsx(xe,{}),children:O||n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"text-when-wide",children:"PPT ZIP"}),n.jsx("span",{className:"text-when-narrow",children:"PPT ZIP"})]})}),n.jsxs(E,{variant:"primary",size:"md",as:ht,to:h.length?`/worship/${h.map(t=>encodeURIComponent(t.id)).join(",")}?toKeys=${h.map(t=>encodeURIComponent(t.toKey||"")).join(",")}`:"/worship",title:"Open Worship Mode",iconLeft:n.jsx(gt,{}),children:[" ",n.jsx("span",{className:"text-when-wide",children:"Worship Mode"}),n.jsx("span",{className:"text-when-narrow",children:"Worship"})]})]})]})]}),n.jsxs("div",{className:"BuilderPage",style:{marginTop:8},children:[n.jsx("div",{className:"BuilderLeft",children:n.jsx("section",{className:"setlist-section setlist-add","data-role":"add",children:n.jsxs("div",{className:"card setlist-pane",children:[n.jsxs("div",{className:["BuilderHeader","section-header",z?"no-sticky":""].filter(Boolean).join(" "),style:{display:"flex",alignItems:"center",gap:8},children:[n.jsx("strong",{style:{whiteSpace:"nowrap"},children:"Add songs"}),n.jsx(un,{value:A,onChange:t=>D(t.target.value),placeholder:"Search...",style:{flex:1,minWidth:0}}),n.jsxs("label",{className:"row",style:{gap:6,alignItems:"center"},children:[n.jsx("input",{type:"checkbox",checked:I,onChange:t=>B(t.target.checked)}),n.jsx("span",{className:"meta",title:"Limit results to songs tagged ICP",children:"ICP only"})]})]}),p.length>0?n.jsxs("div",{className:["BuilderHeader","section-header",z?"no-sticky":""].filter(Boolean).join(" "),style:{paddingTop:0,display:"flex",alignItems:"center",gap:8},children:[n.jsx("span",{className:"meta",children:"Language"}),n.jsx("div",{className:"tagbar",children:p.map(t=>n.jsx(fn,{variant:"filter",selected:m===t,onClick:()=>S(t),title:`Use ${yt(t)} where available`,children:yt(t)},t))})]}):null,n.jsx("div",{className:["BuilderScroll","setlist-scroll","setlist-list",z?"no-pane-scroll":"pane-scroll","pane--addSongs"].join(" "),children:Fe?n.jsx("div",{style:{display:"grid",gap:".5rem",gridTemplateColumns:"repeat(auto-fill, minmax(320px, 1fr))",marginTop:6},children:Ot.map(t=>n.jsx(We,{title:t.title,subtitle:`${t.originalKey||""}${t.tags?.length?` • ${t.tags.join(", ")}`:""}`,rightSlot:n.jsx(E,{"aria-label":"Add",title:"Add to set",variant:"primary",iconLeft:n.jsx(Xe,{}),iconOnly:!0,onClick:i=>{i.stopPropagation(),et(t)}}),onClick:()=>et(t)},t.id))}):n.jsx("div",{children:"Loading search…"})})]})})}),n.jsx("div",{className:"BuilderRight",style:{minHeight:0,display:"flex",flexDirection:"column"},children:n.jsxs("section",{className:"setlist-section setlist-current","data-role":"current",children:[n.jsxs("div",{className:"card setlist-pane",children:[n.jsxs("div",{className:["BuilderHeader","section-header",z?"no-sticky":""].filter(Boolean).join(" "),style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8},children:[n.jsxs("strong",{children:["Current setlist (",h.length,")"]}),n.jsx(E,{size:"sm",variant:"secondary",onClick:()=>{Oe(!0),ge("")},iconLeft:n.jsx(Xe,{}),children:"Add Verse"})]}),n.jsx("div",{className:["BuilderScroll","setlist-scroll","setlist-list",z?"no-pane-scroll":"pane-scroll","pane--currentSet"].join(" "),style:{marginTop:6},children:h.map((t,i)=>{if(Ve(t.id)){const u=ze(t.id)?.refDisplay||t.id;return n.jsx(We,{draggable:!0,onDragStart:g=>{g.dataTransfer.setData("text/plain",String(t.uid||t.id)),g.dataTransfer.effectAllowed="move"},onDragOver:g=>{g.preventDefault(),g.dataTransfer.dropEffect="move"},onDrop:g=>{g.preventDefault();const w=g.dataTransfer.getData("text/plain");st(w,i)},title:u,subtitle:"ESV",rightSlot:n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[n.jsx(E,{onClick:()=>Ce(t.uid,"up"),title:"Move up",iconLeft:n.jsx(xt,{})}),n.jsx(E,{onClick:()=>Ce(t.uid,"down"),title:"Move down",iconLeft:n.jsx(wt,{})}),n.jsx(E,{onClick:()=>nt(t.uid),title:"Remove",iconLeft:n.jsx(bt,{}),iconOnly:!0,style:{color:"#b91c1c"}})]})},t.uid||`${t.id}-${i}`)}const o=ye(t.id);return o?n.jsx(We,{draggable:!0,onDragStart:c=>{c.dataTransfer.setData("text/plain",String(t.uid||t.id)),c.dataTransfer.effectAllowed="move"},onDragOver:c=>{c.preventDefault(),c.dataTransfer.dropEffect="move"},onDrop:c=>{c.preventDefault();const u=c.dataTransfer.getData("text/plain");st(u,i)},title:o.title,subtitle:`Original: ${o.originalKey||"—"}`,rightSlot:n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[n.jsx(pn,{variant:"ui",baseKey:o.originalKey||"C",valueKey:t.toKey||o.originalKey||"C",onChange:c=>Kt(t.uid,c)}),n.jsx(E,{onClick:()=>Ce(t.uid,"up"),title:"Move up",iconLeft:n.jsx(xt,{})}),n.jsx(E,{onClick:()=>Ce(t.uid,"down"),title:"Move down",iconLeft:n.jsx(wt,{})}),n.jsx(E,{onClick:()=>nt(t.uid),title:"Remove",iconLeft:n.jsx(bt,{}),iconOnly:!0,style:{color:"#b91c1c"}})]})},t.uid||`${t.id}-${i}`):null})})]}),n.jsxs("div",{className:"print-only",style:{marginTop:16},children:[n.jsx("h2",{style:{fontSize:"20pt",margin:"0 0 8pt 0"},children:j}),n.jsx("ol",{style:{fontSize:"12pt",lineHeight:1.4,paddingLeft:"1.2em"},children:h.map((t,i)=>{if(Ve(t.id)){const o=ze(t.id);return n.jsx("li",{children:o?.refDisplay||t.id},t.uid||`${t.id}-${i}`)}const l=ye(t.id);return l?n.jsxs("li",{children:[l.title," — ",t.toKey||l.originalKey||"—"]},t.uid||`${t.id}-${i}`):null})})]})]})})]})]})}export{Gn as default};
