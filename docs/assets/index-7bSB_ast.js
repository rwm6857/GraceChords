const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./jspdf.es.min-voj3xho5.js","./index-CH1NwEcj.js","./index-Wri8gDRg.css"])))=>i.map(i=>d[i]);
import{_ as L}from"./index-CH1NwEcj.js";import{e as b}from"./fonts-OQpvcT7Z.js";import{n as H,c as D,m as M,D as $,a as G}from"./pdfLayout-B8r8HOIC.js";import{p as V}from"./pdfLayout-B8r8HOIC.js";const I=typeof window<"u"&&(()=>{try{return localStorage.getItem("pdfDebug")==="1"}catch{return!1}})();async function _(){const{jsPDF:a}=await L(async()=>{const{jsPDF:e}=await import("./jspdf.es.min-voj3xho5.js").then(t=>t.j);return{jsPDF:e}},__vite__mapDeps([0,1,2]),import.meta.url);return new a({unit:"pt",format:"letter"})}function E(a,e,t){var y;const o=a.internal.pageSize.getWidth(),s=a.internal.pageSize.getHeight(),i={...$,...t,pageWidth:o,pageHeight:s};(y=e==null?void 0:e.meta)!=null&&y.capo&&(t==null?void 0:t.showCapo)!==!1&&(i.headerOffsetY=(i.headerOffsetY||$.headerOffsetY)+14);const l=M(a,i.lyricFamily,"normal"),m=M(a,i.chordFamily,"bold");return D(e,i,l,m)}function v(a,e,{title:t,key:o,capo:s,showCapo:i=!0}){const l=String(e.lyricFamily||"Helvetica"),m=String(e.chordFamily||"Courier"),y=a.internal.pageSize.getWidth(),d=a.internal.pageSize.getHeight(),c=e.margin,f=Math.max(22,e.lyricSizePt+6),g=Math.max(12,e.lyricSizePt-2),W=4,T=e.lyricSizePt,k=Math.round(e.lyricSizePt*.85),r=c+e.headerOffsetY,u=y-c*2,F=e.columns===2?(u-e.gutter)/2:u;e.layout.pages.forEach((C,w)=>{if(w>0&&a.addPage(),a.setFont(l,"bold"),a.setFontSize(f),a.text(t,c,c+24),a.setFont(l,"italic"),a.setFontSize(g),a.text(`Key: ${o||"—"}`,c,c+40),i&&typeof s=="number"&&a.text(`Capo: ${s}`,c,c+54),I){a.setDrawColor(180),a.rect(c,r,F,d-c-r),e.columns===2&&a.rect(c+F+e.gutter,r,F,d-c-r);const P=e.layout.pages[0];let S="";if(P){const n=G(P,e.lyricSizePt),x=d-c-r;let h=(n[0]||0)/x,z=1;e.columns===2&&(h=((n[0]||0)+(n[1]||0))/(2*x),z=1-Math.abs((n[0]||0)-(n[1]||0))/x),S=` • occ=${h.toFixed(2)} • bal=${z.toFixed(2)}`}a.setFont(l,"normal"),a.setFontSize(9),a.text(`Plan: ${e.columns} col • size ${e.lyricSizePt}pt • singlePage=${e.layout.pages.length===1?"yes":"no"}${S}`,c,d-c*.6)}C.columns.forEach(P=>{var x;let S=P.x,n=r;for(const h of P.blocks)if(h.type==="section")n+=k,a.setFont(l,"bold"),a.setFontSize(T),a.text(`[${h.header}]`,S,n),n+=T+4;else if(h.type==="line")if(h.comment){const z=Math.max(10,e.lyricSizePt-2);a.setFont(l,"italic"),a.setFontSize(z),a.setTextColor(120),a.text(h.comment,S,n),a.setTextColor(0),n+=z+3}else{if((x=h.chords)!=null&&x.length){a.setFont(m,"bold"),a.setFontSize(e.chordSizePt);for(const z of h.chords)a.text(z.sym,S+z.x,n);n+=e.chordSizePt+W/2}a.setFont(l,"normal"),a.setFontSize(e.lyricSizePt),a.text(h.lyrics,S,n),n+=e.lyricSizePt+W}})})}async function O(a,e={}){const t=await _();let o={};try{o=await b(t)}catch{}const s={lyricFamily:o.lyricFamily||e.lyricFamily||"Helvetica",chordFamily:o.chordFamily||e.chordFamily||"Courier",...e},i=t.internal.pageSize.getWidth(),l=t.internal.pageSize.getHeight(),m=f=>g=>g?g.length*(f*.6):0,y=f=>g=>{try{return t.setFont(s.lyricFamily,"normal"),t.setFontSize(f),t.getTextWidth(g||"")}catch{return m(f)(g)}},d=f=>g=>{try{return t.setFont(s.chordFamily,"bold"),t.setFontSize(f),t.getTextWidth(g||"")}catch{return m(f)(g)}},c=H(a);return D(c,{...s,pageWidth:i,pageHeight:l},y,d)}async function j(a,e){var d;const t=await _();let o={};try{o=await b(t)}catch{}const s={lyricSizePt:Math.max(12,(e==null?void 0:e.lyricSizePt)||16),chordSizePt:Math.max(12,(e==null?void 0:e.chordSizePt)||16),margin:36,lyricFamily:o.lyricFamily||"Helvetica",chordFamily:o.chordFamily||"Courier",columns:(e==null?void 0:e.columns)===2?2:1,showCapo:e==null?void 0:e.showCapo},i=H(a),{plan:l}=E(t,i,s),m=a.title||i.title||"Untitled",y=a.key||i.key||"C";return v(t,l,{title:m,key:y,capo:(d=i.meta)==null?void 0:d.capo,showCapo:(e==null?void 0:e.showCapo)!==!1}),t.setProperties({title:`${m} – GraceChords`}),t.save(`${m.replace(/\s+/g,"_")}.pdf`),{plan:l}}async function U(a,e={}){const t=await _();let o={};try{o=await b(t)}catch{}const s={lyricSizePt:Math.max(12,(e==null?void 0:e.lyricSizePt)||16),chordSizePt:Math.max(12,(e==null?void 0:e.chordSizePt)||16),margin:36,lyricFamily:o.lyricFamily||"Helvetica",chordFamily:o.chordFamily||"Courier",columns:(e==null?void 0:e.columns)===2?2:1,showCapo:e==null?void 0:e.showCapo},i=!!(e!=null&&e.includeTOC),l=e==null?void 0:e.coverImageDataUrl,m=a.map((r,u)=>{var n;const F=H(r),{plan:C}=E(t,F,s),w=r.title||F.title||"Untitled",P=r.key||F.key||"C",S=(n=F.meta)==null?void 0:n.capo;return{raw:r,plan:C,title:w,key:P,capo:S,num:r._songbookNum||u+1,origTitle:r._origTitle||w}}),y=t.internal.pageSize.getWidth(),d=t.internal.pageSize.getHeight(),c=s.margin,f=16,g=Math.floor((d-c*2-40)/f),W=i?Math.ceil(m.length/g):0;let T=1+(l?1:0)+W;const k=m.map(r=>{const u={num:r.num,title:r.origTitle,page:T};return T+=r.plan.layout.pages.length,u});if(l){try{t.addImage(l,"JPEG",0,0,y,d,void 0,"FAST")}catch{}(i||m.length)&&t.addPage()}if(i){t.setFont(s.lyricFamily,"bold"),t.setFontSize(24),t.text("Table of Contents",y/2,c+20,{align:"center"}),t.setFont(s.lyricFamily,"normal"),t.setFontSize(12);let r=c+40;k.forEach((u,F)=>{F>0&&F%g===0&&(t.addPage(),r=c);const C=`${u.num} ${u.title}`;t.text(C,c,r);const w=String(u.page),P=y-c,S=t.getTextWidth(C),n=t.getTextWidth(w),x=P-c-S-n-4;if(x>0){const h=t.getTextWidth("."),z=".".repeat(Math.max(0,Math.floor(x/h)));t.text(z,c+S+2,r)}t.text(w,P,r,{align:"right"}),r+=f}),m.length&&t.addPage()}m.forEach((r,u)=>{u>0&&t.addPage(),v(t,r.plan,{title:r.title,key:r.key,capo:r.capo,showCapo:(e==null?void 0:e.showCapo)!==!1})}),t.setProperties({title:(e==null?void 0:e.docTitle)||"GraceChords Setlist"}),t.save((e==null?void 0:e.fileName)||"GraceChords_Selection.pdf")}async function K(a,{includeTOC:e,coverImageDataUrl:t}={}){const o=a.map((i,l)=>({...i,title:`${l+1}. ${i.title}`,_songbookNum:l+1,_origTitle:i.title})),s=new Date().toISOString().slice(0,10).replace(/-/g,"");await U(o,{includeTOC:e,coverImageDataUrl:t,docTitle:"GraceChords Songbook",fileName:`songbook-${s}.pdf`})}export{D as chooseBestLayout,O as chooseBestLayoutAuto,U as downloadMultiSongPdf,j as downloadSingleSongPdf,K as downloadSongbookPdf,H as normalizeSongInput,V as planSongLayout};
