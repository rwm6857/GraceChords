import{r as n,j as t,I as ge,B as m,z as L,v as he,P as R,h as pe,k as xe,C as fe,A as ye,f as je,l as V,m as Se,n as ve,o as be,q as we,w as Ce}from"./index-BGjortaf.js";import{m as ke,a as B,p as Te}from"./markdown-C16qQ7Y6.js";const Ie="10401040";function Ne(){const[g,h]=n.useState(!1),[f,C]=n.useState("");return g?t.jsx(Ae,{}):t.jsxs("div",{className:"container",style:{maxWidth:480},children:[t.jsx("h1",{children:"Admin: Resources"}),t.jsx("p",{children:"Enter password to continue."}),t.jsxs("form",{onSubmit:p=>{p.preventDefault(),h(f===Ie)},children:[t.jsx(ge,{id:"adminPw",type:"password",value:f,onChange:p=>C(p.target.value),placeholder:"Password"}),t.jsx("div",{style:{marginTop:8,display:"flex",justifyContent:"flex-end"},children:t.jsx(m,{variant:"primary",type:"submit",children:"Enter"})})]})]})}function Ae({actions:g,onDraftChange:h,showGhTools:f=!0,heading:C="Admin: Resources",wrapInContainer:p=!0,panelize:q=!1,prefill:o=null}){const[y]=n.useState(()=>(L?.items||[]).slice().sort((e,s)=>(s.date||"").localeCompare(e.date||""))),[j,S]=n.useState(""),[a,c]=n.useState({title:"",author:"",date:new Date().toISOString().slice(0,10),tags:[],summary:""}),[d,k]=n.useState(""),[x,J]=n.useState(()=>{try{return localStorage.getItem("admin:editsAuthor")||""}catch{return""}});n.useEffect(()=>{try{localStorage.setItem("admin:editsAuthor",x||"")}catch{}},[x]);function v(){S(""),c({title:"",author:"",date:new Date().toISOString().slice(0,10),tags:[],summary:""}),k("")}async function O(e){if(!e)return;const i=`${"./".replace(/\/+$/,"")+"/"}resources/${e.slug}.md`,r=await je(i),l=Te(r);S(e.slug),c({title:String(l.meta.title||e.title||""),author:String(l.meta.author||e.author||""),date:String(l.meta.date||e.date||new Date().toISOString().slice(0,10)),tags:Array.isArray(l.meta.tags)?l.meta.tags:[],summary:String(l.meta.summary||e.summary||"")}),k(l.content||"")}function Y(e){c(s=>({...s,title:e})),j||S(B(e))}function Q(e){c(s=>({...s,author:e}))}function X(e){c(s=>({...s,date:e}))}function Z(e){const s=String(e||"").split(/[,;]/).map(i=>i.trim()).filter(Boolean);c(i=>({...i,tags:s}))}function ee(e){c(s=>({...s,summary:e}))}const te=n.useMemo(()=>ke(d),[d]),[T,M]=n.useState([]),[se,I]=n.useState(!1),[ae,_]=n.useState(!1),[W,ne]=n.useState("main"),[D,N]=n.useState(null),[F,b]=n.useState(!1);n.useEffect(()=>{b(!1)},[o?.slug,o?.kind]);function H(e=a,s=d){return["---",`title: "${(e.title||"").replace(/"/g,'\\"')}"`,`author: "${(e.author||"").replace(/"/g,'\\"')}"`,`date: "${e.date||""}"`,`tags: ${JSON.stringify(e.tags||[])} `,`summary: "${(e.summary||"").replace(/"/g,'\\"')}"`,"---",""].join(`
`)+(s||"")}function A(){const e=j||B(a.title||"untitled"),s=`${e}.md`,i=H(),r={filename:s,content:i,title:a.title,commitMsg:`${L?.items?.some(l=>l.slug===e)?"update":"add"}: ${s}`};M([r])}async function le(){try{const{default_branch:e}=await V({owner:"rwm6857",repo:"GraceChords"});if(ne(e||"main"),!String(x||"").trim()){alert("Please enter your name in the Edits Author field before submitting.");return}T.length||A(),I(!0)}catch(e){alert(String(e?.message||e))}}async function ie({branchName:e,prTitle:s,prBody:i}){_(!0);try{const r="rwm6857",l="GraceChords",{sha:oe}=await V({owner:r,repo:l});await Se({owner:r,repo:l,fromSha:oe,newBranch:e});for(const u of T){const K=`public/resources/${u.filename}`,ue=await ve({owner:r,repo:l,path:K,ref:e}),me=u.commitMsg&&u.commitMsg.trim()?u.commitMsg.trim():`add: ${u.filename}`;await be({owner:r,repo:l,branch:e,path:K,contentBase64:we(u.content),message:me,sha:ue})}const ce=`${i||""}${i?`

`:""}Submitted by: ${String(x||"").trim()}`,de=await Ce({owner:r,repo:l,head:e,base:W,title:s,body:ce});window.open(de.html_url,"_blank","noopener"),M([]),I(!1)}finally{_(!1)}}const w=j||B(a.title||"untitled"),$=`${w}.md`,G=H(),U=y.some(e=>e.slug===w),P=n.useMemo(()=>({slug:w,filename:$,meta:a,body:d,content:G,isExisting:U}),[w,$,a,d,G,U]);n.useEffect(()=>{typeof h=="function"&&h(P)},[P,h]),n.useEffect(()=>{if(!F&&o){if(o.kind==="existing"&&o.slug){const e=y.find(s=>s.slug===o.slug);if(e){O(e),b(!0);return}b(!0);return}o.kind==="new"&&(v(),b(!0))}},[o,F,y]);const re=typeof g=="function"?g({draft:P,newPost:v}):g,E=q?"gc-editor-panel":"card",z=t.jsxs(t.Fragment,{children:[t.jsx("h1",{children:C}),f&&t.jsx("div",{className:E,style:{marginTop:12},children:t.jsxs("div",{className:"Row",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[t.jsx("strong",{children:"GitHub:"}),t.jsxs("span",{children:["Token: ",D?`@${D.login}`:localStorage.getItem("ghToken")?"set":"not set"]}),t.jsx("button",{className:"btn",onClick:()=>{const e=prompt("Paste GitHub token (repo scope):","");e!==null&&localStorage.setItem("ghToken",e.trim())},children:"Set token"}),t.jsx("button",{className:"btn",onClick:()=>{localStorage.removeItem("ghToken"),N(null)},children:"Clear token"}),t.jsx("button",{className:"btn",onClick:async()=>{try{const e=await he();N(e),alert(`Token OK: ${e.login}`)}catch(e){N(null),alert(String(e?.message||e))}},children:"Validate"}),t.jsx("div",{className:"spacer"}),t.jsxs("label",{className:"Small",style:{display:"flex",alignItems:"center",gap:6},children:[t.jsxs("span",{children:["Edits Author ",t.jsx("span",{"aria-hidden":!0,style:{color:"#ef4444"},children:"*"})]}),t.jsx("input",{value:x,onChange:e=>J(e.target.value),placeholder:"Your name",style:{minWidth:180}})]})]})}),t.jsxs("div",{className:E,style:{marginTop:12},children:[t.jsx("strong",{children:"Existing posts"}),t.jsxs("div",{className:"Row Small",style:{marginTop:6,gap:8,flexWrap:"wrap"},children:[y.map(e=>t.jsx("button",{className:"gc-btn gc-btn--sm",onClick:()=>O(e),title:`Edit ${e.title}`,children:e.title},e.slug)),t.jsx("span",{className:"spacer"}),t.jsx(m,{onClick:v,iconLeft:t.jsx(R,{}),children:"New Post"})]})]}),t.jsxs("div",{className:E,style:{marginTop:12},children:[t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[t.jsxs("label",{children:["Title",t.jsx("input",{value:a.title,onChange:e=>Y(e.target.value)})]}),t.jsxs("label",{children:["Author",t.jsx("input",{value:a.author,onChange:e=>Q(e.target.value)})]}),t.jsxs("label",{children:["Date",t.jsx("input",{type:"date",value:a.date,onChange:e=>X(e.target.value)})]}),t.jsxs("label",{children:["Tags (comma-separated)",t.jsx("input",{value:(a.tags||[]).join(", "),onChange:e=>Z(e.target.value),placeholder:"leadership, vocals"})]}),t.jsxs("label",{children:["Summary",t.jsx("input",{value:a.summary,onChange:e=>ee(e.target.value)})]}),t.jsxs("label",{children:["Slug",t.jsx("input",{value:j,onChange:e=>S(e.target.value),placeholder:"auto from title"})]})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginTop:10},children:[t.jsxs("div",{children:[t.jsx("div",{className:"Row Small",style:{justifyContent:"space-between"},children:t.jsx("strong",{children:"Content (Markdown)"})}),t.jsx("textarea",{value:d,onChange:e=>k(e.target.value),style:{width:"100%",minHeight:"50vh",fontFamily:'"Roboto Mono", ui-monospace, Menlo, Consolas, monospace'}})]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Preview"}),t.jsxs("div",{className:"card",style:{minHeight:"50vh",overflow:"auto",padding:10},children:[t.jsxs("div",{className:"Small",style:{opacity:.9,marginBottom:6},children:[a.title?t.jsx("div",{children:t.jsx("strong",{children:a.title})}):null,t.jsxs("div",{children:["by ",a.author||"—"," • ",a.date||"—"]}),a.tags?.length?t.jsx("div",{className:"Small",style:{display:"flex",gap:6,flexWrap:"wrap",marginTop:4},children:a.tags.map(e=>t.jsx("span",{className:"gc-tag gc-tag--gray",children:e},e))}):null,a.summary?t.jsx("div",{style:{marginTop:4},children:a.summary}):null]}),t.jsx("div",{className:"PostBody",dangerouslySetInnerHTML:{__html:te}})]})]})]})]}),re||t.jsxs(pe,{style:{position:"sticky",bottom:0,marginTop:12,display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[t.jsxs(m,{onClick:v,children:[t.jsx(R,{})," New"]}),t.jsxs(m,{onClick:A,children:[t.jsx(xe,{})," Validate"]}),t.jsxs(m,{onClick:A,children:[t.jsx(R,{})," Stage"]})]}),t.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,minWidth:0},children:t.jsxs("label",{className:"Small",style:{display:"flex",alignItems:"center",gap:6},children:[t.jsx("span",{children:"Filename"}),t.jsx("input",{readOnly:!0,value:$,style:{width:320}})]})}),t.jsx("div",{style:{display:"flex",gap:8,alignItems:"center"},children:t.jsxs(m,{className:"gc-btn gc-btn--primary",onClick:le,children:[t.jsx(fe,{})," Publish"]})})]}),t.jsx(ye,{open:se,onClose:()=>I(!1),defaultBranch:W,staged:T,onCreate:ie,busy:ae})]});return p?t.jsx("div",{className:"container",style:{maxWidth:1100},children:z}):z}const Ee=Object.freeze(Object.defineProperty({__proto__:null,default:Ne},Symbol.toStringTag,{value:"Module"}));export{Ee as A,Ae as R};
