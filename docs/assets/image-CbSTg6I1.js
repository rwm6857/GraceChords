import{chooseBestLayout as T}from"./pdfLayout-DIcZ0WB0.js";import{a as M}from"./fonts-OQpvcT7Z.js";import"./index-Dni1_X47.js";function w(t,{pxWidth:n,pxHeight:a,dpi:x=150}){const r=document.createElement("canvas");r.width=n,r.height=a;const e=r.getContext("2d");e.fillStyle="#fff",e.fillRect(0,0,r.width,r.height);const d=x/72;e.scale(d,d);const s=t.margin,f=Math.max(22,t.lyricSizePt+6),y=Math.max(12,t.lyricSizePt-2);e.fillStyle="#000",e.font=`bold ${f}px ${t.lyricFamily}`,e.fillText(t.title,s,s+24),e.font=`italic ${y}px ${t.lyricFamily}`,e.fillText(`Key: ${t.key||"â€”"}`,s,s+40);const o=4,m=t.lyricSizePt,l=Math.round(t.lyricSizePt*.85),g=s+t.headerOffsetY;return(t.layout.pages||[])[0].columns.forEach($=>{let u=$.x,c=g;$.blocks.forEach(i=>{var S;i.type==="section"?(c+=l,e.font=`bold ${m}px ${t.lyricFamily}`,e.fillText(`[${i.header}]`,u,c),c+=m+4):i.type==="line"&&((S=i.chords)!=null&&S.length&&(e.font=`bold ${t.chordSizePt}px ${t.chordFamily}`,i.chords.forEach(P=>e.fillText(P.sym,u+P.x,c)),c+=t.chordSizePt+o/2),e.font=`normal ${t.lyricSizePt}px ${t.lyricFamily}`,e.fillText(i.lyrics,u,c),c+=t.lyricSizePt+o)})}),r}async function C(t,n={}){const a=n.dpi||150,x=n.widthInches||8.5,r=n.heightInches||11,e=Math.round(x*a),d=Math.round(r*a),s=await M(),{lyricFamily:f,chordFamily:y}=s;let o=n.plan;if(!o){const h=document.createElement("canvas").getContext("2d");o=T(t,{lyricFamily:f,chordFamily:y},c=>i=>(h.font=`${c}px ${f}`,h.measureText(i||"").width),c=>i=>(h.font=`bold ${c}px ${y}`,h.measureText(i||"").width)).plan}if(o.layout.pages.length>1)return{error:"MULTI_PAGE",plan:o};const m=w(o,{pxWidth:e,pxHeight:d,dpi:a}),l=document.createElement("a"),g=(n.slug||t.slug||t.title||"untitled").replace(/\s+/g,"_");return l.href=m.toDataURL("image/jpeg",.92),l.download=`${g}.jpg`,l.click(),{plan:o}}export{C as downloadSingleSongJpg,M as ensureCanvasFonts,w as renderPlanToCanvas};
