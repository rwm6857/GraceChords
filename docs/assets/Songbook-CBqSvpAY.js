const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./pdf-CmbbPwDZ.js","./index-Crd0mHyz.js","./index-B-kUmedf.css","./fonts-OQpvcT7Z.js","./pdfLayout-BuE93-3l.js"])))=>i.map(i=>d[i]);
import{r as i,i as G,j as t,B as J,S as Q,_ as X,f as Y,p as Z,b as v}from"./index-Crd0mHyz.js";let P;const R=()=>P||(P=X(()=>import("./pdf-CmbbPwDZ.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url));function b(a,o){return((a==null?void 0:a.title)||"").localeCompare((o==null?void 0:o.title)||"",void 0,{sensitivity:"base"})}function S(a){return[...new Set(a.filter(Boolean))].sort((o,f)=>String(o).localeCompare(String(f),void 0,{sensitivity:"base"}))}function te(){const a=i.useMemo(()=>{var e;return(((e=G)==null?void 0:e.items)||[]).slice().sort(b)},[]),[o,f]=i.useState(""),[u,E]=i.useState("All"),[g,I]=i.useState("All"),[h,M]=i.useState("All"),_=i.useMemo(()=>S(a.flatMap(e=>Array.isArray(e.tags)?e.tags:e.tags?[e.tags]:[])),[a]),D=i.useMemo(()=>S(a.map(e=>e.country).filter(Boolean)),[a]),$=i.useMemo(()=>S(a.flatMap(e=>Array.isArray(e.authors)?e.authors:e.authors?[e.authors]:[])),[a]),c=i.useMemo(()=>{const e=o.trim().toLowerCase();let l=a;return e&&(l=l.filter(s=>{const r=(s.title||"").toLowerCase(),m=(Array.isArray(s.authors)?s.authors.join(", "):s.authors||"").toLowerCase();return r.includes(e)||m.includes(e)})),u!=="All"&&(l=l.filter(s=>Array.isArray(s.tags)?s.tags.includes(u):s.tags===u)),g!=="All"&&(l=l.filter(s=>s.country===g)),h!=="All"&&(l=l.filter(s=>Array.isArray(s.authors)?s.authors.includes(h):s.authors===h)),l.slice().sort(b)},[a,o,u,g,h]),[x,j]=i.useState(()=>new Set),d=i.useMemo(()=>c.filter(e=>x.has(e.id)).slice().sort(b),[c,x]),N=c.length,C=x.size;function A(e,l){j(s=>{const r=new Set(s);return l?r.add(e):r.delete(e),r})}function O(){c.length&&j(e=>{const l=new Set(e);for(const s of c)l.add(s.id);return l})}function W(){j(new Set)}const[k,q]=i.useState(!0),[z,p]=i.useState(null),[y,w]=i.useState(!1);async function H(){if(d.length){w(!0);try{const{downloadSongbookPdf:e}=await R(),l=[];for(const s of d)try{const r=`./songs/${s.filename}`,m=await Y(r),n=Z(m),K=n.blocks.map(B=>({section:B.section,lines:(B.lines||[]).map(T=>({plain:T.text,chordPositions:(T.chords||[]).map(L=>({sym:L.sym,index:L.index}))}))})),V=s.filename.replace(/\.chordpro$/,"");l.push({title:n.meta.title||s.title||V,key:n.meta.key||n.meta.originalkey||s.originalKey||"C",lyricsBlocks:K})}catch(r){console.error(r),v(`Failed to process ${s.filename}`)}l.length&&await e(l,{includeTOC:k,coverImageDataUrl:z})}finally{w(!1)}}}function F(){R()}function U(e){var r;const l=(r=e.target.files)==null?void 0:r[0];if(!l){p(null);return}if(l.size>2*1024*1024){v("Image must be under 2 MB"),e.target.value="",p(null);return}if(!l.type.startsWith("image/")){v("File must be an image"),e.target.value="",p(null);return}const s=new FileReader;s.onload=()=>p(String(s.result||"")),s.readAsDataURL(l)}return a.length===0?t.jsx("div",{className:"BuilderPage",children:t.jsx("section",{className:"BuilderLeft",children:t.jsxs("header",{className:"BuilderHeader",children:[t.jsx("h1",{children:"No songs found"}),t.jsx("p",{className:"Small",children:"The song index is empty or failed to load."})]})})}):t.jsxs("div",{className:"BuilderPage",children:[t.jsx(J,{busy:y}),t.jsxs("div",{className:"TopRow",children:[t.jsx("div",{className:"TopLeft"}),t.jsx("h1",{className:"TopTitle",children:"Songbook Builder"}),t.jsx("div",{className:"TopRight"})]}),t.jsx("div",{className:"card SongbookToolbar",children:t.jsxs("div",{className:"Row",style:{gap:"1rem",flexWrap:"wrap",alignItems:"center"},children:[t.jsxs("div",{className:"Field",children:[t.jsx("input",{id:"sb-toc",type:"checkbox",checked:k,onChange:e=>q(e.target.checked)}),t.jsx("label",{htmlFor:"sb-toc",children:"Include table of contents"})]}),t.jsxs("div",{className:"Field",children:[t.jsx("label",{htmlFor:"sb-cover",children:"Cover page (image):"}),t.jsx("input",{id:"sb-cover",className:"CoverInput",type:"file",accept:"image/*",onChange:U})]}),t.jsxs("div",{className:"Field",style:{marginLeft:"auto",gap:".5rem"},children:[t.jsxs("button",{className:"btn",onClick:O,disabled:!N,children:["Select all (",N," filtered)"]}),t.jsx("button",{className:"btn",onClick:W,disabled:!C,children:"Clear"}),t.jsx("button",{className:"btn primary",onClick:H,onMouseEnter:F,onFocus:F,disabled:!d.length||y,title:d.length?"Export PDF":"Select some songs first",children:y?"Exporting…":`Export PDF (${d.length})`})]})]})}),t.jsxs("section",{className:"BuilderLeft",children:[t.jsxs("header",{className:"BuilderHeader",children:[t.jsxs("div",{className:"Row",style:{gap:"1rem",alignItems:"flex-end",flexWrap:"wrap"},children:[t.jsxs("div",{className:"Field",style:{minWidth:220},children:[t.jsx("label",{htmlFor:"sb-search",children:"Search:"}),t.jsx("input",{id:"sb-search",type:"search",placeholder:"Title or author",value:o,onChange:e=>f(e.target.value),style:{width:"100%"}})]}),t.jsxs("div",{className:"Field",children:[t.jsx("label",{htmlFor:"sb-tag",children:"Tag:"}),t.jsxs("select",{id:"sb-tag",value:u,onChange:e=>E(e.target.value),children:[t.jsx("option",{children:"All"}),_.map(e=>t.jsx("option",{value:e,children:e},e))]})]}),t.jsxs("div",{className:"Field",children:[t.jsx("label",{htmlFor:"sb-country",children:"Country:"}),t.jsxs("select",{id:"sb-country",value:g,onChange:e=>I(e.target.value),children:[t.jsx("option",{children:"All"}),D.map(e=>t.jsx("option",{value:e,children:e},e))]})]}),t.jsxs("div",{className:"Field",children:[t.jsx("label",{htmlFor:"sb-author",children:"Author:"}),t.jsxs("select",{id:"sb-author",value:h,onChange:e=>M(e.target.value),children:[t.jsx("option",{children:"All"}),$.map(e=>t.jsx("option",{value:e,children:e},e))]})]})]}),t.jsxs("div",{className:"Row Small",style:{marginTop:".5rem"},children:[t.jsx("strong",{children:C})," selected"]})]}),t.jsx("div",{className:"BuilderScroll gc-scroll",role:"region","aria-label":"Song list",children:t.jsx("div",{className:"gc-list",children:c.map(e=>{const l=x.has(e.id),s=Array.isArray(e.authors)?e.authors.join(", "):e.authors||"",r=Array.isArray(e.tags)?e.tags:e.tags?String(e.tags).split(",").map(n=>n.trim()):[],m=[s||"—",e.country].filter(Boolean).join(" • ");return t.jsx(Q,{title:e.title,subtitle:m,tags:r,leftSlot:t.jsx("input",{type:"checkbox",checked:l,onChange:n=>A(e.id,n.target.checked),onClick:n=>n.stopPropagation(),"aria-label":`Select ${e.title}`}),onClick:()=>A(e.id,!l)},e.id)})})})]}),t.jsx("aside",{className:"BuilderRight",children:t.jsx("div",{className:"RightSection RightScroll",role:"region","aria-label":"Selected songs",children:t.jsx("ol",{className:"List",style:{listStyle:"decimal inside"},children:d.map(e=>t.jsxs("li",{children:[e.title,Array.isArray(e.authors)&&e.authors.length?t.jsxs("span",{className:"Small",children:[" — ",e.authors.join(", ")]}):null]},e.id))})})})]})}export{te as default};
