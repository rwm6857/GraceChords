const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./jspdf.es.min-B_XCfe1Y.js","./index-C7PgAHJF.js","./index-Wri8gDRg.css"])))=>i.map(i=>d[i]);
import{_ as E}from"./index-C7PgAHJF.js";import{e as _}from"./fonts-OQpvcT7Z.js";import{n as b,c as v,m as $,D as G}from"./pdfLayout-5U5Nker-.js";import{p as J}from"./pdfLayout-5U5Nker-.js";const L=typeof window<"u"&&(()=>{try{return localStorage.getItem("pdfDebug")==="1"}catch{return!1}})();async function W(){const{jsPDF:e}=await E(async()=>{const{jsPDF:t}=await import("./jspdf.es.min-B_XCfe1Y.js").then(a=>a.j);return{jsPDF:t}},__vite__mapDeps([0,1,2]),import.meta.url);return new e({unit:"pt",format:"letter"})}function C(e,t,a){const n=e.internal.pageSize.getWidth(),i=e.internal.pageSize.getHeight(),l={...G,...a,pageWidth:n,pageHeight:i},s=$(e,l.lyricFamily,"normal"),o=$(e,l.chordFamily,"bold");return v(t,l,s,o)}function D(e,t,{title:a,key:n}){const i=String(t.lyricFamily||"Helvetica"),l=String(t.chordFamily||"Courier"),s=e.internal.pageSize.getWidth(),o=e.internal.pageSize.getHeight(),c=t.margin,w=Math.max(22,t.lyricSizePt+6),y=Math.max(12,t.lyricSizePt-2),F=4,P=t.lyricSizePt,k=Math.round(t.lyricSizePt*.85),d=c+t.headerOffsetY,T=s-c*2,r=t.columns===2?(T-t.gutter)/2:T;t.layout.pages.forEach((g,u)=>{u>0&&e.addPage(),e.setFont(i,"bold"),e.setFontSize(w),e.text(a,c,c+24),e.setFont(i,"italic"),e.setFontSize(y),e.text(`Key: ${n||"—"}`,c,c+40),L&&(e.setDrawColor(180),e.rect(c,d,r,o-c-d),t.columns===2&&e.rect(c+r+t.gutter,d,r,o-c-d),e.setFont(i,"normal"),e.setFontSize(9),e.text(`Plan: ${t.columns} col • size ${t.lyricSizePt}pt • singlePage=${t.layout.pages.length===1?"yes":"no"} • ${t.lyricFamily}/${t.chordFamily}`,c,o-c*.6)),g.columns.forEach(S=>{var z;let h=S.x,m=d;for(const f of S.blocks)if(f.type==="section")m+=k,e.setFont(i,"bold"),e.setFontSize(P),e.text(`[${f.header}]`,h,m),m+=P+4;else if(f.type==="line"){if((z=f.chords)!=null&&z.length){e.setFont(l,"bold"),e.setFontSize(t.chordSizePt);for(const x of f.chords)e.text(x.sym,h+x.x,m);m+=t.chordSizePt+F/2}e.setFont(i,"normal"),e.setFontSize(t.lyricSizePt),e.text(f.lyrics,h,m),m+=t.lyricSizePt+F}})})}async function B(e,t={}){const a=await W();let n={};try{n=await _(a)}catch{}const i={lyricFamily:n.lyricFamily||t.lyricFamily||"Helvetica",chordFamily:n.chordFamily||t.chordFamily||"Courier",...t};return C(a,b(e),i)}async function N(e,t){const a=await W();let n={};try{n=await _(a)}catch{}const i={lyricSizePt:Math.max(12,(t==null?void 0:t.lyricSizePt)||16),chordSizePt:Math.max(12,(t==null?void 0:t.chordSizePt)||16),margin:36,lyricFamily:n.lyricFamily||"Helvetica",chordFamily:n.chordFamily||"Courier",columns:(t==null?void 0:t.columns)===2?2:1},l=b(e),{plan:s}=C(a,l,i),o=e.title||l.title||"Untitled",c=e.key||l.key||"C";return D(a,s,{title:o,key:c}),a.setProperties({title:`${o} – GraceChords`}),a.save(`${o.replace(/\s+/g,"_")}.pdf`),{plan:s}}async function I(e,t={}){const a=await W();let n={};try{n=await _(a)}catch{}const i={lyricSizePt:Math.max(12,(t==null?void 0:t.lyricSizePt)||16),chordSizePt:Math.max(12,(t==null?void 0:t.chordSizePt)||16),margin:36,lyricFamily:n.lyricFamily||"Helvetica",chordFamily:n.chordFamily||"Courier",columns:(t==null?void 0:t.columns)===2?2:1},l=!!(t!=null&&t.includeTOC),s=t==null?void 0:t.coverImageDataUrl,o=e.map((r,g)=>{const u=b(r),{plan:S}=C(a,u,i),h=r.title||u.title||"Untitled",m=r.key||u.key||"C";return{raw:r,plan:S,title:h,key:m,num:r._songbookNum||g+1,origTitle:r._origTitle||h}}),c=a.internal.pageSize.getWidth(),w=a.internal.pageSize.getHeight(),y=i.margin,F=16,P=Math.floor((w-y*2-40)/F),k=l?Math.ceil(o.length/P):0;let d=1+(s?1:0)+k;const T=o.map(r=>{const g={num:r.num,title:r.origTitle,page:d};return d+=r.plan.layout.pages.length,g});if(s){try{a.addImage(s,"JPEG",0,0,c,w,void 0,"FAST")}catch{}(l||o.length)&&a.addPage()}if(l){a.setFont(i.lyricFamily,"bold"),a.setFontSize(24),a.text("Table of Contents",c/2,y+20,{align:"center"}),a.setFont(i.lyricFamily,"normal"),a.setFontSize(12);let r=y+40;T.forEach((g,u)=>{u>0&&u%P===0&&(a.addPage(),r=y);const S=`${g.num} ${g.title}`;a.text(S,y,r);const h=String(g.page),m=c-y,z=a.getTextWidth(S),f=a.getTextWidth(h),x=m-y-z-f-4;if(x>0){const M=a.getTextWidth("."),H=".".repeat(Math.max(0,Math.floor(x/M)));a.text(H,y+z+2,r)}a.text(h,m,r,{align:"right"}),r+=F}),o.length&&a.addPage()}o.forEach((r,g)=>{g>0&&a.addPage(),D(a,r.plan,{title:r.title,key:r.key})}),a.setProperties({title:(t==null?void 0:t.docTitle)||"GraceChords Setlist"}),a.save((t==null?void 0:t.fileName)||"GraceChords_Selection.pdf")}async function j(e,{includeTOC:t,coverImageDataUrl:a}={}){const n=e.map((l,s)=>({...l,title:`${s+1}. ${l.title}`,_songbookNum:s+1,_origTitle:l.title})),i=new Date().toISOString().slice(0,10).replace(/-/g,"");await I(n,{includeTOC:t,coverImageDataUrl:a,docTitle:"GraceChords Songbook",fileName:`songbook-${i}.pdf`})}export{v as chooseBestLayout,B as chooseBestLayoutAuto,I as downloadMultiSongPdf,N as downloadSingleSongPdf,j as downloadSongbookPdf,J as planSongLayout};
