import{r as n,j as e,I as de,B as m,v as me,P as A,a as ue,b as ge,C as he,A as pe,m as xe,g as G,d as fe,e as ye,f as je,h as Se,k as ve}from"./index-CxbwBe6L.js";import{r as U,m as be,a as P,p as we}from"./markdown-DhTLSAy7.js";const Ce="10401040";function Te(){const[u,g]=n.useState(!1),[x,S]=n.useState("");return u?e.jsx(ke,{}):e.jsxs("div",{className:"container",style:{maxWidth:480},children:[e.jsx("h1",{children:"Admin: Resources"}),e.jsx("p",{children:"Enter password to continue."}),e.jsxs("form",{onSubmit:h=>{h.preventDefault(),g(x===Ce)},children:[e.jsx(de,{id:"adminPw",type:"password",value:x,onChange:h=>S(h.target.value),placeholder:"Password"}),e.jsx("div",{style:{marginTop:8,display:"flex",justifyContent:"flex-end"},children:e.jsx(m,{variant:"primary",type:"submit",children:"Enter"})})]})]})}function ke({actions:u,onDraftChange:g,showGhTools:x=!0,heading:S="Admin: Resources",wrapInContainer:h=!0,panelize:K=!1}){const[E]=n.useState(()=>(U?.items||[]).slice().sort((t,a)=>(a.date||"").localeCompare(t.date||""))),[f,y]=n.useState(""),[s,o]=n.useState({title:"",author:"",date:new Date().toISOString().slice(0,10),tags:[],summary:""}),[c,v]=n.useState(""),[p,L]=n.useState(()=>{try{return localStorage.getItem("admin:editsAuthor")||""}catch{return""}});n.useEffect(()=>{try{localStorage.setItem("admin:editsAuthor",p||"")}catch{}},[p]);function b(){y(""),o({title:"",author:"",date:new Date().toISOString().slice(0,10),tags:[],summary:""}),v("")}async function V(t){if(!t)return;const i=`${"./".replace(/\/+$/,"")+"/"}resources/${t.slug}.md`,r=await xe(i),l=we(r);y(t.slug),o({title:String(l.meta.title||t.title||""),author:String(l.meta.author||t.author||""),date:String(l.meta.date||t.date||new Date().toISOString().slice(0,10)),tags:Array.isArray(l.meta.tags)?l.meta.tags:[],summary:String(l.meta.summary||t.summary||"")}),v(l.content||"")}function z(t){o(a=>({...a,title:t})),f||y(P(t))}function J(t){o(a=>({...a,author:t}))}function Y(t){o(a=>({...a,date:t}))}function q(t){const a=String(t||"").split(/[,;]/).map(i=>i.trim()).filter(Boolean);o(i=>({...i,tags:a}))}function Q(t){o(a=>({...a,summary:t}))}const X=n.useMemo(()=>be(c),[c]),[w,R]=n.useState([]),[Z,C]=n.useState(!1),[ee,B]=n.useState(!1),[O,te]=n.useState("main"),[M,T]=n.useState(null);function _(t=s,a=c){return["---",`title: "${(t.title||"").replace(/"/g,'\\"')}"`,`author: "${(t.author||"").replace(/"/g,'\\"')}"`,`date: "${t.date||""}"`,`tags: ${JSON.stringify(t.tags||[])} `,`summary: "${(t.summary||"").replace(/"/g,'\\"')}"`,"---",""].join(`
`)+(a||"")}function k(){const t=f||P(s.title||"untitled"),a=`${t}.md`,i=_(),r={filename:a,content:i,title:s.title,commitMsg:`${U?.items?.some(l=>l.slug===t)?"update":"add"}: ${a}`};R([r])}async function se(){try{const{default_branch:t}=await G({owner:"rwm6857",repo:"GraceChords"});if(te(t||"main"),!String(p||"").trim()){alert("Please enter your name in the Edits Author field before submitting.");return}w.length||k(),C(!0)}catch(t){alert(String(t?.message||t))}}async function ae({branchName:t,prTitle:a,prBody:i}){B(!0);try{const r="rwm6857",l="GraceChords",{sha:le}=await G({owner:r,repo:l});await fe({owner:r,repo:l,fromSha:le,newBranch:t});for(const d of w){const H=`public/resources/${d.filename}`,oe=await ye({owner:r,repo:l,path:H,ref:t}),ce=d.commitMsg&&d.commitMsg.trim()?d.commitMsg.trim():`add: ${d.filename}`;await je({owner:r,repo:l,branch:t,path:H,contentBase64:Se(d.content),message:ce,sha:oe})}const ie=`${i||""}${i?`

`:""}Submitted by: ${String(p||"").trim()}`,re=await ve({owner:r,repo:l,head:t,base:O,title:a,body:ie});window.open(re.html_url,"_blank","noopener"),R([]),C(!1)}finally{B(!1)}}const j=f||P(s.title||"untitled"),I=`${j}.md`,W=_(),D=E.some(t=>t.slug===j),N=n.useMemo(()=>({slug:j,filename:I,meta:s,body:c,content:W,isExisting:D}),[j,I,s,c,W,D]);n.useEffect(()=>{typeof g=="function"&&g(N)},[N,g]);const ne=typeof u=="function"?u({draft:N,newPost:b}):u,$=K?"gc-editor-panel":"card",F=e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:S}),x&&e.jsx("div",{className:$,style:{marginTop:12},children:e.jsxs("div",{className:"Row",style:{alignItems:"center",gap:8,flexWrap:"wrap"},children:[e.jsx("strong",{children:"GitHub:"}),e.jsxs("span",{children:["Token: ",M?`@${M.login}`:localStorage.getItem("ghToken")?"set":"not set"]}),e.jsx("button",{className:"btn",onClick:()=>{const t=prompt("Paste GitHub token (repo scope):","");t!==null&&localStorage.setItem("ghToken",t.trim())},children:"Set token"}),e.jsx("button",{className:"btn",onClick:()=>{localStorage.removeItem("ghToken"),T(null)},children:"Clear token"}),e.jsx("button",{className:"btn",onClick:async()=>{try{const t=await me();T(t),alert(`Token OK: ${t.login}`)}catch(t){T(null),alert(String(t?.message||t))}},children:"Validate"}),e.jsx("div",{className:"spacer"}),e.jsxs("label",{className:"Small",style:{display:"flex",alignItems:"center",gap:6},children:[e.jsxs("span",{children:["Edits Author ",e.jsx("span",{"aria-hidden":!0,style:{color:"#ef4444"},children:"*"})]}),e.jsx("input",{value:p,onChange:t=>L(t.target.value),placeholder:"Your name",style:{minWidth:180}})]})]})}),e.jsxs("div",{className:$,style:{marginTop:12},children:[e.jsx("strong",{children:"Existing posts"}),e.jsxs("div",{className:"Row Small",style:{marginTop:6,gap:8,flexWrap:"wrap"},children:[E.map(t=>e.jsx("button",{className:"gc-btn gc-btn--sm",onClick:()=>V(t),title:`Edit ${t.title}`,children:t.title},t.slug)),e.jsx("span",{className:"spacer"}),e.jsx(m,{onClick:b,iconLeft:e.jsx(A,{}),children:"New Post"})]})]}),e.jsxs("div",{className:$,style:{marginTop:12},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsxs("label",{children:["Title",e.jsx("input",{value:s.title,onChange:t=>z(t.target.value)})]}),e.jsxs("label",{children:["Author",e.jsx("input",{value:s.author,onChange:t=>J(t.target.value)})]}),e.jsxs("label",{children:["Date",e.jsx("input",{type:"date",value:s.date,onChange:t=>Y(t.target.value)})]}),e.jsxs("label",{children:["Tags (comma-separated)",e.jsx("input",{value:(s.tags||[]).join(", "),onChange:t=>q(t.target.value),placeholder:"leadership, vocals"})]}),e.jsxs("label",{children:["Summary",e.jsx("input",{value:s.summary,onChange:t=>Q(t.target.value)})]}),e.jsxs("label",{children:["Slug",e.jsx("input",{value:f,onChange:t=>y(t.target.value),placeholder:"auto from title"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginTop:10},children:[e.jsxs("div",{children:[e.jsx("div",{className:"Row Small",style:{justifyContent:"space-between"},children:e.jsx("strong",{children:"Content (Markdown)"})}),e.jsx("textarea",{value:c,onChange:t=>v(t.target.value),style:{width:"100%",minHeight:"50vh",fontFamily:'"Roboto Mono", ui-monospace, Menlo, Consolas, monospace'}})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Preview"}),e.jsxs("div",{className:"card",style:{minHeight:"50vh",overflow:"auto",padding:10},children:[e.jsxs("div",{className:"Small",style:{opacity:.9,marginBottom:6},children:[s.title?e.jsx("div",{children:e.jsx("strong",{children:s.title})}):null,e.jsxs("div",{children:["by ",s.author||"—"," • ",s.date||"—"]}),s.tags?.length?e.jsx("div",{className:"Small",style:{display:"flex",gap:6,flexWrap:"wrap",marginTop:4},children:s.tags.map(t=>e.jsx("span",{className:"gc-tag gc-tag--gray",children:t},t))}):null,s.summary?e.jsx("div",{style:{marginTop:4},children:s.summary}):null]}),e.jsx("div",{className:"PostBody",dangerouslySetInnerHTML:{__html:X}})]})]})]})]}),ne||e.jsxs(ue,{style:{position:"sticky",bottom:0,marginTop:12,display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsxs(m,{onClick:b,children:[e.jsx(A,{})," New"]}),e.jsxs(m,{onClick:k,children:[e.jsx(ge,{})," Validate"]}),e.jsxs(m,{onClick:k,children:[e.jsx(A,{})," Stage"]})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,minWidth:0},children:e.jsxs("label",{className:"Small",style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("span",{children:"Filename"}),e.jsx("input",{readOnly:!0,value:I,style:{width:320}})]})}),e.jsx("div",{style:{display:"flex",gap:8,alignItems:"center"},children:e.jsxs(m,{className:"gc-btn gc-btn--primary",onClick:se,children:[e.jsx(he,{})," Publish"]})})]}),e.jsx(pe,{open:Z,onClose:()=>C(!1),defaultBranch:O,staged:w,onCreate:ae,busy:ee})]});return h?e.jsx("div",{className:"container",style:{maxWidth:1100},children:F}):F}const $e=Object.freeze(Object.defineProperty({__proto__:null,default:Te},Symbol.toStringTag,{value:"Module"}));export{$e as A,ke as R};
