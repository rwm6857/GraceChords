const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./jspdf.es.min-DC0tIcnD.js","./index-BN4EzNLg.js","./index-Wri8gDRg.css"])))=>i.map(i=>d[i]);
import{_ as v}from"./index-BN4EzNLg.js";import{e as b}from"./fonts-OQpvcT7Z.js";import{chooseBestLayout as H,normalizeSongInput as $,DEFAULT_LAYOUT_OPT as k,columnHeights as G}from"./pdfLayout-BTB5Jmxg.js";import{planSongLayout as V}from"./pdfLayout-BTB5Jmxg.js";const I=typeof window<"u"&&(()=>{try{return localStorage.getItem("pdfDebug")==="1"}catch{return!1}})();async function M(){const{jsPDF:a}=await v(async()=>{const{jsPDF:e}=await import("./jspdf.es.min-DC0tIcnD.js").then(t=>t.j);return{jsPDF:e}},__vite__mapDeps([0,1,2]),import.meta.url);return new a({unit:"pt",format:"letter"})}function D(a,e,t){var n;a.internal.pageSize.getWidth(),a.internal.pageSize.getHeight();const l={...k,...t};return(n=e==null?void 0:e.meta)!=null&&n.capo&&(t==null?void 0:t.showCapo)!==!1&&(l.headerOffsetY=(l.headerOffsetY||k.headerOffsetY)+14),H(e)}function E(a,e,{title:t,key:l,capo:n,showCapo:h=!0}){const o=String(e.lyricFamily||"Helvetica"),y=String(e.chordFamily||"Courier"),P=a.internal.pageSize.getWidth(),f=a.internal.pageSize.getHeight(),c=e.margin,C=Math.max(22,e.lyricSizePt+6),T=Math.max(12,e.lyricSizePt-2),W=4,w=e.lyricSizePt,_=Math.round(e.lyricSizePt*.85),r=c+e.headerOffsetY,s=P-c*2,d=e.columns===2?(s-e.gutter)/2:s;e.layout.pages.forEach((x,z)=>{if(z>0&&a.addPage(),a.setFont(o,"bold"),a.setFontSize(C),a.text(t,c,c+24),a.setFont(o,"italic"),a.setFontSize(T),a.text(`Key: ${l||"—"}`,c,c+40),h&&typeof n=="number"&&a.text(`Capo: ${n}`,c,c+54),I){a.setDrawColor(180),a.rect(c,r,d,f-c-r),e.columns===2&&a.rect(c+d+e.gutter,r,d,f-c-r);const u=e.layout.pages[0];let g="";if(u){const i=G(u,e.lyricSizePt),F=f-c-r;let m=(i[0]||0)/F,S=1;e.columns===2&&(m=((i[0]||0)+(i[1]||0))/(2*F),S=1-Math.abs((i[0]||0)-(i[1]||0))/F),g=` • occ=${m.toFixed(2)} • bal=${S.toFixed(2)}`}a.setFont(o,"normal"),a.setFontSize(9),a.text(`Plan: ${e.columns} col • size ${e.lyricSizePt}pt • singlePage=${e.layout.pages.length===1?"yes":"no"}${g}`,c,f-c*.6)}x.columns.forEach(u=>{var F;let g=u.x,i=r;for(const m of u.blocks)if(m.type==="section")i+=_,a.setFont(o,"bold"),a.setFontSize(w),a.text(`[${m.header}]`,g,i),i+=w+4;else if(m.type==="line")if(m.comment){const S=Math.max(10,e.lyricSizePt-2);a.setFont(o,"italic"),a.setFontSize(S),a.setTextColor(120),a.text(m.comment,g,i),a.setTextColor(0),i+=S+3}else{if((F=m.chords)!=null&&F.length){a.setFont(y,"bold"),a.setFontSize(e.chordSizePt);for(const S of m.chords)a.text(S.sym,g+S.x,i);i+=e.chordSizePt+W/2}a.setFont(o,"normal"),a.setFontSize(e.lyricSizePt),a.text(m.lyrics,g,i),i+=e.lyricSizePt+W}})})}async function B(a,e={}){const t=await M();let l={};try{l=await b(t)}catch{}({lyricFamily:l.lyricFamily||e.lyricFamily,chordFamily:l.chordFamily||e.chordFamily,...e},t.internal.pageSize.getWidth()),t.internal.pageSize.getHeight();const n=$(a);return H(n)}async function O(a,e){var f;const t=await M();let l={};try{l=await b(t)}catch{}const n={lyricSizePt:Math.max(12,(e==null?void 0:e.lyricSizePt)||16),chordSizePt:Math.max(12,(e==null?void 0:e.chordSizePt)||16),margin:36,lyricFamily:l.lyricFamily||"Helvetica",chordFamily:l.chordFamily||"Courier",columns:(e==null?void 0:e.columns)===2?2:1,showCapo:e==null?void 0:e.showCapo},h=$(a),{plan:o}=D(t,h,n),y=a.title||h.title||"Untitled",P=a.key||h.key||"C";return E(t,o,{title:y,key:P,capo:(f=h.meta)==null?void 0:f.capo,showCapo:(e==null?void 0:e.showCapo)!==!1}),t.setProperties({title:`${y} – GraceChords`}),t.save(`${y.replace(/\s+/g,"_")}.pdf`),{plan:o}}async function L(a,e={}){const t=await M();let l={};try{l=await b(t)}catch{}const n={lyricSizePt:Math.max(12,(e==null?void 0:e.lyricSizePt)||16),chordSizePt:Math.max(12,(e==null?void 0:e.chordSizePt)||16),margin:36,lyricFamily:l.lyricFamily||"Helvetica",chordFamily:l.chordFamily||"Courier",columns:(e==null?void 0:e.columns)===2?2:1,showCapo:e==null?void 0:e.showCapo},h=!!(e!=null&&e.includeTOC),o=e==null?void 0:e.coverImageDataUrl,y=a.map((r,s)=>{var i;const d=$(r),{plan:x}=D(t,d,n),z=r.title||d.title||"Untitled",u=r.key||d.key||"C",g=(i=d.meta)==null?void 0:i.capo;return{raw:r,plan:x,title:z,key:u,capo:g,num:r._songbookNum||s+1,origTitle:r._origTitle||z}}),P=t.internal.pageSize.getWidth(),f=t.internal.pageSize.getHeight(),c=n.margin,C=16,T=Math.floor((f-c*2-40)/C),W=h?Math.ceil(y.length/T):0;let w=1+(o?1:0)+W;const _=y.map(r=>{const s={num:r.num,title:r.origTitle,page:w};return w+=r.plan.layout.pages.length,s});if(o){try{t.addImage(o,"JPEG",0,0,P,f,void 0,"FAST")}catch{}(h||y.length)&&t.addPage()}if(h){t.setFont(n.lyricFamily,"bold"),t.setFontSize(24),t.text("Table of Contents",P/2,c+20,{align:"center"}),t.setFont(n.lyricFamily,"normal"),t.setFontSize(12);let r=c+40;_.forEach((s,d)=>{d>0&&d%T===0&&(t.addPage(),r=c);const x=`${s.num} ${s.title}`;t.text(x,c,r);const z=String(s.page),u=P-c,g=t.getTextWidth(x),i=t.getTextWidth(z),F=u-c-g-i-4;if(F>0){const m=t.getTextWidth("."),S=".".repeat(Math.max(0,Math.floor(F/m)));t.text(S,c+g+2,r)}t.text(z,u,r,{align:"right"}),r+=C}),y.length&&t.addPage()}y.forEach((r,s)=>{s>0&&t.addPage(),E(t,r.plan,{title:r.title,key:r.key,capo:r.capo,showCapo:(e==null?void 0:e.showCapo)!==!1})}),t.setProperties({title:(e==null?void 0:e.docTitle)||"GraceChords Setlist"}),t.save((e==null?void 0:e.fileName)||"GraceChords_Selection.pdf")}async function j(a,{includeTOC:e,coverImageDataUrl:t}={}){const l=a.map((h,o)=>({...h,title:`${o+1}. ${h.title}`,_songbookNum:o+1,_origTitle:h.title})),n=new Date().toISOString().slice(0,10).replace(/-/g,"");await L(l,{includeTOC:e,coverImageDataUrl:t,docTitle:"GraceChords Songbook",fileName:`songbook-${n}.pdf`})}function K(a,e,t={lyrics:"Noto Sans",chords:"Noto Sans Mono",chordWeight:"bold"}){return _measureSection(a,{fontSize:e,lyricFamily:t.lyrics,chordFamily:t.chords,chordWeight:t.chordWeight||"bold"})}export{H as chooseBestLayout,B as chooseBestLayoutAuto,L as downloadMultiSongPdf,O as downloadSingleSongPdf,j as downloadSongbookPdf,K as measureSection,$ as normalizeSongInput,V as planSongLayout};
