const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./jspdf.es.min-D6AUrmNK.js","./index-raZiI3nL.js","./index-Wri8gDRg.css"])))=>i.map(i=>d[i]);
import{_ as D}from"./index-raZiI3nL.js";import{e as k}from"./fonts-OQpvcT7Z.js";import{chooseBestLayout as $,normalizeSongInput as _,DEFAULT_LAYOUT_OPT as H}from"./pdfLayout-Di6FuHgv.js";import{planSongLayout as R}from"./pdfLayout-Di6FuHgv.js";const E=typeof window<"u"&&(()=>{try{return localStorage.getItem("pdfDebug")==="1"}catch{return!1}})();async function M(){const{jsPDF:t}=await D(async()=>{const{jsPDF:e}=await import("./jspdf.es.min-D6AUrmNK.js").then(r=>r.j);return{jsPDF:e}},__vite__mapDeps([0,1,2]),import.meta.url);return new t({unit:"pt",format:"letter"})}function A(t,e,r){var w,C,T;t.internal.pageSize.getWidth();const s=t.internal.pageSize.getHeight(),n={...H,...r};(w=e==null?void 0:e.meta)!=null&&w.capo&&(r==null?void 0:r.showCapo)!==!1&&(n.headerOffsetY=(n.headerOffsetY||H.headerOffsetY)+14);const h=(n.margin||36)+(n.headerOffsetY||0),o=s-h-(n.margin||36),P=(i=>{if(Array.isArray(i==null?void 0:i.sections))return i.sections;if(Array.isArray(i==null?void 0:i.blocks)){const z=[];let a=null;for(const l of i.blocks){if(l.type==="section"){a={header:l.header||l.name||"Section",lines:[]},z.push(a);continue}a||(a={header:"Section",lines:[]},z.push(a)),l.type==="line"&&a.lines.push(l)}return z}return typeof(i==null?void 0:i.body)=="string"?i.body.split(/\n\s*\n/).map(a=>a.trim()).filter(Boolean).map((a,l)=>({header:`S${l+1}`,lines:a.split(/\r?\n/).filter(f=>f.trim().length)})):[{header:"S1",lines:[]}]})(e),S=i=>{const a=Math.round(i*.85);return P.map((l,f)=>{let d=a;const x=Array.isArray(l.lines)?l.lines:[];for(const m of x){const g=Array.isArray(m.chords)?m.chords.map(b=>b.sym).join(" "):"";g&&(t.setFont(n.chordFamily,"bold"),t.setFontSize(i),t.getTextWidth(g),d+=i+4/2);const y=typeof m.lyrics=="string"?m.lyrics:typeof m.text=="string"?m.text:"";t.setFont(n.lyricFamily,"normal"),t.setFontSize(i),t.getTextWidth(y),d+=i+4}return d<a+i&&(d=a+i),{id:f+1,type:"section",height:d}})};return $({pageContentHeight:o,hasColumnsHint:((C=e==null?void 0:e.meta)==null?void 0:C.columns)===2||((T=e==null?void 0:e.hints)==null?void 0:T.columns)===2,honorColumnBreaks:!0,measureSectionsForPt:S})}function v(t,e,{title:r,key:s,capo:n,showCapo:h=!0}){const o=String(e.lyricFamily||"Helvetica"),u=String(e.chordFamily||"Courier"),P=t.internal.pageSize.getWidth(),S=t.internal.pageSize.getHeight(),c=e.margin,w=Math.max(22,e.lyricSizePt+6),C=Math.max(12,e.lyricSizePt-2),T=4,i=e.lyricSizePt,z=Math.round(e.lyricSizePt*.85),a=c+e.headerOffsetY,l=P-c*2,f=e.columns===2?(l-e.gutter)/2:l;e.layout.pages.forEach((d,x)=>{if(x>0&&t.addPage(),t.setFont(o,"bold"),t.setFontSize(w),t.text(r,c,c+24),t.setFont(o,"italic"),t.setFontSize(C),t.text(`Key: ${s||"—"}`,c,c+40),h&&typeof n=="number"&&t.text(`Capo: ${n}`,c,c+54),E){t.setDrawColor(180),t.rect(c,a,f,S-c-a),e.columns===2&&t.rect(c+f+e.gutter,a,f,S-c-a),e.layout.pages.length,e.columns,t.setFont(o,"normal"),t.setFontSize(9);const m=e.debugFooter?e.debugFooter:`Plan: ${e.columns} col • size ${e.lyricSizePt}pt • singlePage=${e.layout.pages.length===1?"yes":"no"}`;t.text(m,c,S-c*.6)}d.columns.forEach(m=>{var b;let g=m.x,y=a;for(const F of m.blocks)if(F.type==="section")y+=z,t.setFont(o,"bold"),t.setFontSize(i),t.text(`[${F.header}]`,g,y),y+=i+4;else if(F.type==="line")if(F.comment){const W=Math.max(10,e.lyricSizePt-2);t.setFont(o,"italic"),t.setFontSize(W),t.setTextColor(120),t.text(F.comment,g,y),t.setTextColor(0),y+=W+3}else{if((b=F.chords)!=null&&b.length){t.setFont(u,"bold"),t.setFontSize(e.chordSizePt);for(const W of F.chords)t.text(W.sym,g+W.x,y);y+=e.chordSizePt+T/2}t.setFont(o,"normal"),t.setFontSize(e.lyricSizePt),t.text(F.lyrics,g,y),y+=e.lyricSizePt+T}})})}async function L(t,e={}){const r=await M();let s={};try{s=await k(r)}catch{}({lyricFamily:s.lyricFamily||e.lyricFamily,chordFamily:s.chordFamily||e.chordFamily,...e},r.internal.pageSize.getWidth()),r.internal.pageSize.getHeight();const n=_(t);return $(n)}async function N(t,e){var S;const r=await M();let s={};try{s=await k(r)}catch{}const n={lyricSizePt:Math.max(12,(e==null?void 0:e.lyricSizePt)||16),chordSizePt:Math.max(12,(e==null?void 0:e.chordSizePt)||16),margin:36,lyricFamily:s.lyricFamily||"Helvetica",chordFamily:s.chordFamily||"Courier",columns:(e==null?void 0:e.columns)===2?2:1,showCapo:e==null?void 0:e.showCapo},h=_(t),{plan:o}=A(r,h,n),u=t.title||h.title||"Untitled",P=t.key||h.key||"C";return v(r,o,{title:u,key:P,capo:(S=h.meta)==null?void 0:S.capo,showCapo:(e==null?void 0:e.showCapo)!==!1}),r.setProperties({title:`${u} – GraceChords`}),r.save(`${u.replace(/\s+/g,"_")}.pdf`),{plan:o}}async function G(t,e={}){const r=await M();let s={};try{s=await k(r)}catch{}const n={lyricSizePt:Math.max(12,(e==null?void 0:e.lyricSizePt)||16),chordSizePt:Math.max(12,(e==null?void 0:e.chordSizePt)||16),margin:36,lyricFamily:s.lyricFamily||"Helvetica",chordFamily:s.chordFamily||"Courier",columns:(e==null?void 0:e.columns)===2?2:1,showCapo:e==null?void 0:e.showCapo},h=!!(e!=null&&e.includeTOC),o=e==null?void 0:e.coverImageDataUrl,u=t.map((a,l)=>{var y;const f=_(a),{plan:d}=A(r,f,n),x=a.title||f.title||"Untitled",m=a.key||f.key||"C",g=(y=f.meta)==null?void 0:y.capo;return{raw:a,plan:d,title:x,key:m,capo:g,num:a._songbookNum||l+1,origTitle:a._origTitle||x}}),P=r.internal.pageSize.getWidth(),S=r.internal.pageSize.getHeight(),c=n.margin,w=16,C=Math.floor((S-c*2-40)/w),T=h?Math.ceil(u.length/C):0;let i=1+(o?1:0)+T;const z=u.map(a=>{const l={num:a.num,title:a.origTitle,page:i};return i+=a.plan.layout.pages.length,l});if(o){try{r.addImage(o,"JPEG",0,0,P,S,void 0,"FAST")}catch{}(h||u.length)&&r.addPage()}if(h){r.setFont(n.lyricFamily,"bold"),r.setFontSize(24),r.text("Table of Contents",P/2,c+20,{align:"center"}),r.setFont(n.lyricFamily,"normal"),r.setFontSize(12);let a=c+40;z.forEach((l,f)=>{f>0&&f%C===0&&(r.addPage(),a=c);const d=`${l.num} ${l.title}`;r.text(d,c,a);const x=String(l.page),m=P-c,g=r.getTextWidth(d),y=r.getTextWidth(x),b=m-c-g-y-4;if(b>0){const F=r.getTextWidth("."),W=".".repeat(Math.max(0,Math.floor(b/F)));r.text(W,c+g+2,a)}r.text(x,m,a,{align:"right"}),a+=w}),u.length&&r.addPage()}u.forEach((a,l)=>{l>0&&r.addPage(),v(r,a.plan,{title:a.title,key:a.key,capo:a.capo,showCapo:(e==null?void 0:e.showCapo)!==!1})}),r.setProperties({title:(e==null?void 0:e.docTitle)||"GraceChords Setlist"}),r.save((e==null?void 0:e.fileName)||"GraceChords_Selection.pdf")}async function U(t,{includeTOC:e,coverImageDataUrl:r}={}){const s=t.map((h,o)=>({...h,title:`${o+1}. ${h.title}`,_songbookNum:o+1,_origTitle:h.title})),n=new Date().toISOString().slice(0,10).replace(/-/g,"");await G(s,{includeTOC:e,coverImageDataUrl:r,docTitle:"GraceChords Songbook",fileName:`songbook-${n}.pdf`})}function O(t,e,r={lyrics:"Noto Sans",chords:"Noto Sans Mono",chordWeight:"bold"}){return _measureSection(t,{fontSize:e,lyricFamily:r.lyrics,chordFamily:r.chords,chordWeight:r.chordWeight||"bold"})}export{$ as chooseBestLayout,L as chooseBestLayoutAuto,G as downloadMultiSongPdf,N as downloadSingleSongPdf,U as downloadSongbookPdf,O as measureSection,_ as normalizeSongInput,R as planSongLayout};
