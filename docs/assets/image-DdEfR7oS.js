import{planSongLayout as p}from"./pdf-plan-DduNKW6E.js";import{a as M}from"./fonts-OQpvcT7Z.js";function w(t,{pxWidth:r,pxHeight:l,dpi:g=150}){const o=document.createElement("canvas");o.width=r,o.height=l;const e=o.getContext("2d");e.fillStyle="#fff",e.fillRect(0,0,o.width,o.height);const f=g/72;e.scale(f,f);const n=t.margin,y=Math.max(22,t.lyricSizePt+6),m=Math.max(12,t.lyricSizePt-2);e.fillStyle="#000",e.font=`bold ${y}px ${t.lyricFamily}`,e.fillText(t.title,n,n+24),e.font=`italic ${m}px ${t.lyricFamily}`,e.fillText(`Key: ${t.key||"â€”"}`,n,n+40);const i=4,u=t.lyricSizePt,h=Math.round(t.lyricSizePt*.85),x=n+t.headerOffsetY;return(t.layout.pages||[])[0].columns.forEach($=>{let a=$.x,c=x;$.blocks.forEach(s=>{var S;s.type==="section"?(c+=h,e.font=`bold ${u}px ${t.lyricFamily}`,e.fillText(`[${s.header}]`,a,c),c+=u+4):s.type==="line"&&((S=s.chords)!=null&&S.length&&(e.font=`bold ${t.chordSizePt}px ${t.chordFamily}`,s.chords.forEach(P=>e.fillText(P.sym,a+P.x,c)),c+=t.chordSizePt+i/2),e.font=`normal ${t.lyricSizePt}px ${t.lyricFamily}`,e.fillText(s.lyrics,a,c),c+=t.lyricSizePt+i)})}),o}async function F(t,r={}){const l=r.dpi||150,g=r.widthInches||8.5,o=r.heightInches||11,e=Math.round(g*l),f=Math.round(o*l),n=await M(),{lyricFamily:y,chordFamily:m}=n;let i=r.plan;if(!i){const d=document.createElement("canvas").getContext("2d");i=p(t,{lyricFamily:y,chordFamily:m},a=>c=>(d.font=`${a}px ${y}`,d.measureText(c||"").width),a=>c=>(d.font=`bold ${a}px ${m}`,d.measureText(c||"").width))}if(i.layout.pages.length>1)return{error:"MULTI_PAGE",plan:i};const u=w(i,{pxWidth:e,pxHeight:f,dpi:l}),h=document.createElement("a"),x=(r.slug||t.slug||t.title||"untitled").replace(/\s+/g,"_");return h.href=u.toDataURL("image/jpeg",.92),h.download=`${x}.jpg`,h.click(),{plan:i}}export{F as downloadSingleSongJpg,M as ensureCanvasFonts,w as renderPlanToCanvas};
