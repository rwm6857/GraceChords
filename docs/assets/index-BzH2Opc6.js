const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./jspdf.es.min-B_NOgtXP.js","./index-BzQzGhIP.js","./index-Wri8gDRg.css"])))=>i.map(i=>d[i]);
import{_ as L}from"./index-BzQzGhIP.js";import{e as _}from"./fonts-OQpvcT7Z.js";import{n as b,c as E,m as H,D}from"./pdfLayout-CMv9Ihfm.js";import{p as J}from"./pdfLayout-CMv9Ihfm.js";const G=typeof window<"u"&&(()=>{try{return localStorage.getItem("pdfDebug")==="1"}catch{return!1}})();async function M(){const{jsPDF:a}=await L(async()=>{const{jsPDF:e}=await import("./jspdf.es.min-B_NOgtXP.js").then(t=>t.j);return{jsPDF:e}},__vite__mapDeps([0,1,2]),import.meta.url);return new a({unit:"pt",format:"letter"})}function v(a,e,t){var s;const n=a.internal.pageSize.getWidth(),o=a.internal.pageSize.getHeight(),i={...D,...t,pageWidth:n,pageHeight:o};(s=e==null?void 0:e.meta)!=null&&s.capo&&(t==null?void 0:t.showCapo)!==!1&&(i.headerOffsetY=(i.headerOffsetY||D.headerOffsetY)+14);const l=H(a,i.lyricFamily,"normal"),h=H(a,i.chordFamily,"bold"),{plan:m}=E(e,i,l,h);return{plan:m}}function $(a,e,{title:t,key:n,capo:o,showCapo:i=!0}){const l=String(e.lyricFamily||"Helvetica"),h=String(e.chordFamily||"Courier"),m=a.internal.pageSize.getWidth(),s=a.internal.pageSize.getHeight(),r=e.margin,d=Math.max(22,e.lyricSizePt+6),g=Math.max(12,e.lyricSizePt-2),W=4,T=e.lyricSizePt,k=Math.round(e.lyricSizePt*.85),c=r+e.headerOffsetY,u=m-r*2,f=e.columns===2?(u-e.gutter)/2:u;e.layout.pages.forEach((F,C)=>{C>0&&a.addPage(),a.setFont(l,"bold"),a.setFontSize(d),a.text(t,r,r+24),a.setFont(l,"italic"),a.setFontSize(g),a.text(`Key: ${n||"—"}`,r,r+40),i&&typeof o=="number"&&a.text(`Capo: ${o}`,r,r+54),G&&(a.setDrawColor(180),a.rect(r,c,f,s-r-c),e.columns===2&&a.rect(r+f+e.gutter,c,f,s-r-c),e.layout.pages.length,e.columns,a.setFont(l,"normal"),a.setFontSize(9),a.text(e.debugFooter||"",r,s-r*.6)),F.columns.forEach(z=>{var x;let P=z.x,y=c;for(const S of z.blocks)if(S.type==="section")y+=k,a.setFont(l,"bold"),a.setFontSize(T),a.text(`[${S.header}]`,P,y),y+=T+4;else if(S.type==="line")if(S.comment){const w=Math.max(10,e.lyricSizePt-2);a.setFont(l,"italic"),a.setFontSize(w),a.setTextColor(120),a.text(S.comment,P,y),a.setTextColor(0),y+=w+3}else{if((x=S.chords)!=null&&x.length){a.setFont(h,"bold"),a.setFontSize(e.chordSizePt);for(const w of S.chords)a.text(w.sym,P+w.x,y);y+=e.chordSizePt+W/2}a.setFont(l,"normal"),a.setFontSize(e.lyricSizePt),a.text(S.lyrics,P,y),y+=e.lyricSizePt+W}})})}async function A(a,e={}){const t=await M();let n={};try{n=await _(t)}catch{}const o={lyricFamily:n.lyricFamily||e.lyricFamily||"Helvetica",chordFamily:n.chordFamily||e.chordFamily||"Courier",...e},i=t.internal.pageSize.getWidth(),l=t.internal.pageSize.getHeight(),h=d=>g=>g?g.length*(d*.6):0,m=d=>g=>{try{return t.setFont(o.lyricFamily,"normal"),t.setFontSize(d),t.getTextWidth(g||"")}catch{return h(d)(g)}},s=d=>g=>{try{return t.setFont(o.chordFamily,"bold"),t.setFontSize(d),t.getTextWidth(g||"")}catch{return h(d)(g)}},r=b(a);return E(r,{...o,pageWidth:i,pageHeight:l},m,s)}async function B(a,e){var r;const t=await M();let n={};try{n=await _(t)}catch{}const o={lyricSizePt:Math.max(12,(e==null?void 0:e.lyricSizePt)||16),chordSizePt:Math.max(12,(e==null?void 0:e.chordSizePt)||16),margin:36,lyricFamily:n.lyricFamily||"Helvetica",chordFamily:n.chordFamily||"Courier",columns:(e==null?void 0:e.columns)===2?2:1,showCapo:e==null?void 0:e.showCapo},i=b(a),l=v(t,i,o),h=l&&l.plan?l.plan:l,m=a.title||i.title||"Untitled",s=a.key||i.key||"C";return $(t,h,{title:m,key:s,capo:(r=i.meta)==null?void 0:r.capo,showCapo:(e==null?void 0:e.showCapo)!==!1}),t.setProperties({title:`${m} – GraceChords`}),t.save(`${m.replace(/\s+/g,"_")}.pdf`),{plan:h}}async function I(a,e={}){const t=await M();let n={};try{n=await _(t)}catch{}const o={lyricSizePt:Math.max(12,(e==null?void 0:e.lyricSizePt)||16),chordSizePt:Math.max(12,(e==null?void 0:e.chordSizePt)||16),margin:36,lyricFamily:n.lyricFamily||"Helvetica",chordFamily:n.chordFamily||"Courier",columns:(e==null?void 0:e.columns)===2?2:1,showCapo:e==null?void 0:e.showCapo},i=!!(e!=null&&e.includeTOC),l=e==null?void 0:e.coverImageDataUrl,h=a.map((c,u)=>{var x;const f=b(c),F=v(t,f,o),C=F&&F.plan?F.plan:F,z=c.title||f.title||"Untitled",P=c.key||f.key||"C",y=(x=f.meta)==null?void 0:x.capo;return{raw:c,plan:C,title:z,key:P,capo:y,num:c._songbookNum||u+1,origTitle:c._origTitle||z}}),m=t.internal.pageSize.getWidth(),s=t.internal.pageSize.getHeight(),r=o.margin,d=16,g=Math.floor((s-r*2-40)/d),W=i?Math.ceil(h.length/g):0;let T=1+(l?1:0)+W;const k=h.map(c=>{const u={num:c.num,title:c.origTitle,page:T};return T+=c.plan.layout.pages.length,u});if(l){try{t.addImage(l,"JPEG",0,0,m,s,void 0,"FAST")}catch{}(i||h.length)&&t.addPage()}if(i){t.setFont(o.lyricFamily,"bold"),t.setFontSize(24),t.text("Table of Contents",m/2,r+20,{align:"center"}),t.setFont(o.lyricFamily,"normal"),t.setFontSize(12);let c=r+40;k.forEach((u,f)=>{f>0&&f%g===0&&(t.addPage(),c=r);const F=`${u.num} ${u.title}`;t.text(F,r,c);const C=String(u.page),z=m-r,P=t.getTextWidth(F),y=t.getTextWidth(C),x=z-r-P-y-4;if(x>0){const S=t.getTextWidth("."),w=".".repeat(Math.max(0,Math.floor(x/S)));t.text(w,r+P+2,c)}t.text(C,z,c,{align:"right"}),c+=d}),h.length&&t.addPage()}h.forEach((c,u)=>{u>0&&t.addPage(),$(t,c.plan,{title:c.title,key:c.key,capo:c.capo,showCapo:(e==null?void 0:e.showCapo)!==!1})}),t.setProperties({title:(e==null?void 0:e.docTitle)||"GraceChords Setlist"}),t.save((e==null?void 0:e.fileName)||"GraceChords_Selection.pdf")}async function O(a,{includeTOC:e,coverImageDataUrl:t}={}){const n=a.map((i,l)=>({...i,title:`${l+1}. ${i.title}`,_songbookNum:l+1,_origTitle:i.title})),o=new Date().toISOString().slice(0,10).replace(/-/g,"");await I(n,{includeTOC:e,coverImageDataUrl:t,docTitle:"GraceChords Songbook",fileName:`songbook-${o}.pdf`})}function j(a,e,t={lyrics:"Noto Sans",chords:"Noto Sans Mono",chordWeight:"bold"}){return _measureSection(a,{fontSize:e,lyricFamily:t.lyrics,chordFamily:t.chords,chordWeight:t.chordWeight||"bold"})}export{E as chooseBestLayout,A as chooseBestLayoutAuto,I as downloadMultiSongPdf,B as downloadSingleSongPdf,O as downloadSongbookPdf,j as measureSection,b as normalizeSongInput,J as planSongLayout};
