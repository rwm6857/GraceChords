const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./jszip.min--FJUkU0Q.js","./index-CvWRXNDv.js","./index-DzN3YmhX.css","./index-zf49Y8u-.js"])))=>i.map(i=>d[i]);
import{_ as re,j as t,u as et,a as tt,b as nt,r as g,i as st,d as it,F as rt,B as v,c as ot,T as je,D as _,L as ve,e as Ne,M as Pe,S as at,C as lt,P as Te,f as ct,I as dt,g as $e,K as ut,A as ft,h as pt,k as mt,l as ht,m as yt,p as gt,s as xt,t as wt,n as St,o as bt,q as L}from"./index-CvWRXNDv.js";import{P as jt}from"./PageContainer-mZ36EUOO.js";const ke="gracechords.sets.v1";function Q(){try{const e=localStorage.getItem(ke);return e?JSON.parse(e):{sets:{}}}catch{return{sets:{}}}}function De(e){localStorage.setItem(ke,JSON.stringify(e))}function vt(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"id-"+Math.random().toString(36).slice(2)+Date.now().toString(36)}function O(){const{sets:e}=Q();return Object.values(e).sort((s,i)=>(i.updatedAt||0)-(s.updatedAt||0))}function Nt(e){const{sets:s}=Q();return s[e]||null}function Ie(e){const s=Date.now(),i={id:e.id||vt(),name:e.name?.trim()||"Untitled Set",items:Array.isArray(e.items)?e.items:[],createdAt:e.createdAt||s,updatedAt:s},r=Q();return r.sets[i.id]=i,De(r),i}function Pt(e){const s=Q();return s.sets[e]?(delete s.sets[e],De(s),!0):!1}const Tt="application/vnd.openxmlformats-officedocument.presentationml.slide+xml",$t="application/vnd.openxmlformats-officedocument.presentationml.notesSlide+xml",Z="http://schemas.openxmlformats.org/presentationml/2006/main",It="http://schemas.openxmlformats.org/officeDocument/2006/relationships",Ct=new DOMParser,Et=new XMLSerializer;function At(e){const s="setlist",i=String(e).trim();return i&&i.replace(/\s+/g,"_").replace(/[^A-Za-z0-9_.-]/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"")||s}async function Ce(e){const s=await fetch(e);if(!s.ok)throw new Error(`Failed to load PPTX: ${e}`);return s.arrayBuffer()}function R(e){const s=Ct.parseFromString(e,"application/xml"),i=s.getElementsByTagName("parsererror")[0];if(i)throw new Error(i.textContent||"Failed to parse XML");return s}function X(e){return Et.serializeToString(e)}function J(e){const s=String(e||"").match(/(\d+)$/);return s?Number(s[1]):0}function se(e,s){let i=0;return e.filter(r=>s.test(r)).forEach(r=>{const a=r.name.match(s);if(!a)return;const c=Number(a[1]);Number.isNaN(c)||(i=Math.max(i,c))}),i}function G(e,s,i){if(Array.from(e.getElementsByTagName("Override")).some(c=>c.getAttribute("PartName")===s))return;const a=e.createElement("Override");a.setAttribute("PartName",s),a.setAttribute("ContentType",i),e.documentElement.appendChild(a)}function ie(e,s){if(!s)return null;if(s.startsWith("/"))return s.slice(1);const i=e.split("/");i.pop();const r=s.split("/");for(const a of r)if(a==="..")i.pop();else{if(a===".")continue;i.push(a)}return i.join("/")}function V(e,s){const i=e.split("/");i.pop();const r=s.split("/");let a=0;for(;a<i.length&&a<r.length&&i[a]===r[a];)a++;const c=i.length-a,m=[];for(let w=0;w<c;w++)m.push("..");return m.push(...r.slice(a)),m.join("/")}function ee(e){const s=e.match(/^(.*\/)([^/]*?)(\d+)(\.[^.]+)$/);return s?{dir:s[1],prefix:s[2],number:Number(s[3]),ext:s[4]}:null}function q(e,s,i){const r=Number(e[s]||0);i>r&&(e[s]=i)}function te(e,s){const r=Number(e[s]||0)+1;return e[s]=r,r}async function Lt(e){const s="ppt/presentation.xml",i=await e.file(s).async("string"),r=R(i),a=r.getElementsByTagNameNS(Z,"sldIdLst")[0]||r.getElementsByTagName("p:sldIdLst")[0],m=(a?Array.from(a.getElementsByTagNameNS(Z,"sldId")).concat(Array.from(a.getElementsByTagName("p:sldId"))):[]).reduce((b,N)=>{const y=Number(N.getAttribute("id"));return Number.isNaN(y)?b:Math.max(b,y)},255),w="ppt/_rels/presentation.xml.rels",f=await e.file(w).async("string"),S=R(f),P=Array.from(S.getElementsByTagName("Relationship")).reduce((b,N)=>{const y=J(N.getAttribute("Id"));return Math.max(b,y)},0),u="[Content_Types].xml",T=await e.file(u).async("string"),E=R(T),$={};return e.filter(()=>!0).forEach(b=>{const N=ee(b.name);if(!N)return;const y=`${N.dir}${N.prefix}`;q($,y,N.number)}),q($,"ppt/slides/slide",se(e,/^ppt\/slides\/slide(\d+)\.xml$/)),q($,"ppt/notesSlides/notesSlide",se(e,/^ppt\/notesSlides\/notesSlide(\d+)\.xml$/)),q($,"ppt/media/image",se(e,/^ppt\/media\/image(\d+)\.[^.]+$/)),{zip:e,presentationXmlPath:s,presentationDoc:r,sldIdList:a,presentationRelsPath:w,presentationRelsDoc:S,contentTypesPath:u,contentTypesDoc:E,nextSlideId:m,nextRelId:P,counters:$}}function kt(e,s,i){const r=e.presentationRelsDoc.documentElement,a=e.presentationRelsDoc.createElement("Relationship");a.setAttribute("Id",i),a.setAttribute("Type","http://schemas.openxmlformats.org/officeDocument/2006/relationships/slide"),a.setAttribute("Target",`slides/slide${s}.xml`),r.appendChild(a)}function Dt(e,s){const i=e.presentationDoc,r=e.sldIdList||(()=>{const c=i.createElementNS(Z,"p:sldIdLst");return i.documentElement.appendChild(c),e.sldIdList=c,c})(),a=i.createElementNS(Z,"p:sldId");e.nextSlideId+=1,a.setAttribute("id",String(e.nextSlideId)),a.setAttributeNS(It,"r:id",s),r.appendChild(a)}async function _t(e,s,i,r){const a=await s.file(i).async("uint8array");e.file(r,a)}async function _e(e,s,i,r){const a=await s.file(i).async("string");e.file(r,a)}async function Rt(e,s,i,r,a){const c=ee(i);if(!c)return null;const m=`${c.dir}${c.prefix}`,w=te(e.counters,m),f=`${c.dir}${c.prefix}${w}${c.ext}`;await _e(e.zip,s,i,f),G(e.contentTypesDoc,`/${f}`,$t);const S=`${c.dir}_rels/${c.prefix}${c.number}${c.ext}.rels`,x=s.file(S)[0];if(x){const P=await x.async("string"),u=R(P),T=Array.from(u.getElementsByTagName("Relationship")),E=V(f,r);T.forEach(b=>{(b.getAttribute("Type")||"").endsWith("/slide")&&b.setAttribute("Target",E)});const $=`${c.dir}_rels/${c.prefix}${w}${c.ext}.rels`;e.zip.file($,X(u))}return a.set(i,f),f}async function Bt(e,s,i,r,a,c){const m=r.path,f=`ppt/slides/_rels/slide${r.number}.xml.rels`,S=s.file(f)[0];if(!S)return;const x=await S.async("string"),P=R(x),u=Array.from(P.getElementsByTagName("Relationship")),T=a;for(const $ of u){const b=$.getAttribute("Type")||"",N=$.getAttribute("Target")||"";if(N)if(b.endsWith("/notesSlide")){const y=ie(m,N);if(!y)continue;const C=c.get(y)||await Rt(e,s,y,a,c);if(!C)continue;const K=V(T,C);$.setAttribute("Target",K)}else if(b.includes("/image")||b.includes("/video")||b.includes("/audio")){const y=ie(m,N);if(!y)continue;const A=c.get(y)||await Kt(e,s,i,y,c);if(!A)continue;const C=V(T,A);$.setAttribute("Target",C)}else{const y=ie(m,N);if(!y||y.startsWith("ppt/slideLayouts")||y.startsWith("ppt/slideMasters")||!s.file(y)[0])continue;const A=c.get(y)||await Xt(e,s,i,y,c);if(!A)continue;const C=V(T,A);$.setAttribute("Target",C)}}const E=`ppt/slides/_rels/${a.split("/").pop()}.rels`;e.zip.file(E,X(P))}function Ee(e,s){if(!e)return null;const r=Array.from(e.getElementsByTagName("Override")).find(a=>a.getAttribute("PartName")===s);return r&&r.getAttribute("ContentType")||null}function Ot(e,s,i){if(!i||Array.from(e.getElementsByTagName("Default")).some(m=>m.getAttribute("Extension")===i))return;const a=Array.from(s?.getElementsByTagName?.("Default")||[]).find(m=>m.getAttribute("Extension")===i);if(!a)return;const c=e.createElement("Default");c.setAttribute("Extension",i),c.setAttribute("ContentType",a.getAttribute("ContentType")||""),e.documentElement.appendChild(c)}async function Xt(e,s,i,r,a){const c=ee(r);if(!c){if(!e.zip.file(r)[0]){const x=await s.file(r).async("string");e.zip.file(r,x);const P=Ee(i,`/${r}`);P&&G(e.contentTypesDoc,`/${r}`,P)}return a.set(r,r),r}const m=`${c.dir}${c.prefix}`,w=te(e.counters,m),f=`${c.dir}${c.prefix}${w}${c.ext}`;await _e(e.zip,s,r,f);const S=Ee(i,`/${r}`);return S&&G(e.contentTypesDoc,`/${f}`,S),a.set(r,f),f}async function Kt(e,s,i,r,a){const c=ee(r);if(!c)return null;const m=`${c.dir}${c.prefix}`,w=te(e.counters,m),f=`${c.dir}${c.prefix}${w}${c.ext}`;await _t(e.zip,s,r,f);const S=c.ext.startsWith(".")?c.ext.slice(1):"";return Ot(e.contentTypesDoc,i,S),a.set(r,f),f}async function Mt(e,s){const i=s.file(/^ppt\/slides\/slide\d+\.xml$/).sort((c,m)=>{const w=J(c.name),f=J(m.name);return w-f});if(!i.length)return;const r=await s.file("[Content_Types].xml").async("string"),a=R(r);for(let c=0;c<i.length;c++){const m=i[c],w=J(m.name),f=te(e.counters,"ppt/slides/slide"),S=`ppt/slides/slide${f}.xml`,x=await m.async("string");e.zip.file(S,x),G(e.contentTypesDoc,`/${S}`,Tt),e.nextRelId+=1;const P=`rId${e.nextRelId}`;kt(e,f,P),Dt(e,P);const u=new Map;u.set(m.name,S),await Bt(e,s,a,{path:m.name,number:w},S,u)}}function zt(e){e.zip.file(e.presentationXmlPath,X(e.presentationDoc)),e.zip.file(e.presentationRelsPath,X(e.presentationRelsDoc)),e.zip.file(e.contentTypesPath,X(e.contentTypesDoc))}function Ut(e,s){const i=document.createElement("a");i.href=URL.createObjectURL(e),i.download=s,i.rel="noopener",i.click(),URL.revokeObjectURL(i.href)}async function Ft(e=[],s="Setlist"){if(!Array.isArray(e)||e.length===0)throw new Error("No PPTX files to merge");const i=(await re(async()=>{const{default:x}=await import("./jszip.min--FJUkU0Q.js").then(P=>P.j);return{default:x}},__vite__mapDeps([0,1,2]),import.meta.url)).default,[r,...a]=e,c=await Ce(r),m=await i.loadAsync(c),w=await Lt(m);for(let x=0;x<a.length;x++){const P=await Ce(a[x]),u=await i.loadAsync(P);await Mt(w,u)}zt(w);const f=await m.generateAsync({type:"blob"}),S=At(s||"Setlist");Ut(f,`${S}.pptx`)}function Wt(e){const s=e||"/";return s.endsWith("/")?s:`${s}/`}function Yt(e){return e?e.slug?e.slug:e.filename?e.filename.replace(/\.chordpro$/i,""):e.title?e.title.trim().toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_.-]/g,""):"":""}async function qt(e={},s={}){const{name:i="Setlist",songs:r=[]}=e||{},{availablePptxMap:a=null,baseUrl:c="./",onEmpty:m}=s,w=Wt(c),f=[];for(const S of r){const x=Yt(S);x&&(a&&!a[x]||f.push(`${w}pptx/${x}.pptx`))}if(!f.length){typeof m=="function"&&m();return}await Ft(f,i)}function Ht({label:e,id:s,children:i,className:r="",...a}){return t.jsxs("label",{className:"gc-field",htmlFor:s,children:[e?t.jsx("span",{className:"gc-label",children:e}):null,t.jsx("span",{className:"gc-select",children:t.jsx("select",{id:s,className:r,...a,children:i})})]})}let Ae;const Le=()=>Ae||(Ae=re(()=>import("./index-zf49Y8u-.js").then(e=>e.i),__vite__mapDeps([3,1,2]),import.meta.url));function Jt(){try{if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID()}catch{}return`sel-${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`}function Re(e){if(!e)return null;const{id:s,toKey:i=""}=e;return s==null?null:{uid:Jt(),id:s,toKey:i}}function H(e=[]){return e.map(s=>Re(s)).filter(Boolean)}function Qt(){const{code:e,songIds:s}=et(),i=tt(),r=nt(),[a,c]=g.useState("New Setlist"),[m,w]=g.useState(""),[f,S]=g.useState([]),[x,P]=g.useState(()=>{try{return localStorage.getItem("pref:icpOnly")==="1"}catch{return!1}});g.useEffect(()=>{try{localStorage.setItem("pref:icpOnly",x?"1":"0")}catch{}},[x]);const[u,T]=g.useState([]),[E,$]=g.useState({}),[b,N]=g.useState(""),[y,A]=g.useState("");Object.keys(E).length;const[C,K]=g.useState(!1),[Be,Oe]=g.useState(()=>{try{return window.innerWidth<=640}catch{return!1}}),[Vt,Xe]=g.useState(()=>{try{return window.innerWidth<=820}catch{return!1}}),[M,Ke]=g.useState(()=>{try{return window.innerWidth<=900}catch{return!1}}),oe=g.useRef(""),ae=g.useRef(""),[z,U]=g.useState(null),[B,le]=g.useState(()=>O()),[ce,F]=g.useState(""),[Me,W]=g.useState(!1),[de,ue]=g.useState("");g.useEffect(()=>{const n=st?.items||[],l=new Set,d=[];for(const o of n)l.has(o.id)||(l.add(o.id),d.push(o));S(d)},[]),g.useEffect(()=>{let n=!1;async function l(){const d={};for(const o of u){const p=f.find(D=>D.id===o.id);if(!p)continue;const h=p.filename.replace(/\.chordpro$/i,""),j=`./pptx/${h}.pptx`;await ht(j,h)&&(d[h]=!0)}n||$(d)}return l(),()=>{n=!0}},[u,f]),g.useEffect(()=>{try{const n=document.documentElement,l=document.body;oe.current=n.style.overflowY||"",ae.current=l.style.overflowY||"",getComputedStyle(n).overflowY==="hidden"&&(n.style.overflowY=""),getComputedStyle(l).overflowY==="hidden"&&(l.style.overflowY="")}catch{}return()=>{try{document.documentElement.style.overflowY=oe.current,document.body.style.overflowY=ae.current}catch{}}},[]),g.useEffect(()=>{if(!e)return;const{entries:n,error:l}=it(e);if(l){alert(l),r("/setlist",{replace:!0});return}const d=n.map(h=>({id:h.id,toKey:h.toKey}));T(H(d));const o=d.map(h=>h.id).join(","),p=d.map(h=>encodeURIComponent(h.toKey||"")).join(",");r(`/setlist/${o}?toKeys=${p}`,{replace:!0})},[e]),g.useEffect(()=>{if(!s)return;const n=(s||"").split(",").map(p=>p.trim()).filter(Boolean);if(!n.length)return;const d=(new URLSearchParams(i.search||"").get("toKeys")||"").split(",").map(p=>decodeURIComponent(p)).filter(Boolean),o=n.map((p,h)=>({id:p,toKey:d[h]||""}));T(H(o))},[s,i.search]),g.useEffect(()=>{try{if(!Array.isArray(u))return;if(u.length===0){(e||s)&&r("/setlist",{replace:!0});return}const n=u.map(p=>p.id).join(","),l=u.map(p=>encodeURIComponent(p.toKey||"")).join(","),d=s||"",o=new URLSearchParams(i.search||"").get("toKeys")||"";(n!==d||l!==o)&&r(`/setlist/${n}?toKeys=${l}`,{replace:!0})}catch{}},[u.map(n=>`${n.id}:${n.toKey}`).join("|"),s,i.search,e]),g.useEffect(()=>{try{const n=localStorage.getItem("setlist");if(!n||O().length>0)return;const l=JSON.parse(n);if(l?.name||(l?.list?.length||0)>0){const d=Ie({name:l.name||"Imported Set",items:l.list||[]});le(O()),U(d.id),c(d.name),T(H(d.items||[])),F(d.id)}}catch{}},[]),g.useEffect(()=>{function n(){try{const l=window.innerWidth;Oe(l<=640),Xe(l<=820),Ke(l<=900)}catch{}}return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]);const ne=g.useMemo(()=>new rt(f,{keys:["title","tags"],threshold:.4}),[f]);function ze(n){return!x||(Array.isArray(n.tags)?n.tags.includes("ICP"):n.tags==="ICP")}const Ue=g.useMemo(()=>(m?ne.search(m).map(l=>l.item):f.slice().sort((l,d)=>l.title.localeCompare(d.title))).filter(ze),[m,ne,f,x]);function fe(n){if(!n)return;const l=Re({id:n.id,toKey:n.originalKey||n.key||"C"});T(d=>[...d,l])}function Fe(n){T(l=>l.filter(d=>d.uid!==n))}function pe(n,l){T(d=>{const o=d.findIndex(I=>I.uid===n);if(o<0)return d;const p=o+(l==="up"?-1:1);if(p<0||p>=d.length)return d;const h=d.slice(),[j]=h.splice(o,1);return h.splice(p,0,j),h})}function We(n,l){T(d=>{if(l<0||l>=d.length)return d;const o=d.findIndex(j=>j.uid===n);if(o<0||o===l)return d;const p=d.slice(),[h]=p.splice(o,1);return p.splice(l,0,h),p})}function Ye(n,l){T(d=>d.map(o=>o.uid===n?{...o,toKey:l}:o))}function me(n){le(O()),F(n||"")}function he(){U(null),c("New Setlist"),T([]),F("")}function qe(){const n=a?.trim()||"New Setlist",l=window.prompt("Save set as:",n);if(l===null)return;const d=String(l).trim()||"New Setlist";let o=z;if(!o){const j=(O()||[]).find(I=>(I.name||"")===d);j&&(o=j.id)}const p=u.map(({id:j,toKey:I})=>({id:j,toKey:I})),h=Ie({id:o,name:d,items:p});c(h.name),U(h.id),me(h.id)}function He(){const n=de||ce||"";if(!n){W(!1);return}const l=Nt(n);l&&(U(l.id),c(l.name||"New Setlist"),T(H(l.items||[])),F(l.id)),W(!1)}function Je(){const n=B[0]?.id||"";ue(ce||n),W(!0)}function Ve(){z&&window.confirm(`Delete set "${a}"? This cannot be undone.`)&&(Pt(z),he(),me(""))}async function ye(){K(!0);try{const{downloadMultiSongPdf:n}=await Le(),l=[];for(const d of u){const o=f.find(p=>p.id===d.id);if(o)try{const p=`./songs/${o.filename}`,h=await yt(p),j=gt(h),I=j.meta?.key||j.meta?.originalkey||o.originalKey||"C",D=xt(I,d.toKey||I),Ze=(j.sections||[]).map(Se=>({section:Se.label,lines:(Se.lines||[]).map(k=>k.instrumental?{instrumental:wt(k.instrumental,D)}:k.comment?{plain:k.comment,chordPositions:[],comment:k.comment}:{plain:k.lyrics||"",chordPositions:(k.chords||[]).map(be=>({sym:St(be.sym,D),index:be.index}))})})),Ge=o.filename.replace(/\.chordpro$/i,""),Qe=bt({title:j.meta?.title||o.title||Ge,key:d.toKey||I,capo:j.meta?.capo,lyricsBlocks:Ze});l.push(Qe)}catch(p){console.error(p),L(`Failed to process ${o.filename}`)}}l.length&&await n(l)}finally{K(!1)}}function Y(){Le()}async function ge(){try{const n=u.map(o=>o.id).join(","),l=u.map(o=>encodeURIComponent(o.toKey||"")).join(","),d=`${i.origin}${i.pathname}#/setlist/${n}?toKeys=${l}`;await navigator.clipboard.writeText(d);try{L?.("Link copied!")}catch{}}catch{alert("Failed to copy link")}}async function xe(){if(y)return;N(`Bundling 0/${u.length}…`);const n=(await re(async()=>{const{default:o}=await import("./jszip.min--FJUkU0Q.js").then(p=>p.j);return{default:o}},__vite__mapDeps([0,1,2]),import.meta.url)).default,l=new n;let d=0;for(let o=0;o<u.length;o++){const p=u[o],h=f.find(I=>I.id===p.id);if(!h){N(`Bundling ${o+1}/${u.length}…`);continue}N(`Bundling ${o+1}/${u.length}…`);const j=h.filename.replace(/\.chordpro$/i,"");if(E[j])try{const I=await fetch(`./pptx/${j}.pptx`);if(!I.ok)continue;const D=await I.blob();d++,l.file(`${String(d).padStart(2,"0")}-${j}.pptx`,D)}catch{}}if(d>0){const o=await l.generateAsync({type:"blob"}),p=new Date().toISOString().slice(0,10).replace(/-/g,""),h=document.createElement("a");h.href=URL.createObjectURL(o),h.download=`setlist-pptx-${p}.zip`,h.click(),URL.revokeObjectURL(h.href)}else try{L&&L("No PPTX files found for selected songs")||alert("No PPTX files found for selected songs")}catch{}N("")}async function we(){if(!(b||y)){A("Combining…");try{const n=[];for(const l of u){const d=f.find(p=>p.id===l.id);if(!d)continue;const o=d.filename.replace(/\.chordpro$/i,"");E[o]&&n.push(d)}if(!n.length){try{L&&L("No PPTX files found for selected songs")||alert("No PPTX files found for selected songs")}catch{}return}await qt({name:a||"Setlist",songs:n},{baseUrl:"./"})}catch(n){console.error(n);try{L&&L("Failed to combine PPTX files")||alert("Failed to combine PPTX files")}catch{}}finally{A("")}}}return t.jsxs(jt,{children:[Me?t.jsx("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,.45)",zIndex:90},role:"dialog","aria-modal":"true",children:t.jsxs("div",{style:{background:"var(--card)",color:"var(--text)",border:"1px solid var(--line)",borderRadius:10,padding:16,width:"min(560px, 92vw)"},children:[t.jsx("h3",{style:{marginTop:0,marginBottom:8},children:"Load Set"}),B.length?t.jsxs("label",{style:{display:"block",margin:"8px 0"},children:["Select a saved set",t.jsx("select",{value:de,onChange:n=>ue(n.target.value),style:{width:"100%"},children:B.map(n=>t.jsxs("option",{value:n.id,children:[n.name," · ",new Date(n.updatedAt).toLocaleString()]},n.id))})]}):t.jsx("div",{className:"meta",children:"No saved sets yet."}),t.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:8,marginTop:12},children:[t.jsx(v,{onClick:()=>W(!1),children:"Cancel"}),t.jsx(v,{variant:"primary",onClick:He,disabled:!B.length,children:"Load"})]})]})}):null,t.jsx(ot,{busy:C}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:12,marginBottom:4},children:[t.jsx("div",{}),t.jsx("h1",{style:{margin:0},children:"Setlist Builder"}),t.jsx("div",{})]}),Be?t.jsx(je,{className:"card",style:{marginTop:8,position:"static"},children:t.jsxs("div",{className:"setlist-actions--mobile",style:{width:"100%"},children:[t.jsx(v,{variant:"primary",onClick:ye,onMouseEnter:Y,onFocus:Y,disabled:C||u.length===0,title:"Export set as a single PDF",iconLeft:t.jsx(_,{}),children:"PDF"}),t.jsx(v,{onClick:xe,disabled:u.length===0||!!b||!!y,title:u.length===0?"Add songs to export PPTX bundle":"Export PPTX bundle (ZIP) for selected songs",iconLeft:t.jsx(_,{}),children:"PPTX ZIP"}),t.jsx(v,{onClick:we,disabled:u.length===0||!!b||!!y,title:u.length===0?"Add songs to combine PPTX files":"Combine PPTX files into a single presentation",iconLeft:t.jsx(_,{}),children:y||"Single PPTX"}),t.jsx(v,{onClick:ge,title:"Copy shareable link",iconLeft:t.jsx(ve,{}),disabled:u.length===0,children:"Share"}),t.jsx(v,{as:Ne,to:u.length?`/worship/${u.map(n=>n.id).join(",")}?toKeys=${u.map(n=>encodeURIComponent(n.toKey)).join(",")}`:"/worship",title:"Open Worship Mode",iconLeft:t.jsx(Pe,{}),children:"Worship"})]})}):t.jsxs(je,{className:"card",style:{marginTop:8,position:"static"},children:[t.jsx("div",{style:{width:"100%",marginBottom:6},children:t.jsx("strong",{title:"Current set name",children:a||"New Setlist"})}),t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap",width:"100%"},children:[t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[t.jsxs(v,{size:"sm",variant:"secondary",onClick:qe,title:"Save set",iconLeft:t.jsx(at,{}),children:[" ",t.jsx("span",{className:"text-when-wide",children:"Save"})]}),t.jsxs(v,{size:"sm",variant:"secondary",onClick:Je,title:"Load saved set",iconLeft:t.jsx(lt,{}),disabled:!B.length,children:[" ",t.jsx("span",{className:"text-when-wide",children:"Load"})]}),t.jsxs(v,{size:"sm",variant:"secondary",onClick:he,title:"New set",iconLeft:t.jsx(Te,{}),children:[" ",t.jsx("span",{className:"text-when-wide",children:"New"})]}),t.jsxs(v,{size:"sm",variant:"secondary",onClick:Ve,disabled:!z,title:"Delete set",iconLeft:t.jsx(ct,{}),children:[" ",t.jsx("span",{className:"text-when-wide",children:"Delete"})]})]}),t.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[t.jsx(v,{variant:"primary",size:"md",onClick:ye,onMouseEnter:Y,onFocus:Y,disabled:C||u.length===0,title:"Export set as a single PDF",iconLeft:t.jsx(_,{}),children:C?"Exporting…":t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-when-wide",children:"Export PDF"}),t.jsx("span",{className:"text-when-narrow",children:"PDF"})]})}),t.jsx(v,{variant:"primary",size:"md",onClick:xe,disabled:u.length===0||!!b||!!y,title:u.length===0?"Add songs to export PPTX bundle":"Export PPTX bundle (ZIP) for selected songs",iconLeft:t.jsx(_,{}),children:b||t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-when-wide",children:"Export PPTX ZIP"}),t.jsx("span",{className:"text-when-narrow",children:"PPTX ZIP"})]})}),t.jsx(v,{variant:"primary",size:"md",onClick:we,disabled:u.length===0||!!b||!!y,title:u.length===0?"Add songs to combine PPTX files":"Combine PPTX files into a single presentation",iconLeft:t.jsx(_,{}),children:y||t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-when-wide",children:"Single PPTX"}),t.jsx("span",{className:"text-when-narrow",children:"Single"})]})}),t.jsx(v,{variant:"primary",size:"md",onClick:ge,title:"Copy shareable link",iconLeft:t.jsx(ve,{}),disabled:u.length===0,children:"Share Set"}),t.jsxs(v,{variant:"primary",size:"md",as:Ne,to:u.length?`/worship/${u.map(n=>n.id).join(",")}?toKeys=${u.map(n=>encodeURIComponent(n.toKey)).join(",")}`:"/worship",title:"Open Worship Mode",iconLeft:t.jsx(Pe,{}),children:[" ",t.jsx("span",{className:"text-when-wide",children:"Worship Mode"}),t.jsx("span",{className:"text-when-narrow",children:"Worship"})]})]})]})]}),t.jsxs("div",{className:"BuilderPage",style:{marginTop:8},children:[t.jsx("div",{className:"BuilderLeft",children:t.jsx("section",{className:"setlist-section setlist-add","data-role":"add",children:t.jsxs("div",{className:"card setlist-pane",children:[t.jsxs("div",{className:["BuilderHeader","section-header",M?"no-sticky":""].filter(Boolean).join(" "),style:{display:"flex",alignItems:"center",gap:8},children:[t.jsx("strong",{style:{whiteSpace:"nowrap"},children:"Add songs"}),t.jsx(dt,{value:m,onChange:n=>w(n.target.value),placeholder:"Search...",style:{flex:1,minWidth:0}}),t.jsxs("label",{className:"row",style:{gap:6,alignItems:"center"},children:[t.jsx("input",{type:"checkbox",checked:x,onChange:n=>P(n.target.checked)}),t.jsx("span",{className:"meta",title:"Limit results to songs tagged ICP",children:"ICP only"})]})]}),t.jsx("div",{className:["BuilderScroll","setlist-scroll","setlist-list",M?"no-pane-scroll":"pane-scroll","pane--addSongs"].join(" "),children:ne?t.jsx("div",{style:{display:"grid",gap:".5rem",gridTemplateColumns:"repeat(auto-fill, minmax(320px, 1fr))",marginTop:6},children:Ue.map(n=>t.jsx($e,{title:n.title,subtitle:`${n.originalKey||""}${n.tags?.length?` • ${n.tags.join(", ")}`:""}`,rightSlot:t.jsx(v,{"aria-label":"Add",title:"Add to set",variant:"primary",iconLeft:t.jsx(Te,{}),iconOnly:!0,onClick:l=>{l.stopPropagation(),fe(n)}}),onClick:()=>fe(n)},n.id))}):t.jsx("div",{children:"Loading search…"})})]})})}),t.jsx("div",{className:"BuilderRight",style:{minHeight:0,display:"flex",flexDirection:"column"},children:t.jsxs("section",{className:"setlist-section setlist-current","data-role":"current",children:[t.jsxs("div",{className:"card setlist-pane",children:[t.jsx("div",{className:["BuilderHeader","section-header",M?"no-sticky":""].filter(Boolean).join(" "),children:t.jsxs("strong",{children:["Current setlist (",u.length,")"]})}),t.jsx("div",{className:["BuilderScroll","setlist-scroll","setlist-list",M?"no-pane-scroll":"pane-scroll","pane--currentSet"].join(" "),style:{marginTop:6},children:u.map((n,l)=>{const d=f.find(o=>o.id===n.id);return d?t.jsx($e,{draggable:!0,onDragStart:o=>{o.dataTransfer.setData("text/plain",String(n.uid||n.id)),o.dataTransfer.effectAllowed="move"},onDragOver:o=>{o.preventDefault(),o.dataTransfer.dropEffect="move"},onDrop:o=>{o.preventDefault();const p=o.dataTransfer.getData("text/plain");We(p,l)},title:d.title,subtitle:`Original: ${d.originalKey||"—"}`,rightSlot:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[t.jsx(Ht,{value:n.toKey,onChange:o=>Ye(n.uid,o.target.value),children:ut.map(o=>t.jsx("option",{value:o,children:o},o))}),t.jsx(v,{onClick:()=>pe(n.uid,"up"),title:"Move up",iconLeft:t.jsx(ft,{})}),t.jsx(v,{onClick:()=>pe(n.uid,"down"),title:"Move down",iconLeft:t.jsx(pt,{})}),t.jsx(v,{onClick:()=>Fe(n.uid),title:"Remove",iconLeft:t.jsx(mt,{}),iconOnly:!0,style:{color:"#b91c1c"}})]})},n.uid||`${n.id}-${l}`):null})})]}),t.jsxs("div",{className:"print-only",style:{marginTop:16},children:[t.jsx("h2",{style:{fontSize:"20pt",margin:"0 0 8pt 0"},children:a}),t.jsx("ol",{style:{fontSize:"12pt",lineHeight:1.4,paddingLeft:"1.2em"},children:u.map((n,l)=>{const d=f.find(o=>o.id===n.id);return d?t.jsxs("li",{children:[d.title," — ",n.toKey||d.originalKey||"—"]},n.uid||`${n.id}-${l}`):null})})]})]})})]})]})}export{Qt as default};
