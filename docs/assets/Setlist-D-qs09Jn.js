const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./jszip.min-DQy2NDw2.js","./index-D0hn_-XN.js","./index-BDqcYvTh.css","./index-mcXb0Jom.js"])))=>i.map(i=>d[i]);
import{_ as le,j as n,u as st,a as it,b as rt,r as x,i as ot,d as at,F as lt,B as N,c as ct,T as ve,D as F,L as Pe,e as Ee,M as Ce,S as dt,C as ut,P as Ae,f as pt,I as mt,g as Me,K as ft,A as ht,h as gt,k as yt,l as xt,m as wt,p as St,s as bt,t as jt,n as Nt,o as Tt,q as B}from"./index-D0hn_-XN.js";import{P as It}from"./PageContainer-3vV88ylR.js";const ke="gracechords.sets.v1";function re(){try{const e=localStorage.getItem(ke);return e?JSON.parse(e):{sets:{}}}catch{return{sets:{}}}}function Be(e){localStorage.setItem(ke,JSON.stringify(e))}function vt(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"id-"+Math.random().toString(36).slice(2)+Date.now().toString(36)}function H(){const{sets:e}=re();return Object.values(e).sort((t,i)=>(i.updatedAt||0)-(t.updatedAt||0))}function Pt(e){const{sets:t}=re();return t[e]||null}function Le(e){const t=Date.now(),i={id:e.id||vt(),name:e.name?.trim()||"Untitled Set",items:Array.isArray(e.items)?e.items:[],createdAt:e.createdAt||t,updatedAt:t},c=re();return c.sets[i.id]=i,Be(c),i}function Et(e){const t=re();return t.sets[e]?(delete t.sets[e],Be(t),!0):!1}const Ct="application/vnd.openxmlformats-officedocument.presentationml.slide+xml",At="application/vnd.openxmlformats-officedocument.presentationml.slideMaster+xml",$="http://schemas.openxmlformats.org/presentationml/2006/main",ce="http://schemas.openxmlformats.org/officeDocument/2006/relationships",Mt="application/vnd.openxmlformats-officedocument.presentationml.notesMaster+xml",Lt=new DOMParser,$t=new XMLSerializer;function Rt(e){const t="setlist",i=String(e).trim();return i&&i.replace(/\s+/g,"_").replace(/[^A-Za-z0-9_.-]/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"")||t}async function $e(e){const t=await fetch(e);if(!t.ok)throw new Error(`Failed to load PPTX: ${e}`);return t.arrayBuffer()}function W(e){const t=Lt.parseFromString(e,"application/xml"),i=t.getElementsByTagName("parsererror")[0];if(i)throw new Error(i.textContent||"Failed to parse XML");return t}function J(e){return $t.serializeToString(e)}function ae(e){const t=String(e||"").match(/(\d+)$/);return t?Number(t[1]):0}function K(e,t){let i=0;return e.filter(c=>t.test(c)).forEach(c=>{const r=c.name.match(t);if(!r)return;const d=Number(r[1]);Number.isNaN(d)||(i=Math.max(i,d))}),i}function _e(e,t,i){if(Array.from(e.getElementsByTagName("Override")).some(d=>d.getAttribute("PartName")===t))return;const r=e.createElement("Override");r.setAttribute("PartName",t),r.setAttribute("ContentType",i),e.documentElement.appendChild(r)}function Oe(e,t){if(!t)return null;if(t.startsWith("/"))return t.slice(1);const i=e.split("/");i.pop();const c=t.split("/");for(const r of c)if(r==="..")i.pop();else{if(r===".")continue;i.push(r)}return i.join("/")}function Y(e,t){const i=e.split("/");i.pop();const c=t.split("/");let r=0;for(;r<i.length&&r<c.length&&i[r]===c[r];)r++;const d=i.length-r,m=[];for(let h=0;h<d;h++)m.push("..");return m.push(...c.slice(r)),m.join("/")}function Xe(e){const t=e.match(/^(.*\/)([^/]*?)(\d+)(\.[^.]+)$/);return t?{dir:t[1],prefix:t[2],number:Number(t[3]),ext:t[4]}:null}function _(e,t,i){const c=Number(e[t]||0);i>c&&(e[t]=i)}function Ke(e,t){const c=Number(e[t]||0)+1;return e[t]=c,c}function O(e,t){if(!e)return null;const i=e.file(t);return Array.isArray(i)?i.length?i[0]:null:i||null}function ie(e){const t=e.lastIndexOf("/"),i=t>=0?e.slice(0,t+1):"",c=t>=0?e.slice(t+1):e;return`${i}_rels/${c}.rels`}function Dt(e,t){if(!e||!t)return{contentType:"",fromOverride:!1,extension:""};const i=`/${t}`,r=Array.from(e.getElementsByTagName("Override")).find(p=>p.getAttribute("PartName")===i);if(r)return{contentType:r.getAttribute("ContentType")||"",fromOverride:!0,extension:t.split(".").pop()||""};const d=Array.from(e.getElementsByTagName("Default")),m=t.split(".").pop()||"",h=d.find(p=>p.getAttribute("Extension")===m);return h?{contentType:h.getAttribute("ContentType")||"",fromOverride:!1,extension:m}:{contentType:"",fromOverride:!1,extension:m}}function kt(e,t,i){if(!i||Array.from(e.getElementsByTagName("Default")).some(m=>m.getAttribute("Extension")===i))return;const r=Array.from(t?.getElementsByTagName?.("Default")||[]).find(m=>m.getAttribute("Extension")===i);if(!r)return;const d=e.createElement("Default");d.setAttribute("Extension",i),d.setAttribute("ContentType",r.getAttribute("ContentType")||""),e.documentElement.appendChild(d)}function Bt(e){return e?!/xml|text|application\/(.*\+xml)/i.test(e):!1}async function _t(e){const t="ppt/presentation.xml",i=O(e,t);if(!i)throw new Error("Base PPTX missing ppt/presentation.xml");const c=await i.async("string"),r=W(c),d=r.getElementsByTagNameNS($,"sldIdLst")[0]||r.getElementsByTagName("p:sldIdLst")[0],h=(d?Array.from(d.getElementsByTagNameNS($,"sldId")).concat(Array.from(d.getElementsByTagName("p:sldId"))):[]).reduce((A,M)=>{const I=Number(M.getAttribute("id"));return Number.isNaN(I)?A:Math.max(A,I)},255),p="ppt/_rels/presentation.xml.rels",w=O(e,p);if(!w)throw new Error("Base PPTX missing ppt/_rels/presentation.xml.rels");const g=await w.async("string"),v=W(g),S=Array.from(v.getElementsByTagName("Relationship")).reduce((A,M)=>{const I=ae(M.getAttribute("Id"));return Math.max(A,I)},0),P=r.getElementsByTagNameNS($,"sldMasterIdLst")[0]||r.getElementsByTagName("p:sldMasterIdLst")[0]||null,b=(P?Array.from(P.getElementsByTagNameNS($,"sldMasterId")).concat(Array.from(P.getElementsByTagName("p:sldMasterId"))):[]).reduce((A,M)=>{const I=Number(M.getAttribute("id"));return Number.isNaN(I)?A:Math.max(A,I)},2147483647),R=r.getElementsByTagNameNS($,"notesMasterIdLst")[0]||r.getElementsByTagName("p:notesMasterIdLst")[0]||null,T="[Content_Types].xml",U=O(e,T);if(!U)throw new Error("Base PPTX missing [Content_Types].xml");const D=await U.async("string"),k=W(D),C={};return e.filter(()=>!0).forEach(A=>{const M=Xe(A.name);if(!M)return;const I=`${M.dir}${M.prefix}`;_(C,I,M.number)}),_(C,"ppt/slides/slide",K(e,/^ppt\/slides\/slide(\d+)\.xml$/)),_(C,"ppt/notesSlides/notesSlide",K(e,/^ppt\/notesSlides\/notesSlide(\d+)\.xml$/)),_(C,"ppt/slideMasters/slideMaster",K(e,/^ppt\/slideMasters\/slideMaster(\d+)\.xml$/)),_(C,"ppt/slideLayouts/slideLayout",K(e,/^ppt\/slideLayouts\/slideLayout(\d+)\.xml$/)),_(C,"ppt/theme/theme",K(e,/^ppt\/theme\/theme(\d+)\.xml$/)),_(C,"ppt/notesMasters/notesMaster",K(e,/^ppt\/notesMasters\/notesMaster(\d+)\.xml$/)),_(C,"ppt/media/image",K(e,/^ppt\/media\/image(\d+)\.[^.]+$/)),{zip:e,presentationXmlPath:t,presentationDoc:r,sldIdList:d,sldMasterList:P,notesMasterList:R,presentationRelsPath:p,presentationRelsDoc:v,contentTypesPath:T,contentTypesDoc:k,nextSlideId:h,nextRelId:S,nextMasterId:b,counters:C,partMap:new Map,masterRelMap:new Map,notesMasterRelMap:new Map}}function Ot(e,t,i){const c=e.presentationRelsDoc.documentElement,r=e.presentationRelsDoc.createElement("Relationship");r.setAttribute("Id",i),r.setAttribute("Type","http://schemas.openxmlformats.org/officeDocument/2006/relationships/slide"),r.setAttribute("Target",`slides/slide${t}.xml`),c.appendChild(r)}function Xt(e,t){const i=e.presentationDoc,c=e.sldIdList||(()=>{const d=i.createElementNS($,"p:sldIdLst");return i.documentElement.appendChild(d),e.sldIdList=d,d})(),r=i.createElementNS($,"p:sldId");e.nextSlideId+=1,r.setAttribute("id",String(e.nextSlideId)),r.setAttributeNS(ce,"r:id",t),c.appendChild(r)}function Kt(e,t){if(e.masterRelMap.has(t))return e.masterRelMap.get(t);const i=e.presentationDoc,c=e.presentationRelsDoc;let r=e.sldMasterList;if(!r){r=i.createElementNS($,"p:sldMasterIdLst");const p=i.documentElement.firstChild;p?i.documentElement.insertBefore(r,p):i.documentElement.appendChild(r),e.sldMasterList=r}e.nextMasterId=Number(e.nextMasterId||2147483647),e.nextMasterId+=1,e.nextRelId+=1;const d=`rId${e.nextRelId}`,m=i.createElementNS($,"p:sldMasterId");m.setAttribute("id",String(e.nextMasterId)),m.setAttributeNS(ce,"r:id",d),r.appendChild(m);const h=c.createElement("Relationship");return h.setAttribute("Id",d),h.setAttribute("Type","http://schemas.openxmlformats.org/officeDocument/2006/relationships/slideMaster"),h.setAttribute("Target",Y("ppt/presentation.xml",t)),c.documentElement.appendChild(h),e.masterRelMap.set(t,d),d}function Ut(e,t){if(e.notesMasterRelMap.has(t))return e.notesMasterRelMap.get(t);const i=e.presentationDoc,c=e.presentationRelsDoc;let r=e.notesMasterList;if(!r){r=i.createElementNS($,"p:notesMasterIdLst");const p=i.documentElement,w=e.sldIdList||p.firstChild;w?p.insertBefore(r,w):p.appendChild(r),e.notesMasterList=r}e.nextRelId+=1;const d=`rId${e.nextRelId}`,m=i.createElementNS($,"p:notesMasterId");m.setAttributeNS(ce,"r:id",d),r.appendChild(m);const h=c.createElement("Relationship");return h.setAttribute("Id",d),h.setAttribute("Type","http://schemas.openxmlformats.org/officeDocument/2006/relationships/notesMaster"),h.setAttribute("Target",Y("ppt/presentation.xml",t)),c.documentElement.appendChild(h),e.notesMasterRelMap.set(t,d),d}async function se(e,t,i,c,r,d={}){if(!r)return null;const m=`${c}:${r}`;if(e.partMap.has(m))return e.partMap.get(m);const h=O(t,r);if(!h)return null;const p=Xe(r),w=Dt(i,r);let g;if(p){const P=`${p.dir}${p.prefix}`,L=Ke(e.counters,P);g=`${p.dir}${p.prefix}${L}${p.ext}`}else{if(O(e.zip,r))return e.partMap.set(m,r),r;g=r}e.partMap.set(m,g),w.fromOverride?_e(e.contentTypesDoc,`/${g}`,w.contentType):w.extension&&kt(e.contentTypesDoc,i,w.extension);const v=await h.async(Bt(w.contentType)?"uint8array":"string");e.zip.file(g,v);const u=ie(r),S=O(t,u);if(S){const P=await S.async("string"),L=W(P),b=Array.from(L.getElementsByTagName("Relationship"));for(const T of b){if((T.getAttribute("TargetMode")||"").toLowerCase()==="external")continue;const D=T.getAttribute("Target")||"",k=Oe(r,D);if(!k)continue;let C=null;if(typeof d.relationshipMutator=="function"){const I=await d.relationshipMutator({node:T,type:T.getAttribute("Type")||"",absolutePath:k,newPartPath:g,originalPartPath:r});if(I===!1)continue;I&&I.targetPath&&(C=I.targetPath)}const A=C||await se(e,t,i,c,k);if(!A)continue;const M=Y(g,A);T.setAttribute("Target",M)}const R=ie(g);e.zip.file(R,J(L))}return w.contentType===At?Kt(e,g):w.contentType===Mt&&Ut(e,g),g}async function zt(e,t,i,c,r,d){const m=ie(r),h=O(t,m);if(!h)return;const p=await h.async("string"),w=W(p),g=Array.from(w.getElementsByTagName("Relationship"));for(const u of g){const S=u.getAttribute("Type")||"",P=u.getAttribute("Target")||"";if(!P)continue;const L=Oe(r,P);if(L)if(S.endsWith("/notesSlide")){const b=await se(e,t,i,c,L,{relationshipMutator:({type:R})=>R.endsWith("/slide")?{targetPath:d}:null});if(!b)continue;u.setAttribute("Target",Y(d,b))}else if(S.includes("/image")||S.includes("/audio")||S.includes("/video")){const b=await se(e,t,i,c,L);if(!b)continue;u.setAttribute("Target",Y(d,b))}else{const b=await se(e,t,i,c,L);if(!b)continue;u.setAttribute("Target",Y(d,b))}}const v=ie(d);e.zip.file(v,J(w))}async function Ft(e,t,i){const c=t.file(/^ppt\/slides\/slide\d+\.xml$/).sort((m,h)=>{const p=ae(m.name),w=ae(h.name);return p-w});if(!c.length)return;const r=O(t,"[Content_Types].xml");if(!r)throw new Error("Source PPTX missing [Content_Types].xml");const d=W(await r.async("string"));for(const m of c){const h=Ke(e.counters,"ppt/slides/slide"),p=`ppt/slides/slide${h}.xml`,w=await m.async("string");e.zip.file(p,w),_e(e.contentTypesDoc,`/${p}`,Ct),e.nextRelId+=1;const g=`rId${e.nextRelId}`;Ot(e,h,g),Xt(e,g);const v=m.name;e.partMap.set(`${i}:${v}`,p),await zt(e,t,d,i,v,p)}}function Wt(e){e.zip.file(e.presentationXmlPath,J(e.presentationDoc)),e.zip.file(e.presentationRelsPath,J(e.presentationRelsDoc)),e.zip.file(e.contentTypesPath,J(e.contentTypesDoc))}function Yt(e,t){const i=document.createElement("a");i.href=URL.createObjectURL(e),i.download=t,i.rel="noopener",i.click(),URL.revokeObjectURL(i.href)}async function qt(e=[],t="Setlist"){if(!Array.isArray(e)||e.length===0)throw new Error("No PPTX files to merge");const i=(await le(async()=>{const{default:g}=await import("./jszip.min-DQy2NDw2.js").then(v=>v.j);return{default:g}},__vite__mapDeps([0,1,2]),import.meta.url)).default,[c,...r]=e,d=await $e(c),m=await i.loadAsync(d),h=await _t(m);for(let g=0;g<r.length;g++){const v=await $e(r[g]),u=await i.loadAsync(v);await Ft(h,u,`src${g+1}`)}Wt(h);const p=await m.generateAsync({type:"blob"}),w=Rt(t||"Setlist");Yt(p,`${w}.pptx`)}function Ht(e){const t=e||"/";return t.endsWith("/")?t:`${t}/`}function Jt(e){return e?e.slug?e.slug:e.filename?e.filename.replace(/\.chordpro$/i,""):e.title?e.title.trim().toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_.-]/g,""):"":""}async function Zt(e={},t={}){const{name:i="Setlist",songs:c=[]}=e||{},{availablePptxMap:r=null,baseUrl:d="./",onEmpty:m}=t,h=Ht(d),p=[];for(const w of c){const g=Jt(w);g&&(r&&!r[g]||p.push(`${h}pptx/${g}.pptx`))}if(!p.length){typeof m=="function"&&m();return}await qt(p,i)}function Vt({label:e,id:t,children:i,className:c="",...r}){return n.jsxs("label",{className:"gc-field",htmlFor:t,children:[e?n.jsx("span",{className:"gc-label",children:e}):null,n.jsx("span",{className:"gc-select",children:n.jsx("select",{id:t,className:c,...r,children:i})})]})}let Re;const De=()=>Re||(Re=le(()=>import("./index-mcXb0Jom.js").then(e=>e.i),__vite__mapDeps([3,1,2]),import.meta.url));function Gt(){try{if(typeof crypto<"u"&&crypto.randomUUID)return crypto.randomUUID()}catch{}return`sel-${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`}function Ue(e){if(!e)return null;const{id:t,toKey:i=""}=e;return t==null?null:{uid:Gt(),id:t,toKey:i}}function ne(e=[]){return e.map(t=>Ue(t)).filter(Boolean)}function tn(){const{code:e,songIds:t}=st(),i=it(),c=rt(),[r,d]=x.useState("New Setlist"),[m,h]=x.useState(""),[p,w]=x.useState([]),[g,v]=x.useState(()=>{try{return localStorage.getItem("pref:icpOnly")==="1"}catch{return!1}});x.useEffect(()=>{try{localStorage.setItem("pref:icpOnly",g?"1":"0")}catch{}},[g]);const[u,S]=x.useState([]),[P,L]=x.useState({}),[b,R]=x.useState(""),[T,U]=x.useState("");Object.keys(P).length;const[D,k]=x.useState(!1),[C,A]=x.useState(()=>{try{return window.innerWidth<=640}catch{return!1}}),[M,I]=x.useState(()=>{try{return window.innerWidth<=820}catch{return!1}}),[Z,ze]=x.useState(()=>{try{return window.innerWidth<=900}catch{return!1}}),de=x.useRef(""),ue=x.useRef(""),[V,G]=x.useState(null),[q,pe]=x.useState(()=>H()),[me,Q]=x.useState(""),[Fe,ee]=x.useState(!1),[fe,he]=x.useState("");x.useEffect(()=>{const s=ot?.items||[],a=new Set,l=[];for(const o of s)a.has(o.id)||(a.add(o.id),l.push(o));w(l)},[]),x.useEffect(()=>{let s=!1;async function a(){const l={};for(const o of u){const f=p.find(z=>z.id===o.id);if(!f)continue;const y=f.filename.replace(/\.chordpro$/i,""),j=`./pptx/${y}.pptx`;await xt(j,y)&&(l[y]=!0)}s||L(l)}return a(),()=>{s=!0}},[u,p]),x.useEffect(()=>{try{const s=document.documentElement,a=document.body;de.current=s.style.overflowY||"",ue.current=a.style.overflowY||"",getComputedStyle(s).overflowY==="hidden"&&(s.style.overflowY=""),getComputedStyle(a).overflowY==="hidden"&&(a.style.overflowY="")}catch{}return()=>{try{document.documentElement.style.overflowY=de.current,document.body.style.overflowY=ue.current}catch{}}},[]),x.useEffect(()=>{if(!e)return;const{entries:s,error:a}=at(e);if(a){alert(a),c("/setlist",{replace:!0});return}const l=s.map(y=>({id:y.id,toKey:y.toKey}));S(ne(l));const o=l.map(y=>y.id).join(","),f=l.map(y=>encodeURIComponent(y.toKey||"")).join(",");c(`/setlist/${o}?toKeys=${f}`,{replace:!0})},[e]),x.useEffect(()=>{if(!t)return;const s=(t||"").split(",").map(f=>f.trim()).filter(Boolean);if(!s.length)return;const l=(new URLSearchParams(i.search||"").get("toKeys")||"").split(",").map(f=>decodeURIComponent(f)).filter(Boolean),o=s.map((f,y)=>({id:f,toKey:l[y]||""}));S(ne(o))},[t,i.search]),x.useEffect(()=>{try{if(!Array.isArray(u))return;if(u.length===0){(e||t)&&c("/setlist",{replace:!0});return}const s=u.map(f=>f.id).join(","),a=u.map(f=>encodeURIComponent(f.toKey||"")).join(","),l=t||"",o=new URLSearchParams(i.search||"").get("toKeys")||"";(s!==l||a!==o)&&c(`/setlist/${s}?toKeys=${a}`,{replace:!0})}catch{}},[u.map(s=>`${s.id}:${s.toKey}`).join("|"),t,i.search,e]),x.useEffect(()=>{try{const s=localStorage.getItem("setlist");if(!s||H().length>0)return;const a=JSON.parse(s);if(a?.name||(a?.list?.length||0)>0){const l=Le({name:a.name||"Imported Set",items:a.list||[]});pe(H()),G(l.id),d(l.name),S(ne(l.items||[])),Q(l.id)}}catch{}},[]),x.useEffect(()=>{function s(){try{const a=window.innerWidth;A(a<=640),I(a<=820),ze(a<=900)}catch{}}return window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]);const oe=x.useMemo(()=>new lt(p,{keys:["title","tags"],threshold:.4}),[p]);function We(s){return!g||(Array.isArray(s.tags)?s.tags.includes("ICP"):s.tags==="ICP")}const Ye=x.useMemo(()=>(m?oe.search(m).map(a=>a.item):p.slice().sort((a,l)=>a.title.localeCompare(l.title))).filter(We),[m,oe,p,g]);function ge(s){if(!s)return;const a=Ue({id:s.id,toKey:s.originalKey||s.key||"C"});S(l=>[...l,a])}function qe(s){S(a=>a.filter(l=>l.uid!==s))}function ye(s,a){S(l=>{const o=l.findIndex(E=>E.uid===s);if(o<0)return l;const f=o+(a==="up"?-1:1);if(f<0||f>=l.length)return l;const y=l.slice(),[j]=y.splice(o,1);return y.splice(f,0,j),y})}function He(s,a){S(l=>{if(a<0||a>=l.length)return l;const o=l.findIndex(j=>j.uid===s);if(o<0||o===a)return l;const f=l.slice(),[y]=f.splice(o,1);return f.splice(a,0,y),f})}function Je(s,a){S(l=>l.map(o=>o.uid===s?{...o,toKey:a}:o))}function xe(s){pe(H()),Q(s||"")}function we(){G(null),d("New Setlist"),S([]),Q("")}function Ze(){const s=r?.trim()||"New Setlist",a=window.prompt("Save set as:",s);if(a===null)return;const l=String(a).trim()||"New Setlist";let o=V;if(!o){const j=(H()||[]).find(E=>(E.name||"")===l);j&&(o=j.id)}const f=u.map(({id:j,toKey:E})=>({id:j,toKey:E})),y=Le({id:o,name:l,items:f});d(y.name),G(y.id),xe(y.id)}function Ve(){const s=fe||me||"";if(!s){ee(!1);return}const a=Pt(s);a&&(G(a.id),d(a.name||"New Setlist"),S(ne(a.items||[])),Q(a.id)),ee(!1)}function Ge(){const s=q[0]?.id||"";he(me||s),ee(!0)}function Qe(){V&&window.confirm(`Delete set "${r}"? This cannot be undone.`)&&(Et(V),we(),xe(""))}async function Se(){k(!0);try{const{downloadMultiSongPdf:s}=await De(),a=[];for(const l of u){const o=p.find(f=>f.id===l.id);if(o)try{const f=`./songs/${o.filename}`,y=await wt(f),j=St(y),E=j.meta?.key||j.meta?.originalkey||o.originalKey||"C",z=bt(E,l.toKey||E),et=(j.sections||[]).map(Te=>({section:Te.label,lines:(Te.lines||[]).map(X=>X.instrumental?{instrumental:jt(X.instrumental,z)}:X.comment?{plain:X.comment,chordPositions:[],comment:X.comment}:{plain:X.lyrics||"",chordPositions:(X.chords||[]).map(Ie=>({sym:Nt(Ie.sym,z),index:Ie.index}))})})),tt=o.filename.replace(/\.chordpro$/i,""),nt=Tt({title:j.meta?.title||o.title||tt,key:l.toKey||E,capo:j.meta?.capo,lyricsBlocks:et});a.push(nt)}catch(f){console.error(f),B(`Failed to process ${o.filename}`)}}a.length&&await s(a)}finally{k(!1)}}function te(){De()}async function be(){try{const s=u.map(o=>o.id).join(","),a=u.map(o=>encodeURIComponent(o.toKey||"")).join(","),l=`${i.origin}${i.pathname}#/setlist/${s}?toKeys=${a}`;await navigator.clipboard.writeText(l);try{B?.("Link copied!")}catch{}}catch{alert("Failed to copy link")}}async function je(){if(T)return;R(`Bundling 0/${u.length}…`);const s=(await le(async()=>{const{default:o}=await import("./jszip.min-DQy2NDw2.js").then(f=>f.j);return{default:o}},__vite__mapDeps([0,1,2]),import.meta.url)).default,a=new s;let l=0;for(let o=0;o<u.length;o++){const f=u[o],y=p.find(E=>E.id===f.id);if(!y){R(`Bundling ${o+1}/${u.length}…`);continue}R(`Bundling ${o+1}/${u.length}…`);const j=y.filename.replace(/\.chordpro$/i,"");if(P[j])try{const E=await fetch(`./pptx/${j}.pptx`);if(!E.ok)continue;const z=await E.blob();l++,a.file(`${String(l).padStart(2,"0")}-${j}.pptx`,z)}catch{}}if(l>0){const o=await a.generateAsync({type:"blob"}),f=new Date().toISOString().slice(0,10).replace(/-/g,""),y=document.createElement("a");y.href=URL.createObjectURL(o),y.download=`setlist-pptx-${f}.zip`,y.click(),URL.revokeObjectURL(y.href)}else try{B&&B("No PPTX files found for selected songs")||alert("No PPTX files found for selected songs")}catch{}R("")}async function Ne(){if(!(b||T)){U("Combining…");try{const s=[];for(const a of u){const l=p.find(f=>f.id===a.id);if(!l)continue;const o=l.filename.replace(/\.chordpro$/i,"");P[o]&&s.push(l)}if(!s.length){try{B&&B("No PPTX files found for selected songs")||alert("No PPTX files found for selected songs")}catch{}return}await Zt({name:r||"Setlist",songs:s},{baseUrl:"./"})}catch(s){console.error(s);try{B&&B("Failed to combine PPTX files")||alert("Failed to combine PPTX files")}catch{}}finally{U("")}}}return n.jsxs(It,{children:[Fe?n.jsx("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,.45)",zIndex:90},role:"dialog","aria-modal":"true",children:n.jsxs("div",{style:{background:"var(--card)",color:"var(--text)",border:"1px solid var(--line)",borderRadius:10,padding:16,width:"min(560px, 92vw)"},children:[n.jsx("h3",{style:{marginTop:0,marginBottom:8},children:"Load Set"}),q.length?n.jsxs("label",{style:{display:"block",margin:"8px 0"},children:["Select a saved set",n.jsx("select",{value:fe,onChange:s=>he(s.target.value),style:{width:"100%"},children:q.map(s=>n.jsxs("option",{value:s.id,children:[s.name," · ",new Date(s.updatedAt).toLocaleString()]},s.id))})]}):n.jsx("div",{className:"meta",children:"No saved sets yet."}),n.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:8,marginTop:12},children:[n.jsx(N,{onClick:()=>ee(!1),children:"Cancel"}),n.jsx(N,{variant:"primary",onClick:Ve,disabled:!q.length,children:"Load"})]})]})}):null,n.jsx(ct,{busy:D}),n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:12,marginBottom:4},children:[n.jsx("div",{}),n.jsx("h1",{style:{margin:0},children:"Setlist Builder"}),n.jsx("div",{})]}),C?n.jsx(ve,{className:"card",style:{marginTop:8,position:"static"},children:n.jsxs("div",{className:"setlist-actions--mobile",style:{width:"100%"},children:[n.jsx(N,{variant:"primary",onClick:Se,onMouseEnter:te,onFocus:te,disabled:D||u.length===0,title:"Export set as a single PDF",iconLeft:n.jsx(F,{}),children:"PDF"}),n.jsx(N,{onClick:je,disabled:u.length===0||!!b||!!T,title:u.length===0?"Add songs to export PPTX bundle":"Export PPTX bundle (ZIP) for selected songs",iconLeft:n.jsx(F,{}),children:"PPTX ZIP"}),n.jsx(N,{onClick:Ne,disabled:u.length===0||!!b||!!T,title:u.length===0?"Add songs to combine PPTX files":"Combine PPTX files into a single presentation",iconLeft:n.jsx(F,{}),children:T||"Single PPTX"}),n.jsx(N,{onClick:be,title:"Copy shareable link",iconLeft:n.jsx(Pe,{}),disabled:u.length===0,children:"Share"}),n.jsx(N,{as:Ee,to:u.length?`/worship/${u.map(s=>s.id).join(",")}?toKeys=${u.map(s=>encodeURIComponent(s.toKey)).join(",")}`:"/worship",title:"Open Worship Mode",iconLeft:n.jsx(Ce,{}),children:"Worship"})]})}):n.jsxs(ve,{className:"card",style:{marginTop:8,position:"static"},children:[n.jsx("div",{style:{width:"100%",marginBottom:6},children:n.jsx("strong",{title:"Current set name",children:r||"New Setlist"})}),n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap",width:"100%"},children:[n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[n.jsxs(N,{size:"sm",variant:"secondary",onClick:Ze,title:"Save set",iconLeft:n.jsx(dt,{}),children:[" ",n.jsx("span",{className:"text-when-wide",children:"Save"})]}),n.jsxs(N,{size:"sm",variant:"secondary",onClick:Ge,title:"Load saved set",iconLeft:n.jsx(ut,{}),disabled:!q.length,children:[" ",n.jsx("span",{className:"text-when-wide",children:"Load"})]}),n.jsxs(N,{size:"sm",variant:"secondary",onClick:we,title:"New set",iconLeft:n.jsx(Ae,{}),children:[" ",n.jsx("span",{className:"text-when-wide",children:"New"})]}),n.jsxs(N,{size:"sm",variant:"secondary",onClick:Qe,disabled:!V,title:"Delete set",iconLeft:n.jsx(pt,{}),children:[" ",n.jsx("span",{className:"text-when-wide",children:"Delete"})]})]}),n.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[n.jsx(N,{variant:"primary",size:"md",onClick:Se,onMouseEnter:te,onFocus:te,disabled:D||u.length===0,title:"Export set as a single PDF",iconLeft:n.jsx(F,{}),children:D?"Exporting…":n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"text-when-wide",children:"Export PDF"}),n.jsx("span",{className:"text-when-narrow",children:"PDF"})]})}),n.jsx(N,{variant:"primary",size:"md",onClick:je,disabled:u.length===0||!!b||!!T,title:u.length===0?"Add songs to export PPTX bundle":"Export PPTX bundle (ZIP) for selected songs",iconLeft:n.jsx(F,{}),children:b||n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"text-when-wide",children:"Export PPTX ZIP"}),n.jsx("span",{className:"text-when-narrow",children:"PPTX ZIP"})]})}),n.jsx(N,{variant:"primary",size:"md",onClick:Ne,disabled:u.length===0||!!b||!!T,title:u.length===0?"Add songs to combine PPTX files":"Combine PPTX files into a single presentation",iconLeft:n.jsx(F,{}),children:T||n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"text-when-wide",children:"Single PPTX"}),n.jsx("span",{className:"text-when-narrow",children:"Single"})]})}),n.jsx(N,{variant:"primary",size:"md",onClick:be,title:"Copy shareable link",iconLeft:n.jsx(Pe,{}),disabled:u.length===0,children:"Share Set"}),n.jsxs(N,{variant:"primary",size:"md",as:Ee,to:u.length?`/worship/${u.map(s=>s.id).join(",")}?toKeys=${u.map(s=>encodeURIComponent(s.toKey)).join(",")}`:"/worship",title:"Open Worship Mode",iconLeft:n.jsx(Ce,{}),children:[" ",n.jsx("span",{className:"text-when-wide",children:"Worship Mode"}),n.jsx("span",{className:"text-when-narrow",children:"Worship"})]})]})]})]}),n.jsxs("div",{className:"BuilderPage",style:{marginTop:8},children:[n.jsx("div",{className:"BuilderLeft",children:n.jsx("section",{className:"setlist-section setlist-add","data-role":"add",children:n.jsxs("div",{className:"card setlist-pane",children:[n.jsxs("div",{className:["BuilderHeader","section-header",Z?"no-sticky":""].filter(Boolean).join(" "),style:{display:"flex",alignItems:"center",gap:8},children:[n.jsx("strong",{style:{whiteSpace:"nowrap"},children:"Add songs"}),n.jsx(mt,{value:m,onChange:s=>h(s.target.value),placeholder:"Search...",style:{flex:1,minWidth:0}}),n.jsxs("label",{className:"row",style:{gap:6,alignItems:"center"},children:[n.jsx("input",{type:"checkbox",checked:g,onChange:s=>v(s.target.checked)}),n.jsx("span",{className:"meta",title:"Limit results to songs tagged ICP",children:"ICP only"})]})]}),n.jsx("div",{className:["BuilderScroll","setlist-scroll","setlist-list",Z?"no-pane-scroll":"pane-scroll","pane--addSongs"].join(" "),children:oe?n.jsx("div",{style:{display:"grid",gap:".5rem",gridTemplateColumns:"repeat(auto-fill, minmax(320px, 1fr))",marginTop:6},children:Ye.map(s=>n.jsx(Me,{title:s.title,subtitle:`${s.originalKey||""}${s.tags?.length?` • ${s.tags.join(", ")}`:""}`,rightSlot:n.jsx(N,{"aria-label":"Add",title:"Add to set",variant:"primary",iconLeft:n.jsx(Ae,{}),iconOnly:!0,onClick:a=>{a.stopPropagation(),ge(s)}}),onClick:()=>ge(s)},s.id))}):n.jsx("div",{children:"Loading search…"})})]})})}),n.jsx("div",{className:"BuilderRight",style:{minHeight:0,display:"flex",flexDirection:"column"},children:n.jsxs("section",{className:"setlist-section setlist-current","data-role":"current",children:[n.jsxs("div",{className:"card setlist-pane",children:[n.jsx("div",{className:["BuilderHeader","section-header",Z?"no-sticky":""].filter(Boolean).join(" "),children:n.jsxs("strong",{children:["Current setlist (",u.length,")"]})}),n.jsx("div",{className:["BuilderScroll","setlist-scroll","setlist-list",Z?"no-pane-scroll":"pane-scroll","pane--currentSet"].join(" "),style:{marginTop:6},children:u.map((s,a)=>{const l=p.find(o=>o.id===s.id);return l?n.jsx(Me,{draggable:!0,onDragStart:o=>{o.dataTransfer.setData("text/plain",String(s.uid||s.id)),o.dataTransfer.effectAllowed="move"},onDragOver:o=>{o.preventDefault(),o.dataTransfer.dropEffect="move"},onDrop:o=>{o.preventDefault();const f=o.dataTransfer.getData("text/plain");He(f,a)},title:l.title,subtitle:`Original: ${l.originalKey||"—"}`,rightSlot:n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[n.jsx(Vt,{value:s.toKey,onChange:o=>Je(s.uid,o.target.value),children:ft.map(o=>n.jsx("option",{value:o,children:o},o))}),n.jsx(N,{onClick:()=>ye(s.uid,"up"),title:"Move up",iconLeft:n.jsx(ht,{})}),n.jsx(N,{onClick:()=>ye(s.uid,"down"),title:"Move down",iconLeft:n.jsx(gt,{})}),n.jsx(N,{onClick:()=>qe(s.uid),title:"Remove",iconLeft:n.jsx(yt,{}),iconOnly:!0,style:{color:"#b91c1c"}})]})},s.uid||`${s.id}-${a}`):null})})]}),n.jsxs("div",{className:"print-only",style:{marginTop:16},children:[n.jsx("h2",{style:{fontSize:"20pt",margin:"0 0 8pt 0"},children:r}),n.jsx("ol",{style:{fontSize:"12pt",lineHeight:1.4,paddingLeft:"1.2em"},children:u.map((s,a)=>{const l=p.find(o=>o.id===s.id);return l?n.jsxs("li",{children:[l.title," — ",s.toKey||l.originalKey||"—"]},s.uid||`${s.id}-${a}`):null})})]})]})})]})]})}export{tn as default};
