const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./jspdf.es.min-CmWzlFYx.js","./index-SUFm4BsU.js","./index-Wri8gDRg.css"])))=>i.map(i=>d[i]);
import{_ as v}from"./index-SUFm4BsU.js";import{e as k}from"./fonts-OQpvcT7Z.js";import{chooseBestLayout as $,normalizeSongInput as _,DEFAULT_LAYOUT_OPT as H}from"./pdfLayout-C9QtzmYy.js";import{planSongLayout as K}from"./pdfLayout-C9QtzmYy.js";const A=typeof window<"u"&&(()=>{try{return localStorage.getItem("pdfDebug")==="1"}catch{return!1}})();async function M(){const{jsPDF:r}=await v(async()=>{const{jsPDF:e}=await import("./jspdf.es.min-CmWzlFYx.js").then(t=>t.j);return{jsPDF:e}},__vite__mapDeps([0,1,2]),import.meta.url);return new r({unit:"pt",format:"letter"})}function D(r,e,t){var i,y,u;r.internal.pageSize.getWidth(),r.internal.pageSize.getHeight();const h={...H,...t};return(i=e==null?void 0:e.meta)!=null&&i.capo&&(t==null?void 0:t.showCapo)!==!1&&(h.headerOffsetY=(h.headerOffsetY||H.headerOffsetY)+14),(l=>{if(Array.isArray(l==null?void 0:l.sections))return l.sections;if(Array.isArray(l==null?void 0:l.blocks)){const a=[];let n=null;for(const o of l.blocks){if(o.type==="section"){n={header:o.header||o.name||"Section",lines:[]},a.push(n);continue}n||(n={header:"Section",lines:[]},a.push(n)),o.type==="line"&&n.lines.push(o)}return a}return typeof(l==null?void 0:l.body)=="string"?l.body.split(/\n\s*\n/).map(n=>n.trim()).filter(Boolean).map((n,o)=>({header:`S${o+1}`,lines:n.split(/\r?\n/).filter(C=>C.trim().length)})):[{header:"S1",lines:[]}]})(e),$({hasColumnsHint:((y=e==null?void 0:e.meta)==null?void 0:y.columns)===2||((u=e==null?void 0:e.hints)==null?void 0:u.columns)===2})}function E(r,e,{title:t,key:h,capo:m,showCapo:s=!0}){const i=String(e.lyricFamily||"Helvetica"),y=String(e.chordFamily||"Courier"),u=r.internal.pageSize.getWidth(),l=r.internal.pageSize.getHeight(),a=e.margin,n=Math.max(22,e.lyricSizePt+6),o=Math.max(12,e.lyricSizePt-2),C=4,b=e.lyricSizePt,W=Math.round(e.lyricSizePt*.85),c=a+e.headerOffsetY,f=u-a*2,g=e.columns===2?(f-e.gutter)/2:f;e.layout.pages.forEach((P,T)=>{if(T>0&&r.addPage(),r.setFont(i,"bold"),r.setFontSize(n),r.text(t,a,a+24),r.setFont(i,"italic"),r.setFontSize(o),r.text(`Key: ${h||"—"}`,a,a+40),s&&typeof m=="number"&&r.text(`Capo: ${m}`,a,a+54),A){r.setDrawColor(180),r.rect(a,c,g,l-a-c),e.columns===2&&r.rect(a+g+e.gutter,c,g,l-a-c),e.layout.pages.length,e.columns,r.setFont(i,"normal"),r.setFontSize(9);const S=e.debugFooter?e.debugFooter:`Plan: ${e.columns} col • size ${e.lyricSizePt}pt • singlePage=${e.layout.pages.length===1?"yes":"no"}`;r.text(S,a,l-a*.6)}P.columns.forEach(S=>{var x;let z=S.x,d=c;for(const F of S.blocks)if(F.type==="section")d+=W,r.setFont(i,"bold"),r.setFontSize(b),r.text(`[${F.header}]`,z,d),d+=b+4;else if(F.type==="line")if(F.comment){const w=Math.max(10,e.lyricSizePt-2);r.setFont(i,"italic"),r.setFontSize(w),r.setTextColor(120),r.text(F.comment,z,d),r.setTextColor(0),d+=w+3}else{if((x=F.chords)!=null&&x.length){r.setFont(y,"bold"),r.setFontSize(e.chordSizePt);for(const w of F.chords)r.text(w.sym,z+w.x,d);d+=e.chordSizePt+C/2}r.setFont(i,"normal"),r.setFontSize(e.lyricSizePt),r.text(F.lyrics,z,d),d+=e.lyricSizePt+C}})})}async function U(r,e={}){const t=await M();let h={};try{h=await k(t)}catch{}const m={lyricFamily:h.lyricFamily||e.lyricFamily||"Helvetica",chordFamily:h.chordFamily||e.chordFamily||"Courier",...e},s=t.internal.pageSize.getWidth(),i=t.internal.pageSize.getHeight(),y=n=>o=>o?o.length*(n*.6):0,u=n=>o=>{try{return t.setFont(m.lyricFamily,"normal"),t.setFontSize(n),t.getTextWidth(o||"")}catch{return y(n)(o)}},l=n=>o=>{try{return t.setFont(m.chordFamily,"bold"),t.setFontSize(n),t.getTextWidth(o||"")}catch{return y(n)(o)}},a=_(r);return $(a,{...m,pageWidth:s,pageHeight:i},u,l)}async function Y(r,e){var a;const t=await M();let h={};try{h=await k(t)}catch{}const m={lyricSizePt:Math.max(12,(e==null?void 0:e.lyricSizePt)||16),chordSizePt:Math.max(12,(e==null?void 0:e.chordSizePt)||16),margin:36,lyricFamily:h.lyricFamily||"Helvetica",chordFamily:h.chordFamily||"Courier",columns:(e==null?void 0:e.columns)===2?2:1,showCapo:e==null?void 0:e.showCapo},s=_(r),i=D(t,s,m),y=i&&i.plan?i.plan:i,u=r.title||s.title||"Untitled",l=r.key||s.key||"C";return E(t,y,{title:u,key:l,capo:(a=s.meta)==null?void 0:a.capo,showCapo:(e==null?void 0:e.showCapo)!==!1}),t.setProperties({title:`${u} – GraceChords`}),t.save(`${u.replace(/\s+/g,"_")}.pdf`),{plan:y}}async function G(r,e={}){const t=await M();let h={};try{h=await k(t)}catch{}const m={lyricSizePt:Math.max(12,(e==null?void 0:e.lyricSizePt)||16),chordSizePt:Math.max(12,(e==null?void 0:e.chordSizePt)||16),margin:36,lyricFamily:h.lyricFamily||"Helvetica",chordFamily:h.chordFamily||"Courier",columns:(e==null?void 0:e.columns)===2?2:1,showCapo:e==null?void 0:e.showCapo},s=!!(e!=null&&e.includeTOC),i=e==null?void 0:e.coverImageDataUrl,y=r.map((c,f)=>{var x;const g=_(c),P=D(t,g,m),T=P&&P.plan?P.plan:P,S=c.title||g.title||"Untitled",z=c.key||g.key||"C",d=(x=g.meta)==null?void 0:x.capo;return{raw:c,plan:T,title:S,key:z,capo:d,num:c._songbookNum||f+1,origTitle:c._origTitle||S}}),u=t.internal.pageSize.getWidth(),l=t.internal.pageSize.getHeight(),a=m.margin,n=16,o=Math.floor((l-a*2-40)/n),C=s?Math.ceil(y.length/o):0;let b=1+(i?1:0)+C;const W=y.map(c=>{const f={num:c.num,title:c.origTitle,page:b};return b+=c.plan.layout.pages.length,f});if(i){try{t.addImage(i,"JPEG",0,0,u,l,void 0,"FAST")}catch{}(s||y.length)&&t.addPage()}if(s){t.setFont(m.lyricFamily,"bold"),t.setFontSize(24),t.text("Table of Contents",u/2,a+20,{align:"center"}),t.setFont(m.lyricFamily,"normal"),t.setFontSize(12);let c=a+40;W.forEach((f,g)=>{g>0&&g%o===0&&(t.addPage(),c=a);const P=`${f.num} ${f.title}`;t.text(P,a,c);const T=String(f.page),S=u-a,z=t.getTextWidth(P),d=t.getTextWidth(T),x=S-a-z-d-4;if(x>0){const F=t.getTextWidth("."),w=".".repeat(Math.max(0,Math.floor(x/F)));t.text(w,a+z+2,c)}t.text(T,S,c,{align:"right"}),c+=n}),y.length&&t.addPage()}y.forEach((c,f)=>{f>0&&t.addPage(),E(t,c.plan,{title:c.title,key:c.key,capo:c.capo,showCapo:(e==null?void 0:e.showCapo)!==!1})}),t.setProperties({title:(e==null?void 0:e.docTitle)||"GraceChords Setlist"}),t.save((e==null?void 0:e.fileName)||"GraceChords_Selection.pdf")}async function B(r,{includeTOC:e,coverImageDataUrl:t}={}){const h=r.map((s,i)=>({...s,title:`${i+1}. ${s.title}`,_songbookNum:i+1,_origTitle:s.title})),m=new Date().toISOString().slice(0,10).replace(/-/g,"");await G(h,{includeTOC:e,coverImageDataUrl:t,docTitle:"GraceChords Songbook",fileName:`songbook-${m}.pdf`})}function O(r,e,t={lyrics:"Noto Sans",chords:"Noto Sans Mono",chordWeight:"bold"}){return _measureSection(r,{fontSize:e,lyricFamily:t.lyrics,chordFamily:t.chords,chordWeight:t.chordWeight||"bold"})}export{$ as chooseBestLayout,U as chooseBestLayoutAuto,G as downloadMultiSongPdf,Y as downloadSingleSongPdf,B as downloadSongbookPdf,O as measureSection,_ as normalizeSongInput,K as planSongLayout};
