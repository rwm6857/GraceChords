const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./jspdf.es.min-BFS6dweX.js","./index-B4XhguVE.js","./index-Wri8gDRg.css"])))=>i.map(i=>d[i]);
import{_ as I}from"./index-B4XhguVE.js";import{e as H}from"./fonts-OQpvcT7Z.js";import{n as _,c as D,m as M,D as $,a as L}from"./pdfLayout-uvODlOMF.js";import{p as q}from"./pdfLayout-uvODlOMF.js";const G=typeof window<"u"&&(()=>{try{return localStorage.getItem("pdfDebug")==="1"}catch{return!1}})();async function b(){const{jsPDF:a}=await I(async()=>{const{jsPDF:e}=await import("./jspdf.es.min-BFS6dweX.js").then(t=>t.j);return{jsPDF:e}},__vite__mapDeps([0,1,2]),import.meta.url);return new a({unit:"pt",format:"letter"})}function E(a,e,t){var y;const s=a.internal.pageSize.getWidth(),l=a.internal.pageSize.getHeight(),i={...$,...t,pageWidth:s,pageHeight:l};(y=e==null?void 0:e.meta)!=null&&y.capo&&(t==null?void 0:t.showCapo)!==!1&&(i.headerOffsetY=(i.headerOffsetY||$.headerOffsetY)+14);const n=M(a,i.lyricFamily,"normal"),m=M(a,i.chordFamily,"bold");return D(e,i,n,m)}function v(a,e,{title:t,key:s,capo:l,showCapo:i=!0}){const n=String(e.lyricFamily||"Helvetica"),m=String(e.chordFamily||"Courier"),y=a.internal.pageSize.getWidth(),d=a.internal.pageSize.getHeight(),c=e.margin,f=Math.max(22,e.lyricSizePt+6),h=Math.max(12,e.lyricSizePt-2),W=4,T=e.lyricSizePt,k=Math.round(e.lyricSizePt*.85),r=c+e.headerOffsetY,u=y-c*2,F=e.columns===2?(u-e.gutter)/2:u;e.layout.pages.forEach((C,w)=>{if(w>0&&a.addPage(),a.setFont(n,"bold"),a.setFontSize(f),a.text(t,c,c+24),a.setFont(n,"italic"),a.setFontSize(h),a.text(`Key: ${s||"—"}`,c,c+40),i&&typeof l=="number"&&a.text(`Capo: ${l}`,c,c+54),G){a.setDrawColor(180),a.rect(c,r,F,d-c-r),e.columns===2&&a.rect(c+F+e.gutter,r,F,d-c-r);const P=e.layout.pages[0];let S="";if(P){const o=L(P,e.lyricSizePt),x=d-c-r;let g=(o[0]||0)/x,z=1;e.columns===2&&(g=((o[0]||0)+(o[1]||0))/(2*x),z=1-Math.abs((o[0]||0)-(o[1]||0))/x),S=` • occ=${g.toFixed(2)} • bal=${z.toFixed(2)}`}a.setFont(n,"normal"),a.setFontSize(9),a.text(`Plan: ${e.columns} col • size ${e.lyricSizePt}pt • singlePage=${e.layout.pages.length===1?"yes":"no"}${S}`,c,d-c*.6)}C.columns.forEach(P=>{var x;let S=P.x,o=r;for(const g of P.blocks)if(g.type==="section")o+=k,a.setFont(n,"bold"),a.setFontSize(T),a.text(`[${g.header}]`,S,o),o+=T+4;else if(g.type==="line")if(g.comment){const z=Math.max(10,e.lyricSizePt-2);a.setFont(n,"italic"),a.setFontSize(z),a.setTextColor(120),a.text(g.comment,S,o),a.setTextColor(0),o+=z+3}else{if((x=g.chords)!=null&&x.length){a.setFont(m,"bold"),a.setFontSize(e.chordSizePt);for(const z of g.chords)a.text(z.sym,S+z.x,o);o+=e.chordSizePt+W/2}a.setFont(n,"normal"),a.setFontSize(e.lyricSizePt),a.text(g.lyrics,S,o),o+=e.lyricSizePt+W}})})}async function O(a,e={}){const t=await b();let s={};try{s=await H(t)}catch{}const l={lyricFamily:s.lyricFamily||e.lyricFamily||"Helvetica",chordFamily:s.chordFamily||e.chordFamily||"Courier",...e},i=t.internal.pageSize.getWidth(),n=t.internal.pageSize.getHeight(),m=f=>h=>h?h.length*(f*.6):0,y=f=>h=>{try{return t.setFont(l.lyricFamily,"normal"),t.setFontSize(f),t.getTextWidth(h||"")}catch{return m(f)(h)}},d=f=>h=>{try{return t.setFont(l.chordFamily,"bold"),t.setFontSize(f),t.getTextWidth(h||"")}catch{return m(f)(h)}},c=_(a);return D(c,{...l,pageWidth:i,pageHeight:n},y,d)}async function j(a,e){var d;const t=await b();let s={};try{s=await H(t)}catch{}const l={lyricSizePt:Math.max(12,(e==null?void 0:e.lyricSizePt)||16),chordSizePt:Math.max(12,(e==null?void 0:e.chordSizePt)||16),margin:36,lyricFamily:s.lyricFamily||"Helvetica",chordFamily:s.chordFamily||"Courier",columns:(e==null?void 0:e.columns)===2?2:1,showCapo:e==null?void 0:e.showCapo},i=_(a),{plan:n}=E(t,i,l),m=a.title||i.title||"Untitled",y=a.key||i.key||"C";return v(t,n,{title:m,key:y,capo:(d=i.meta)==null?void 0:d.capo,showCapo:(e==null?void 0:e.showCapo)!==!1}),t.setProperties({title:`${m} – GraceChords`}),t.save(`${m.replace(/\s+/g,"_")}.pdf`),{plan:n}}async function N(a,e={}){const t=await b();let s={};try{s=await H(t)}catch{}const l={lyricSizePt:Math.max(12,(e==null?void 0:e.lyricSizePt)||16),chordSizePt:Math.max(12,(e==null?void 0:e.chordSizePt)||16),margin:36,lyricFamily:s.lyricFamily||"Helvetica",chordFamily:s.chordFamily||"Courier",columns:(e==null?void 0:e.columns)===2?2:1,showCapo:e==null?void 0:e.showCapo},i=!!(e!=null&&e.includeTOC),n=e==null?void 0:e.coverImageDataUrl,m=a.map((r,u)=>{var o;const F=_(r),{plan:C}=E(t,F,l),w=r.title||F.title||"Untitled",P=r.key||F.key||"C",S=(o=F.meta)==null?void 0:o.capo;return{raw:r,plan:C,title:w,key:P,capo:S,num:r._songbookNum||u+1,origTitle:r._origTitle||w}}),y=t.internal.pageSize.getWidth(),d=t.internal.pageSize.getHeight(),c=l.margin,f=16,h=Math.floor((d-c*2-40)/f),W=i?Math.ceil(m.length/h):0;let T=1+(n?1:0)+W;const k=m.map(r=>{const u={num:r.num,title:r.origTitle,page:T};return T+=r.plan.layout.pages.length,u});if(n){try{t.addImage(n,"JPEG",0,0,y,d,void 0,"FAST")}catch{}(i||m.length)&&t.addPage()}if(i){t.setFont(l.lyricFamily,"bold"),t.setFontSize(24),t.text("Table of Contents",y/2,c+20,{align:"center"}),t.setFont(l.lyricFamily,"normal"),t.setFontSize(12);let r=c+40;k.forEach((u,F)=>{F>0&&F%h===0&&(t.addPage(),r=c);const C=`${u.num} ${u.title}`;t.text(C,c,r);const w=String(u.page),P=y-c,S=t.getTextWidth(C),o=t.getTextWidth(w),x=P-c-S-o-4;if(x>0){const g=t.getTextWidth("."),z=".".repeat(Math.max(0,Math.floor(x/g)));t.text(z,c+S+2,r)}t.text(w,P,r,{align:"right"}),r+=f}),m.length&&t.addPage()}m.forEach((r,u)=>{u>0&&t.addPage(),v(t,r.plan,{title:r.title,key:r.key,capo:r.capo,showCapo:(e==null?void 0:e.showCapo)!==!1})}),t.setProperties({title:(e==null?void 0:e.docTitle)||"GraceChords Setlist"}),t.save((e==null?void 0:e.fileName)||"GraceChords_Selection.pdf")}async function K(a,{includeTOC:e,coverImageDataUrl:t}={}){const s=a.map((i,n)=>({...i,title:`${n+1}. ${i.title}`,_songbookNum:n+1,_origTitle:i.title})),l=new Date().toISOString().slice(0,10).replace(/-/g,"");await N(s,{includeTOC:e,coverImageDataUrl:t,docTitle:"GraceChords Songbook",fileName:`songbook-${l}.pdf`})}function J(a,e={}){const{pt:t,colWidth:s,fonts:l={lyricsFamily:"Noto Sans",chordsFamily:"Noto Sans Mono"},columns:i=1}=e;return _measureSectionHeightInternal(a,{pt:t,width:s,lyricsFamily:l.lyricsFamily,chordsFamily:l.chordsFamily,columns:i})}export{D as chooseBestLayout,O as chooseBestLayoutAuto,N as downloadMultiSongPdf,j as downloadSingleSongPdf,K as downloadSongbookPdf,J as measureSectionHeight,_ as normalizeSongInput,q as planSongLayout};
