import{V as N,W as z,X as T}from"./index-kGqVNmLI.js";let x=null;async function k(){if(x)return x;const t="./".replace(/\/+$/,"/"),a=[{family:"NotoSans",weight:"400",style:"normal",file:"NotoSans-Regular.ttf"},{family:"NotoSans",weight:"700",style:"normal",file:"NotoSans-Bold.ttf"},{family:"NotoSans",weight:"400",style:"italic",file:"NotoSans-Italic.ttf"},{family:"NotoSans",weight:"700",style:"italic",file:"NotoSans-BoldItalic.ttf"},{family:"NotoSansMono",weight:"400",style:"normal",file:"NotoSansMono-Regular.ttf"},{family:"NotoSansMono",weight:"700",style:"normal",file:"NotoSansMono-Bold.ttf"}];return x=Promise.all(a.map(async i=>{const l=await new FontFace(i.family,`url(${t}fonts/${i.file})`,{weight:i.weight,style:i.style}).load();document.fonts.add(l)})).then(()=>({lyricFamily:"NotoSans",chordFamily:"NotoSansMono"})).catch(()=>({lyricFamily:"Helvetica",chordFamily:"Courier"})),x}function p(t,{pxWidth:a,pxHeight:i,dpi:S=150}){const l=document.createElement("canvas");l.width=a,l.height=i;const e=l.getContext("2d");e.fillStyle="#fff",e.fillRect(0,0,l.width,l.height);const g=S/72;e.scale(g,g);const r=t.margin,d=Math.max(22,t.lyricSizePt+6),u=Math.max(12,t.lyricSizePt-2);e.fillStyle="#000",e.font=`bold ${d}px ${t.lyricFamily}`,e.fillText(String(t.title||"Untitled"),r,r+24),e.font=`italic ${u}px ${t.lyricFamily}`;const s=String(t.key||"â€”");e.fillText(`Key of ${s}`,r,r+40);const y=4,m=t.lyricSizePt,$=Math.round(t.lyricSizePt*.85),h=r+(t.headerOffsetY||d*1.05+u*1.05+12);return(t.layout.pages||[])[0].columns.forEach(w=>{let c=w.x,o=h;w.blocks.forEach(n=>{if(n.type==="section")o+=$,e.font=`bold ${m}px ${t.lyricFamily}`,e.fillText(`[${n.header}]`,c,o),o+=m+4;else if(n.type==="instrumental"){const f=N(n.instrumental||{},{split:t.columns===2});f.length&&(e.font=`bold ${t.chordSizePt}px ${t.chordFamily}`,e.fillStyle="#000",f.forEach(M=>{e.fillText(M,c,o),o+=t.lyricSizePt+y}))}else if(n.type==="line"){if(n.comment){e.font=`italic ${t.lyricSizePt}px ${t.lyricFamily}`;const f=e.fillStyle;e.fillStyle="#6b7280",e.fillText(n.comment,c,o),e.fillStyle=f,o+=t.lyricSizePt+y;return}n.chords?.length&&(e.font=`bold ${t.chordSizePt}px ${t.chordFamily}`,n.chords.forEach(f=>e.fillText(f.sym,c+f.x,o)),o+=t.chordSizePt+y/2),e.font=`normal ${t.lyricSizePt}px ${t.lyricFamily}`,e.fillText(n.lyrics,c,o),o+=t.lyricSizePt+y}})}),l}async function C(t,a={}){const i=a.dpi||150,S=a.widthInches||8.5,l=a.heightInches||11,e=Math.round(S*i),g=Math.round(l*i),r=await k(),{lyricFamily:d,chordFamily:u}=r;let s=a.plan;if(!s){const h=document.createElement("canvas").getContext("2d");s=z(t,{lyricFamily:d,chordFamily:u},c=>o=>(h.font=`${c}px ${d}`,h.measureText(o||"").width),c=>o=>(h.font=`bold ${c}px ${u}`,h.measureText(o||"").width)).plan}if(s.layout.pages.length>1)return{error:"MULTI_PAGE",plan:s};const y=p(s,{pxWidth:e,pxHeight:g,dpi:i}),m=document.createElement("a"),$=T(String(a.slug||t.slug||t.title||"untitled"));return m.href=y.toDataURL("image/jpeg",.92),m.download=`${$}.jpg`,m.click(),{plan:s}}export{C as downloadSingleSongJpg,k as ensureCanvasFonts,p as renderPlanToCanvas};
