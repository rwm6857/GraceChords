const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./pdf-DHhV_TB1.js","./index-nRDsoA5z.js","./index-bad4BzDR.css","./fonts-OQpvcT7Z.js","./pdf-plan-DduNKW6E.js"])))=>i.map(i=>d[i]);
import{r as n,i as U,j as t,_ as V,f as J,p as Q,b as X}from"./index-nRDsoA5z.js";let L;const T=()=>L||(L=V(()=>import("./pdf-DHhV_TB1.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url));function p(r,i){return((r==null?void 0:r.title)||"").localeCompare((i==null?void 0:i.title)||"",void 0,{sensitivity:"base"})}function y(r){return[...new Set(r.filter(Boolean))].sort((i,f)=>String(i).localeCompare(String(f),void 0,{sensitivity:"base"}))}function Z(){const r=n.useMemo(()=>{var e;return(((e=U)==null?void 0:e.items)||[]).slice().sort(p)},[]),[i,f]=n.useState(""),[h,M]=n.useState("All"),[m,E]=n.useState("All"),[u,I]=n.useState("All"),_=n.useMemo(()=>y(r.flatMap(e=>Array.isArray(e.tags)?e.tags:e.tags?[e.tags]:[])),[r]),B=n.useMemo(()=>y(r.map(e=>e.country).filter(Boolean)),[r]),R=n.useMemo(()=>y(r.flatMap(e=>Array.isArray(e.authors)?e.authors:e.authors?[e.authors]:[])),[r]),c=n.useMemo(()=>{const e=i.trim().toLowerCase();let l=r;return e&&(l=l.filter(s=>{const a=(s.title||"").toLowerCase(),o=(Array.isArray(s.authors)?s.authors.join(", "):s.authors||"").toLowerCase();return a.includes(e)||o.includes(e)})),h!=="All"&&(l=l.filter(s=>Array.isArray(s.tags)?s.tags.includes(h):s.tags===h)),m!=="All"&&(l=l.filter(s=>s.country===m)),u!=="All"&&(l=l.filter(s=>Array.isArray(s.authors)?s.authors.includes(u):s.authors===u)),l.slice().sort(p)},[r,i,h,m,u]),[g,j]=n.useState(()=>new Set),d=n.useMemo(()=>c.filter(e=>g.has(e.id)).slice().sort(p),[c,g]),v=c.length,S=g.size;function $(e,l){j(s=>{const a=new Set(s);return l?a.add(e):a.delete(e),a})}function D(){c.length&&j(e=>{const l=new Set(e);for(const s of c)l.add(s.id);return l})}function H(){j(new Set)}const[b,O]=n.useState(!0),[z,N]=n.useState(null),[A,C]=n.useState(!1);async function q(){if(d.length){C(!0);try{const{downloadSongbookPdf:e,downloadMultiSongPdf:l}=await T(),s=[];for(const a of d)try{const o=`./songs/${a.filename}`,G=await J(o),x=Q(G),K=x.blocks.map(w=>({section:w.section,lines:(w.lines||[]).map(P=>({plain:P.text,chordPositions:(P.chords||[]).map(F=>({sym:F.sym,index:F.index}))}))}));s.push({title:x.meta.title||a.title,key:x.meta.key||x.meta.originalkey||a.originalKey||"C",lyricsBlocks:K})}catch(o){console.error(o),X(`Failed to process ${a.filename}`)}s.length&&(typeof e=="function"?await e(s,{includeTOC:b,cover:z}):await l(s,{lyricSizePt:16,chordSizePt:16}))}finally{C(!1)}}}function k(){T()}function W(e){var a;const l=(a=e.target.files)==null?void 0:a[0];if(!l){N(null);return}const s=new FileReader;s.onload=()=>N(String(s.result||"")),s.readAsDataURL(l)}return r.length===0?t.jsx("div",{className:"SongbookPage",children:t.jsx("section",{className:"SongPicker",children:t.jsxs("div",{className:"SongPickerHeader",children:[t.jsx("h3",{children:"No songs found"}),t.jsx("p",{className:"Small",children:"The song index is empty or failed to load."})]})})}):t.jsxs("div",{className:"SongbookPage",children:[t.jsxs("section",{className:"SongPicker",children:[t.jsxs("div",{className:"SongPickerHeader",children:[t.jsxs("div",{className:"Row",style:{gap:"1rem",alignItems:"flex-end",flexWrap:"wrap"},children:[t.jsxs("div",{className:"Field",style:{minWidth:220},children:[t.jsx("label",{htmlFor:"sb-search",children:"Search:"}),t.jsx("input",{id:"sb-search",type:"search",placeholder:"Title or author",value:i,onChange:e=>f(e.target.value),style:{width:"100%"}})]}),t.jsxs("div",{className:"Field",children:[t.jsx("label",{htmlFor:"sb-tag",children:"Tag:"}),t.jsxs("select",{id:"sb-tag",value:h,onChange:e=>M(e.target.value),children:[t.jsx("option",{children:"All"}),_.map(e=>t.jsx("option",{value:e,children:e},e))]})]}),t.jsxs("div",{className:"Field",children:[t.jsx("label",{htmlFor:"sb-country",children:"Country:"}),t.jsxs("select",{id:"sb-country",value:m,onChange:e=>E(e.target.value),children:[t.jsx("option",{children:"All"}),B.map(e=>t.jsx("option",{value:e,children:e},e))]})]}),t.jsxs("div",{className:"Field",children:[t.jsx("label",{htmlFor:"sb-author",children:"Author:"}),t.jsxs("select",{id:"sb-author",value:u,onChange:e=>I(e.target.value),children:[t.jsx("option",{children:"All"}),R.map(e=>t.jsx("option",{value:e,children:e},e))]})]}),t.jsxs("div",{className:"Field",style:{marginLeft:"auto",gap:".5rem"},children:[t.jsxs("button",{className:"Button",onClick:D,disabled:!v,children:["Select all (",v," filtered)"]}),t.jsx("button",{className:"Button",onClick:H,disabled:!S,children:"Clear"})]})]}),t.jsxs("div",{className:"Row Small",style:{marginTop:".5rem"},children:[t.jsx("strong",{children:S})," selected"]}),t.jsx("div",{className:"Hr"})]}),t.jsx("div",{className:"SongPickerScroll",role:"region","aria-label":"Song list",children:t.jsx("div",{className:"SongGrid",children:c.map(e=>{const l=g.has(e.id),s=Array.isArray(e.authors)?e.authors.join(", "):e.authors||"",a=Array.isArray(e.tags)?e.tags.join(", "):e.tags||"";return t.jsxs("label",{className:"SongCard",children:[t.jsx("input",{type:"checkbox",checked:l,onChange:o=>$(e.id,o.target.checked),"aria-label":`Select ${e.title}`}),t.jsxs("div",{className:"SongInfo",children:[t.jsx("div",{className:"SongTitle",children:e.title}),t.jsxs("div",{className:"SongMeta",children:[s||"—",a?` • ${a}`:"",e.country?` • ${e.country}`:""]})]})]},e.id)})})})]}),t.jsxs("aside",{className:"SongPreview",children:[t.jsxs("div",{className:"Row",style:{justifyContent:"space-between"},children:[t.jsxs("div",{className:"Field",children:[t.jsx("input",{id:"sb-toc",type:"checkbox",checked:b,onChange:e=>O(e.target.checked)}),t.jsx("label",{htmlFor:"sb-toc",children:"Include table of contents"})]}),t.jsxs("div",{className:"Field",children:[t.jsx("label",{htmlFor:"sb-cover",children:"Cover page (image):"}),t.jsx("input",{id:"sb-cover",className:"CoverInput",type:"file",accept:"image/*",onChange:W})]}),t.jsx("div",{className:"Field",style:{marginLeft:"auto"},children:t.jsx("button",{className:"Button",onClick:q,onMouseEnter:k,onFocus:k,disabled:!d.length||A,title:d.length?"Export PDF":"Select some songs first",children:A?"Exporting…":`Export PDF (${d.length})`})})]}),t.jsx("div",{className:"Hr"}),t.jsx("div",{className:"PreviewScroll",role:"region","aria-label":"Selected songs",children:t.jsx("ol",{className:"List",style:{listStyle:"decimal inside"},children:d.map(e=>t.jsxs("li",{children:[e.title,Array.isArray(e.authors)&&e.authors.length?t.jsxs("span",{className:"Small",children:[" — ",e.authors.join(", ")]}):null]},e.id))})})]})]})}export{Z as default};
